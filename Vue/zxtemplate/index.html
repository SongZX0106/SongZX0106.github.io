<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>使用vue3从0搭建后台管理系统 | SZX的开发笔记</title><meta name="keywords" content="vue3.0"><meta name="author" content="SZX"><meta name="copyright" content="SZX"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="项目简介源码地址 https:&#x2F;&#x2F;gitee.com&#x2F;szxio&#x2F;zx-vue-next 描述本项目是使用 vue3 来开发的后台管理系统模板。页面简单大方，使用悬浮式的风格，将菜单栏，顶部面包屑，中间操作区域等合理划分，功能丰富，支持主题颜色自定义，一键开启黑色主题，浅色、深色菜单动态切换等。路由采用动态路由，依托若依后端接口，拥有强大的权限管理功能。对若依感兴趣的点此跳转，希望各位小伙伴能够在">
<meta property="og:type" content="article">
<meta property="og:title" content="使用vue3从0搭建后台管理系统">
<meta property="og:url" content="https://songzx0106.github.io/Vue/zxtemplate/index.html">
<meta property="og:site_name" content="SZX的开发笔记">
<meta property="og:description" content="项目简介源码地址 https:&#x2F;&#x2F;gitee.com&#x2F;szxio&#x2F;zx-vue-next 描述本项目是使用 vue3 来开发的后台管理系统模板。页面简单大方，使用悬浮式的风格，将菜单栏，顶部面包屑，中间操作区域等合理划分，功能丰富，支持主题颜色自定义，一键开启黑色主题，浅色、深色菜单动态切换等。路由采用动态路由，依托若依后端接口，拥有强大的权限管理功能。对若依感兴趣的点此跳转，希望各位小伙伴能够在">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://songzx0106.github.io/images/ys17.jpg">
<meta property="article:published_time" content="2022-10-28T08:13:20.000Z">
<meta property="article:modified_time" content="2023-04-04T07:55:12.845Z">
<meta property="article:author" content="SZX">
<meta property="article:tag" content="vue3.0">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://songzx0106.github.io/images/ys17.jpg"><link rel="shortcut icon" href="/images/favicon.png"><link rel="canonical" href="https://songzx0106.github.io/Vue/zxtemplate/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":5000,"languages":{"author":"作者: SZX","link":"链接: ","source":"来源: SZX的开发笔记","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/jquery.min.js',
    justifiedGallery: {
      js: 'https://fastly.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://fastly.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://fastly.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-04 15:55:12'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2467717_jlvw8717b8.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/images/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">140</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">34</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/ys17.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">SZX的开发笔记</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">使用vue3从0搭建后台管理系统</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-28T08:13:20.000Z" title="发表于 2022-10-28 16:13:20">2022-10-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-04-04T07:55:12.845Z" title="更新于 2023-04-04 15:55:12">2023-04-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/vite/">vite</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">10.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>52分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="使用vue3从0搭建后台管理系统"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h2><h3 id="源码地址"><a href="#源码地址" class="headerlink" title="源码地址"></a>源码地址</h3><p> <a target="_blank" rel="noopener" href="https://gitee.com/szxio/zx-vue-next">https://gitee.com/szxio/zx-vue-next</a></p>
<h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>本项目是使用 vue3 来开发的后台管理系统模板。页面简单大方，使用悬浮式的风格，将菜单栏，顶部面包屑，中间操作区域等合理划分，功能丰富，支持主题颜色自定义，一键开启黑色主题，浅色、深色菜单动态切换等。路由采用动态路由，依托若依后端接口，拥有强大的权限管理功能。对若依感兴趣的<a target="_blank" rel="noopener" href="http://www.ruoyi.vip/">点此跳转</a>，希望各位小伙伴能够在学习本项目的过程中或多或少的有所收获。</p>
<p>如果感觉对你有所帮助，请点击 Star，感谢支持。</p>
<p>本文档同步至以下网站：</p>
<ul>
<li><a href="https://songzx0106.github.io/">https://songzx0106.github.io/</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/SongZhengxing_?type=blog">https://blog.csdn.net/SongZhengxing_?type=blog</a></li>
</ul>
<h3 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h3><ul>
<li>vue3</li>
<li>element-plus</li>
<li>Pinia</li>
<li>vue-router</li>
<li>js-cookie</li>
<li>sass</li>
<li>….</li>
</ul>
<h3 id="页面截图"><a href="#页面截图" class="headerlink" title="页面截图"></a>页面截图</h3><p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-28_15-43-10.png" alt="8558467.jpg"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-28_15-58-30.png" alt="8558467.jpg"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-28_15-59-22.png" alt="8558467.jpg"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-28_16-00-35.png" alt="8558467.jpg"></p>
<h2 id="本地运行"><a href="#本地运行" class="headerlink" title="本地运行"></a>本地运行</h2><p>本项目后端借用了若依的后台框架，在她的基础上稍作了修改。</p>
<p>可以在本地启动本项目中的 java 代码。再启动前端查看效果。</p>
<p>若依启动成功截图</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-28_16-01-25.png" alt="8558467.jpg"></p>
<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>使用 <a target="_blank" rel="noopener" href="https://cn.vitejs.dev/">vite</a> 来创建我们的工程</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm create vite@latest</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn create vite</span><br></pre></td></tr></table></figure>

<p>然后按照提示操作即可！</p>
<h2 id="elementui-plus"><a href="#elementui-plus" class="headerlink" title="elementui-plus"></a>elementui-plus</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>官方文档：<a target="_blank" rel="noopener" href="https://element-plus.gitee.io/zh-CN/">https://element-plus.gitee.io/zh-CN/</a></p>
<p>安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install element-plus --save</span><br></pre></td></tr></table></figure>

<p>引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ElementPlus <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = createApp(App)</span><br><span class="line"></span><br><span class="line">app.use(ElementPlus)</span><br><span class="line">app.mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="组件自动导入"><a href="#组件自动导入" class="headerlink" title="组件自动导入"></a>组件自动导入</h3><p>实现组件自动导入</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -D unplugin-vue-components unplugin-auto-import</span><br></pre></td></tr></table></figure>

<p>然后把下列代码插入到你的 <code>Vite</code>  的配置文件中</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> AutoImport <span class="keyword">from</span> <span class="string">&#x27;unplugin-auto-import/vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Components <span class="keyword">from</span> <span class="string">&#x27;unplugin-vue-components/vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; ElementPlusResolver &#125; <span class="keyword">from</span> <span class="string">&#x27;unplugin-vue-components/resolvers&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    AutoImport(&#123;</span><br><span class="line">      resolvers: [ElementPlusResolver()],</span><br><span class="line">    &#125;),</span><br><span class="line">    Components(&#123;</span><br><span class="line">      resolvers: [ElementPlusResolver()],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="注册所有图标"><a href="#注册所有图标" class="headerlink" title="注册所有图标"></a>注册所有图标</h3><p>安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NPM</span></span><br><span class="line">$ npm install @element-plus/icons-vue</span><br><span class="line"><span class="comment"># Yarn</span></span><br><span class="line">$ yarn add @element-plus/icons-vue</span><br><span class="line"><span class="comment"># pnpm</span></span><br><span class="line">$ pnpm install @element-plus/icons-vue</span><br></pre></td></tr></table></figure>

<p>注册所有组件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> ElementPlusIconsVue <span class="keyword">from</span> <span class="string">&#x27;@element-plus/icons-vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = createApp(App)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [key, component] <span class="keyword">of</span> <span class="built_in">Object</span>.entries(ElementPlusIconsVue)) &#123;</span><br><span class="line">  app.component(key, component)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="解决默认是英文的问题"><a href="#解决默认是英文的问题" class="headerlink" title="解决默认是英文的问题"></a>解决默认是英文的问题</h3><p>引入中文包：<code>import lang from &#39;element-plus/lib/locale/lang/zh-cn&#39;</code>，然后设置全局语言即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lang <span class="keyword">from</span> <span class="string">&#x27;element-plus/lib/locale/lang/zh-cn&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ElementPlus <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = createApp(App)</span><br><span class="line">app.use(ElementPlus, &#123;</span><br><span class="line">  locale: lang,</span><br><span class="line">&#125;)</span><br><span class="line">app.mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="添加Router"><a href="#添加Router" class="headerlink" title="添加Router"></a>添加Router</h2><p>官方文档：<a target="_blank" rel="noopener" href="https://router.vuejs.org/zh/">https://router.vuejs.org/zh/</a></p>
<p>安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue-router@4</span><br></pre></td></tr></table></figure>

<p>新建测试路由</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 1.从vue-router导出两个方法使用</span><br><span class="line">import &#123;createRouter, createWebHashHistory&#125; from &#39;vue-router&#39;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 2.声明菜单数组</span><br><span class="line">const routes &#x3D; [</span><br><span class="line">    &#123;</span><br><span class="line">        path: &#39;&#x2F;&#39;,</span><br><span class="line">        component: import(&quot;..&#x2F;view&#x2F;home&#x2F;home.vue&quot;)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        path: &#39;&#x2F;about&#39;,</span><br><span class="line">        component: import(&quot;..&#x2F;view&#x2F;about&#x2F;about.vue&quot;)</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 3. 创建路由实例并传递 &#96;routes&#96; 配置</span><br><span class="line">&#x2F;&#x2F; 你可以在这里输入更多的配置，但我们在这里</span><br><span class="line">&#x2F;&#x2F; 暂时保持简单</span><br><span class="line">const router &#x3D; createRouter(&#123;</span><br><span class="line">    &#x2F;&#x2F; 4. 内部提供了 history 模式的实现。为了简单起见，我们在这里使用 hash 模式。</span><br><span class="line">    history: createWebHashHistory(),</span><br><span class="line">    routes, &#x2F;&#x2F; &#96;routes: routes&#96; 的缩写</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 导出路由</span><br><span class="line">export default router;</span><br></pre></td></tr></table></figure>

<p>引入</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;./router/index&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = createApp(App)</span><br><span class="line">app.use(router)</span><br><span class="line">app.mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>修改App.vue</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-view</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="配置-路径别名"><a href="#配置-路径别名" class="headerlink" title="配置@路径别名"></a>配置@路径别名</h2><p>首先安装依赖</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @types/node</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;defineConfig&#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; resolve &#125; <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置路径别名</span></span><br><span class="line"><span class="keyword">const</span> alias = &#123;</span><br><span class="line">  <span class="string">&#x27;@&#x27;</span>: resolve(__dirname, <span class="string">&#x27;./src&#x27;</span>),</span><br><span class="line">  <span class="string">&#x27;*&#x27;</span>: resolve(<span class="string">&#x27;&#x27;</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        vue()</span><br><span class="line">    ],</span><br><span class="line">    resolve: &#123;alias&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="安装prettier代码格式化插件"><a href="#安装prettier代码格式化插件" class="headerlink" title="安装prettier代码格式化插件"></a>安装prettier代码格式化插件</h2><p>安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save-dev prettier</span><br></pre></td></tr></table></figure>

<p>然后再根目录新建 <code>.prettierrc</code> 文件，内容如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;printWidth&quot;</span>: <span class="number">180</span>,</span><br><span class="line">  <span class="string">&quot;tabWidth&quot;</span>: <span class="number">4</span>,</span><br><span class="line">  <span class="string">&quot;semi&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;singleQuote&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;trailingComma&quot;</span>: <span class="string">&quot;es5&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后以 webStorm 工具为例，使用 prettier</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-09_15-19-01.png" alt="8558467.jpg"></p>
<p>格式效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-09_15-24-07.png" alt="8558467.jpg"></p>
<h2 id="Pinia"><a href="#Pinia" class="headerlink" title="Pinia"></a>Pinia</h2><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pinia</span><br></pre></td></tr></table></figure>

<p>添加 <code>src/stores/index.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="comment">// 创建</span></span><br><span class="line"><span class="keyword">const</span> pinia = createPinia()</span><br><span class="line"><span class="comment">// 导出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> pinia</span><br></pre></td></tr></table></figure>

<p>引入</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;createApp&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">import</span> pinia <span class="keyword">from</span> <span class="string">&quot;./stores/index&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = createApp(App)</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">app.use(pinia)</span><br><span class="line">app.mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="使用pinia保存路由信息"><a href="#使用pinia保存路由信息" class="headerlink" title="使用pinia保存路由信息"></a>使用pinia保存路由信息</h3><p>新建 <code>src/store/routesList.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一个参数是应用程序中 store 的唯一 id</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> routesList = defineStore(<span class="string">&#x27;routesList&#x27;</span>, &#123;</span><br><span class="line">  state: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    routesList: [],</span><br><span class="line">  &#125;),</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="comment">// 设置路由集合</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">setRouterList</span>(<span class="params">data: <span class="built_in">any</span></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.routesList = data</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>然后再前置路由守卫中调用方法保存</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; routesList &#125; <span class="keyword">from</span> <span class="string">&#x27;../stores/routesList&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由加载前</span></span><br><span class="line">router.beforeEach(<span class="keyword">async</span> (to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> routerList = routesList()</span><br><span class="line">  <span class="keyword">await</span> routerList.setRouterList(routes[<span class="number">0</span>].children)</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="递归显示多级菜单"><a href="#递归显示多级菜单" class="headerlink" title="递归显示多级菜单"></a>递归显示多级菜单</h2><p>新建 <code>src/layout/menu/Menu.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-menu</span> <span class="attr">default-active</span>=<span class="string">&quot;2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;el-menu-vertical-demo&quot;</span> @<span class="attr">open</span>=<span class="string">&quot;handleOpen&quot;</span> @<span class="attr">close</span>=<span class="string">&quot;handleClose&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--遍历路由集合--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;item in state.routerList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.path&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--二级展开菜单--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-sub-menu</span> <span class="attr">:index</span>=<span class="string">&quot;item.path&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;item.children &amp;&amp; item.children.length &gt; 0&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.path&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> #<span class="attr">title</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!--&lt;SvgIcon :name=&quot;val.meta.icon&quot; /&gt;--&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sub-menu</span> <span class="attr">:chil</span>=<span class="string">&quot;item.children&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-sub-menu</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--一级路由--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">:index</span>=<span class="string">&quot;item.path&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.path&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!--&lt;SvgIcon :name=&quot;item.meta.icon&quot; /&gt;--&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-menu</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; useRouter, useRoute &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; Document, Menu <span class="keyword">as</span> IconMenu, Location, Setting &#125; <span class="keyword">from</span> <span class="string">&#x27;@element-plus/icons-vue&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; onMounted, reactive, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; routesList &#125; <span class="keyword">from</span> <span class="string">&#x27;../../stores/routesList&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> SubMenu <span class="keyword">from</span> <span class="string">&#x27;./SubMenu.vue&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> state = reactive(&#123;</span></span><br><span class="line">  router: useRouter(),</span><br><span class="line">  routerList: routesList().routesList,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="javascript"><span class="keyword">const</span> handleOpen = <span class="function">(<span class="params">key: string, keyPath: string[]</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// console.log(key, keyPath)</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript"><span class="keyword">const</span> handleClose = <span class="function">(<span class="params">key: string, keyPath: string[]</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// console.log(key, keyPath)</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">.el-menu &#123;</span><br><span class="line"><span class="css">  <span class="attribute">border-right</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="css">  <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>新建 <code>src/layout/menu/SubMenu.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;val in props.chil&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-sub-menu</span> <span class="attr">:index</span>=<span class="string">&quot;val.path&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;val.path&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;val.children &amp;&amp; val.children.length &gt; 0&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> #<span class="attr">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; val.name &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--组件递归--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">sub-menu</span> <span class="attr">:chil</span>=<span class="string">&quot;val.children&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-sub-menu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">:index</span>=<span class="string">&quot;val.path&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;val.path&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; val.name &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; defineProps &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> props = defineProps([<span class="string">&#x27;chil&#x27;</span>])</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果展示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-09_17-41-51.png" alt="8558467.jpg"></p>
<h2 id="根据权限显示菜单"><a href="#根据权限显示菜单" class="headerlink" title="根据权限显示菜单"></a>根据权限显示菜单</h2><p>首先设置两个角色：admin、common，分别表示管理员和普通用户。</p>
<p>创建 <code>src/stores/userInfo.ts</code>，暂时写死一个用户数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一个参数是应用程序中 store 的唯一 id</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> userInfo = defineStore(<span class="string">&#x27;userInfo&#x27;</span>, &#123;</span><br><span class="line">  state: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// 用户名称</span></span><br><span class="line">    userName: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">    <span class="comment">// 用户id</span></span><br><span class="line">    userId: <span class="string">&#x27;zx-001&#x27;</span>,</span><br><span class="line">    <span class="comment">// 用户权限 admin:管理员，common:普通用户</span></span><br><span class="line">    roles: [<span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">    <span class="comment">// 用户头像</span></span><br><span class="line">    portrait:</span><br><span class="line">      <span class="string">&#x27;https://img2.baidu.com/it/u=1978192862,2048448374&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=504&amp;h=500&#x27;</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="comment">// 设置用户信息</span></span><br><span class="line">    <span class="function"><span class="title">setUserInfo</span>(<span class="params">info: any</span>)</span> &#123;&#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>创建 <code>src/stores/routesList.ts</code> 文件，存放路由集合信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一个参数是应用程序中 store 的唯一 id</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> routesList = defineStore(<span class="string">&#x27;routesList&#x27;</span>, &#123;</span><br><span class="line">  state: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    routesList: [],</span><br><span class="line">  &#125;),</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="comment">// 设置路由集合</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">setRouterList</span>(<span class="params">data: any</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.routesList = data</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>创建  <code>src/router/routes.ts</code> 菜单数据文件，其中 meta 里面有 roles 数组，表示只要用户的角色在这里就显示当前菜单</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/router/routes.ts</span></span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&#x27;../layout/index.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Parent <span class="keyword">from</span> <span class="string">&#x27;../layout/routerview/Parent.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * meta 属性意义</span></span><br><span class="line"><span class="comment"> *  roles 设置那些权限可见。admin：管理员，common：普通职工</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;router.home&#x27;</span>,</span><br><span class="line">    component: Layout,</span><br><span class="line">    redirect: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    children: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">        meta: &#123;</span><br><span class="line">          roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        name: <span class="string">&#x27;router.home&#x27;</span>,</span><br><span class="line">        component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/home/home.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">        meta: &#123;</span><br><span class="line">          roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        name: <span class="string">&#x27;router.about&#x27;</span>,</span><br><span class="line">        component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/about/about.vue&#x27;</span>),</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">&#x27;/order&#x27;</span>,</span><br><span class="line">        meta: &#123;</span><br><span class="line">          roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        name: <span class="string">&#x27;router.order&#x27;</span>,</span><br><span class="line">        component: Parent,</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            path: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">            meta: &#123;</span><br><span class="line">              roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">            name: <span class="string">&#x27;router.order_list&#x27;</span>,</span><br><span class="line">            component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/order/list.vue&#x27;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            path: <span class="string">&#x27;stock&#x27;</span>,</span><br><span class="line">            meta: &#123;</span><br><span class="line">              roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">            name: <span class="string">&#x27;router.order_stock&#x27;</span>,</span><br><span class="line">            component: Parent,</span><br><span class="line">            children: [</span><br><span class="line">              &#123;</span><br><span class="line">                path: <span class="string">&#x27;price&#x27;</span>,</span><br><span class="line">                meta: &#123;</span><br><span class="line">                  roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">                &#125;,</span><br><span class="line">                name: <span class="string">&#x27;router.order_stock_price&#x27;</span>,</span><br><span class="line">                component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/order/price.vue&#x27;</span>),</span><br><span class="line">              &#125;,</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">&#x27;/system&#x27;</span>,</span><br><span class="line">        name: <span class="string">&#x27;router.system&#x27;</span>,</span><br><span class="line">        meta: &#123;</span><br><span class="line">          roles: [<span class="string">&#x27;admin&#x27;</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        component: Parent,</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">            path: <span class="string">&#x27;menu&#x27;</span>,</span><br><span class="line">            meta: &#123;</span><br><span class="line">              roles: [<span class="string">&#x27;admin&#x27;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">            name: <span class="string">&#x27;router.system_menu&#x27;</span>,</span><br><span class="line">            component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/system/menu.vue&#x27;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            path: <span class="string">&#x27;role&#x27;</span>,</span><br><span class="line">            meta: &#123;</span><br><span class="line">              roles: [<span class="string">&#x27;admin&#x27;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">            name: <span class="string">&#x27;router.system_role&#x27;</span>,</span><br><span class="line">            component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/system/role.vue&#x27;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            path: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">            meta: &#123;</span><br><span class="line">              roles: [<span class="string">&#x27;admin&#x27;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">            name: <span class="string">&#x27;router.system_user&#x27;</span>,</span><br><span class="line">            component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/system/user.vue&#x27;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            path: <span class="string">&#x27;dept&#x27;</span>,</span><br><span class="line">            meta: &#123;</span><br><span class="line">              roles: [<span class="string">&#x27;admin&#x27;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">            name: <span class="string">&#x27;router.system_dept&#x27;</span>,</span><br><span class="line">            component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/system/dept.vue&#x27;</span>),</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>修改 <code>src/router/index.ts</code> 文件如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.从vue-router导出两个方法使用</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHashHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; routesList &#125; <span class="keyword">from</span> <span class="string">&#x27;../stores/routesList&#x27;</span></span><br><span class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">&#x27;./routes&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 创建路由实例并传递 `routes` 配置</span></span><br><span class="line"><span class="comment">// 你可以在这里输入更多的配置，但我们在这里</span></span><br><span class="line"><span class="comment">// 暂时保持简单</span></span><br><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">  <span class="comment">// 4. 内部提供了 history 模式的实现。为了简单起见，我们在这里使用 hash 模式。</span></span><br><span class="line">  history: createWebHashHistory(),</span><br><span class="line">  routes, <span class="comment">// `routes: routes` 的缩写</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由加载前</span></span><br><span class="line">router.beforeEach(<span class="keyword">async</span> (to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> routerList = routesList()</span><br><span class="line">  <span class="keyword">await</span> routerList.setRouterList(routes[<span class="number">0</span>].children)</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出路由</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>

<p>添加 <code>src/router/filterRouter.ts</code> 文件，待会会用到这里面的方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断路由 `meta.roles` 中是否包含当前登录用户权限字段</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>roles 用户权限标识，在 userInfos（用户信息）的 roles（登录页登录时缓存到浏览器）数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>route 当前循环时的路由项</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>返回对比后有权限的路由项</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">hasRoles</span>(<span class="params">roles: any, route: any</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (route.meta &amp;&amp; route.meta.roles)</span><br><span class="line">    <span class="keyword">return</span> roles.some(<span class="function">(<span class="params">role: any</span>) =&gt;</span> route.meta.roles.includes(role))</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取当前用户权限标识去比对路由表，设置递归过滤有权限的路由</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>routes 当前路由 children</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>roles 用户权限标识，在 userInfos（用户信息）的 roles（登录页登录时缓存到浏览器）数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>返回有权限的路由数组 `meta.roles` 中控制</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setFilterHasRolesMenu</span>(<span class="params">routes: any, roles: any</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> menu: any = []</span><br><span class="line">  routes.forEach(<span class="function">(<span class="params">route: any</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> item = &#123; ...route &#125;</span><br><span class="line">    <span class="keyword">if</span> (hasRoles(roles, item)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (item.children) &#123;</span><br><span class="line">        item.children = setFilterHasRolesMenu(item.children, roles)</span><br><span class="line">      &#125;</span><br><span class="line">      menu.push(item)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> menu</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 路由扁平化方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">routes</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">flatten</span>(<span class="params">routes: any</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> routes.reduce(</span><br><span class="line">    (arr: any, <span class="attr">old</span>: any) =&gt; arr.concat([old], flatten(old.children || [])),</span><br><span class="line">    []</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>src/layout/menu/Menu.vue</code> 组件中添加如下逻辑，首先进入页面触发 onBeforeMount，在该生命周期中调用 getRouterListByRole 方法获取菜单数据，getRouterListByRole 方法中又调用 setFilterHasRolesMenu 方法，来实现根据权限获取不同菜单</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; onBeforeRouteUpdate, useRoute &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; onBeforeMount, reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; routesList &#125; <span class="keyword">from</span> <span class="string">&#x27;../../stores/routesList&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; userInfo &#125; <span class="keyword">from</span> <span class="string">&#x27;../../stores/userInfo&#x27;</span></span><br><span class="line"><span class="keyword">import</span> SubMenu <span class="keyword">from</span> <span class="string">&#x27;./SubMenu.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Menu <span class="keyword">as</span> IconMenu &#125; <span class="keyword">from</span> <span class="string">&#x27;@element-plus/icons-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; setFilterHasRolesMenu &#125; <span class="keyword">from</span> <span class="string">&#x27;../../router/filterRouter&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useI18n &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-i18n&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; t &#125; = useI18n()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = reactive(&#123;</span><br><span class="line">  routerList: [], <span class="comment">// 路由数据</span></span><br><span class="line">  active: useRoute().path, <span class="comment">// 根据路由默认选中菜单</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">onBeforeMount(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 获取当前的组件信息</span></span><br><span class="line">  <span class="keyword">let</span> routerList = getRouterListByRole()</span><br><span class="line">  routerList.forEach(<span class="function">(<span class="params">item: any</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (item.children) &#123;</span><br><span class="line">      resolvePath(item.path, item.children)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 赋值</span></span><br><span class="line">  state.routerList = routerList</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 递归遍历深层菜单的路径</span></span><br><span class="line"><span class="keyword">const</span> resolvePath = <span class="function">(<span class="params">parentPath: string, children: <span class="built_in">Array</span>&lt;any&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">  children.forEach(<span class="function">(<span class="params">item: any</span>) =&gt;</span> &#123;</span><br><span class="line">    item.path = parentPath + <span class="string">&#x27;/&#x27;</span> + item.path</span><br><span class="line">    <span class="keyword">if</span> (item.children) &#123;</span><br><span class="line">      resolvePath(item.path, item.children)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 路由更新时更新菜单选中</span></span><br><span class="line">onBeforeRouteUpdate(<span class="function">(<span class="params">to</span>) =&gt;</span> &#123;</span><br><span class="line">  state.active = to.path</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 根据用户权限获取菜单数据</span></span><br><span class="line"><span class="keyword">const</span> getRouterListByRole = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> roles = userInfo().roles</span><br><span class="line">  <span class="keyword">const</span> routerList = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(routesList().routesList))</span><br><span class="line">  <span class="keyword">return</span> setFilterHasRolesMenu(routerList, roles)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果显示</p>
<p>普通用户没有系统管理菜单</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-18_17-59-39.png" alt="8558467.jpg"></p>
<p>管理员可以看到系统管理</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-18_17-58-51.png" alt="8558467.jpg"></p>
<h2 id="实现点击菜单进行路由跳转"><a href="#实现点击菜单进行路由跳转" class="headerlink" title="实现点击菜单进行路由跳转"></a>实现点击菜单进行路由跳转</h2><p>首先添加下面代码，作用是可以将内层的菜单设置为全路径</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">onBeforeMount(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 获取当前的组件信息</span></span><br><span class="line">  <span class="keyword">let</span> routerList = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(routesList().routesList))</span><br><span class="line">  routerList.forEach(<span class="function">(<span class="params">item: any</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (item.children) &#123;</span><br><span class="line">      resolvePath(item.path, item.children)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 赋值</span></span><br><span class="line">  state.routerList = routerList</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 递归遍历深层菜单的路径</span></span><br><span class="line"><span class="keyword">const</span> resolvePath = <span class="function">(<span class="params">parentPath: string, children: <span class="built_in">Array</span>&lt;any&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">  children.forEach(<span class="function">(<span class="params">item: any</span>) =&gt;</span> &#123;</span><br><span class="line">    item.path = parentPath + <span class="string">&#x27;/&#x27;</span> + item.path</span><br><span class="line">    <span class="keyword">if</span> (item.children) &#123;</span><br><span class="line">      resolvePath(item.path, item.children)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后开启 Menu 组件的 router 模式即可</p>
<h2 id="动态面包屑导航"><a href="#动态面包屑导航" class="headerlink" title="动态面包屑导航"></a>动态面包屑导航</h2><p>完整代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-breadcrumb</span> <span class="attr">separator</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">    &lt;el-breadcrumb-item</span><br><span class="line">      v-for=&quot;(item, index) in state.breadcrumbList&quot;</span><br><span class="line">      :key=&quot;index&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;breadcrumb-text&quot;</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-breadcrumb-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-breadcrumb</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; watch, ref, reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// 引入路由</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; useRoute &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> state = reactive(&#123;</span></span><br><span class="line">  breadcrumbList: [],</span><br><span class="line">  route: useRoute(),</span><br><span class="line">&#125;)</span><br><span class="line"><span class="javascript"><span class="comment">// 初始化面包屑</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> initBreadcrumbList = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// route.matched 可以获取当前路由的完整路由表</span></span></span><br><span class="line">  state.breadcrumbList = state.route.matched.slice(1)</span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript"><span class="comment">// 监听路由变化</span></span></span><br><span class="line">watch(</span><br><span class="line">  state.route,</span><br><span class="line">  () =&gt; &#123;</span><br><span class="line">    initBreadcrumbList()</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="javascript">  &#123; <span class="attr">deep</span>: <span class="literal">true</span>, <span class="attr">immediate</span>: <span class="literal">true</span> &#125;</span></span><br><span class="line">)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-10_11-07-17.png" alt="8558467.jpg"></p>
<h2 id="页面最大化和最小化"><a href="#页面最大化和最小化" class="headerlink" title="页面最大化和最小化"></a>页面最大化和最小化</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;full&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-icon</span> <span class="attr">:size</span>=<span class="string">&quot;20&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleFullScreen&quot;</span> <span class="attr">class</span>=<span class="string">&quot;icon-color&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">FullScreen</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-icon</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; reactive, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> state = reactive(&#123;</span></span><br><span class="line"><span class="javascript">  fullscreen: <span class="literal">false</span>,</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="javascript"><span class="keyword">const</span> handleFullScreen = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> element = <span class="built_in">document</span>.documentElement</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 判断是否已经是全屏</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// 如果是全屏，退出</span></span></span><br><span class="line">  if (state.fullscreen) &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (<span class="built_in">document</span>.exitFullscreen) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.exitFullscreen()</span></span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">document</span>.webkitCancelFullScreen) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.webkitCancelFullScreen()</span></span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">document</span>.mozCancelFullScreen) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.mozCancelFullScreen()</span></span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">document</span>.msExitFullscreen) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.msExitFullscreen()</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">  &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 否则，进入全屏</span></span></span><br><span class="line">    if (element.requestFullscreen) &#123;</span><br><span class="line">      element.requestFullscreen()</span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.webkitRequestFullScreen) &#123;</span></span><br><span class="line">      element.webkitRequestFullScreen()</span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.mozRequestFullScreen) &#123;</span></span><br><span class="line">      element.mozRequestFullScreen()</span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (element.msRequestFullscreen) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// IE11</span></span></span><br><span class="line">      element.msRequestFullscreen()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="javascript">  <span class="comment">// 改变当前全屏状态</span></span></span><br><span class="line">  state.fullscreen = !state.fullscreen</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line">.full &#123;</span><br><span class="line"><span class="css">  <span class="attribute">width</span>: <span class="number">35px</span>;</span></span><br><span class="line"><span class="css">  <span class="attribute">height</span>: <span class="number">35px</span>;</span></span><br><span class="line"><span class="css">  <span class="attribute">background</span>: <span class="built_in">var</span>(--el-color-primary-light-<span class="number">9</span>);</span></span><br><span class="line"><span class="css">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">  <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">  <span class="attribute">justify-content</span>: center;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.icon-color &#123;</span><br><span class="line"><span class="css">  <span class="attribute">color</span>: <span class="built_in">var</span>(--el-color-primary);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="主题颜色自定义"><a href="#主题颜色自定义" class="headerlink" title="主题颜色自定义"></a>主题颜色自定义</h2><p>添加一个初始化配置文件 <code>src/stores/styleconfig.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> state = &#123;</span><br><span class="line">  <span class="comment">// 默认 primary 主题颜色</span></span><br><span class="line">  primary: <span class="string">&#x27;#752bec&#x27;</span>,</span><br><span class="line">  <span class="comment">// 白色背景</span></span><br><span class="line">  bgWhite: <span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从缓存中读取预设的样式配置</span></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;styleConfig&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> (config) &#123;</span><br><span class="line">  state = <span class="built_in">JSON</span>.parse(config)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一个参数是应用程序中 store 的唯一 id</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> styleConfig = defineStore(<span class="string">&#x27;styleConfig&#x27;</span>, &#123;</span><br><span class="line">  state: <span class="function">() =&gt;</span> state,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>新建一个工具文件 <code>src/utils/theme.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ElMessage &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * hex颜色转rgb颜色</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>str 颜色值字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>返回处理后的颜色值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">hexToRgb</span>(<span class="params">str: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">let</span> hexs: <span class="built_in">any</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">   <span class="keyword">let</span> reg = <span class="regexp">/^\#?[0-9A-Fa-f]&#123;6&#125;$/</span>;</span><br><span class="line">   <span class="keyword">if</span> (!reg.test(str)) <span class="keyword">return</span> ElMessage.warning(<span class="string">&#x27;输入错误的hex&#x27;</span>);</span><br><span class="line">   str = str.replace(<span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">   hexs = str.match(<span class="regexp">/../g</span>);</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) hexs[i] = <span class="built_in">parseInt</span>(hexs[i], <span class="number">16</span>);</span><br><span class="line">   <span class="keyword">return</span> hexs;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * rgb颜色转Hex颜色</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>r 代表红色</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>g 代表绿色</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>b 代表蓝色</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>返回处理后的颜色值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">rgbToHex</span>(<span class="params">r: <span class="built_in">any</span>, g: <span class="built_in">any</span>, b: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">let</span> reg = <span class="regexp">/^\d&#123;1,3&#125;$/</span>;</span><br><span class="line">   <span class="keyword">if</span> (!reg.test(r) || !reg.test(g) || !reg.test(b)) <span class="keyword">return</span> ElMessage.warning(<span class="string">&#x27;输入错误的rgb颜色值&#x27;</span>);</span><br><span class="line">   <span class="keyword">let</span> hexs = [r.toString(<span class="number">16</span>), g.toString(<span class="number">16</span>), b.toString(<span class="number">16</span>)];</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) <span class="keyword">if</span> (hexs[i].length == <span class="number">1</span>) hexs[i] = <span class="string">`0<span class="subst">$&#123;hexs[i]&#125;</span>`</span>;</span><br><span class="line">   <span class="keyword">return</span> <span class="string">`#<span class="subst">$&#123;hexs.join(<span class="string">&#x27;&#x27;</span>)&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 加深颜色值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>color 颜色值字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>level 加深的程度，限0-1之间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>返回处理后的颜色值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getDarkColor</span>(<span class="params">color: <span class="built_in">string</span>, level: <span class="built_in">number</span></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">let</span> reg = <span class="regexp">/^\#?[0-9A-Fa-f]&#123;6&#125;$/</span>;</span><br><span class="line">   <span class="keyword">if</span> (!reg.test(color)) <span class="keyword">return</span> ElMessage.warning(<span class="string">&#x27;输入错误的hex颜色值&#x27;</span>);</span><br><span class="line">   <span class="keyword">let</span> rgb = hexToRgb(color);</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) rgb[i] = <span class="built_in">Math</span>.floor(rgb[i] * (<span class="number">1</span> - level));</span><br><span class="line">   <span class="keyword">return</span> rgbToHex(rgb[<span class="number">0</span>], rgb[<span class="number">1</span>], rgb[<span class="number">2</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 变浅颜色值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>color 颜色值字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>level 加深的程度，限0-1之间</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>返回处理后的颜色值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getLightColor</span>(<span class="params">color: <span class="built_in">string</span>, level: <span class="built_in">number</span></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">let</span> reg = <span class="regexp">/^\#?[0-9A-Fa-f]&#123;6&#125;$/</span>;</span><br><span class="line">   <span class="keyword">if</span> (!reg.test(color)) <span class="keyword">return</span> ElMessage.warning(<span class="string">&#x27;输入错误的hex颜色值&#x27;</span>);</span><br><span class="line">   <span class="keyword">let</span> rgb = hexToRgb(color);</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) rgb[i] = <span class="built_in">Math</span>.floor((<span class="number">255</span> - rgb[i]) * level + rgb[i]);</span><br><span class="line">   <span class="keyword">return</span> rgbToHex(rgb[<span class="number">0</span>], rgb[<span class="number">1</span>], rgb[<span class="number">2</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再新建一个配置文件 <code>src/config/styleSetting.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; styleConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;../stores/styleconfig&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getLightColor &#125; <span class="keyword">from</span> <span class="string">&#x27;../utils/theme&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置主题颜色</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> setPrimaryColor = <span class="function">(<span class="params">color = <span class="string">&#x27;&#x27;</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.documentElement</span><br><span class="line">  <span class="comment">// 设置主题颜色变量</span></span><br><span class="line">  el.style.setProperty(<span class="string">&#x27;--el-color-primary&#x27;</span>, color || styleConfig().primary)</span><br><span class="line">  <span class="comment">// 颜色变浅</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= <span class="number">9</span>; i++) &#123;</span><br><span class="line">    el.style.setProperty(</span><br><span class="line">      <span class="string">`--el-color-primary-light-<span class="subst">$&#123;i&#125;</span>`</span>,</span><br><span class="line">      <span class="string">`<span class="subst">$&#123;getLightColor(color || styleConfig().primary, i / <span class="number">10</span>)&#125;</span>`</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置主背景颜色</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> setBgWhite = <span class="function">(<span class="params">color = <span class="string">&#x27;&#x27;</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.documentElement</span><br><span class="line">  el.style.setProperty(<span class="string">&#x27;--el-color-bg-white&#x27;</span>, color || styleConfig().bgWhite)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 页面加载时默认执行所有方法</span></span><br><span class="line"><span class="keyword">const</span> setStyle = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  setPrimaryColor()</span><br><span class="line">  setBgWhite()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> setStyle</span><br></pre></td></tr></table></figure>

<p>然后在 <code>main.ts</code> 中引入 <code>styleSetting.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> setStyle <span class="keyword">from</span> <span class="string">&quot;./config/styleSetting&quot;</span>;</span><br><span class="line"></span><br><span class="line">app.use(setStyle)</span><br></pre></td></tr></table></figure>

<p>然后在 css 中需要设置主颜色时，直接使用变量来代替颜色值，例如下面是设置菜单选中时的颜色</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; <span class="selector-class">.el-menu-item</span><span class="selector-class">.is-active</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--el-color-primary);</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--el-color-primary-light-<span class="number">9</span>);</span><br><span class="line">  <span class="attribute">transition</span>: <span class="number">0.5s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; <span class="selector-class">.el-menu-item</span><span class="selector-class">.is-active</span>:after &#123;</span><br><span class="line">  content: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--el-color-primary);</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">transition</span>: <span class="number">0.5s</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>默认显示的主题颜色</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-10_15-51-23.png" alt="8558467.jpg"></p>
<p>然后写一个设置主题颜色的方法，来实时的更新 <code>--el-color-primary</code> 值，点击保存后把配置保存在缓存中</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-icon</span> <span class="attr">:size</span>=<span class="string">&quot;20&quot;</span> <span class="attr">class</span>=<span class="string">&quot;icon-color&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;state.isShow = true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Brush</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-icon</span>&gt;</span></span><br><span class="line">  &lt;el-drawer</span><br><span class="line">    v-model=&quot;state.isShow&quot;</span><br><span class="line">    title=&quot;主题设置&quot;</span><br><span class="line">    direction=&quot;rtl&quot;</span><br><span class="line">    size=&quot;380px&quot;</span><br><span class="line">    :before-close=&quot;beforeClose&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>&gt;</span></span><br><span class="line">      &lt;el-form</span><br><span class="line">        :model=&quot;state.config&quot;</span><br><span class="line">        label-width=&quot;100px&quot;</span><br><span class="line">        class=&quot;content&quot;</span><br><span class="line">        label-position=&quot;left&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;主题颜色&quot;</span>&gt;</span></span><br><span class="line">          &lt;el-color-picker</span><br><span class="line">            v-model=&quot;state.config.primary&quot;</span><br><span class="line">            @change=&quot;changePrimary&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> #<span class="attr">footer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;flex: auto&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;state.isShow = false&quot;</span>&gt;</span>关闭<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;confirmClick&quot;</span>&gt;</span>保存<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-drawer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; setPrimaryColor &#125; <span class="keyword">from</span> <span class="string">&#x27;../../config/styleSetting&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; styleConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;../../stores/styleconfig&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> state = reactive(&#123;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 是否显示右侧设置框</span></span></span><br><span class="line"><span class="javascript">  isShow: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 主题配置对象</span></span></span><br><span class="line">  config: &#123;</span><br><span class="line"><span class="javascript">    <span class="comment">// 默认 primary 主题颜色</span></span></span><br><span class="line">    primary: styleConfig().primary,</span><br><span class="line"><span class="javascript">    <span class="comment">// 白色背景</span></span></span><br><span class="line">    bgWhite: styleConfig().bgWhite,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="javascript"><span class="comment">// 关闭设置框</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> beforeClose = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">  state.isShow = <span class="literal">false</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript"><span class="comment">//修改主题色</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> changePrimary = <span class="function">(<span class="params">color: string</span>) =&gt;</span> &#123;</span></span><br><span class="line">  setPrimaryColor(color)</span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript"><span class="comment">// 保存配置</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> confirmClick = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">localStorage</span>.setItem(<span class="string">&#x27;styleConfig&#x27;</span>, <span class="built_in">JSON</span>.stringify(state.config))</span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.location.reload()</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line">.icon-color &#123;</span><br><span class="line"><span class="css">  <span class="attribute">width</span>: <span class="number">35px</span>;</span></span><br><span class="line"><span class="css">  <span class="attribute">height</span>: <span class="number">35px</span>;</span></span><br><span class="line"><span class="css">  <span class="attribute">background</span>: <span class="built_in">var</span>(--el-color-primary-light-<span class="number">9</span>);</span></span><br><span class="line"><span class="css">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">  <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">  <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="css">  <span class="attribute">color</span>: <span class="built_in">var</span>(--el-color-primary);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.content &#123;</span><br><span class="line"><span class="css">  <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--el-color-primary-light-<span class="number">6</span>);</span></span><br><span class="line"><span class="css">  <span class="attribute">padding-top</span>: <span class="number">15px</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改一个颜色后，页面整体颜色都会发生变化</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-10_15-54-04.png" alt="8558467.jpg"></p>
<h2 id="设置国际化"><a href="#设置国际化" class="headerlink" title="设置国际化"></a>设置国际化</h2><p>引入指定版本的 <code>&quot;vue-i18n&quot;: &quot;^9.1.10&quot;</code> ，否则高版本会报错</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue-i18n@9.1.10</span><br></pre></td></tr></table></figure>

<p>新建文件夹 <code>src/i18n</code>，这个文件夹下新建如下文件：</p>
<ul>
<li>lang<ul>
<li>en.ts</li>
<li>zh.ts</li>
</ul>
</li>
<li>router<ul>
<li>en.ts</li>
<li>zh.ts</li>
</ul>
</li>
<li>index.ts</li>
</ul>
<p>内容分别如下</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/en.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    login: &#123;</span><br><span class="line">        login: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">        userName: <span class="string">&#x27;userName&#x27;</span>,</span><br><span class="line">        password: <span class="string">&#x27;password&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/zh.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    login: &#123;</span><br><span class="line">        login: <span class="string">&#x27;登录&#x27;</span>,</span><br><span class="line">        userName: <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">        password: <span class="string">&#x27;密码&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// router/en.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  router: &#123;</span><br><span class="line">    title: <span class="string">&#x27;ZX-SYSTEM&#x27;</span>,</span><br><span class="line">    home: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">    about: <span class="string">&#x27;about&#x27;</span>,</span><br><span class="line">    order: <span class="string">&#x27;mall management&#x27;</span>,</span><br><span class="line">    order_list: <span class="string">&#x27;orderList&#x27;</span>,</span><br><span class="line">    order_stock: <span class="string">&#x27;inventory&#x27;</span>,</span><br><span class="line">    order_stock_price: <span class="string">&#x27;price&#x27;</span>,</span><br><span class="line">    system: <span class="string">&#x27;system management&#x27;</span>,</span><br><span class="line">    system_menu: <span class="string">&#x27;menu&#x27;</span>,</span><br><span class="line">    system_role: <span class="string">&#x27;role&#x27;</span>,</span><br><span class="line">    system_user: <span class="string">&#x27;user&#x27;</span>,</span><br><span class="line">    system_dept: <span class="string">&#x27;department&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// router/en.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    router: &#123;</span><br><span class="line">        title: <span class="string">&#x27;ZX-管理系统&#x27;</span>,</span><br><span class="line">        home: <span class="string">&quot;首页&quot;</span>,</span><br><span class="line">        about: <span class="string">&quot;关于我&quot;</span>,</span><br><span class="line">        order: <span class="string">&quot;商城管理&quot;</span>,</span><br><span class="line">        order_list: <span class="string">&quot;订单列表&quot;</span>,</span><br><span class="line">        order_stock: <span class="string">&quot;库存管理&quot;</span>,</span><br><span class="line">        order_stock_price: <span class="string">&quot;价格管理&quot;</span>,</span><br><span class="line">        system: <span class="string">&quot;系统管理&quot;</span>,</span><br><span class="line">        system_menu: <span class="string">&quot;菜单管理&quot;</span>,</span><br><span class="line">        system_role: <span class="string">&quot;角色管理&quot;</span>,</span><br><span class="line">        system_user: <span class="string">&quot;用户管理&quot;</span>,</span><br><span class="line">        system_dept: <span class="string">&quot;部门管理&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在 index.ts 里面整合</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123;createI18n&#125; <span class="keyword">from</span> <span class="string">&#x27;vue-i18n&#x27;</span></span><br><span class="line"><span class="keyword">import</span> pagesEn <span class="keyword">from</span> <span class="string">&quot;./pages/en&quot;</span></span><br><span class="line"><span class="keyword">import</span> pagesZh <span class="keyword">from</span> <span class="string">&quot;./pages/zh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> layoutEn <span class="keyword">from</span> <span class="string">&quot;./router/en&quot;</span></span><br><span class="line"><span class="keyword">import</span> layoutZh <span class="keyword">from</span> <span class="string">&quot;./router/zh&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ./pages 表示各个页面的国际化</span></span><br><span class="line"><span class="comment"> * ./router 表示左侧菜单的国际化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> messages = &#123;</span><br><span class="line">    en: &#123;</span><br><span class="line">        ...pagesEn,</span><br><span class="line">        ...layoutEn</span><br><span class="line">    &#125;,</span><br><span class="line">    zh: &#123;</span><br><span class="line">        ...pagesZh,</span><br><span class="line">        ...layoutZh</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> language = (navigator.language || <span class="string">&#x27;en&#x27;</span>).toLocaleLowerCase() <span class="comment">// 这是获取浏览器的语言</span></span><br><span class="line"><span class="keyword">const</span> i18n = createI18n(&#123;</span><br><span class="line">    legacy: <span class="literal">false</span>,</span><br><span class="line">    locale: <span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;lang&#x27;</span>) || language.split(<span class="string">&#x27;-&#x27;</span>)[<span class="number">0</span>] || <span class="string">&#x27;en&#x27;</span>, <span class="comment">// 首先从缓存里拿，没有的话就用浏览器语言，</span></span><br><span class="line">    fallbackLocale: <span class="string">&#x27;en&#x27;</span>, <span class="comment">// 设置备用语言</span></span><br><span class="line">    messages,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> i18n</span><br></pre></td></tr></table></figure>

<p>在 <code>main.ts </code> 中引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> i18n <span class="keyword">from</span> <span class="string">&quot;./i18n/index&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = createApp(App)</span><br><span class="line">app.use(i18n)</span><br><span class="line">app.mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>使用也非常简单，根据前缀不同，会自动的显示不同的语言</p>
<p>在页面中使用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; t(&#x27;login.userName&#x27;) &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123;useI18n&#125; <span class="keyword">from</span> <span class="string">&#x27;vue-i18n&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> &#123;t&#125; = useI18n()</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在菜单中使用，修改 name 的值，不能写死为固定的中文名，而是改成国际化文件对应的属性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: <span class="string">&#x27;stock&#x27;</span>,</span><br><span class="line">  meta: &#123;</span><br><span class="line">    roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  name: <span class="string">&#x27;router.order_stock&#x27;</span>,</span><br><span class="line">  component: Parent,</span><br><span class="line">  children: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&#x27;price&#x27;</span>,</span><br><span class="line">      meta: &#123;</span><br><span class="line">        roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      name: <span class="string">&#x27;router.order_stock_price&#x27;</span>,</span><br><span class="line">      component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/order/price.vue&#x27;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>然后在组件中使用 t 转义</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">:index</span>=<span class="string">&quot;item.path&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.path&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-icon</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">icon-menu</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-icon</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; t(item.name) &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useI18n &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-i18n&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; t &#125; = useI18n()</span><br></pre></td></tr></table></figure>

<p>然后可以添加一个方法，来切换中英文显示</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;full&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;taggerLang&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;icon-color&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123; state.lang === &#x27;zh&#x27; ? &#x27;中&#x27; : &#x27;en&#x27; &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123;reactive, computed, onMounted&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> state = reactive(&#123;</span></span><br><span class="line"><span class="javascript">  lang: <span class="string">&#x27;zh&#x27;</span>,</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="javascript">onMounted(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> lang = <span class="built_in">localStorage</span>.getItem(<span class="string">&quot;lang&quot;</span>)</span></span><br><span class="line"><span class="javascript">  <span class="keyword">if</span> (!lang || lang === <span class="string">&#x27;zh&#x27;</span>) &#123;</span></span><br><span class="line"><span class="javascript">    state.lang = <span class="string">&#x27;zh&#x27;</span></span></span><br><span class="line"><span class="javascript">  &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">    state.lang = <span class="string">&#x27;en&#x27;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> taggerLang = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">if</span> (state.lang === <span class="string">&#x27;zh&#x27;</span>) &#123;</span></span><br><span class="line"><span class="javascript">    state.lang = <span class="string">&#x27;en&#x27;</span></span></span><br><span class="line"><span class="javascript">  &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">    state.lang = <span class="string">&#x27;zh&#x27;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="javascript">  <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;lang&quot;</span>,state.lang)</span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.location.reload()</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>英文界面</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-18_17-33-00.png" alt="8558467.jpg"></p>
<p>中文界面</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-18_17-35-20.png" alt="8558467.jpg"></p>
<h2 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h2><h3 id="添加返回模拟数据的方法"><a href="#添加返回模拟数据的方法" class="headerlink" title="添加返回模拟数据的方法"></a>添加返回模拟数据的方法</h3><p>模拟实现从后端直接获取路由进行菜单展示</p>
<p>首先新建：src/api/testrouter/index.ts，这个文件用来模拟后端接口返回数据</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 管理员看到的菜单</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> adminRouter = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    code: <span class="number">200</span>,</span><br><span class="line">    msg: <span class="string">&#x27;成功&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      rows: [</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">          meta: &#123;</span><br><span class="line">            roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">            title: <span class="string">&#x27;router.home&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          name: <span class="string">&#x27;router.home&#x27;</span>,</span><br><span class="line">          component: <span class="string">&#x27;view/home/home.vue&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">          meta: &#123;</span><br><span class="line">            roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">            title: <span class="string">&#x27;router.about&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          name: <span class="string">&#x27;router.about&#x27;</span>,</span><br><span class="line">          component: <span class="string">&#x27;view/about/about&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&#x27;/order&#x27;</span>,</span><br><span class="line">          meta: &#123;</span><br><span class="line">            roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">            title: <span class="string">&#x27;router.order&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          name: <span class="string">&#x27;router.order&#x27;</span>,</span><br><span class="line">          component: <span class="string">&#x27;layout/routerview/Parent&#x27;</span>,</span><br><span class="line">          children: [</span><br><span class="line">            &#123;</span><br><span class="line">              path: <span class="string">&#x27;/order/list&#x27;</span>,</span><br><span class="line">              meta: &#123;</span><br><span class="line">                roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">                title: <span class="string">&#x27;router.order_list&#x27;</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">              name: <span class="string">&#x27;router.order_list&#x27;</span>,</span><br><span class="line">              component: <span class="string">&#x27;view/order/list&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              path: <span class="string">&#x27;/order/stock&#x27;</span>,</span><br><span class="line">              meta: &#123;</span><br><span class="line">                roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">                title: <span class="string">&#x27;router.order_stock&#x27;</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">              name: <span class="string">&#x27;router.order_stock&#x27;</span>,</span><br><span class="line">              component: <span class="string">&#x27;layout/routerview/Parent&#x27;</span>,</span><br><span class="line">              children: [</span><br><span class="line">                &#123;</span><br><span class="line">                  path: <span class="string">&#x27;/order/price&#x27;</span>,</span><br><span class="line">                  meta: &#123;</span><br><span class="line">                    roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">                    title: <span class="string">&#x27;router.order_stock_price&#x27;</span>,</span><br><span class="line">                  &#125;,</span><br><span class="line">                  name: <span class="string">&#x27;router.order_stock_price&#x27;</span>,</span><br><span class="line">                  component: <span class="string">&#x27;view/order/price&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">              ],</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&#x27;/system&#x27;</span>,</span><br><span class="line">          name: <span class="string">&#x27;router.system&#x27;</span>,</span><br><span class="line">          meta: &#123;</span><br><span class="line">            roles: [<span class="string">&#x27;admin&#x27;</span>],</span><br><span class="line">            title: <span class="string">&#x27;router.system&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          component: <span class="string">&#x27;layout/routerview/Parent&#x27;</span>,</span><br><span class="line">          children: [</span><br><span class="line">            &#123;</span><br><span class="line">              path: <span class="string">&#x27;/system/menu&#x27;</span>,</span><br><span class="line">              meta: &#123;</span><br><span class="line">                roles: [<span class="string">&#x27;admin&#x27;</span>],</span><br><span class="line">                title: <span class="string">&#x27;router.system_menu&#x27;</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">              name: <span class="string">&#x27;router.system_menu&#x27;</span>,</span><br><span class="line">              component: <span class="string">&#x27;view/system/menu&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              path: <span class="string">&#x27;/system/role&#x27;</span>,</span><br><span class="line">              meta: &#123;</span><br><span class="line">                roles: [<span class="string">&#x27;admin&#x27;</span>],</span><br><span class="line">                title: <span class="string">&#x27;router.system_role&#x27;</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">              name: <span class="string">&#x27;router.system_role&#x27;</span>,</span><br><span class="line">              component: <span class="string">&#x27;view/system/role&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              path: <span class="string">&#x27;/system/user&#x27;</span>,</span><br><span class="line">              meta: &#123;</span><br><span class="line">                roles: [<span class="string">&#x27;admin&#x27;</span>],</span><br><span class="line">                title: <span class="string">&#x27;router.system_user&#x27;</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">              name: <span class="string">&#x27;router.system_user&#x27;</span>,</span><br><span class="line">              component: <span class="string">&#x27;view/system/user&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              path: <span class="string">&#x27;/system/dept&#x27;</span>,</span><br><span class="line">              meta: &#123;</span><br><span class="line">                roles: [<span class="string">&#x27;admin&#x27;</span>],</span><br><span class="line">                title: <span class="string">&#x27;router.system_dept&#x27;</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">              name: <span class="string">&#x27;router.system_dept&#x27;</span>,</span><br><span class="line">              component: <span class="string">&#x27;view/system/dept&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通用户看到的菜单</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> commonRouter = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    code: <span class="number">200</span>,</span><br><span class="line">    msg: <span class="string">&#x27;成功&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      rows: [</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">          meta: &#123;</span><br><span class="line">            roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">            title: <span class="string">&#x27;router.home&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          name: <span class="string">&#x27;router.home&#x27;</span>,</span><br><span class="line">          component: <span class="string">&#x27;view/home/home.vue&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">          meta: &#123;</span><br><span class="line">            roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">            title: <span class="string">&#x27;router.about&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          name: <span class="string">&#x27;router.about&#x27;</span>,</span><br><span class="line">          component: <span class="string">&#x27;view/about/about&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&#x27;/order&#x27;</span>,</span><br><span class="line">          meta: &#123;</span><br><span class="line">            roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">            title: <span class="string">&#x27;router.order&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          name: <span class="string">&#x27;router.order&#x27;</span>,</span><br><span class="line">          component: <span class="string">&#x27;layout/routerview/Parent&#x27;</span>,</span><br><span class="line">          children: [</span><br><span class="line">            &#123;</span><br><span class="line">              path: <span class="string">&#x27;/order/list&#x27;</span>,</span><br><span class="line">              meta: &#123;</span><br><span class="line">                roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">                title: <span class="string">&#x27;router.order_list&#x27;</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">              name: <span class="string">&#x27;router.order_list&#x27;</span>,</span><br><span class="line">              component: <span class="string">&#x27;view/order/list&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              path: <span class="string">&#x27;/order/stock&#x27;</span>,</span><br><span class="line">              meta: &#123;</span><br><span class="line">                roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">                title: <span class="string">&#x27;router.order_stock&#x27;</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">              name: <span class="string">&#x27;router.order_stock&#x27;</span>,</span><br><span class="line">              component: <span class="string">&#x27;layout/routerview/Parent&#x27;</span>,</span><br><span class="line">              children: [</span><br><span class="line">                &#123;</span><br><span class="line">                  path: <span class="string">&#x27;/order/price&#x27;</span>,</span><br><span class="line">                  meta: &#123;</span><br><span class="line">                    roles: [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">                    title: <span class="string">&#x27;router.order_stock_price&#x27;</span>,</span><br><span class="line">                  &#125;,</span><br><span class="line">                  name: <span class="string">&#x27;router.order_stock_price&#x27;</span>,</span><br><span class="line">                  component: <span class="string">&#x27;view/order/price&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">              ],</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加模拟获取菜单数据的接口"><a href="#添加模拟获取菜单数据的接口" class="headerlink" title="添加模拟获取菜单数据的接口"></a>添加模拟获取菜单数据的接口</h3><p>新建：src/api/menu/index.ts，这个里面来获取上面接口的返回值</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; adminRouter, commonRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;../testrouter&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; userInfo &#125; <span class="keyword">from</span> <span class="string">&#x27;../../stores/userInfo&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模拟获取后端返回的路由集合</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;Promise&lt;unknown&gt;&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getRouterListFun = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> username = userInfo().getUserInfo().userName</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (username === <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">      resolve(adminRouter())</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      resolve(commonRouter())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加模拟返回用户信息的接口"><a href="#添加模拟返回用户信息的接口" class="headerlink" title="添加模拟返回用户信息的接口"></a>添加模拟返回用户信息的接口</h3><p>接着新建模拟登录接口：src/api/login/index.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getUerInfoFun = <span class="function">(<span class="params">parames: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 获取登录表单传递过来的参数</span></span><br><span class="line">    <span class="built_in">console</span>.log(parames)</span><br><span class="line">    resolve(&#123;</span><br><span class="line">      code: <span class="number">200</span>,</span><br><span class="line">      msg: <span class="string">&#x27;成功&#x27;</span>,</span><br><span class="line">      data: &#123;</span><br><span class="line">        info: &#123;</span><br><span class="line">          userName: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">          photo:</span><br><span class="line">            <span class="string">&#x27;https://img2.baidu.com/it/u=1978192862,2048448374&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=504&amp;h=500&#x27;</span>,</span><br><span class="line">          time: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(),</span><br><span class="line">          roles: [<span class="string">&#x27;admin&#x27;</span>],</span><br><span class="line">          authBtnList: [<span class="string">&#x27;btn.add&#x27;</span>, <span class="string">&#x27;btn.del&#x27;</span>, <span class="string">&#x27;btn.edit&#x27;</span>, <span class="string">&#x27;btn.link&#x27;</span>],</span><br><span class="line">          token: <span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="封装获取菜单，保存菜单的方法"><a href="#封装获取菜单，保存菜单的方法" class="headerlink" title="封装获取菜单，保存菜单的方法"></a>封装获取菜单，保存菜单的方法</h3><p>新建 src/router/backEnd.ts，用于处理后端返回的数据</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; RouteRecordRaw &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Session &#125; <span class="keyword">from</span> <span class="string">&#x27;../utils/storage&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getRouterListFun &#125; <span class="keyword">from</span> <span class="string">&#x27;../api/menu&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useRequestOldRoutes &#125; <span class="keyword">from</span> <span class="string">&#x27;../stores/requestOldRoutes&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; dynamicRoutes, notFoundAndNoPower &#125; <span class="keyword">from</span> <span class="string">&#x27;./routes&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; formatFlatteningRoutes, formatTwoStageRoutes, router &#125; <span class="keyword">from</span> <span class="string">&#x27;./index&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; routesList &#125; <span class="keyword">from</span> <span class="string">&#x27;../stores/routesList&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useTagsViewRoutes &#125; <span class="keyword">from</span> <span class="string">&#x27;../stores/tagsViewRoutes&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> layouModules: <span class="built_in">any</span> = <span class="keyword">import</span>.meta.glob(<span class="string">&#x27;../layout/routerView/*.&#123;vue,tsx&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> viewsModules: <span class="built_in">any</span> = <span class="keyword">import</span>.meta.glob(<span class="string">&#x27;../view/**/*.&#123;vue,tsx&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 后端控制路由</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取目录下的 .vue、.tsx 全部文件</span></span><br><span class="line"><span class="comment"> * key是组件的地址，value为 component 函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method </span>import.meta.glob</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@link </span>参考：https://cn.vitejs.dev/guide/features.html#json</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> dynamicViewsModules: Record&lt;<span class="built_in">string</span>, <span class="built_in">Function</span>&gt; = <span class="built_in">Object</span>.assign(</span><br><span class="line">  &#123;&#125;,</span><br><span class="line">  &#123; ...layouModules &#125;,</span><br><span class="line">  &#123; ...viewsModules &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后端控制路由：初始化方法，防止刷新时路由丢失</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method </span>NextLoading 界面 loading 动画开始执行</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method </span>useUserInfo().setUserInfos() 触发初始化用户信息 pinia</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method </span>useRequestOldRoutes().setRequestOldRoutes() 存储接口原始路由（未处理component），根据需求选择使用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method </span>setAddRoute 添加动态路由</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method </span>setFilterMenuAndCacheTagsViewRoutes 设置路由到 vuex routesList 中（已处理成多级嵌套路由）及缓存多级嵌套数组处理后的一维数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">initBackEndControlRoutes</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 无 token 停止执行下一步</span></span><br><span class="line">  <span class="keyword">if</span> (!Session.get(<span class="string">&#x27;token&#x27;</span>)) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment">// 获取路由菜单数据</span></span><br><span class="line">  <span class="keyword">const</span> res: <span class="built_in">any</span> = <span class="keyword">await</span> getRouterListFun()</span><br><span class="line">  <span class="comment">// 存储接口原始路由（未处理component），根据需求选择使用</span></span><br><span class="line">  <span class="keyword">await</span> useRequestOldRoutes().setRequestOldRoutes(</span><br><span class="line">    <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(res.data.rows))</span><br><span class="line">  )</span><br><span class="line">  <span class="comment">// 清空路由，避免出错</span></span><br><span class="line">  dynamicRoutes[<span class="number">0</span>].children = []</span><br><span class="line">  <span class="comment">// 处理路由（component），替换 dynamicRoutes（/@/router/route）第一个顶级 children 的路由</span></span><br><span class="line">  dynamicRoutes[<span class="number">0</span>].children = <span class="keyword">await</span> backEndComponent(res.data.rows)</span><br><span class="line">  <span class="comment">// 添加动态路由</span></span><br><span class="line">  <span class="keyword">await</span> setAddRoute()</span><br><span class="line">  <span class="comment">// 设置路由到 vuex routesList 中（已处理成多级嵌套路由）及缓存多级嵌套数组处理后的一维数组</span></span><br><span class="line">  <span class="keyword">await</span> setFilterMenuAndCacheTagsViewRoutes()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置路由到 vuex routesList 中（已处理成多级嵌套路由）及缓存多级嵌套数组处理后的一维数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>用于左侧菜单、横向菜单的显示</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>用于 tagsView、菜单搜索中：未过滤隐藏的(isHide)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setFilterMenuAndCacheTagsViewRoutes</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 保存处理后的数据</span></span><br><span class="line">  routesList().setRouterList(dynamicRoutes[<span class="number">0</span>].children)</span><br><span class="line">  setCacheTagsViewRoutes()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 缓存多级嵌套数组处理后的一维数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>用于 tagsView、菜单搜索中：未过滤隐藏的(isHide)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setCacheTagsViewRoutes</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> storesTagsView = useTagsViewRoutes()</span><br><span class="line">  storesTagsView.setTagsViewRoutes(</span><br><span class="line">    formatTwoStageRoutes(formatFlatteningRoutes(dynamicRoutes))[<span class="number">0</span>].children</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理路由格式及添加捕获所有路由或 404 Not found 路由</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>替换 dynamicRoutes（/@/router/route）第一个顶级 children 的路由</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>返回替换后的路由数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setFilterRouteEnd</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> filterRouteEnd: <span class="built_in">any</span> = formatTwoStageRoutes(</span><br><span class="line">    formatFlatteningRoutes(dynamicRoutes)</span><br><span class="line">  )</span><br><span class="line">  filterRouteEnd[<span class="number">0</span>].children = [</span><br><span class="line">    ...filterRouteEnd[<span class="number">0</span>].children,</span><br><span class="line">    ...notFoundAndNoPower,</span><br><span class="line">  ]</span><br><span class="line">  <span class="keyword">return</span> filterRouteEnd</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加动态路由</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method </span>router.addRoute</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>此处循环为 dynamicRoutes（/@/router/route）第一个顶级 children 的路由一维数组，非多级嵌套</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@link </span>参考：https://next.router.vuejs.org/zh/api/#addroute</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">setAddRoute</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">await</span> setFilterRouteEnd().forEach(<span class="function">(<span class="params">route: RouteRecordRaw</span>) =&gt;</span> &#123;</span><br><span class="line">    router.addRoute(route)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后端路由 component 转换</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>routes 后端返回的路由表数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>返回处理成函数后的 component</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">backEndComponent</span>(<span class="params">routes: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!routes) <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">return</span> routes.map(<span class="function">(<span class="params">item: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (item.component)</span><br><span class="line">      item.component = dynamicImport(</span><br><span class="line">        dynamicViewsModules,</span><br><span class="line">        item.component <span class="keyword">as</span> <span class="built_in">string</span></span><br><span class="line">      )</span><br><span class="line">    item.children &amp;&amp; backEndComponent(item.children)</span><br><span class="line">    <span class="keyword">return</span> item</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后端路由 component 转换函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>dynamicViewsModules 获取目录下的 .vue、.tsx 全部文件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>component 当前要处理项 component</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>返回处理成函数后的 component</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">dynamicImport</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  dynamicViewsModules: Record&lt;<span class="built_in">string</span>, <span class="built_in">Function</span>&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  component: <span class="built_in">string</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(dynamicViewsModules)</span><br><span class="line">  <span class="keyword">const</span> matchKeys = keys.filter(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> k = key.replace(<span class="regexp">/..\//</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> k.startsWith(<span class="string">`<span class="subst">$&#123;component&#125;</span>`</span>) || k.startsWith(<span class="string">`/<span class="subst">$&#123;component&#125;</span>`</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">if</span> (matchKeys?.length === <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> matchKey = matchKeys[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> dynamicViewsModules[matchKey]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (matchKeys?.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加辅助文件"><a href="#添加辅助文件" class="headerlink" title="添加辅助文件"></a>添加辅助文件</h3><p>上面的代码中引用了下面的文件</p>
<p>src/stores/requestOldRoutes.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后端返回原始路由(未处理时)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@methods </span>setCacheKeepAlive 设置接口原始路由数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useRequestOldRoutes = defineStore(<span class="string">&#x27;useRequestOldRoutes&#x27;</span>, &#123;</span><br><span class="line">  state: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    requestOldRoutes: [],</span><br><span class="line">  &#125;),</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">setRequestOldRoutes</span>(<span class="params">routes: <span class="built_in">any</span></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.requestOldRoutes = routes</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>src/stores/routesList.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一个参数是应用程序中 store 的唯一 id</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> routesList = defineStore(<span class="string">&#x27;routesList&#x27;</span>, &#123;</span><br><span class="line">  state: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    routesList: [],</span><br><span class="line">  &#125;),</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="comment">// 设置路由集合</span></span><br><span class="line">    <span class="function"><span class="title">setRouterList</span>(<span class="params">data: <span class="built_in">any</span></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.routesList = data</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>src/stores/tagsViewRoutes.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Session &#125; <span class="keyword">from</span> <span class="string">&#x27;../utils/storage&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * TagsView 路由列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@methods </span>setTagsViewRoutes 设置 TagsView 路由列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@methods </span>setCurrenFullscreen 设置开启/关闭全屏时的 boolean 状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useTagsViewRoutes = defineStore(<span class="string">&#x27;tagsViewRoutes&#x27;</span>, &#123;</span><br><span class="line">  state: (): <span class="function"><span class="params">any</span> =&gt;</span> (&#123;</span><br><span class="line">    tagsViewRoutes: [],</span><br><span class="line">    isTagsViewCurrenFull: <span class="literal">false</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">setTagsViewRoutes</span>(<span class="params">data: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.tagsViewRoutes = data</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function"><span class="title">setCurrenFullscreen</span>(<span class="params">bool: <span class="built_in">Boolean</span></span>)</span> &#123;</span><br><span class="line">      Session.set(<span class="string">&#x27;isTagsViewCurrenFull&#x27;</span>, bool)</span><br><span class="line">      <span class="built_in">this</span>.isTagsViewCurrenFull = bool</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="修改导出路由的文件"><a href="#修改导出路由的文件" class="headerlink" title="修改导出路由的文件"></a>修改导出路由的文件</h3><p>然后改写 src/router/routes.ts，分成三个部分导出</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">&#x27;../layout/index.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 动态路由</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> dynamicRoutes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    component: Layout,</span><br><span class="line">    redirect: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      isKeepAlive: <span class="literal">true</span>,</span><br><span class="line">      title: <span class="string">&#x27;首页&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    children: [],</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义404,401等路由</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> notFoundAndNoPower = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/:path(.*)*&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;notFound&#x27;</span>,</span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/view/error/404.vue&#x27;</span>),</span><br><span class="line">    meta: &#123;</span><br><span class="line">      title: <span class="string">&#x27;404&#x27;</span>,</span><br><span class="line">      isHide: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/401&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;noPower&#x27;</span>,</span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/view/error/401.vue&#x27;</span>),</span><br><span class="line">    meta: &#123;</span><br><span class="line">      title: <span class="string">&#x27;404&#x27;</span>,</span><br><span class="line">      isHide: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义静态路由（默认路由）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> staticRoutes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;router.login&#x27;</span>,</span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../view/login/index.vue&#x27;</span>),</span><br><span class="line">    meta: &#123;</span><br><span class="line">      title: <span class="string">&#x27;router.login&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="修改router文件"><a href="#修改router文件" class="headerlink" title="修改router文件"></a>修改router文件</h3><p>修改 src/router/index.ts，默认只加载一个 staticRoutes</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.从vue-router导出两个方法使用</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHashHistory, useRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; routesList &#125; <span class="keyword">from</span> <span class="string">&#x27;../stores/routesList&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; staticRoutes &#125; <span class="keyword">from</span> <span class="string">&#x27;./routes&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Session &#125; <span class="keyword">from</span> <span class="string">&#x27;../utils/storage&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; initBackEndControlRoutes &#125; <span class="keyword">from</span> <span class="string">&#x27;./backEnd&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">  <span class="comment">// 4. 内部提供了 history 模式的实现。为了简单起见，我们在这里使用 hash 模式。</span></span><br><span class="line">  history: createWebHashHistory(),</span><br><span class="line">  routes: staticRoutes, <span class="comment">// 加载静态路由</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 路由多级嵌套数组处理成一维数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>arr 传入路由菜单数据数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>返回处理后的一维路由菜单数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">formatFlatteningRoutes</span>(<span class="params">arr: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (arr.length &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (arr[i].children) &#123;</span><br><span class="line">      arr = arr.slice(<span class="number">0</span>, i + <span class="number">1</span>).concat(arr[i].children, arr.slice(i + <span class="number">1</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一维数组处理成多级嵌套数组（只保留二级：也就是二级以上全部处理成只有二级，keep-alive 支持二级缓存）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>isKeepAlive 处理 `name` 值，进行缓存。顶级关闭，全部不缓存</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@link </span>参考：https://v3.cn.vuejs.org/api/built-in-components.html#keep-alive</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>arr 处理后的一维路由菜单数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns </span>返回将一维数组重新处理成 `定义动态路由（dynamicRoutes）` 的格式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">formatTwoStageRoutes</span>(<span class="params">arr: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (arr.length &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  <span class="keyword">const</span> newArr: <span class="built_in">any</span> = []</span><br><span class="line">  <span class="keyword">const</span> cacheList: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt; = []</span><br><span class="line">  arr.forEach(<span class="function">(<span class="params">v: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (v.path === <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">      newArr.push(&#123;</span><br><span class="line">        component: v.component,</span><br><span class="line">        name: v.name,</span><br><span class="line">        path: v.path,</span><br><span class="line">        redirect: v.redirect,</span><br><span class="line">        meta: v.meta,</span><br><span class="line">        children: [],</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 判断是否是动态路由（xx/:id/:name），用于 tagsView 等中使用</span></span><br><span class="line">      <span class="keyword">if</span> (v.path.indexOf(<span class="string">&#x27;/:&#x27;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">        v.meta[<span class="string">&#x27;isDynamic&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">        v.meta[<span class="string">&#x27;isDynamicPath&#x27;</span>] = v.path</span><br><span class="line">      &#125;</span><br><span class="line">      newArr[<span class="number">0</span>].children.push(&#123; ...v &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> newArr</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由加载前</span></span><br><span class="line">router.beforeEach(<span class="keyword">async</span> (to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> token = Session.get(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (to.path === <span class="string">&#x27;/login&#x27;</span> &amp;&amp; !token) &#123;</span><br><span class="line">    next()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!token) &#123;</span><br><span class="line">      next(</span><br><span class="line">        <span class="string">`/login?redirect=<span class="subst">$&#123;to.path&#125;</span>&amp;params=<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(</span></span></span><br><span class="line"><span class="string"><span class="subst">          to.query ? to.query : to.params</span></span></span><br><span class="line"><span class="string"><span class="subst">        )&#125;</span>`</span></span><br><span class="line">      )</span><br><span class="line">      Session.clear()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (token &amp;&amp; to.path === <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">      next(<span class="string">&#x27;/home&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 判断pinia中是否有路由信息</span></span><br><span class="line">      <span class="keyword">if</span> (routesList().routesList.length === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 后端控制路由：路由数据初始化，防止刷新时丢失</span></span><br><span class="line">        <span class="keyword">await</span> initBackEndControlRoutes()</span><br><span class="line">        <span class="comment">// 动态添加路由：防止非首页刷新时跳转回首页的问题</span></span><br><span class="line">        next(&#123; ...to, <span class="attr">replace</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        next()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出路由</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>

<h3 id="添加登录页面完成测试"><a href="#添加登录页面完成测试" class="headerlink" title="添加登录页面完成测试"></a>添加登录页面完成测试</h3><p>最后添加登录页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;login&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; useRoute, useRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; getUerInfoFun &#125; <span class="keyword">from</span> <span class="string">&#x27;../../api/login&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; userInfo &#125; <span class="keyword">from</span> <span class="string">&#x27;../../stores/userInfo&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; initBackEndControlRoutes &#125; <span class="keyword">from</span> <span class="string">&#x27;../../router/backEnd&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> state = reactive(&#123;</span></span><br><span class="line">  router: useRouter(),</span><br><span class="line">  route: useRoute(),</span><br><span class="line">  loginForm: &#123;</span><br><span class="line"><span class="javascript">    username: <span class="string">&#x27;admin&#x27;</span>,</span></span><br><span class="line"><span class="javascript">    password: <span class="string">&#x27;123456&#x27;</span>,</span></span><br><span class="line">    code: 1234,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> login = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 获取用户信息</span></span></span><br><span class="line"><span class="javascript">  getUerInfoFun(state.loginForm).then(<span class="keyword">async</span> (res: any) =&gt; &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 保存用户基本信息</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">await</span> userInfo().setUserInfos(res.data.info)</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 获取路由信息</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">await</span> initBackEndControlRoutes()</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 进行路由跳转</span></span></span><br><span class="line">    siginSuccess()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> siginSuccess = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 跳转到上次关闭的页面</span></span></span><br><span class="line">  if (state.route.query?.redirect) &#123;</span><br><span class="line">    state.router.push(&#123;</span><br><span class="line"><span class="handlebars"><span class="xml">      path: <span class="tag">&lt;<span class="name">string</span>&gt;</span>state.route.query?.redirect,</span></span></span><br><span class="line">      query:</span><br><span class="line"><span class="javascript">        <span class="built_in">Object</span>.keys(&lt;string&gt;state.route.query?.params).length &gt; <span class="number">0</span></span></span><br><span class="line"><span class="javascript">          ? <span class="built_in">JSON</span>.parse(&lt;string&gt;state.route.query?.params)</span></span><br><span class="line"><span class="javascript">          : <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line">    &#125;)</span><br><span class="line"><span class="javascript">  &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 跳转到首页</span></span></span><br><span class="line"><span class="javascript">    state.router.push(<span class="string">&#x27;/&#x27;</span>)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="实现退出登录方法"><a href="#实现退出登录方法" class="headerlink" title="实现退出登录方法"></a>实现退出登录方法</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; userInfo().getUserInfo().userName &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-dropdown</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;user-img&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;userInfo().getUserInfo().photo&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> #<span class="attr">dropdown</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-dropdown-menu</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-dropdown-item</span> @<span class="attr">click</span>=<span class="string">&quot;logOut&quot;</span></span></span><br><span class="line"><span class="tag">          &gt;</span>&#123;&#123; t(&#x27;router.log_out&#x27;) &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-dropdown-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-dropdown-menu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-dropdown</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; Session &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/storage&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; userInfo &#125; <span class="keyword">from</span> <span class="string">&#x27;@/stores/userInfo&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; useI18n &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-i18n&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> &#123; t &#125; = useI18n()</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> state = reactive(&#123;</span></span><br><span class="line">  router: useRouter(),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> logOut = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">  Session.clear()</span><br><span class="line">  state.router.push(&#123;</span><br><span class="line"><span class="javascript">    path: <span class="string">&#x27;/login&#x27;</span>,</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span>&gt;</span></span><br><span class="line">.user-img &#123;</span><br><span class="line"><span class="css">  <span class="attribute">width</span>: <span class="number">44px</span>;</span></span><br><span class="line"><span class="css">  <span class="attribute">height</span>: <span class="number">44px</span>;</span></span><br><span class="line"><span class="css">  <span class="attribute">border-radius</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="css">  <span class="attribute">border</span>: <span class="number">2px</span> <span class="built_in">var</span>(--el-color-primary) solid;</span></span><br><span class="line"><span class="css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">  <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">  <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"></span><br><span class="line"><span class="css">  <span class="selector-tag">img</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">border-radius</span>: <span class="number">50px</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="测试不同人员返回不同菜单"><a href="#测试不同人员返回不同菜单" class="headerlink" title="测试不同人员返回不同菜单"></a>测试不同人员返回不同菜单</h3><p>首先我们直接写死一个用户名为 test 的用户来登录</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-22_18-38-13.png" alt="8558467.jpg"></p>
<p>查看菜单，没有系统管理的菜单</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-22_18-36-06.png" alt="8558467.jpg"></p>
<p>然后再用 admin 登录</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-22_18-39-27.png" alt="8558467.jpg"></p>
<p>修改后，重新登录查看菜单</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-22_18-40-37.png" alt="8558467.jpg"></p>
<h2 id="在js中使用scss变量"><a href="#在js中使用scss变量" class="headerlink" title="在js中使用scss变量"></a>在js中使用scss变量</h2><p>首先创建 scss 变量文件 primary.module.scss</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$primary-color</span>: var(--el-color-primary);</span><br><span class="line"></span><br><span class="line">:export &#123;</span><br><span class="line">  primaryColor: <span class="variable">$primary-color</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>需要注意的是，在 <code>vite</code> 创建的项目中，如果你想在 <code>js</code> 里引用 <code>scss</code> 文件，需要在后缀前加上 <code>.module</code> 。</strong></p>
<p>然后再 js 中引入，html 中直接使用对应的变量即可</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table</span><br><span class="line">          :header-cell-style=&quot;&#123; background: exCss.primaryColor, color: &#x27;#fff&#x27; &#125;&quot;</span><br><span class="line">          :data=&quot;state.tableData&quot;</span><br><span class="line">          stripe</span><br><span class="line">          style=&quot;width: 100%&quot;</span><br><span class="line">&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;date&quot;</span> <span class="attr">label</span>=<span class="string">&quot;Date&quot;</span> <span class="attr">width</span>=<span class="string">&quot;180&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span> <span class="attr">label</span>=<span class="string">&quot;Name&quot;</span> <span class="attr">width</span>=<span class="string">&quot;180&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;address&quot;</span> <span class="attr">label</span>=<span class="string">&quot;Address&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> exCss <span class="keyword">from</span> <span class="string">&#x27;@/style/module/primary.module.scss&#x27;</span></span><br></pre></td></tr></table></figure>

<p>我这里做了一个表头的背景色跟着主题色变化的功能</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-25_16-22-58.png" alt="8558467.jpg"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-25_16-23-40.png" alt="8558467.jpg"></p>
<h2 id="webstorm设置代码块"><a href="#webstorm设置代码块" class="headerlink" title="webstorm设置代码块"></a>webstorm设置代码块</h2><p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-26_17-33-34.png" alt="8558467.jpg"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-26_17-34-53.png" alt="8558467.jpg"></p>
<h2 id="自动导入vue3相关Api"><a href="#自动导入vue3相关Api" class="headerlink" title="自动导入vue3相关Api"></a>自动导入vue3相关Api</h2><h3 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -D unplugin-vue-components unplugin-auto-import</span><br></pre></td></tr></table></figure>

<h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;defineConfig&#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> AutoImport <span class="keyword">from</span> <span class="string">&#x27;unplugin-auto-import/vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Components <span class="keyword">from</span> <span class="string">&#x27;unplugin-vue-components/vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;ElementPlusResolver&#125; <span class="keyword">from</span> <span class="string">&#x27;unplugin-vue-components/resolvers&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        vue(),</span><br><span class="line">        AutoImport(&#123;</span><br><span class="line">            <span class="comment">// Auto import functions from Vue, e.g. ref, reactive, toRef...</span></span><br><span class="line">            <span class="comment">// 自动导入 Vue 相关函数，如：ref, reactive, toRef 等</span></span><br><span class="line">            imports: [<span class="string">&#x27;vue&#x27;</span>],</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">// Auto import functions from Element Plus, e.g. ElMessage, ElMessageBox... (with style)</span></span><br><span class="line">            <span class="comment">// 自动导入 Element Plus 相关函数，如：ElMessage, ElMessageBox... (带样式)</span></span><br><span class="line">            resolvers: [</span><br><span class="line">                ElementPlusResolver(),</span><br><span class="line">            ],</span><br><span class="line">        &#125;),</span><br><span class="line"></span><br><span class="line">        Components(&#123;</span><br><span class="line">            resolvers: [</span><br><span class="line">                <span class="comment">// 自动导入 Element Plus 组件</span></span><br><span class="line">                ElementPlusResolver(),</span><br><span class="line">            ],</span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="添加自动依赖"><a href="#添加自动依赖" class="headerlink" title="添加自动依赖"></a>添加自动依赖</h3><p>重启项目后会自动生成两个文件</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-28_09-47-08.png" alt="8558467.jpg"></p>
<p>其中 auto-import.d.ts 文件里面声明了所有可以自动引入的 Api</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>设置完成后，在页面使用 reactive，ref，onMounted 等函数时，无需从 vue 中导出，可以直接使用。示例如下</p>
<p>在使用过程中也通过 webStorm 可以看到改函数的来源</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-28_09-52-18.png" alt="8558467.jpg"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    count:&#123;&#123; state.total &#125;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> state = reactive(&#123;</span></span><br><span class="line">  total: 0</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> add = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">  state.total += 1</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果在页面中可以正常显示，控制台也没有报错</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/Snipaste_2022-10-28_09-57-00.png" alt="8558467.jpg"></p>
<h2 id="自定义全局loading"><a href="#自定义全局loading" class="headerlink" title="自定义全局loading"></a>自定义全局loading</h2><p>首先添加css样式文件 src/style/loading.scss</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.loading-next</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100vw</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">99999</span>;</span><br><span class="line"></span><br><span class="line">  &amp;<span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: black;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.6</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.loading-next</span> <span class="selector-class">.loading-next-box</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: translate(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.loading-next</span> <span class="selector-class">.loading-next-box-warp</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">80px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">80px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.loading-next</span> <span class="selector-class">.loading-next-box-warp</span> <span class="selector-class">.loading-next-box-item</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">33.333333%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">33.333333%</span>;</span><br><span class="line">  <span class="attribute">background</span>: var(--el-color-primary);</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">animation</span>: loading-next-animation <span class="number">1.2s</span> infinite ease;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.loading-next</span> <span class="selector-class">.loading-next-box-warp</span> <span class="selector-class">.loading-next-box-item</span><span class="selector-pseudo">:nth-child</span>(<span class="number">7</span>) &#123;</span><br><span class="line">  <span class="attribute">animation-delay</span>: <span class="number">0s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.loading-next</span> <span class="selector-class">.loading-next-box-warp</span> <span class="selector-class">.loading-next-box-item</span><span class="selector-pseudo">:nth-child</span>(<span class="number">4</span>),</span><br><span class="line"><span class="selector-class">.loading-next</span> <span class="selector-class">.loading-next-box-warp</span> <span class="selector-class">.loading-next-box-item</span><span class="selector-pseudo">:nth-child</span>(<span class="number">8</span>) &#123;</span><br><span class="line">  <span class="attribute">animation-delay</span>: <span class="number">0.1s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.loading-next</span> <span class="selector-class">.loading-next-box-warp</span> <span class="selector-class">.loading-next-box-item</span><span class="selector-pseudo">:nth-child</span>(<span class="number">1</span>),</span><br><span class="line"><span class="selector-class">.loading-next</span> <span class="selector-class">.loading-next-box-warp</span> <span class="selector-class">.loading-next-box-item</span><span class="selector-pseudo">:nth-child</span>(<span class="number">5</span>),</span><br><span class="line"><span class="selector-class">.loading-next</span> <span class="selector-class">.loading-next-box-warp</span> <span class="selector-class">.loading-next-box-item</span><span class="selector-pseudo">:nth-child</span>(<span class="number">9</span>) &#123;</span><br><span class="line">  <span class="attribute">animation-delay</span>: <span class="number">0.2s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.loading-next</span> <span class="selector-class">.loading-next-box-warp</span> <span class="selector-class">.loading-next-box-item</span><span class="selector-pseudo">:nth-child</span>(<span class="number">2</span>),</span><br><span class="line"><span class="selector-class">.loading-next</span> <span class="selector-class">.loading-next-box-warp</span> <span class="selector-class">.loading-next-box-item</span><span class="selector-pseudo">:nth-child</span>(<span class="number">6</span>) &#123;</span><br><span class="line">  <span class="attribute">animation-delay</span>: <span class="number">0.3s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.loading-next</span> <span class="selector-class">.loading-next-box-warp</span> <span class="selector-class">.loading-next-box-item</span><span class="selector-pseudo">:nth-child</span>(<span class="number">3</span>) &#123;</span><br><span class="line">  <span class="attribute">animation-delay</span>: <span class="number">0.4s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> loading-next-animation &#123;</span><br><span class="line">  0%,</span><br><span class="line">  70%,</span><br><span class="line">  100% &#123;</span><br><span class="line">    <span class="attribute">transform</span>: scale3D(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  35% &#123;</span><br><span class="line">    <span class="attribute">transform</span>: scale3D(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加 src/utils/loading.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; nextTick &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../style/loading.scss&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 页面全局 Loading</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method </span>start 创建 loading</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@method </span>done 移除 loading</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> zxLoading = &#123;</span><br><span class="line">  <span class="comment">// 创建 loading</span></span><br><span class="line">  show: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> bodys: Element = <span class="built_in">document</span>.body</span><br><span class="line">    <span class="keyword">const</span> div = &lt;HTMLElement&gt;<span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">    div.setAttribute(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;loading-next&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> htmls = <span class="string">`</span></span><br><span class="line"><span class="string">         &lt;div class=&quot;loading-next-box&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;loading-next-box-warp&quot;&gt;</span></span><br><span class="line"><span class="string">               &lt;div class=&quot;loading-next-box-item&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">               &lt;div class=&quot;loading-next-box-item&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">               &lt;div class=&quot;loading-next-box-item&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">               &lt;div class=&quot;loading-next-box-item&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">               &lt;div class=&quot;loading-next-box-item&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">               &lt;div class=&quot;loading-next-box-item&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">               &lt;div class=&quot;loading-next-box-item&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">               &lt;div class=&quot;loading-next-box-item&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">               &lt;div class=&quot;loading-next-box-item&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">         &lt;/div&gt;</span></span><br><span class="line"><span class="string">      `</span></span><br><span class="line">    div.innerHTML = htmls</span><br><span class="line">    bodys.insertBefore(div, bodys.childNodes[<span class="number">0</span>])</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 移除 loading</span></span><br><span class="line">  hidden: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> el = &lt;HTMLElement&gt;<span class="built_in">document</span>.querySelector(<span class="string">&#x27;.loading-next&#x27;</span>)</span><br><span class="line">      el?.parentNode?.removeChild(el)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; zxLoading &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/loading&#x27;</span></span><br><span class="line"></span><br><span class="line">zxLoading.show()</span><br><span class="line">  </span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    zxLoading.hidden()</span><br><span class="line">&#125;,<span class="number">2000</span>)</span><br></pre></td></tr></table></figure>

<h2 id="CSS设置动画"><a href="#CSS设置动画" class="headerlink" title="CSS设置动画"></a>CSS设置动画</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;err-text&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>404<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line">.err-text &#123;</span><br><span class="line"><span class="css">  <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">  <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="css">  <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="css">  <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="css">  <span class="attribute">font-weight</span>: <span class="number">700</span>;</span></span><br><span class="line"><span class="css">  <span class="attribute">font-size</span>: <span class="number">70px</span>;</span></span><br><span class="line"><span class="css">  <span class="comment">/*设置动画名称，多少时间内完成，infinite:无限循环播放*/</span></span></span><br><span class="line"><span class="css">  <span class="attribute">animation</span>: zoom <span class="number">0.7s</span> infinite;</span></span><br><span class="line"><span class="css">  <span class="comment">/*开启反向动画*/</span></span></span><br><span class="line"><span class="css">  <span class="attribute">animation-direction</span>: alternate;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="css"><span class="keyword">@keyframes</span> zoom &#123;</span></span><br><span class="line">  0% &#123;</span><br><span class="line"><span class="css">    <span class="attribute">font-size</span>: <span class="number">70px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">color</span>: <span class="built_in">rgba</span>(<span class="number">242</span>, <span class="number">80</span>, <span class="number">80</span>, <span class="number">0.96</span>);</span></span><br><span class="line">  &#125;</span><br><span class="line">  100% &#123;</span><br><span class="line"><span class="css">    <span class="attribute">font-size</span>: <span class="number">120px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">color</span>: <span class="number">#8935ea</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果展示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images2/VeryCapture_20221028152622.gif" alt="8558467.jpg"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">SZX</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://songzx0106.github.io/Vue/zxtemplate/">https://songzx0106.github.io/Vue/zxtemplate/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://SongZX0106.github.io" target="_blank">SZX的开发笔记</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/vue3-0/">vue3.0</a></div><div class="post_share"><div class="social-share" data-image="/images/ys17.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/share.min.css" media="print" onload="this.media='all'"><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/images/wechat.png" target="_blank"><img class="post-qr-code-img" data-lazy-src="/images/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/images/alipay.jpg" target="_blank"><img class="post-qr-code-img" data-lazy-src="/images/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/JavaScript/20221028/"><img class="prev-cover" data-lazy-src="/images/ys12.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">为网站增加樱花飘落效果全站背景唯美樱花JS美化</div></div></a></div><div class="next-post pull-right"><a href="/JavaScript/tree/"><img class="next-cover" data-lazy-src="/images/ys04.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">树形结构和一维数组互转</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/Vue/Vue3/" title="Vue3.2 新特性"><img class="cover" data-lazy-src="/images/ys09.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-27</div><div class="title">Vue3.2 新特性</div></div></a></div><div><a href="/Vue/vue3ref/" title="Vue3中使用动态ref"><img class="cover" data-lazy-src="/images/ys12.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-17</div><div class="title">Vue3中使用动态ref</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="/images/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">SZX</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">140</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">34</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://gitee.com/szxio"><i class="iconfont icon-gitee-fill-round"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">welcome to my blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">项目简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E5%9C%B0%E5%9D%80"><span class="toc-number">1.1.</span> <span class="toc-text">源码地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.2.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">1.3.</span> <span class="toc-text">技术栈</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E6%88%AA%E5%9B%BE"><span class="toc-number">1.4.</span> <span class="toc-text">页面截图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E8%BF%90%E8%A1%8C"><span class="toc-number">2.</span> <span class="toc-text">本地运行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.</span> <span class="toc-text">创建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#elementui-plus"><span class="toc-number">4.</span> <span class="toc-text">elementui-plus</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">4.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%AF%BC%E5%85%A5"><span class="toc-number">4.2.</span> <span class="toc-text">组件自动导入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E6%89%80%E6%9C%89%E5%9B%BE%E6%A0%87"><span class="toc-number">4.3.</span> <span class="toc-text">注册所有图标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%BB%98%E8%AE%A4%E6%98%AF%E8%8B%B1%E6%96%87%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">4.4.</span> <span class="toc-text">解决默认是英文的问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0Router"><span class="toc-number">5.</span> <span class="toc-text">添加Router</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-%E8%B7%AF%E5%BE%84%E5%88%AB%E5%90%8D"><span class="toc-number">6.</span> <span class="toc-text">配置@路径别名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85prettier%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%8F%92%E4%BB%B6"><span class="toc-number">7.</span> <span class="toc-text">安装prettier代码格式化插件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pinia"><span class="toc-number">8.</span> <span class="toc-text">Pinia</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-number">8.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8pinia%E4%BF%9D%E5%AD%98%E8%B7%AF%E7%94%B1%E4%BF%A1%E6%81%AF"><span class="toc-number">8.2.</span> <span class="toc-text">使用pinia保存路由信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%92%E5%BD%92%E6%98%BE%E7%A4%BA%E5%A4%9A%E7%BA%A7%E8%8F%9C%E5%8D%95"><span class="toc-number">9.</span> <span class="toc-text">递归显示多级菜单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E6%9D%83%E9%99%90%E6%98%BE%E7%A4%BA%E8%8F%9C%E5%8D%95"><span class="toc-number">10.</span> <span class="toc-text">根据权限显示菜单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%82%B9%E5%87%BB%E8%8F%9C%E5%8D%95%E8%BF%9B%E8%A1%8C%E8%B7%AF%E7%94%B1%E8%B7%B3%E8%BD%AC"><span class="toc-number">11.</span> <span class="toc-text">实现点击菜单进行路由跳转</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E9%9D%A2%E5%8C%85%E5%B1%91%E5%AF%BC%E8%88%AA"><span class="toc-number">12.</span> <span class="toc-text">动态面包屑导航</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E6%9C%80%E5%A4%A7%E5%8C%96%E5%92%8C%E6%9C%80%E5%B0%8F%E5%8C%96"><span class="toc-number">13.</span> <span class="toc-text">页面最大化和最小化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E9%A2%98%E9%A2%9C%E8%89%B2%E8%87%AA%E5%AE%9A%E4%B9%89"><span class="toc-number">14.</span> <span class="toc-text">主题颜色自定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%9B%BD%E9%99%85%E5%8C%96"><span class="toc-number">15.</span> <span class="toc-text">设置国际化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1"><span class="toc-number">16.</span> <span class="toc-text">动态路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%BF%94%E5%9B%9E%E6%A8%A1%E6%8B%9F%E6%95%B0%E6%8D%AE%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">16.1.</span> <span class="toc-text">添加返回模拟数据的方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%A8%A1%E6%8B%9F%E8%8E%B7%E5%8F%96%E8%8F%9C%E5%8D%95%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="toc-number">16.2.</span> <span class="toc-text">添加模拟获取菜单数据的接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%A8%A1%E6%8B%9F%E8%BF%94%E5%9B%9E%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="toc-number">16.3.</span> <span class="toc-text">添加模拟返回用户信息的接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E8%8E%B7%E5%8F%96%E8%8F%9C%E5%8D%95%EF%BC%8C%E4%BF%9D%E5%AD%98%E8%8F%9C%E5%8D%95%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">16.4.</span> <span class="toc-text">封装获取菜单，保存菜单的方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%BE%85%E5%8A%A9%E6%96%87%E4%BB%B6"><span class="toc-number">16.5.</span> <span class="toc-text">添加辅助文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%AF%BC%E5%87%BA%E8%B7%AF%E7%94%B1%E7%9A%84%E6%96%87%E4%BB%B6"><span class="toc-number">16.6.</span> <span class="toc-text">修改导出路由的文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9router%E6%96%87%E4%BB%B6"><span class="toc-number">16.7.</span> <span class="toc-text">修改router文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E5%AE%8C%E6%88%90%E6%B5%8B%E8%AF%95"><span class="toc-number">16.8.</span> <span class="toc-text">添加登录页面完成测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95%E6%96%B9%E6%B3%95"><span class="toc-number">16.9.</span> <span class="toc-text">实现退出登录方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E4%B8%8D%E5%90%8C%E4%BA%BA%E5%91%98%E8%BF%94%E5%9B%9E%E4%B8%8D%E5%90%8C%E8%8F%9C%E5%8D%95"><span class="toc-number">16.10.</span> <span class="toc-text">测试不同人员返回不同菜单</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8js%E4%B8%AD%E4%BD%BF%E7%94%A8scss%E5%8F%98%E9%87%8F"><span class="toc-number">17.</span> <span class="toc-text">在js中使用scss变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webstorm%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%A0%81%E5%9D%97"><span class="toc-number">18.</span> <span class="toc-text">webstorm设置代码块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%AF%BC%E5%85%A5vue3%E7%9B%B8%E5%85%B3Api"><span class="toc-number">19.</span> <span class="toc-text">自动导入vue3相关Api</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-2"><span class="toc-number">19.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">19.2.</span> <span class="toc-text">修改配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%8A%A8%E4%BE%9D%E8%B5%96"><span class="toc-number">19.3.</span> <span class="toc-text">添加自动依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">19.4.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%A8%E5%B1%80loading"><span class="toc-number">20.</span> <span class="toc-text">自定义全局loading</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSS%E8%AE%BE%E7%BD%AE%E5%8A%A8%E7%94%BB"><span class="toc-number">21.</span> <span class="toc-text">CSS设置动画</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Vue/%E5%8A%A0%E8%BD%BD%E8%BF%9C%E7%A8%8Bvue%E6%96%87%E4%BB%B6/" title="使用 vue3-sfc-loader 在运行时动态加载 .vue 文件"><img data-lazy-src="/images/ys18.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 vue3-sfc-loader 在运行时动态加载 .vue 文件"/></a><div class="content"><a class="title" href="/Vue/%E5%8A%A0%E8%BD%BD%E8%BF%9C%E7%A8%8Bvue%E6%96%87%E4%BB%B6/" title="使用 vue3-sfc-loader 在运行时动态加载 .vue 文件">使用 vue3-sfc-loader 在运行时动态加载 .vue 文件</a><time datetime="2024-04-11T02:07:24.000Z" title="发表于 2024-04-11 10:07:24">2024-04-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/JavaScript/%E5%B7%A7%E7%94%A8CSS%E7%9A%84clamp%E5%87%BD%E6%95%B0/" title="巧用CSS的clamp函数"><img data-lazy-src="/images/ys09.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="巧用CSS的clamp函数"/></a><div class="content"><a class="title" href="/JavaScript/%E5%B7%A7%E7%94%A8CSS%E7%9A%84clamp%E5%87%BD%E6%95%B0/" title="巧用CSS的clamp函数">巧用CSS的clamp函数</a><time datetime="2024-03-14T02:04:37.000Z" title="发表于 2024-03-14 10:04:37">2024-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Vue/%E6%89%8B%E5%86%99vue3%E6%BA%90%E7%A0%81/" title="手写Vue3核心源码"><img data-lazy-src="/images/ys20.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="手写Vue3核心源码"/></a><div class="content"><a class="title" href="/Vue/%E6%89%8B%E5%86%99vue3%E6%BA%90%E7%A0%81/" title="手写Vue3核心源码">手写Vue3核心源码</a><time datetime="2024-03-09T02:40:34.000Z" title="发表于 2024-03-09 10:40:34">2024-03-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/JavaScript/%E4%BB%BFChatGPT%E5%85%89%E6%A0%87%E8%B7%9F%E9%9A%8F%E6%95%88%E6%9E%9C/" title="仿ChatGPT光标跟随效果"><img data-lazy-src="/images/ys14.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="仿ChatGPT光标跟随效果"/></a><div class="content"><a class="title" href="/JavaScript/%E4%BB%BFChatGPT%E5%85%89%E6%A0%87%E8%B7%9F%E9%9A%8F%E6%95%88%E6%9E%9C/" title="仿ChatGPT光标跟随效果">仿ChatGPT光标跟随效果</a><time datetime="2024-01-19T14:57:50.000Z" title="发表于 2024-01-19 22:57:50">2024-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Vue/20231224/" title="手写Vue2源码"><img data-lazy-src="/images/ys13.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="手写Vue2源码"/></a><div class="content"><a class="title" href="/Vue/20231224/" title="手写Vue2源码">手写Vue2源码</a><time datetime="2023-12-24T08:28:09.000Z" title="发表于 2023-12-24 16:28:09">2023-12-24</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/images/ys17.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By SZX</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">少年辛苦终身事，莫向光阴惰寸功。<a target="_blank" rel="noopener" href="https://gitee.com/szxio">My Gitee</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/instantpage.min.js" type="module"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'iJzt0X9OdhFCcdn4N0dJ86fY-gzGzoHsz',
      appKey: '8vtaRafgQSvU5ntYgszJfRW5',
      placeholder: '留下你的精彩评论',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/canvas-fluttering-ribbon.min.js"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/click-show-text.min.js" data-mobile="true" data-text="富强,民主,文明,和谐,自由,平等,公正,法制,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>