<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>React技术全家桶全套完整版 | SZX的开发笔记</title><meta name="keywords" content="React"><meta name="author" content="SZX"><meta name="copyright" content="SZX"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="第一章 React 入门源码地址：https:&#x2F;&#x2F;gitee.com&#x2F;szxio&#x2F;zero-basic-learning-react React 官网中文网地址 https:&#x2F;&#x2F;react.docschina.org&#x2F; React 特点 声明式编码 组件化编码 React Native 可以编写原生的应用 高效 （优秀的Diffing算法）  React 高效的原因 使用虚拟DOM不总是直接的操作">
<meta property="og:type" content="article">
<meta property="og:title" content="React技术全家桶全套完整版">
<meta property="og:url" content="https://songzx0106.github.io/React/01_React/index.html">
<meta property="og:site_name" content="SZX的开发笔记">
<meta property="og:description" content="第一章 React 入门源码地址：https:&#x2F;&#x2F;gitee.com&#x2F;szxio&#x2F;zero-basic-learning-react React 官网中文网地址 https:&#x2F;&#x2F;react.docschina.org&#x2F; React 特点 声明式编码 组件化编码 React Native 可以编写原生的应用 高效 （优秀的Diffing算法）  React 高效的原因 使用虚拟DOM不总是直接的操作">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://songzx0106.github.io/images/ys08.jpg">
<meta property="article:published_time" content="2021-12-13T07:20:19.000Z">
<meta property="article:modified_time" content="2023-04-04T07:55:05.752Z">
<meta property="article:author" content="SZX">
<meta property="article:tag" content="React">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://songzx0106.github.io/images/ys08.jpg"><link rel="shortcut icon" href="/images/favicon.png"><link rel="canonical" href="https://songzx0106.github.io/React/01_React/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":5000,"languages":{"author":"作者: SZX","link":"链接: ","source":"来源: SZX的开发笔记","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/jquery.min.js',
    justifiedGallery: {
      js: 'https://fastly.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://fastly.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://fastly.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-04 15:55:05'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2467717_jlvw8717b8.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/images/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">150</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/ys08.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">SZX的开发笔记</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">React技术全家桶全套完整版</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-12-13T07:20:19.000Z" title="发表于 2021-12-13 15:20:19">2021-12-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-04-04T07:55:05.752Z" title="更新于 2023-04-04 15:55:05">2023-04-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/React%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/">React快速入门</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">25.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>109分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="React技术全家桶全套完整版"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="第一章-React-入门"><a href="#第一章-React-入门" class="headerlink" title="第一章 React 入门"></a>第一章 React 入门</h2><p>源码地址：<a target="_blank" rel="noopener" href="https://gitee.com/szxio/zero-basic-learning-react">https://gitee.com/szxio/zero-basic-learning-react</a></p>
<h3 id="React-官网"><a href="#React-官网" class="headerlink" title="React 官网"></a>React 官网</h3><p>中文网地址</p>
<p><a target="_blank" rel="noopener" href="https://react.docschina.org/">https://react.docschina.org/</a></p>
<h3 id="React-特点"><a href="#React-特点" class="headerlink" title="React 特点"></a>React 特点</h3><ul>
<li>声明式编码</li>
<li>组件化编码</li>
<li>React Native 可以编写原生的应用</li>
<li>高效 （优秀的Diffing算法）</li>
</ul>
<h3 id="React-高效的原因"><a href="#React-高效的原因" class="headerlink" title="React 高效的原因"></a>React 高效的原因</h3><ul>
<li>使用虚拟DOM不总是直接的操作页面真实DOM</li>
<li>DOM Diffing 算法，最小化的页面重绘</li>
</ul>
<h3 id="Hello-React"><a href="#Hello-React" class="headerlink" title="Hello React"></a>Hello React</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 准备一个容器，用来盛放页面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 首先引入react.development.js 这个是React核心库 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/react.development.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 其次引入react-dom 这个是React操作DOM的库，必须在核心库之后引入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/react-dom.development.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- babel是将jsx翻译成普通的js --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/babel.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 声明一个script标签，type值设置成 text/babel --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/babel&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 这里不能添加引号，因为当前写的是jsx</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> DOM = <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello React<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 引入react-dom后就有了ReactDOM.render() 方法，用来渲染页面</span></span></span><br><span class="line"><span class="javascript">    ReactDOM.render(DOM,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面代码可以在页面中渲染出一个 Hello React</p>
<p>注意点：</p>
<ul>
<li>必须先引入React核心库<code>react.development.js</code>，然后再引入<code>react-dom.development.js</code></li>
<li>必须将script标签的type设置为 text/babel，表明我们写的是 jsx</li>
<li>jsx里面的dom不能添加引号</li>
</ul>
<h3 id="jsx多级嵌套标签语法"><a href="#jsx多级嵌套标签语法" class="headerlink" title="jsx多级嵌套标签语法"></a>jsx多级嵌套标签语法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/babel&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">const</span> DOM = (</span><br><span class="line">        &lt;h1&gt;</span><br><span class="line">            &lt;span&gt;Hello React&lt;/span&gt;</span><br><span class="line">        &lt;/h1&gt;</span><br><span class="line">    )</span><br><span class="line">    ReactDOM.render(DOM,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>使用一个小括号包起来表示一个整体，在括号内可以换行，像书写 html 一样编写虚拟DOM</p>
<h3 id="jsx语法"><a href="#jsx语法" class="headerlink" title="jsx语法"></a>jsx语法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">    .title &#123;</span><br><span class="line">        background-color: orange;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=<span class="string">&quot;app&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src=<span class="string">&quot;../js/react.development.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;../js/react-dom.development.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;../js/babel.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/babel&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="string">&quot;Hello,React&quot;</span></span><br><span class="line">    <span class="keyword">const</span> myId = <span class="string">&quot;main&quot;</span></span><br><span class="line">    <span class="keyword">const</span> DOM = (</span><br><span class="line">        &lt;div id=&#123;myId&#125;&gt;</span><br><span class="line">            &lt;h1 style=&#123;&#123;<span class="attr">color</span>:<span class="string">&#x27;white&#x27;</span>,<span class="attr">fontSize</span>:<span class="string">&quot;25px&quot;</span>&#125;&#125;&gt;</span><br><span class="line">                &lt;span className=<span class="string">&quot;title&quot;</span>&gt;&#123;data&#125;&lt;/span&gt;    </span><br><span class="line">            &lt;/h1&gt;</span><br><span class="line">            &lt;h2&gt;hello world&lt;/h2&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;text&quot;</span> /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">    ReactDOM.render(DOM,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))    </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>jsx编写虚拟DOM时的语法</p>
<ul>
<li>必须存在一个根元素节点</li>
<li>虚拟DOM中混入JS时使用{}引入</li>
<li>定义class时使用className来定义类样式，避免和es6中的class类语法冲突</li>
<li>定义行内样式时要使用 <code>style=&#123;&#123; &#125;&#125;</code> ，样式要使用驼峰写法</li>
<li>虚拟DOM的标签必须闭合</li>
<li>虚拟DOM的标签首字母规则<ul>
<li>首字母小写时，react-dom 会直接吧该标签翻译成 html 中对应的标签</li>
<li>首字母大写时，react-dom 会认为这个标签是一个组件</li>
</ul>
</li>
</ul>
<h3 id="jsx练习-动态循环数组"><a href="#jsx练习-动态循环数组" class="headerlink" title="jsx练习:动态循环数组"></a>jsx练习:动态循环数组</h3><p>需求：使用jsx动态显示li</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=<span class="string">&quot;app&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;../js/react.development.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;../js/react-dom.development.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;../js/babel.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/babel&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">const</span> liList = [<span class="string">&quot;React&quot;</span>,<span class="string">&quot;Vue&quot;</span>,<span class="string">&quot;Angular&quot;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> DOM = (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;ul&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// jsx的花括号中只能包含js表达式</span></span><br><span class="line">                    liList.map(<span class="function">(<span class="params">item,index</span>)=&gt;</span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &lt;/ul&gt;    </span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">    ReactDOM.render(DOM,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>jsx会自动便利数组内容到页面中</p>
<h2 id="第二章-面向组件编程"><a href="#第二章-面向组件编程" class="headerlink" title="第二章 面向组件编程"></a>第二章 面向组件编程</h2><h3 id="定义函数式组件"><a href="#定义函数式组件" class="headerlink" title="定义函数式组件"></a>定义函数式组件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=<span class="string">&quot;app&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src=<span class="string">&quot;../js/react.development.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;../js/react-dom.development.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;../js/babel.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/babel&quot;</span>&gt;</span><br><span class="line">    <span class="comment">// 1.创建一个函数，首字母必须是大写</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>); </span><br><span class="line">        <span class="comment">// 这里的this是undefined，因为babel将jsx翻译成js后开启了严格模式，严格模式下禁止将自定义函数中的this指向window</span></span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>这是用函数定义的组件，适用于简单组件的定义<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.将组件渲染到页面中</span></span><br><span class="line">    ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span>/&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>)) </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>注意点：定义组件时，组件名称的首字母必须是大写</p>
<p>执行完 <code>ReactDOM.render(&lt;MyComponent/&gt;...</code>之后发生了什么？</p>
<ul>
<li>react找到了MyComponent组件</li>
<li>发现该组件是使用函数式声明的，则调用这个函数获取返回的虚拟DOM</li>
<li>然后将虚拟DOM转成真实DOM渲染到页面中</li>
</ul>
<h3 id="定义一个类式组件"><a href="#定义一个类式组件" class="headerlink" title="定义一个类式组件"></a>定义一个类式组件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个类，继承 React.Component</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 添加render方法</span></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 这里render方法中的this指向的是Mycomponent类实例化出来的对象</span></span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>我是用类定的组件<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span>/&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>注意点：</p>
<ul>
<li>定义的类必须继承 <code>React.Component</code> 类</li>
<li>在自定义组件类中添加<code>render</code>方法，返回虚拟DOM</li>
</ul>
<p>上面代码中执行完<code>ReactDOM.render(&lt;MyComponent/&gt;....</code> 后发生了什么事？</p>
<ul>
<li>首先React解析组件时找到了<code>MyComponent</code>组件</li>
<li>发现该组件是用类创建的，所以自动实例化出来一个这个类的对象</li>
<li>调用该类的render方法获取返回的虚拟DOM</li>
<li>翻译虚拟DOM成真实DOM到页面上</li>
</ul>
<h3 id="组件实例化的三大属性1-state"><a href="#组件实例化的三大属性1-state" class="headerlink" title="组件实例化的三大属性1_state"></a>组件实例化的三大属性1_state</h3><p>页面上内容可以根据状态的改变而改变</p>
<h4 id="初始化状态"><a href="#初始化状态" class="headerlink" title="初始化状态"></a>初始化状态</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义类式组件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 给自定义组件添加构造器方法</span></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 添加super</span></span><br><span class="line">        <span class="built_in">super</span>(props)</span><br><span class="line">        <span class="comment">// 初始化state</span></span><br><span class="line">        <span class="built_in">this</span>.state = &#123;</span><br><span class="line">            isHot: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 从状态中读取isHot属性</span></span><br><span class="line">        <span class="keyword">const</span> &#123; isHot &#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="comment">// 根据属性值判断显示是否炎热</span></span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>今天的天气很&#123;isHot ? &#x27;炎热&#x27; : &#x27;凉爽&#x27;&#125; <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span>/&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br></pre></td></tr></table></figure>

<h4 id="添加事件绑定"><a href="#添加事件绑定" class="headerlink" title="添加事件绑定"></a>添加事件绑定</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义类式组件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 给自定义组件添加构造器方法</span></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 添加super</span></span><br><span class="line">        <span class="built_in">super</span>(props)</span><br><span class="line">        <span class="comment">// 初始化state</span></span><br><span class="line">        <span class="built_in">this</span>.state = &#123;</span><br><span class="line">            isHot: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 在构造器中通过bind改变changeIsHot方法中的this指向</span></span><br><span class="line">        <span class="comment">// 这里定义的changeIsHot添加在了类的本身对象上</span></span><br><span class="line">        <span class="built_in">this</span>.changeIsHot = <span class="built_in">this</span>.changeIsHot.bind(<span class="built_in">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>);</span><br><span class="line">        <span class="comment">// 从状态中读取isHot属性</span></span><br><span class="line">        <span class="keyword">const</span> &#123; isHot &#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="comment">// 1.根据属性值判断显示是否炎热</span></span><br><span class="line">        <span class="comment">// 2.React重写了所有原生的onxxx方法，on后面的第一个单词要大写</span></span><br><span class="line">        <span class="comment">// 3.onClick触发的方法并不是类的原型上的方法，而是类本身定义的方法，也就是在构造器函数中定义的方法</span></span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">onClick</span>=<span class="string">&#123;this.changeIsHot&#125;</span>&gt;</span>今天的天气很&#123;isHot ? &#x27;炎热&#x27; : &#x27;凉爽&#x27;&#125; <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加事件方法，这里的方法添加在了类的原型上</span></span><br><span class="line">    <span class="function"><span class="title">changeIsHot</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">          这里的this是undefined，因为React在编译虚拟DOM时找到了这个方法然后赋值给了onClick作为回调函数,</span></span><br><span class="line"><span class="comment">          我们通过点击h2标签触发这个方法时不是通过组件的示例化对象来触发的，而是直接触发的这个方法,又因为</span></span><br><span class="line"><span class="comment">          这个方法定义在类中，类中的方法默认都是严格模式，并且babel自身也是严格模式,</span></span><br><span class="line"><span class="comment">          所以这里的this是undefined</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>上面代码中的几个注意点：</p>
<ul>
<li>React重写了所有原生的<code>onxxx</code>方法，on后面的第一个单词要大写</li>
<li><code>onClick</code>等于的方法名不能添加括号，否则会默认调用该方法，将该方法的返回值作为<code>onClick</code>的回调</li>
<li>定义事件方法时，一定要注意<code>this</code>指向问题</li>
</ul>
<h4 id="setState方法的使用"><a href="#setState方法的使用" class="headerlink" title="setState方法的使用"></a>setState方法的使用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义类式组件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 给自定义组件添加构造器方法</span></span><br><span class="line">    <span class="comment">// constructor 方法只会调用一次，用来构造组件示例</span></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 添加super</span></span><br><span class="line">        <span class="built_in">super</span>(props)</span><br><span class="line">        <span class="comment">// 初始化state</span></span><br><span class="line">        <span class="built_in">this</span>.state = &#123;</span><br><span class="line">            isHot: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 在构造器中通过bind改变changeIsHot方法中的this指向</span></span><br><span class="line">        <span class="comment">// 这里定义的changeIsHot添加在了类的本身对象上</span></span><br><span class="line">        <span class="built_in">this</span>.changeIsHot = <span class="built_in">this</span>.changeIsHot.bind(<span class="built_in">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// render方法会触发 1+n 次，1表示初始化时触发一次，n 表示state更新后，render就会被触发一次</span></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>);</span><br><span class="line">        <span class="comment">// 从状态中读取isHot属性</span></span><br><span class="line">        <span class="keyword">const</span> &#123; isHot &#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="comment">// 1.根据属性值判断显示是否炎热</span></span><br><span class="line">        <span class="comment">// 2.React重写了所有原生的onxxx方法，on后面的第一个单词要大写</span></span><br><span class="line">        <span class="comment">// 3.onClick触发的方法并不是类的原型上的方法，而是类本身定义的方法，也就是在构造器函数中定义的方法</span></span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">onClick</span>=<span class="string">&#123;this.changeIsHot&#125;</span>&gt;</span>今天的天气很&#123;isHot ? &#x27;炎热&#x27; : &#x27;凉爽&#x27;&#125; <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加事件方法，这里的方法添加在了类的原型上</span></span><br><span class="line">    <span class="comment">// 自定义事件触发次数：点击几次就会触发几次</span></span><br><span class="line">    <span class="function"><span class="title">changeIsHot</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">           这里的this是undefined，因为React在编译虚拟DOM时找到了这个方法然后赋值给了onClick作为回调函数,</span></span><br><span class="line"><span class="comment">           我们通过点击h2标签触发这个方法时不是通过组件的示例化对象来触发的，而是直接触发的这个方法,又因为</span></span><br><span class="line"><span class="comment">           这个方法定义在类中，类中的方法默认都是严格模式，并且babel自身也是严格模式,</span></span><br><span class="line"><span class="comment">           所以这里的this是undefined</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用 setState 方法来修改state中的属性值</span></span><br><span class="line">        <span class="keyword">const</span> &#123;isHot&#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="comment">// setState方法存放在React.Component 类的原型上，并且是对原来对象的合并操作，不是替换操作</span></span><br><span class="line">        <span class="comment">// setState方法执行完后，React会自动调用一次render方法，用来刷新页面</span></span><br><span class="line">        <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">            isHot:!isHot</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 错误示例,我们不能直接修改state里面的值,修改完后页面不会刷新</span></span><br><span class="line">        <span class="comment">// const &#123;isHot&#125; = this.state</span></span><br><span class="line">        <span class="comment">// this.state.isHot = !isHot</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br></pre></td></tr></table></figure>

<p><code>setState</code>方法的说明：<code>setState</code>方法接受一个对象，然后将这个对象合并到原来的<code>state</code>对象中，达到更新数据的操作。这个方法存放在<code>React.component</code>组件的原型上。当<code>setState</code>方法执行完后，会调用一次<code>render</code>方法，用来更新页面。</p>
<p>组件中几个方法的触发次数问题：</p>
<ul>
<li><code>constructor</code>方法：只会在页面加载时触发一次，用来实例化组件对象</li>
<li><code>render</code>方法：触发<code>1+n</code>次，1表示页面加载时触发一次，n表示<code>state</code>对象更新了几次</li>
<li>自定义事件方法：点击了几次就会触发几次</li>
</ul>
<h4 id="state的简写形式"><a href="#state的简写形式" class="headerlink" title="state的简写形式"></a>state的简写形式</h4><p>上面的代码写起来很繁琐，下面的代码时上面代码的简写形式，在开发中我们也推荐写下面的代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个自定义的类组件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 可以在类中直接编写赋值语句，state会添加在类的实例上</span></span><br><span class="line">    state = &#123;</span><br><span class="line">        isHot: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; isHot &#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">onClick</span>=<span class="string">&#123;this.changeIsHot&#125;</span>&gt;</span>今天天气很&#123;isHot ? &#x27;炎热&#x27; : &#x27;凉爽&#x27;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 这里一定要使用箭头函数，因为箭头函数的this指向的是函数的调用者，所以不会有this丢失问题</span></span><br><span class="line">    changeIsHot = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">const</span> &#123; isHot &#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">            isHot: !isHot</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br></pre></td></tr></table></figure>

<h4 id="state问题总结"><a href="#state问题总结" class="headerlink" title="state问题总结"></a>state问题总结</h4><ul>
<li>render方法中的this是组件的实例对象</li>
<li>组件自定义方法的this是undefined，怎么解决？<ul>
<li>在构造函数中使用 bind 方法改变自定义方法中的 this </li>
<li>使用箭头函数赋值</li>
</ul>
</li>
</ul>
<h3 id="组件示例的三大属性2-props"><a href="#组件示例的三大属性2-props" class="headerlink" title="组件示例的三大属性2_props"></a>组件示例的三大属性2_props</h3><h4 id="props的基本使用"><a href="#props的基本使用" class="headerlink" title="props的基本使用"></a>props的基本使用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// React.Component 组件中内置的属性props，用来接受组件上传递过来的值</span></span><br><span class="line">        <span class="keyword">const</span> &#123;name,age&#125; = <span class="built_in">this</span>.props</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;ul&gt;</span><br><span class="line">                &lt;li&gt;姓名：&#123;name&#125;&lt;/li&gt;</span><br><span class="line">                &lt;li&gt;年龄：&#123;age&#125;&lt;/li&gt;    </span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 组件上传递的属性和属性值会作为key，value放在组件示例的props属性中</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">name</span>=<span class="string">&#x27;李四&#x27;</span> <span class="attr">age</span>=<span class="string">&#x27;18&#x27;</span>/&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">name</span>=<span class="string">&#x27;王五&#x27;</span> <span class="attr">age</span>=<span class="string">&#x27;21&#x27;</span>/&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app1&quot;</span>))</span><br></pre></td></tr></table></figure>

<h4 id="批量传递props属性"><a href="#批量传递props属性" class="headerlink" title="批量传递props属性"></a>批量传递props属性</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;name,age&#125; = <span class="built_in">this</span>.props.userInfo</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;ul&gt;</span><br><span class="line">                    &lt;li&gt;姓名：&#123;name&#125;&lt;/li&gt;</span><br><span class="line">                    &lt;li&gt;年龄：&#123;age&#125;&lt;/li&gt;    </span><br><span class="line">                &lt;/ul&gt;    </span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> userInfo = &#123;</span><br><span class="line">    name:<span class="string">&quot;李四&quot;</span>,</span><br><span class="line">    age:<span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// props可以直接传递一个对象</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">userInfo</span>=<span class="string">&#123;userInfo&#125;/</span>&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在React中给我们提供了一个新的语法，使用&#123;...&#125;的方式批量传递props信息，需要注意的是，这种方法在解构取值时，</span></span><br><span class="line"><span class="comment">// 必须要和传递过去的属性值一致，同时这种写法也是上面写法的语法糖</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> &#123;<span class="attr">...userInfo</span>&#125;/&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app2&quot;</span>))</span><br></pre></td></tr></table></figure>

<h4 id="对props属性进行限制"><a href="#对props属性进行限制" class="headerlink" title="对props属性进行限制"></a>对props属性进行限制</h4><p>要想对props中的属性进行限制，首先引入<code>prop-types.js</code>,引入之后全局就多出了一个全局变量<code>PropTypes</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/react.development.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/react-dom.development.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/babel.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这里引入prop-types,用于对props进行限制 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/prop-types.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>然后使用 <code>自定义组件名.propTypes=&#123;&#125;</code>的方式对<code>props</code>中的属性类型和是否必填进行限制</strong></p>
<p><strong>使用 <code>自定义组件名.defaultProps=&#123;&#125;</code>的方式对<code>props</code>中的属性进行默认值设置</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; name, age, sex &#125; = <span class="built_in">this</span>.props</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;ul&gt;</span><br><span class="line">                    &lt;li&gt;姓名:&#123;name&#125;&lt;/li&gt;</span><br><span class="line">                    &lt;li&gt;性别:&#123;sex&#125;&lt;/li&gt;</span><br><span class="line">                    &lt;li&gt;年龄:&#123;age&#125;&lt;/li&gt;</span><br><span class="line">                &lt;/ul&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 给组件的props添加类型和是否必填限制,必须在组件类上添加“ propTypes ” 属性，里面定义每个属性的规则限制</span></span><br><span class="line">MyComponent.propTypes = &#123;</span><br><span class="line">    <span class="comment">// 给属性定义规则是必须使用 PropTypes.数据类型.是否必填</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义name属性类型为字符串，注意string首字母要小写。并且必填，添加 isRequired 属性</span></span><br><span class="line">    name: PropTypes.string.isRequired,</span><br><span class="line">    <span class="comment">// 定义age属性类型为数字类型，注意首字母要小写</span></span><br><span class="line">    age: PropTypes.number,</span><br><span class="line">    <span class="comment">// 定义sex属性的属性值为字符串类型</span></span><br><span class="line">    sex: PropTypes.string,</span><br><span class="line">    <span class="comment">// 定义speak属性的类型为一个函数，注意：这里的名字为 func</span></span><br><span class="line">    speak:PropTypes.func</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给组件属性添加默认值设置</span></span><br><span class="line">MyComponent.defaultProps = &#123;</span><br><span class="line">    <span class="comment">// 设置sex值如果没传时默认是不男不女</span></span><br><span class="line">    sex: <span class="string">&quot;不男不女&quot;</span>,</span><br><span class="line">    <span class="comment">// 设置age默认值是18</span></span><br><span class="line">    age:<span class="number">18</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> speak = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;说话方法&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用标签属性对组件进行传参</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">name</span>=<span class="string">&quot;张三&quot;</span> <span class="attr">sex</span>=<span class="string">&quot;男&quot;</span> <span class="attr">age</span>=<span class="string">&#123;18&#125;</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">name</span>=<span class="string">&quot;张三&quot;</span> <span class="attr">speak</span>=<span class="string">&#123;speak&#125;</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;app2&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>限制类型列表</p>
<table>
<thead>
<tr>
<th>类型值</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>PropTypes.string</td>
<td>字符串</td>
</tr>
<tr>
<td>PropTypes.number</td>
<td>数字类型</td>
</tr>
<tr>
<td>PropTypes.func</td>
<td>函数类型</td>
</tr>
<tr>
<td>PropTypes.isRequired</td>
<td>该属性必填</td>
</tr>
<tr>
<td>PropTypes.string.isRequired</td>
<td>设置属性类型是字符串并且必填</td>
</tr>
</tbody></table>
<h4 id="props限制规则的简写形式"><a href="#props限制规则的简写形式" class="headerlink" title="props限制规则的简写形式"></a>props限制规则的简写形式</h4><p>首先复习一下类中的 <code>static</code> 关键字，这个关键字表示为静态的，在类属性前面声明了这个关键字后，这个属性会被添加到类的本身上面，不会被添加到类的实例化对象上。我们可以利用这个特性来简写props</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="comment">// 显示的简写形式,static 关键字的作用是直接给类自身添加一个属性</span></span><br><span class="line">    <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">        name:PropTypes.string.isRequired,</span><br><span class="line">        sex:PropTypes.number</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置props默认值</span></span><br><span class="line">    <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">        age:<span class="number">18</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">const</span> &#123;name,sex,age&#125; = <span class="built_in">this</span>.props</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;ul&gt;</span><br><span class="line">                    &lt;li&gt;姓名：&#123;name&#125;&lt;/li&gt;</span><br><span class="line">                    &lt;li&gt;性别：&#123;sex&#125;&lt;/li&gt;</span><br><span class="line">                    &lt;li&gt;年龄：&#123;age&#125;&lt;/li&gt;</span><br><span class="line">                &lt;/ul&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userInfo = &#123;</span><br><span class="line">    name:<span class="string">&quot;liis&quot;</span>,</span><br><span class="line">    sex:<span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 传递props数据</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> &#123;<span class="attr">...userInfo</span>&#125;/&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br></pre></td></tr></table></figure>

<h4 id="类式组件中construction的作用"><a href="#类式组件中construction的作用" class="headerlink" title="类式组件中construction的作用"></a>类式组件中construction的作用</h4><p>通常，在 React 中，构造函数仅用于以下两种情况：</p>
<ul>
<li>通过给 <code>this.state</code> 赋值对象来初始化内部 state</li>
<li>为<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/handling-events.html">事件处理函数</a>绑定实例</li>
</ul>
<p>如果我们希望在构造器中通过使用 <code>this.props</code>的方式来使用props，则在构造器中必须接收 <code>porps</code>，并且必须调用 <code>super(props)</code> 将<code>props</code>传递给<code>React.Component</code>,如果不接也不传，则可能出现<code>this.props</code>是<code>undefined</code>的bug</p>
<h3 id="组件实例的三大属性3-refs"><a href="#组件实例的三大属性3-refs" class="headerlink" title="组件实例的三大属性3_refs"></a>组件实例的三大属性3_refs</h3><h4 id="字符串形式的ref"><a href="#字符串形式的ref" class="headerlink" title="字符串形式的ref"></a>字符串形式的ref</h4><p><code>ref</code> 的作用是用来标记一个元素，和 <code>id</code> 的作用类似。<code>React</code> 会自动帮我们收集所有用 <code>ref</code> 标记的元素的真实 <code>DOM</code> 放到组件实例对象的 <code>refs</code> 属性中。使用时我们只需要通过使用 <code>this.refs.xxx</code> 来获取某个标记的元素DOM</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="comment">// 点击按钮触发</span></span><br><span class="line">    showData1 = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// 通过使用 this.refs.input1 可以获取使用 ref 声明的对应的元素DOM</span></span><br><span class="line">        <span class="comment">// 这里获取到DOM是真实DOM，所以可以使用DOM上面的各种属性和方法</span></span><br><span class="line">        <span class="keyword">const</span> &#123;input1&#125; = <span class="built_in">this</span>.refs</span><br><span class="line">        alert(input1.value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;input ref=<span class="string">&quot;input1&quot;</span> placeholder=<span class="string">&quot;点击按钮弹出信息&quot;</span>/&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="built_in">this</span>.showData1&#125;&gt;显示左侧信息&lt;/button&gt;</span><br><span class="line">                &lt;input placeholder=<span class="string">&quot;离焦点触发&quot;</span>/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span>/&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br></pre></td></tr></table></figure>

<h4 id="回调形式的ref"><a href="#回调形式的ref" class="headerlink" title="回调形式的ref"></a>回调形式的ref</h4><p>关于字符串形式的 <code>ref</code> ，官方并不推荐我们使用，并且在未来的某个版本中可能会废弃掉。原因是效率不高。</p>
<p>所以下面是采用回调的形式来声明 <code>ref</code>。使用回调的形式后，<code>React</code> 在编译过程中会自动的调用我们写的回调函数，并且回调时会携带被标记元素的真实<code>DOM</code>。我们可以利用这个特点在回调方法中直接将真实<code>DOM</code>保存在组件的实例对象中。</p>
<p>注意：采用了回调形式创建<code>ref</code>后，<code>React</code>不会再往<code>refs</code>中添加<code>ref</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    showData1 = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// 如果ref采用回调的形式时，则组件实例的 refs 中就没有数据</span></span><br><span class="line">        <span class="comment">// ref 中的回调过来所携带的参数刚好是被标记元素的真实DOM</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">const</span> &#123;input1&#125; = <span class="built_in">this</span></span><br><span class="line">        alert(input1.value)</span><br><span class="line">    &#125;</span><br><span class="line">    showData2 = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;input2&#125; = <span class="built_in">this</span></span><br><span class="line">        alert(input2.value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;input ref=&#123;<span class="function"><span class="params">cnode</span>=&gt;</span> <span class="built_in">this</span>.input1=cnode&#125; placeholder=<span class="string">&quot;点击按钮弹出信息&quot;</span>/&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="built_in">this</span>.showData1&#125;&gt;显示左侧信息&lt;/button&gt;</span><br><span class="line">                &lt;input onBlur=&#123;<span class="built_in">this</span>.showData2&#125; ref=&#123;<span class="function"><span class="params">cnode</span>=&gt;</span> <span class="built_in">this</span>.input2=cnode&#125; placeholder=<span class="string">&quot;离焦点触发&quot;</span>/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span>/&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br></pre></td></tr></table></figure>

<h4 id="关于回调-refs-的说明"><a href="#关于回调-refs-的说明" class="headerlink" title="关于回调 refs 的说明"></a>关于回调 refs 的说明</h4><p>如果 <code>ref</code> 回调函数是以内联函数的方式定义的，在更新过程中它会被执行两次，第一次传入参数 <code>null</code>，然后第二次会传入参数 DOM 元素。这是因为在每次渲染时会创建一个新的函数实例，所以 React 清空旧的 ref 并且设置新的。通过将 ref 的回调函数定义成 class 的绑定函数的方式可以避免上述问题，但是大多数情况下它是无关紧要的。</p>
<p>代理示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        isHot:<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 点击按钮触发</span></span><br><span class="line">    showInfo = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> &#123;isHot&#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="comment">// 更新组件状态触发render方法</span></span><br><span class="line">        <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">            isHot:!isHot</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;isHot&#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div&gt;今天的天气很 &#123;isHot ? <span class="string">&#x27;晴朗&#x27;</span> : <span class="string">&#x27;阴沉&#x27;</span>&#125;&lt;/div&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &lt;input ref=&#123;<span class="function">(<span class="params">cNode</span>)=&gt;</span>&#123;</span><br><span class="line">                            <span class="comment">// 在组件更新过程中，ref的回调会被执行两次，第一次回调参数是null，第二次是真正的DOM</span></span><br><span class="line">                            <span class="built_in">this</span>.input = cNode;</span><br><span class="line">                            <span class="built_in">console</span>.log(<span class="string">&#x27;@&#x27;</span>,cNode);</span><br><span class="line">                        &#125;&#125; placeholder=<span class="string">&quot;输入内容&quot;</span>/&gt;</span><br><span class="line">                    &lt;button onClick=&#123;<span class="built_in">this</span>.showInfo&#125;&gt;点击提示信息&lt;/button&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span>/&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>上面的代码中在第一次运行时，<code>ref</code> 中的只会被触发一次，而在点击按钮更新页面后，<code>ref</code> 的回调会被触发两次，第一次参数是<code>null</code>，第二次才是<code>DOM</code>。</p>
<h4 id="createRef-的使用"><a href="#createRef-的使用" class="headerlink" title="createRef 的使用"></a>createRef 的使用</h4><p><code>React.createRef</code> 创建一个能够通过 <code>ref</code> 属性附加到 <code>React</code> 元素的 <a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/refs-and-the-dom.html">ref</a>容器，这个容器只能装一个元素。专人专用，不能共享。在获取的时候必须通过 <code>current</code> 属性来获取 <code>ref</code> 标记的元素<code>DOM</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="comment">// 使用 createRef 创建 ref,此时input1是一个存放被ref表示的元素DOM的容器，这个容器只能装一个元素</span></span><br><span class="line">    input1 = React.createRef()</span><br><span class="line">    input2 = React.createRef()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示input1的数据</span></span><br><span class="line">    showData1 = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// 使用 createRef 的形式后获取到的元素DOM必须从 current 中获取DOM数据</span></span><br><span class="line">        alert(<span class="built_in">this</span>.input1.current.value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    showData2 = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        alert(<span class="built_in">this</span>.input2.current.value)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;input ref=&#123;<span class="built_in">this</span>.input1&#125; placeholder=<span class="string">&quot;点击按钮弹出信息&quot;</span>/&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="built_in">this</span>.showData1&#125;&gt;显示左侧信息&lt;/button&gt;</span><br><span class="line">                &lt;input ref=&#123;<span class="built_in">this</span>.input2&#125; onBlur=&#123;<span class="built_in">this</span>.showData2&#125;  placeholder=<span class="string">&quot;离焦点触发&quot;</span>/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span>/&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="非受控组件"><a href="#非受控组件" class="headerlink" title="非受控组件"></a>非受控组件</h3><p>简单而言，非受控组件就是当我们提交数据时，才从页面中获取表单内容。这样的组件我们称为非受控组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyForm</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    userName = React.createRef()</span><br><span class="line">    passWord = React.createRef()</span><br><span class="line"></span><br><span class="line">    submitForm = <span class="function">(<span class="params">event</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(event);</span><br><span class="line">        <span class="comment">// 阻止表单提交默认事件</span></span><br><span class="line">        event.preventDefault()</span><br><span class="line">        <span class="comment">// 从this中解构获取ref</span></span><br><span class="line">        <span class="keyword">const</span> &#123;userName,passWord&#125; = <span class="built_in">this</span></span><br><span class="line">        <span class="comment">// 点击提交数据时从ref中获取表单内容</span></span><br><span class="line">        alert(<span class="string">`用户名是：<span class="subst">$&#123;userName.current.value&#125;</span>,密码是：<span class="subst">$&#123;passWord.current.value&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;form onSubmit=&#123;<span class="built_in">this</span>.submitForm&#125;&gt;</span><br><span class="line">                用户名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span> ref=&#123;<span class="built_in">this</span>.userName&#125;/&gt;<span class="xml"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line">                密码：&lt;input type=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span> ref=&#123;<span class="built_in">this</span>.passWord&#125;/&gt;<span class="xml"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line">                &lt;button&gt;登录&lt;/button&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyForm</span>/&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="受控组件"><a href="#受控组件" class="headerlink" title="受控组件"></a>受控组件</h3><p>可以观察下面的代码中并没有通过使用 <code>ref</code> 来获取输入框的值，而是通过 <code>onChange</code> 事件，当输入框的值发生变化时实时的将数据存入 <code>state</code> 中，当我们真正点击提交时再从 <code>state</code> 中获取表单数据。这种获取数据方式的组件称之为受控组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyForm</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        userName:<span class="string">&quot;&quot;</span>,</span><br><span class="line">        passWord:<span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 改变用户名触发</span></span><br><span class="line">    changeName = <span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// 实时的获取输入框的值</span></span><br><span class="line">        <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">            userName:e.target.value</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    changePws = <span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">            passWord:e.target.value</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    submitForm = <span class="function">(<span class="params">event</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// 阻止表单提交默认事件</span></span><br><span class="line">        event.preventDefault()</span><br><span class="line">        <span class="comment">// 从this.state中解构获取表单数据</span></span><br><span class="line">        <span class="keyword">const</span> &#123;userName,passWord&#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="comment">// 显示数据</span></span><br><span class="line">        alert(<span class="string">`用户名是：<span class="subst">$&#123;userName&#125;</span>,密码是：<span class="subst">$&#123;passWord&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;form onSubmit=&#123;<span class="built_in">this</span>.submitForm&#125;&gt;</span><br><span class="line">                用户名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span> onChange=&#123;<span class="built_in">this</span>.changeName&#125;/&gt;<span class="xml"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line">                密码：&lt;input type=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span> onChange=&#123;<span class="built_in">this</span>.changePws&#125;/&gt;<span class="xml"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line">                &lt;button&gt;登录&lt;/button&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyForm</span>/&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="高阶函数和函数柯里化"><a href="#高阶函数和函数柯里化" class="headerlink" title="高阶函数和函数柯里化"></a>高阶函数和函数柯里化</h3><h4 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h4><p>什么是函数柯里化？如果一个函数符合下面2个规范中的任何一个，那么这个函数就是高阶函数</p>
<ul>
<li>若A函数接收的参数是一个函数，那么这个函数就是高阶函数</li>
<li>若A函数的返回值仍然是一个函数，则这个函数就是高阶函数</li>
</ul>
<p>常用的高阶函数有：setTimeout、Array.map()、Promise ……</p>
<h4 id="函数柯里化"><a href="#函数柯里化" class="headerlink" title="函数柯里化"></a>函数柯里化</h4><ul>
<li>通过函数调用继续返回函数的方式，实现多次接收参数最后统一处理的函数编码方式               </li>
</ul>
<p>下面通过一个案例，体会函数柯力化。使用一个方法收集多个输入框数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyForm</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        userName:<span class="string">&quot;&quot;</span>,</span><br><span class="line">        passWord:<span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里的函数返回一个函数去处理剩下的参数，我们称为函数柯里化</span></span><br><span class="line">    saveFormData = <span class="function">(<span class="params">key</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// 返回一个函数作为onChange的回调</span></span><br><span class="line">        <span class="keyword">return</span> <span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(key,e);</span><br><span class="line">            <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">                [key]:e.target.value</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    submitForm = <span class="function">(<span class="params">event</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// 阻止表单提交默认事件</span></span><br><span class="line">        event.preventDefault()</span><br><span class="line">        <span class="comment">// 从this.state中解构获取表单数据</span></span><br><span class="line">        <span class="keyword">const</span> &#123;userName,passWord&#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="comment">// 显示数据</span></span><br><span class="line">        alert(<span class="string">`用户名是：<span class="subst">$&#123;userName&#125;</span>,密码是：<span class="subst">$&#123;passWord&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;form onSubmit=&#123;<span class="built_in">this</span>.submitForm&#125;&gt;</span><br><span class="line">                用户名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span> onChange=&#123;<span class="built_in">this</span>.saveFormData(<span class="string">&#x27;userName&#x27;</span>)&#125;/&gt;<span class="xml"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line">                密码：&lt;input type=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span> onChange=&#123;<span class="built_in">this</span>.saveFormData(<span class="string">&#x27;passWord&#x27;</span>)&#125;/&gt;<span class="xml"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line">                &lt;button&gt;登录&lt;/button&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyForm</span>/&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>上面的代码中，onChange 接收一个方法作为回调。saveFormData 方法由于添加了小括号，所以在第一次编译时会被自动执行，但是由于这个方法的返回值也是一个函数，所以onChange 的回调还是一个函数。</p>
<h2 id="第三章-React生命周期-旧版本"><a href="#第三章-React生命周期-旧版本" class="headerlink" title="第三章 React生命周期(旧版本)"></a>第三章 React生命周期(旧版本)</h2><h3 id="生命周期初体验"><a href="#生命周期初体验" class="headerlink" title="生命周期初体验"></a>生命周期初体验</h3><p>通过完成如下案例：在页面挂载完成后启动一个计时器，每隔200毫秒吧文字大小增加1像素值，当大小超过40像素值时，文字大小重新变回12像素。点击关闭按钮时，卸载组件。组件卸载前清空一下计时器。</p>
<p>效果图</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/1.gif"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LifeComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        fontSize:<span class="number">12</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 点击关闭按钮</span></span><br><span class="line">    unMount = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// 卸载组件,调用固定函数 </span></span><br><span class="line">        ReactDOM.unmountComponentAtNode(<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 组件挂在完成后触发</span></span><br><span class="line">    <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> &#123;fontSize&#125; = <span class="built_in">this</span>.state</span><br><span class="line">            fontSize += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span>(fontSize &gt;= <span class="number">40</span>) fontSize = <span class="number">12</span></span><br><span class="line">            <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">                fontSize:fontSize</span><br><span class="line">            &#125;)    </span><br><span class="line">        &#125;, <span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组件卸载前触发，此时还没真正卸载</span></span><br><span class="line">    <span class="function"><span class="title">componentWillUnmount</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 卸载前清除定时器</span></span><br><span class="line">        <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.timer)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 渲染页面</span></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> &#123;fontSize&#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h2 style=&#123;&#123;<span class="attr">fontSize</span>:fontSize + <span class="string">&#x27;px&#x27;</span>,<span class="attr">transition</span>:<span class="string">&#x27;1s&#x27;</span>&#125;&#125;&gt;我会自己变大变小&lt;/h2&gt;  </span><br><span class="line">                &lt;button onClick=&#123;<span class="built_in">this</span>.unMount&#125;&gt;关闭&lt;/button&gt;  </span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">LifeComponent</span>/&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>上面的案例中用到的生命周期有</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>componentDidMount</code></td>
<td>组件挂载完成后触发</td>
</tr>
<tr>
<td><code>componentWillUnmount</code></td>
<td>组件卸载前触发</td>
</tr>
<tr>
<td><code>ReactDOM.unmountComponentAtNode( document.getElementById() )</code></td>
<td>卸载指定的组件</td>
</tr>
</tbody></table>
<h3 id="组件声明周期"><a href="#组件声明周期" class="headerlink" title="组件声明周期"></a>组件声明周期</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Count</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 组件最先调用constructor</span></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(props)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;Count - constructor&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    state = &#123;</span><br><span class="line">        count: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    add = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; count &#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="built_in">this</span>.setState(&#123; <span class="attr">count</span>: count + <span class="number">1</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组件将要挂载触发</span></span><br><span class="line">    <span class="function"><span class="title">componentWillMount</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;Count - componentWillMount&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组件挂载时</span></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;Count - render&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h2&gt;当前的和为：&#123;<span class="built_in">this</span>.state.count&#125;&lt;/h2&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="built_in">this</span>.add&#125;&gt;点我+<span class="number">1</span>&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组件挂载完成后触发</span></span><br><span class="line">    <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;Count - componentDidMount&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Count</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>组件挂载时流程：</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>函数含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>constructor</code></td>
<td>最先调用构造器方法</td>
</tr>
<tr>
<td><code>componentWillMount</code></td>
<td>组件将要挂载时触发</td>
</tr>
<tr>
<td><code>render</code></td>
<td>组件挂载触发</td>
</tr>
<tr>
<td><code>componentDidMount</code></td>
<td>组件挂载完成后触发</td>
</tr>
</tbody></table>
<p>组件销毁时流程</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>函数含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>componentWillUnmount</code></td>
<td>组件将要销毁时触发</td>
</tr>
<tr>
<td><code>ReactDOM.unmountComponentAtNode( document.getElementById() )</code></td>
<td>卸载指定的组件</td>
</tr>
</tbody></table>
<h3 id="组件的setState流程"><a href="#组件的setState流程" class="headerlink" title="组件的setState流程"></a>组件的setState流程</h3><table>
<thead>
<tr>
<th>函数名</th>
<th>函数含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>shouldComponentUpdate</code></td>
<td>定义组件是否可以被更新，返回布尔值，不写默认返回true,表示可以更新状态</td>
</tr>
<tr>
<td><code>componentWillUpdate</code></td>
<td>组件将要更新</td>
</tr>
<tr>
<td><code>render</code></td>
<td>组件更新方法</td>
</tr>
<tr>
<td><code>componentDidUpdate</code></td>
<td>组件更新完成方法</td>
</tr>
</tbody></table>
<h3 id="forceUpdate-强制更新"><a href="#forceUpdate-强制更新" class="headerlink" title="forceUpdate 强制更新"></a>forceUpdate 强制更新</h3><p><code>forceUpdate</code>方法存放在<code>React</code>的原型链上，可以在代码中直接通过<code>this.</code>来调用。这个方法可以在不更新状态的前提下更新组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接让状态中的count等于10</span></span><br><span class="line"><span class="built_in">this</span>.state.count = <span class="number">10</span></span><br><span class="line"><span class="comment">// 调用React原型链上的方法，不更改状态的前提下强制更新组件</span></span><br><span class="line"><span class="built_in">this</span>.forceUpdate()</span><br></pre></td></tr></table></figure>

<p>执行完<code>this.forceUpdate</code>方法后，会依次触发下面的生命周期钩子函数</p>
<ul>
<li><code>componentWillUpdate</code> 组件将要更新</li>
<li><code>render</code> 编译组件</li>
<li><code>componentDidUpdate</code> 组件更新完成</li>
</ul>
<h3 id="父子组件传参时的更新流程"><a href="#父子组件传参时的更新流程" class="headerlink" title="父子组件传参时的更新流程"></a>父子组件传参时的更新流程</h3><p>当父组件给子组件通过props传参时，会触发<code>componentWillReceiveProps</code>方法，该方法可以接收到传递过来的<code>props</code>。但是，这个方法在初始化传递时不会调用，只会在传递新的<code>props</code>时调用。传递过来之后会依次触发更新流程上的钩子函数。</p>
<p>首先定义父组件。点击按钮切换状态并将状态值传递给子组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        cart:<span class="string">&#x27;奔驰&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    changeCart = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">            cart:<span class="string">&#x27;奥拓&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="built_in">this</span>.changeCart&#125;&gt;点击换车&lt;/button&gt;  </span><br><span class="line">                &#123;<span class="comment">/* 在父组件中直接写子组件的名称即可表示父子组件关系 */</span>&#125;</span><br><span class="line">                &lt;B cart=&#123;<span class="built_in">this</span>.state.cart&#125;/&gt;  </span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再组件中接收这个参数并展示。在点击按钮后回触发<code>componentWillReceiveProps</code>回调方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="comment">// 组件将要接收新的props时触发</span></span><br><span class="line">    <span class="function"><span class="title">componentWillReceiveProps</span>(<span class="params">props</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(props);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;组件将要接收新的props时触发 - componentWillReceiveProps&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 是否更新</span></span><br><span class="line">    <span class="function"><span class="title">shouldComponentUpdate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;是否更新:True&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将要更新</span></span><br><span class="line">    <span class="function"><span class="title">componentWillUpdate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;将要更新&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 编译</span></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;编译&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>(</span><br><span class="line">            &lt;h3&gt;当前的车辆是：&#123;<span class="built_in">this</span>.props.cart&#125;&lt;/h3&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">componentDidUpdate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;更新完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em><strong>注意：<code>componentWillReceiveProps</code>方法只会在传递新的<code>props</code>时触发，在页面加载时不会触发</strong></em></p>
<h3 id="声明周期总结"><a href="#声明周期总结" class="headerlink" title="声明周期总结"></a>声明周期总结</h3><h4 id="初始化阶段"><a href="#初始化阶段" class="headerlink" title="初始化阶段"></a>初始化阶段</h4><table>
<thead>
<tr>
<th>函数名</th>
<th>函数含义</th>
</tr>
</thead>
<tbody><tr>
<td>construction</td>
<td>类的构造器方法</td>
</tr>
<tr>
<td>componentWillMount</td>
<td>组件将要挂载</td>
</tr>
<tr>
<td>render</td>
<td>编译组件</td>
</tr>
<tr>
<td>componentDidMount</td>
<td>组件挂载完成</td>
</tr>
</tbody></table>
<h4 id="更新阶段"><a href="#更新阶段" class="headerlink" title="更新阶段"></a>更新阶段</h4><table>
<thead>
<tr>
<th>函数名</th>
<th>函数含义</th>
</tr>
</thead>
<tbody><tr>
<td>shouldComponentUpdate</td>
<td>获取状态是否可以更新，默认返回true</td>
</tr>
<tr>
<td>componentWillUpdate</td>
<td>组件将要更新</td>
</tr>
<tr>
<td>render</td>
<td>更新状态</td>
</tr>
<tr>
<td>componentDidUpdate</td>
<td>组件更新完成</td>
</tr>
</tbody></table>
<h4 id="卸载阶段"><a href="#卸载阶段" class="headerlink" title="卸载阶段"></a>卸载阶段</h4><table>
<thead>
<tr>
<th>函数名</th>
<th>函数含义</th>
</tr>
</thead>
<tbody><tr>
<td>componentWillUnmount</td>
<td>组价将要卸载</td>
</tr>
<tr>
<td>ReactDOM.unmountComponentAtNode( )</td>
<td>卸载指定的组件</td>
</tr>
</tbody></table>
<h4 id="父组件传参"><a href="#父组件传参" class="headerlink" title="父组件传参"></a>父组件传参</h4><table>
<thead>
<tr>
<th>函数名</th>
<th>函数含义</th>
</tr>
</thead>
<tbody><tr>
<td>componentWillReceiveProps</td>
<td>组件将要接收新的props时触发</td>
</tr>
</tbody></table>
<h4 id="声明周期流程图"><a href="#声明周期流程图" class="headerlink" title="声明周期流程图"></a>声明周期流程图</h4><p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/1.png"></p>
<h2 id="第四章-React声明周期-新版本"><a href="#第四章-React声明周期-新版本" class="headerlink" title="第四章 React声明周期(新版本)"></a>第四章 React声明周期(新版本)</h2><h3 id="新旧生命周期区别"><a href="#新旧生命周期区别" class="headerlink" title="新旧生命周期区别"></a>新旧生命周期区别</h3><p>新版本中即将废弃三个生命周期函数，分别如下</p>
<ul>
<li><code>componentWillMount</code></li>
<li><code>componentWillUpdate</code></li>
<li><code>componentWillReceiveProps</code></li>
</ul>
<p>在17.x版本中，这三个生命周期仍然可以使用，但是会在控制台报警告，我们需要添加<code>UNSAFE_</code>前缀来取消警告。但是在未来的某个版本中可能必须要添加<code>UNSAFE_</code>前缀才能使用它们。这是因为React在做异步渲染，这三个函数可能会被误解和滥用，以至于出现bug，所以我们应该避免使用它们。</p>
<p>新版本中又新增了两个生命周期函数，分别如下</p>
<ul>
<li><code>static getDerivedStateFromProps</code></li>
<li><code>getSnapshotBeforeUpdate</code></li>
</ul>
<h3 id="getDerivedStateFromProps"><a href="#getDerivedStateFromProps" class="headerlink" title="getDerivedStateFromProps"></a>getDerivedStateFromProps</h3><p>该方法在 constructor 之后 render 之前触发。并且要求是一个静态方法，所以要在声明前添加 static 关键字。该方法必须返回 null ，或者衍生状态对象，如果返回了衍生状态对象，则该状态将无法被修改，只能通过 props 来修改状态。</p>
<p>此方法适用于<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#when-to-use-derived-state">罕见的用例</a>，即 state 的值在任何时候都取决于 props。例如，实现 <code>&lt;Transition&gt;</code> 组件可能很方便，该组件会比较当前组件与下一组件，以决定针对哪些组件进行转场动画。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Count</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(props)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;constructor&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    state = &#123;</span><br><span class="line">        count:<span class="number">19</span></span><br><span class="line">    &#125;</span><br><span class="line">    addCount = <span class="function">() =&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> &#123;count&#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">            count:++count</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 17.x新增声明周期函数，从props中获取衍生过来的状态</span></span><br><span class="line">    <span class="comment">// 这个函数必须返回null或者衍生状态对象，返回衍生状态对象后，该状态值不能被修改</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="title">getDerivedStateFromProps</span>(<span class="params">props</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;getDeriveStateFromProps&#x27;</span>,props);</span><br><span class="line">        <span class="keyword">return</span> props</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h2&gt;数据和为：&#123;<span class="built_in">this</span>.state.count&#125;&lt;/h2&gt;</span><br><span class="line">                &lt;h3&gt;姓名：&#123;<span class="built_in">this</span>.state.name&#125;&lt;/h3&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="built_in">this</span>.addCount&#125;&gt;点击+<span class="number">1</span>&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Count</span> <span class="attr">name</span>=<span class="string">&#123;</span>&#x27;李四&#x27;&#125;/&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&#x27;app&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="getSnapshotBeforeUpdate"><a href="#getSnapshotBeforeUpdate" class="headerlink" title="getSnapshotBeforeUpdate"></a>getSnapshotBeforeUpdate</h3><p>该方法在 <code>render</code> 后、<code>componentDidUpdate</code> 之前触发，必须返回一个null或者一个快照，快照可以是任何类型的数据，返回的数据由 <code>componentDidUpdate</code> 函数的第三个参数接收</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Count</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        count:<span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    add = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> &#123;count&#125; = <span class="built_in">this</span>.state</span><br><span class="line">        count++</span><br><span class="line">        <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">            count:count</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 这个函数返回一个快照或者null，返回值交由 componentDidUpdate</span></span><br><span class="line">    <span class="function"><span class="title">getSnapshotBeforeUpdate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;songzx&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;h2&gt;和是：&#123;<span class="built_in">this</span>.state.count&#125;&lt;/h2&gt; </span><br><span class="line">                &lt;button onClick=&#123;<span class="built_in">this</span>.add&#125;&gt;增加&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 更新完成函数接收三个参数，分别是上一次传递的props，更新前的state，getSnapshotBeforeUpdate函数返回的快照值</span></span><br><span class="line">    <span class="function"><span class="title">componentDidUpdate</span>(<span class="params">prevprops,prevstate,snapshot</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(prevprops);</span><br><span class="line">        <span class="built_in">console</span>.log(prevstate);</span><br><span class="line">        <span class="built_in">console</span>.log(snapshot); <span class="comment">//=&gt; songzx</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Count</span> <span class="attr">count</span>=<span class="string">&#123;9&#125;/</span>&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&#x27;app&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="新生命周期图"><a href="#新生命周期图" class="headerlink" title="新生命周期图"></a>新生命周期图</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/szxio/zero-basic-learning-react/raw/master/00_%E8%AF%BE%E7%A8%8B%E8%B5%84%E6%96%99/react%E5%85%A8%E5%AE%B6%E6%A1%B6%E8%B5%84%E6%96%99/02_%E5%8E%9F%E7%90%86%E5%9B%BE/react%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F(%E6%96%B0).png"></p>
<h2 id="第五章-遍历时key的作用"><a href="#第五章-遍历时key的作用" class="headerlink" title="第五章 遍历时key的作用"></a>第五章 遍历时key的作用</h2><h3 id="虚拟DOM中key的作用"><a href="#虚拟DOM中key的作用" class="headerlink" title="虚拟DOM中key的作用"></a>虚拟DOM中key的作用</h3><ul>
<li>简单的说：key时虚拟DOM对象的标识，在更新显示时，key起着及其重要的作用</li>
<li>详细的说：当状态中的数据发生变化时，react会根据【新数据】生成【新的虚拟DOM】，随后React【新虚拟DOM】和【旧虚拟DOM】会进行 diff 比较，比较规则如下：<ul>
<li>旧虚拟DOM会找到和新虚拟DOM中key一样的DOM<ul>
<li>若虚拟DOM中的内容没有变化，则复用之前的旧虚拟DOM</li>
<li>若虚拟DOM中的内容变化了，则生成新的真实DOM替换原来的DOM</li>
</ul>
</li>
<li>旧虚拟DOM中没有找到与新虚拟DOM相同的key<ul>
<li>根据数据创建对应的虚拟DOM，渲染到页面中</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="用index索引值作为key可能会发生的问题"><a href="#用index索引值作为key可能会发生的问题" class="headerlink" title="用index索引值作为key可能会发生的问题"></a>用index索引值作为key可能会发生的问题</h3><ul>
<li>若对数据进行：逆序添加，逆序删除等操作时，会产生没有必要的正式DOM更新。界面效果展示虽然没有问题，但是效率低</li>
<li>如果结构中包含输入类的DOM，会产生DOM更新错误，界面展示都会出现问题</li>
<li>注意：如果不存在对数据进行逆序添加，逆序删除等破坏顺序的操作时，进用于数据的展示，则用index作为key也是没有问题的</li>
</ul>
<h3 id="如何选择key"><a href="#如何选择key" class="headerlink" title="如何选择key"></a>如何选择key</h3><ul>
<li>最好使用每条数据中的唯一值作为key。例如id、身份证号、学号等</li>
<li>如果确定只是简单的数据展示，则用index也是没问题的</li>
</ul>
<h2 id="第六章-React-脚手架"><a href="#第六章-React-脚手架" class="headerlink" title="第六章 React 脚手架"></a>第六章 React 脚手架</h2><h3 id="React-脚手架"><a href="#React-脚手架" class="headerlink" title="React 脚手架"></a>React 脚手架</h3><ul>
<li>xxx 脚手架：用来帮助程序员快速创建一个基于 xxx 库的模板项目<ul>
<li>包含了所有需要的配置（语法检查，jsx编译，devServer）</li>
<li>下载好了相关的依赖</li>
<li>可以直接运行一个简单效果</li>
</ul>
</li>
<li>react 提供了一个用于创建 react 项目的脚手架库： react-react-app</li>
<li>项目的整体架构为：react + webpack + es6 + eslint</li>
<li>使用脚手架开发的项目特点：模块化、工程化、组价化</li>
</ul>
<h3 id="创建和启动"><a href="#创建和启动" class="headerlink" title="创建和启动"></a>创建和启动</h3><p>首先全局安装 react</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g create-react-app</span><br></pre></td></tr></table></figure>

<p>创建项目命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create-react-app 项目名称</span><br></pre></td></tr></table></figure>

<p>启动项目</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br><span class="line">or</span><br><span class="line">yarn start</span><br></pre></td></tr></table></figure>

<p>启动成功后可以看到如下页面</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/2.png"></p>
<h3 id="public-index-html文件的说明"><a href="#public-index-html文件的说明" class="headerlink" title="public/index.html文件的说明"></a>public/index.html文件的说明</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- %PUBLIC_URL% 表示public的访问路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;%PUBLIC_URL%/favicon.ico&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 开启理想视口，用来做移动端适配 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 用于配置浏览器页签加地址栏的颜色，仅支持安卓浏览器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;theme-color&quot;</span> <span class="attr">content</span>=<span class="string">&quot;#000000&quot;</span> /&gt;</span></span><br><span class="line">    &lt;meta</span><br><span class="line">      name=&quot;description&quot;</span><br><span class="line">      content=&quot;Web site created using create-react-app&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    <span class="comment">&lt;!-- 用于指定网页添加到桌面后的图标，只对苹果手机生效 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;%PUBLIC_URL%/logo192.png&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 应用加壳时的配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;manifest&quot;</span> <span class="attr">href</span>=<span class="string">&quot;%PUBLIC_URL%/manifest.json&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>React App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 当浏览器不支持js时显示的提示 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span>You need to enable JavaScript to run this app.<span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="src目录下文件说明"><a href="#src目录下文件说明" class="headerlink" title="src目录下文件说明"></a>src目录下文件说明</h3><p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/3.jpg"></p>
<h3 id="实现一个简单的Hello组件"><a href="#实现一个简单的Hello组件" class="headerlink" title="实现一个简单的Hello组件"></a>实现一个简单的Hello组件</h3><p>在开始之前我们将<code>src</code>文件夹下面的文件全部剪切走，重新开始编写我们的<code>scr</code>文件下的内容</p>
<p>首先编写<code>src/index.js</code>文件，这个文件是我们整个项目的入口文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入react核心库</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">// 引入reactDOM</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="comment">// 引入App组件</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 渲染App组件</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>然后新建<code>src/App.js</code>文件，并编写如下代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入React核心库和Component组件</span></span><br><span class="line"><span class="comment">// react库中默认导出了react和分别导出了Component,所以可以这么引入，这里不是解构赋值</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认导出App组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;Hello React&lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再<code>src</code>目录下新建<code>components</code>文件夹，用来放置我们开发的所有组件。</p>
<p>接着在<code>components</code>文件夹下新建<code>Hello/index.jsx</code>和<code>Hello/index.css</code>文件</p>
<p><code>Hello/index.jsx</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./index.css&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">className</span>=<span class="string">&quot;title&quot;</span>&gt;</span>Hello React<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Hello/index.css</code></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.title</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: orange;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其次我们在<code>components</code>文件夹中再新建<code>Welcome/index.jsx</code>和<code>Welcome/index.css</code></p>
<p><code>Welcome/index.jsx</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./index.css&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Welcome</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">className</span>=<span class="string">&quot;demo&quot;</span>&gt;</span>Welcome<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Welcome/index.css</code></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.demo</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: skyblue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后我们在<code>App.js</code>中引入<code>Hello</code>组件和<code>Welcome</code>组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入React核心库和Component组件</span></span><br><span class="line"><span class="comment">// react库中默认导出了react和分别导出了Component,所以可以这么引入，这里不是解构赋值</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">// 引入Hello组件</span></span><br><span class="line"><span class="keyword">import</span> Hello <span class="keyword">from</span> <span class="string">&quot;./components/Hello&quot;</span>;</span><br><span class="line"><span class="comment">// 引入Welcome组件</span></span><br><span class="line"><span class="keyword">import</span> Welcome <span class="keyword">from</span> <span class="string">&quot;./components/WelCome&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认导出App组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Hello /&gt;</span><br><span class="line">        &lt;Welcome /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终的页面效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/4.png"></p>
<p>上面的代码中有几个细节点：</p>
<ul>
<li>声明组件时文件名首字母要大写</li>
<li>通常我们将组件的后缀设置为<code>jsx</code>，普通的业务文件后缀为<code>js</code></li>
<li><code>React.Component</code>组件可以简写为<code>import React, &#123; Component &#125; from &quot;react&quot;;</code></li>
</ul>
<h3 id="样式文件模块化"><a href="#样式文件模块化" class="headerlink" title="样式文件模块化"></a>样式文件模块化</h3><p>当我们在两个组件中使用了相同的样式类名，会导致后引入组件的样式覆盖之前引入组件的样式。我们可以通过下面的方法来设置样式文件的模块化</p>
<p>首先重命名<code>css</code>文件的后缀固定设置为<code>xxx.model.css</code></p>
<p>然后再组件中使用具名导入的形式引入定义的<code>css</code>文件</p>
<p>使用的时候要使用花括号的形式使用类名，例如：<code>className=&#123;welcome.title&#125;</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> welcome <span class="keyword">from</span> <span class="string">&quot;./index.module.css&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Welcome</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">className</span>=<span class="string">&#123;welcome.title&#125;</span>&gt;</span>Welcome<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="React相关插件"><a href="#React相关插件" class="headerlink" title="React相关插件"></a>React相关插件</h3><p>插件名称</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ES7 React/Redux/GraphQL/React-Native snippets</span><br></pre></td></tr></table></figure>

<p>快捷键</p>
<p><code>rcc</code>，快速新建类式组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">FileName</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>$2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>rfc</code>，快速新建方法组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">$1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>$0<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第七章-实现-ToDoList-案例"><a href="#第七章-实现-ToDoList-案例" class="headerlink" title="第七章 实现 ToDoList 案例"></a>第七章 实现 ToDoList 案例</h2><h3 id="拆分组件"><a href="#拆分组件" class="headerlink" title="拆分组件"></a>拆分组件</h3><p>首先看页面，我们可以根据页面结构将页面分成几个组件</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/6.png"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/5.png"></p>
<p>代码目录结构如下</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/7.png"></p>
<ul>
<li>base.css 用来放置所有页面公共的css</li>
</ul>
<p>在<code>App</code>组件中引入<code>Header</code>,<code>List</code>,<code>Footer</code>组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">&quot;./components/Header&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> List <span class="keyword">from</span> <span class="string">&quot;./components/List&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Footer <span class="keyword">from</span> <span class="string">&quot;./components/Footer&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./base.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> appcss <span class="keyword">from</span> <span class="string">&quot;./app.module.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=&#123;appcss.todoContent&#125;&gt;</span><br><span class="line">        &lt;Header /&gt;</span><br><span class="line">        &lt;List /&gt;</span><br><span class="line">        &lt;Footer /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再<code>List</code>组件中引入<code>Item</code>组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> listcss <span class="keyword">from</span> <span class="string">&quot;./index.module.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Item <span class="keyword">from</span> <span class="string">&quot;../Item&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">index</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ul className=&#123;listcss.listMain&#125;&gt;</span><br><span class="line">       	&lt;Item /&gt;;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="父传子"><a href="#父传子" class="headerlink" title="父传子"></a>父传子</h3><p>父组件给子组件传值,直接在  <code>App</code>  组件中通过 <code>props</code> 给子组件传值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">state = &#123;</span><br><span class="line">    todos: [</span><br><span class="line">        &#123;</span><br><span class="line">            id: <span class="string">&quot;001&quot;</span>,</span><br><span class="line">            name: <span class="string">&quot;吃饭&quot;</span>,</span><br><span class="line">            done: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            id: <span class="string">&quot;002&quot;</span>,</span><br><span class="line">            name: <span class="string">&quot;睡觉&quot;</span>,</span><br><span class="line">            done: <span class="literal">false</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            id: <span class="string">&quot;003&quot;</span>,</span><br><span class="line">            name: <span class="string">&quot;打代码&quot;</span>,</span><br><span class="line">            done: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">&lt;List todos=&#123;todos&#125; /&gt;</span><br></pre></td></tr></table></figure>

<p>然后再 <code>List</code> 组件中从 <code>this.props</code> 对象中获取父组件传递过来的值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从props中接收从App父组件传递过来的todos</span></span><br><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  	<span class="keyword">const</span> &#123; todos &#125; = <span class="built_in">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;ul className=&#123;listcss.listMain&#125;&gt;</span><br><span class="line">            &#123;<span class="comment">/* 遍历循环 Item 组件 */</span>&#125;</span><br><span class="line">            &#123;todos.map(<span class="function">(<span class="params">todo</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// &#123;...todo&#125; 将这个todo都传递给item组件，这种是简写形式</span></span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Item</span> <span class="attr">key</span>=<span class="string">&#123;todo.id&#125;</span> &#123;<span class="attr">...todo</span>&#125;/&gt;</span></span>;</span><br><span class="line">            &#125;)&#125;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    );  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="子传父"><a href="#子传父" class="headerlink" title="子传父"></a>子传父</h3><p>我们可以利用回调函数的特性，来实现子组件给父组件传值</p>
<p>首先在父组件中定义一个方法，然后通过<code>props</code> 将这个方法传递给子组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加一个todo</span></span><br><span class="line">addTodo = <span class="function">(<span class="params">todoObj</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; todos &#125; = <span class="built_in">this</span>.state;</span><br><span class="line">    <span class="comment">// 接收到从子组件传递过来的数据并添加到列表的开头</span></span><br><span class="line">    todos.unshift(todoObj);</span><br><span class="line">    <span class="comment">// 更新状态</span></span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">        todos: todos,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">&lt;Header addTodo=&#123;<span class="built_in">this</span>.addTodo&#125; /&gt;</span><br></pre></td></tr></table></figure>

<p>然后在子组件中调用这个方法并传递值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 顶部输入框键盘弹起事件</span></span><br><span class="line">handerKeyUp = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; keyCode, target &#125; = event;</span><br><span class="line">    <span class="comment">// 判断是否按下的是回车</span></span><br><span class="line">    <span class="keyword">if</span> (keyCode !== <span class="number">13</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// 当前输入的值</span></span><br><span class="line">    <span class="keyword">if</span> (target.value.trim() === <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        alert(<span class="string">&quot;请输入待办项目&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 封装一个代办对象</span></span><br><span class="line">    <span class="keyword">let</span> todoObj = &#123;</span><br><span class="line">        id: nanoid(),</span><br><span class="line">        name: target.value,</span><br><span class="line">        done: <span class="literal">false</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 调用父组件传递过来的方法给App组件传值</span></span><br><span class="line">    <span class="built_in">this</span>.props.addTodo(todoObj);</span><br><span class="line">    <span class="comment">// 清空输入框</span></span><br><span class="line">    target.value = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div className=&#123;headercss.headerMain&#125;&gt;</span><br><span class="line">            &lt;input</span><br><span class="line">                onKeyUp=&#123;<span class="built_in">this</span>.handerKeyUp&#125;</span><br><span class="line">                type=<span class="string">&quot;text&quot;</span></span><br><span class="line">                placeholder=<span class="string">&quot;请输入代办事项，按回车确定&quot;</span></span><br><span class="line">                /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="nanoid-库的使用"><a href="#nanoid-库的使用" class="headerlink" title="nanoid 库的使用"></a>nanoid 库的使用</h3><p>nanoid 可以帮助我们生成一个全球唯一的uuid。</p>
<p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i nanoid --save</span><br></pre></td></tr></table></figure>

<p>使用，注意 nanoid 是采用分别导出的形式导出了一个 nanoid 方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; nanoid &#125; <span class="keyword">from</span> <span class="string">&quot;nanoid&quot;</span>;</span><br><span class="line"></span><br><span class="line">nanoid()</span><br></pre></td></tr></table></figure>

<h3 id="添加鼠标移入移出事件"><a href="#添加鼠标移入移出事件" class="headerlink" title="添加鼠标移入移出事件"></a>添加鼠标移入移出事件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 是否移入状态</span></span><br><span class="line">state = &#123;</span><br><span class="line">    flag: <span class="literal">false</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 鼠标的移入移出事件</span></span><br><span class="line">handerEnter = <span class="function">(<span class="params">flag</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">            flag: flag,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 从List组件中接收todo中的每一项内容</span></span><br><span class="line">    <span class="keyword">const</span> &#123; name, done &#125; = <span class="built_in">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> &#123; flag &#125; = <span class="built_in">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;li</span><br><span class="line">            style=&#123;&#123; <span class="attr">backgroundColor</span>: flag ? <span class="string">&quot;#ddd&quot;</span> : <span class="string">&quot;white&quot;</span> &#125;&#125;</span><br><span class="line">            onMouseEnter=&#123;<span class="built_in">this</span>.handerEnter(<span class="literal">true</span>)&#125;</span><br><span class="line">            onMouseLeave=&#123;<span class="built_in">this</span>.handerEnter(<span class="literal">false</span>)&#125;</span><br><span class="line">            className=&#123;itemcss.itemMain&#125;</span><br><span class="line">            &gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;checkbox&quot;</span> defaultChecked=&#123;done&#125; /&gt;</span><br><span class="line">            &lt;div&gt;&#123;name&#125;&lt;/div&gt;</span><br><span class="line">            &lt;button</span><br><span class="line">                style=&#123;&#123; <span class="attr">display</span>: flag ? <span class="string">&quot;block&quot;</span> : <span class="string">&quot;none&quot;</span> &#125;&#125;</span><br><span class="line">                className=&#123;itemcss.deleteBtn&#125;</span><br><span class="line">                &gt;</span><br><span class="line">                删除</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="脚手架添加propTypes"><a href="#脚手架添加propTypes" class="headerlink" title="脚手架添加propTypes"></a>脚手架添加propTypes</h3><p>默认脚手架没有安装<code>prop-types</code>，需要我们手动安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i prop-types --save</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">&quot;prop-types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对传递过来的prop进行数据类型限制</span></span><br><span class="line"><span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">    addTodo: PropTypes.func.isRequired,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="第八章-配置代理解决跨域"><a href="#第八章-配置代理解决跨域" class="headerlink" title="第八章 配置代理解决跨域"></a>第八章 配置代理解决跨域</h2><h3 id="设置代理方式1"><a href="#设置代理方式1" class="headerlink" title="设置代理方式1"></a>设置代理方式1</h3><p>配置代理前我们需要启动一个后台服务器，我们可以用  <code>node + express </code>快速搭建一个后台服务</p>
<p>安装 <code>express</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express --save</span><br></pre></td></tr></table></figure>

<p>新建 <code>index1.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="comment">// 创建 app</span></span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置中间件</span></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req);</span><br><span class="line">    <span class="comment">// 如果不添加 next 则不会继续往下执行</span></span><br><span class="line">    next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/students&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> query = [</span><br><span class="line">    &#123;</span><br><span class="line">      id: <span class="string">&quot;001&quot;</span>,</span><br><span class="line">      name: <span class="string">&quot;法外狂赌张三&quot;</span>,</span><br><span class="line">      age: <span class="number">18</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      id: <span class="string">&quot;002&quot;</span>,</span><br><span class="line">      name: <span class="string">&quot;李四&quot;</span>,</span><br><span class="line">      age: <span class="number">20</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">  <span class="comment">// 使用 send 可以自动帮助我们设置 Content-Type</span></span><br><span class="line">  res.send(query);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">5000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;服务已启动，地址：http://localhost:5000&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>然后运行 <code>node index1.js</code> 启动后台服务，启动效果如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS D:\mygitee\node后端&gt; node .\index1.js</span><br><span class="line">服务已启动，地址：http://localhost:5000</span><br></pre></td></tr></table></figure>

<p>然后在我们的 <code>React</code> 项目中安装 <code>axios</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install axios --save</span><br></pre></td></tr></table></figure>

<p>接着在 <code>App.js</code> 中发送请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.getStatusData&#125;</span>&gt;</span>点击获取数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  getStatusData = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    axios.get(<span class="string">&quot;http://localhost:5000/students&quot;</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res.data);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时点击按钮发送请求会在控制台看到如下错误</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/8.png"></p>
<p>这时受到浏览器的同源策略影响，产生的请求跨域。我们可以通过配置代理的方式来解决。</p>
<p>找到项目根目录下的 <code>package.json</code> 文件，在跟结构上添加如下代码</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/9.png"></p>
<p>proxy后面跟上后台服务地址，注意不要加具体的接口名字，只要添加http前缀和域名即可，之后重启项目</p>
<p>我们在请求时要将原本的5000端口换成3000，修改App.js文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">axios.get(<span class="string">&quot;http://localhost:3000/students&quot;</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>然后再次点击请求会发现正常拿到数据</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/10.png"></p>
<p>说明：</p>
<ul>
<li>优点：配置简单，前端请求资源时不需要添加前缀即可请求</li>
<li>缺点：不能配置多个，只能配置一个</li>
<li>工作方式：上述方法配置代理，当请求了3000不存在的资源时，那么该请求会转给5000，优先匹配前端资源</li>
</ul>
<h3 id="设置代理方式2"><a href="#设置代理方式2" class="headerlink" title="设置代理方式2"></a>设置代理方式2</h3><p>1.第一步 ：创建代理配置文件，注意该文件名为固定，不可更改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在src目录下新建 src/setupProxy.js</span><br></pre></td></tr></table></figure>

<p>2.第二步 编写 <code>setupProxy.js</code> 文件的配置规则</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="built_in">require</span>(<span class="string">&quot;http-proxy-middleware&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">app</span>) </span>&#123;</span><br><span class="line">  app.use(</span><br><span class="line">    proxy(<span class="string">&quot;/api1&quot;</span>, &#123; <span class="comment">// 所有以api1开头的请求将会被转发到5000端口</span></span><br><span class="line">      target: <span class="string">&quot;http://localhost:5000&quot;</span>, <span class="comment">// 配置产生跨域的地址，也就是服务器的地址</span></span><br><span class="line">      changeOrigin: <span class="literal">true</span>, <span class="comment">// 控制服务器中收到的请求头中Host字段的值</span></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * changeOrigin: true 服务器收到的请求头中的Host的值为  localhost:5000</span></span><br><span class="line"><span class="comment">       * changeOrigin: false 服务器收到的请求头中的Host的值为  localhost:3000</span></span><br><span class="line"><span class="comment">       * 默认为false，但通常我们将它设置为true，欺骗服务器我的这个请求就是从你自身的端口发出来的</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      pathRewrite: &#123; <span class="string">&quot;^/api1&quot;</span>: <span class="string">&quot;&quot;</span> &#125;, <span class="comment">// 去除请求前缀，保证交给后台服务器的地址是一个正常的地址</span></span><br><span class="line">    &#125;),</span><br><span class="line">    proxy(<span class="string">&quot;/api2&quot;</span>, &#123;</span><br><span class="line">      target: <span class="string">&quot;http://localhost:5001&quot;</span>,</span><br><span class="line">      changeOrigin: <span class="literal">true</span>,</span><br><span class="line">      pathRewrite: &#123; <span class="string">&quot;^/api2&quot;</span>: <span class="string">&quot;&quot;</span> &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>3.第三步 重启项目</p>
<p>4.第四步 修改 App.js 中的请求前缀</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="built_in">this</span>.getStatusData&#125;&gt; 获取学生数据 &lt;/button&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="built_in">this</span>.getCartData&#125;&gt; 获取汽车数据 &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  getStatusData = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    axios.get(<span class="string">&quot;/api1/students&quot;</span>).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res.data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  getCartData = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    axios.get(<span class="string">&quot;/api2/carts&quot;</span>).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res.data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5.效果展示，点击两个按钮访问不同的服务器，均能获取到数据</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/11.png"></p>
<h2 id="第九章-开发GitHub搜索接口"><a href="#第九章-开发GitHub搜索接口" class="headerlink" title="第九章 开发GitHub搜索接口"></a>第九章 开发GitHub搜索接口</h2><h3 id="新建node服务"><a href="#新建node服务" class="headerlink" title="新建node服务"></a>新建node服务</h3><p>首先在空白文件夹初始化<code>npm</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init </span><br></pre></td></tr></table></figure>

<p>按照提示会生成一个 <code>package.json</code> 文件</p>
<p>然后安装 <code>express</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express</span><br></pre></td></tr></table></figure>

<p>然后再安装 <code>axios</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install axios</span><br></pre></td></tr></table></figure>

<p>然后再根目录新建 <code>search.js</code>,编写如下代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)()</span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&#x27;axios&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/search/users&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; q &#125; = req.query</span><br><span class="line">    axios(&#123;</span><br><span class="line">        url: <span class="string">&#x27;https://api.github.com/search/users&#x27;</span>,</span><br><span class="line">        params: &#123; q &#125;</span><br><span class="line">    &#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        res.json(response.data)</span><br><span class="line">    &#125;).catch(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        res.json(&#123;</span><br><span class="line">            <span class="string">&quot;total_count&quot;</span>: <span class="number">19</span>,</span><br><span class="line">            <span class="string">&quot;incomplete_results&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;items&quot;</span>: [&#123;</span><br><span class="line">                <span class="string">&quot;login&quot;</span>: <span class="string">&quot;songzx&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">3830378</span>,</span><br><span class="line">                <span class="string">&quot;node_id&quot;</span>: <span class="string">&quot;MDQ6VXNlcjM4MzAzNzg=&quot;</span>,</span><br><span class="line">                <span class="string">&quot;avatar_url&quot;</span>: <span class="string">&quot;https://avatars.githubusercontent.com/u/3830378?v=4&quot;</span>,</span><br><span class="line">                <span class="string">&quot;gravatar_id&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx&quot;</span>,</span><br><span class="line">                <span class="string">&quot;html_url&quot;</span>: <span class="string">&quot;https://github.com/songzx&quot;</span>,</span><br><span class="line">                <span class="string">&quot;followers_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx/followers&quot;</span>,</span><br><span class="line">                <span class="string">&quot;following_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx/following&#123;/other_user&#125;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;gists_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx/gists&#123;/gist_id&#125;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;starred_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx/starred&#123;/owner&#125;&#123;/repo&#125;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;subscriptions_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx/subscriptions&quot;</span>,</span><br><span class="line">                <span class="string">&quot;organizations_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx/orgs&quot;</span>,</span><br><span class="line">                <span class="string">&quot;repos_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx/repos&quot;</span>,</span><br><span class="line">                <span class="string">&quot;events_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx/events&#123;/privacy&#125;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;received_events_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx/received_events&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;User&quot;</span>,</span><br><span class="line">                <span class="string">&quot;site_admin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;score&quot;</span>: <span class="number">1</span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="string">&quot;login&quot;</span>: <span class="string">&quot;songzxDev&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">6290650</span>,</span><br><span class="line">                <span class="string">&quot;node_id&quot;</span>: <span class="string">&quot;MDQ6VXNlcjYyOTA2NTA=&quot;</span>,</span><br><span class="line">                <span class="string">&quot;avatar_url&quot;</span>: <span class="string">&quot;https://avatars.githubusercontent.com/u/6290650?v=4&quot;</span>,</span><br><span class="line">                <span class="string">&quot;gravatar_id&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzxDev&quot;</span>,</span><br><span class="line">                <span class="string">&quot;html_url&quot;</span>: <span class="string">&quot;https://github.com/songzxDev&quot;</span>,</span><br><span class="line">                <span class="string">&quot;followers_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzxDev/followers&quot;</span>,</span><br><span class="line">                <span class="string">&quot;following_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzxDev/following&#123;/other_user&#125;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;gists_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzxDev/gists&#123;/gist_id&#125;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;starred_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzxDev/starred&#123;/owner&#125;&#123;/repo&#125;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;subscriptions_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzxDev/subscriptions&quot;</span>,</span><br><span class="line">                <span class="string">&quot;organizations_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzxDev/orgs&quot;</span>,</span><br><span class="line">                <span class="string">&quot;repos_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzxDev/repos&quot;</span>,</span><br><span class="line">                <span class="string">&quot;events_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzxDev/events&#123;/privacy&#125;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;received_events_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzxDev/received_events&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;User&quot;</span>,</span><br><span class="line">                <span class="string">&quot;site_admin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;score&quot;</span>: <span class="number">1</span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                <span class="string">&quot;login&quot;</span>: <span class="string">&quot;songzx0309&quot;</span>,</span><br><span class="line">                <span class="string">&quot;id&quot;</span>: <span class="number">3347681</span>,</span><br><span class="line">                <span class="string">&quot;node_id&quot;</span>: <span class="string">&quot;MDQ6VXNlcjMzNDc2ODE=&quot;</span>,</span><br><span class="line">                <span class="string">&quot;avatar_url&quot;</span>: <span class="string">&quot;https://avatars.githubusercontent.com/u/3347681?v=4&quot;</span>,</span><br><span class="line">                <span class="string">&quot;gravatar_id&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx0309&quot;</span>,</span><br><span class="line">                <span class="string">&quot;html_url&quot;</span>: <span class="string">&quot;https://github.com/songzx0309&quot;</span>,</span><br><span class="line">                <span class="string">&quot;followers_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx0309/followers&quot;</span>,</span><br><span class="line">                <span class="string">&quot;following_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx0309/following&#123;/other_user&#125;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;gists_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx0309/gists&#123;/gist_id&#125;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;starred_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx0309/starred&#123;/owner&#125;&#123;/repo&#125;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;subscriptions_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx0309/subscriptions&quot;</span>,</span><br><span class="line">                <span class="string">&quot;organizations_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx0309/orgs&quot;</span>,</span><br><span class="line">                <span class="string">&quot;repos_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx0309/repos&quot;</span>,</span><br><span class="line">                <span class="string">&quot;events_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx0309/events&#123;/privacy&#125;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;received_events_url&quot;</span>: <span class="string">&quot;https://api.github.com/users/songzx0309/received_events&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;User&quot;</span>,</span><br><span class="line">                <span class="string">&quot;site_admin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="string">&quot;score&quot;</span>: <span class="number">1</span></span><br><span class="line">            &#125;]</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">5000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;服务已经启动，访问地址 http://localhost:5000/search/users?q=xxx&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>之后在根目录输入启动命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node search.js</span><br></pre></td></tr></table></figure>

<p>启动成功如下：</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/12.png"></p>
<p>请求接口可以看到接口返回的数据</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/13.png"></p>
<h2 id="第十章-组件之间的互相通信"><a href="#第十章-组件之间的互相通信" class="headerlink" title="第十章 组件之间的互相通信"></a>第十章 组件之间的互相通信</h2><h3 id="父子通信"><a href="#父子通信" class="headerlink" title="父子通信"></a>父子通信</h3><p>首先在 <code>APP</code> 组件中引入了 <code>Header</code> 和 <code>List</code> 组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div className=<span class="string">&quot;app-main&quot;</span>&gt;</span><br><span class="line">            &lt;Header  /&gt;</span><br><span class="line">            &lt;List /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Header</code> 组件点击搜索获取到数据后如何给自己的父组件 <code>App</code> 呢？</p>
<p>首先在父组件 <code>App</code> 上定义一个 <code>setStateUsers</code> 方法，然后通过 <code>props</code> 将这个方法传递给子组件 <code>header</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    users: []</span><br><span class="line">  &#125;</span><br><span class="line">  setStateUsers = <span class="function">(<span class="params">users</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      users</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">&quot;app-main&quot;</span>&gt;</span><br><span class="line">        &lt;Header setStateUsers=&#123;<span class="built_in">this</span>.setStateUsers&#125; /&gt;</span><br><span class="line">        &lt;List users=&#123;<span class="built_in">this</span>.state.users&#125;/&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再子组件  <code>Header</code> 中点击搜索获取到数据后调用<code>props</code> 上的方法传递数据给<code>App</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 搜索</span></span><br><span class="line">searchUsers = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 获取输入框的值</span></span><br><span class="line">    <span class="keyword">const</span> nameVal = <span class="built_in">this</span>.inputEle.current.value</span><br><span class="line">    <span class="keyword">if</span> (!nameVal) &#123;</span><br><span class="line">        alert(<span class="string">&#x27;姓名不允许为空&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 发送请求</span></span><br><span class="line">    axiox.get(<span class="string">`/api1/search/users?q=<span class="subst">$&#123;nameVal&#125;</span>`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 调用父组件的方法传递参数</span></span><br><span class="line">        <span class="built_in">this</span>.props.setStateUsers(res.data.items)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这样父组件<code>App</code> 上定义的 <code>setStateUsers</code> 会被触发并且可以接受到 子组件 <code>Header</code> 传递过来的 <code>users</code> 数据，然后通过 <code>props</code> 传递给另外一个子组件 <code>List</code> ，从而完成数据的展示</p>
<h3 id="消息订阅和发布"><a href="#消息订阅和发布" class="headerlink" title="消息订阅和发布"></a>消息订阅和发布</h3><p>完成这个功能我们需要第三方的插件，这里我们采用 <code>pubsub-js</code>,首先安装到我们的项目中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i pubsub-js</span><br></pre></td></tr></table></figure>

<p>该插件采用发布订阅模式来实现组件间通信。</p>
<p>我们来改进上面的传值方法，让 <code>Header</code> 组件和 <code>List</code> 组件直接进行通信，不通过 <code>App</code> 组件进行中转</p>
<p>首先修改 <code>App</code> ，既然来让两个兄弟组件进行通信，那么<code>App</code> 组件就不需要维护状态和方法了，改进后代码如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">&quot;app-main&quot;</span>&gt;</span><br><span class="line">        &lt;Header /&gt;</span><br><span class="line">        &lt;List /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在 <code>Header</code> 组件中发布消息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> headercss <span class="keyword">from</span> <span class="string">&quot;./index.module.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> axiox <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span></span><br><span class="line"><span class="comment">// 使用前引入pubsub-js</span></span><br><span class="line"><span class="keyword">import</span> PubSub <span class="keyword">from</span> <span class="string">&quot;pubsub-js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Header</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 声明ref绑定input框</span></span><br><span class="line">  inputEle = React.createRef()</span><br><span class="line">  <span class="comment">// 搜索</span></span><br><span class="line">  searchUsers = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 获取输入框的值</span></span><br><span class="line">    <span class="keyword">const</span> nameVal = <span class="built_in">this</span>.inputEle.current.value</span><br><span class="line">    <span class="keyword">if</span> (!nameVal) &#123;</span><br><span class="line">      alert(<span class="string">&#x27;姓名不允许为空&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 发送请求</span></span><br><span class="line">    axiox.get(<span class="string">`/api1/search/users?q=<span class="subst">$&#123;nameVal&#125;</span>`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 发布消息，传递请求到的人员信息</span></span><br><span class="line"><span class="comment">       * 发布消息时调用 PubSub.publish() 方法，这个方法传递两个参数</span></span><br><span class="line"><span class="comment">       *  users:发布的消息名称，可以是任何字符串，订阅消息时要和这个名字一致才能接收到消息</span></span><br><span class="line"><span class="comment">       *  第二个参数就是要发布的数据</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      PubSub.publish(<span class="string">&#x27;users&#x27;</span>, res.data.items)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=&#123;headercss.main&#125;&gt;</span><br><span class="line">        &lt;div className=&#123;headercss.searchbox&#125;&gt;</span><br><span class="line">          &lt;h3&gt;Search Gitee Users&lt;/h3&gt;</span><br><span class="line">          &lt;div className=&#123;headercss.inputbox&#125;&gt;</span><br><span class="line">            &lt;input ref=&#123;<span class="built_in">this</span>.inputEle&#125; type=<span class="string">&quot;text&quot;</span> placeholder=<span class="string">&quot;请搜索&quot;</span> /&gt;</span><br><span class="line">            &lt;button onClick=&#123;<span class="built_in">this</span>.searchUsers&#125;&gt;点击搜索&lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发布消息时使用 <code>PubSub.publish(&#39;users&#39;, res.data.items)</code> 方法，这个方法接受两个参数：</p>
<ul>
<li>users：声明发布的消息名称，然后订阅消息时监听这个名称，当消息发布后会触发监听消息的回调</li>
<li>res.data.items：发布消息要发送的数据</li>
</ul>
<p>最后在 <code>List</code> 组件中监听消息，监听到消息后更新状态渲染页面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> listcss <span class="keyword">from</span> <span class="string">&quot;./index.module.css&quot;</span></span><br><span class="line"><span class="keyword">import</span> Item <span class="keyword">from</span> <span class="string">&quot;../Item&quot;</span></span><br><span class="line"><span class="keyword">import</span> PubSub <span class="keyword">from</span> <span class="string">&#x27;pubsub-js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">List</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        users: []</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组件挂载完成时就监听消息</span></span><br><span class="line">    <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 监听消息</span></span><br><span class="line">        PubSub.subscribe(<span class="string">&#x27;users&#x27;</span>, <span class="function">(<span class="params">_, data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 接收到订阅的消息后更新状态</span></span><br><span class="line">            <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">                users: data</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; users &#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div className=&#123;listcss.main&#125;&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    users.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> (</span><br><span class="line">                            &lt;Item key=&#123;item.id&#125; item=&#123;item&#125; /&gt;</span><br><span class="line">                        )</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>订阅消息调用 <code>PubSub.subscribe(&#39;users&#39;,(msg.data)=&gt;&#123;  &#125;)</code>，<code>subscribe</code> 方法同样接受两个参数：</p>
<ul>
<li>第一个参数是要监听那个消息，这个名称要和发布消息时定义的名称一致</li>
<li>第二个参数是一个函数，当消息发布成功后会触发这个函数，这个函数有两个参数<ul>
<li>第一个参数是订阅的消息名</li>
<li>第二个是监听到的数据</li>
</ul>
</li>
</ul>
<h2 id="第十一章-使用-fetch-发送请求"><a href="#第十一章-使用-fetch-发送请求" class="headerlink" title="第十一章 使用 fetch 发送请求"></a>第十一章 使用 fetch 发送请求</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p><code>fetch</code> 是不依赖第三方的原生自带的一个请求方法，它和之前常用的 <code>XMLHttpRequest</code> 是一个级别的，不和 <code>jquery、axios</code> 一个级别，因为这些库都只是对  <code>XMLHttpRequest</code> 的封装。   我们一起来学习一下这个 <code>fetch</code> 到底怎么使用的吧</p>
<h3 id="使用-fetch-发送-GET-请求"><a href="#使用-fetch-发送-GET-请求" class="headerlink" title="使用 fetch 发送 GET 请求"></a>使用 fetch 发送 GET 请求</h3><p>标准写法，有待优化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">`/api1/search/users?q=<span class="subst">$&#123;nameVal&#125;</span>`</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// fetch 第一次返回的并不是服务器返回的数据，而是请求到的状态信息，用来告知我们这个请求是否发送成功</span></span><br><span class="line">    <span class="comment">// 使用结果上自带的 json 方法转成 promise 对象返回出去，交给第二个 then 去处理</span></span><br><span class="line">    <span class="keyword">return</span> res.json()</span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 第二次 then 拿到的才是服务器返回的数据</span></span><br><span class="line">    PubSub.publish(<span class="string">&#x27;users&#x27;</span>, res.items)</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 使用 catch 来处理上述两步骤中可能出现的错误</span></span><br><span class="line">    alert(<span class="built_in">JSON</span>.stringify(err))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>上面的写法还可以进一步优化，使用 <code>async await</code> 语法来优化上述代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">try</span> &#123;</span><br><span class="line">     <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(<span class="string">`/api1/search/users?q=<span class="subst">$&#123;nameVal&#125;</span>`</span>)</span><br><span class="line">     <span class="keyword">const</span> result = <span class="keyword">await</span> response.json()</span><br><span class="line">     PubSub.publish(<span class="string">&#x27;users&#x27;</span>, result.items)</span><br><span class="line"> &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">     <span class="comment">// 使用 try catch 来处理 await 错误</span></span><br><span class="line">     alert(<span class="built_in">JSON</span>.stringify(error))</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 别忘了在距离这个代码最近的方法前添加一个 async 关键字</span></span><br></pre></td></tr></table></figure>

<p><code>await</code> 只能够接收到成功的返回，并不能处理错误的返回，所以我们使用 <code>try cathc</code> 来处理异常结果</p>
<h3 id="使用-fetch-发送-POST-请求"><a href="#使用-fetch-发送-POST-请求" class="headerlink" title="使用 fetch 发送 POST 请求"></a>使用 fetch 发送 POST 请求</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;https://...&#x27;</span>, &#123;</span><br><span class="line">    method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    body: <span class="built_in">JSON</span>.stringify(base),</span><br><span class="line">    headers: &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="第十二章-React-路由"><a href="#第十二章-React-路由" class="headerlink" title="第十二章 React 路由"></a>第十二章 React 路由</h2><h3 id="什么是SPA单页面"><a href="#什么是SPA单页面" class="headerlink" title="什么是SPA单页面"></a>什么是SPA单页面</h3><ul>
<li>整个页面只有一个完整的页面</li>
<li>点击页面的链接不会刷新整个页面，只会做页面的局部更新</li>
<li>数据通过ajax获取，前端异步显示</li>
</ul>
<h3 id="什么是路由"><a href="#什么是路由" class="headerlink" title="什么是路由"></a>什么是路由</h3><ul>
<li>一个路由就是一个映射关系</li>
<li>key为路径，value可能是function，也可能是一个component</li>
</ul>
<h3 id="前端路由的工作原理"><a href="#前端路由的工作原理" class="headerlink" title="前端路由的工作原理"></a>前端路由的工作原理</h3><ul>
<li>前端路由是靠浏览器中的BOM对象身上的history来实现的</li>
<li>我们每次点击菜单进行跳转时会往history的栈结构中压入一条数据</li>
<li>history是H5提出的一个新语法</li>
<li>不用history路由还有一种hasHistory，类似于锚点</li>
</ul>
<h3 id="认识-react-router-dom"><a href="#认识-react-router-dom" class="headerlink" title="认识 react-router-dom"></a>认识 <em>react-router-dom</em></h3><p>react-router-dom 是React官方维护的专门用来开发单页面应用的插件。</p>
<p>安装,目前官方的插件版本已经升级到的6.0,写法和5.0有些不同，学习阶段我们以5.2.0版本为例来学习</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i react-router-dom@5.2.0 --save</span><br></pre></td></tr></table></figure>

<p>安装成功后修改 <code>src\index.js</code>   文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="comment">// 从react-router-dom中引入BrowserRouter组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">    <span class="comment">// 使用 BrowserRouter 组件包裹 App 组件，实现全局路由都由一个路由器管理</span></span><br><span class="line">    &lt;BrowserRouter&gt;</span><br><span class="line">        &lt;App /&gt;</span><br><span class="line">    &lt;/BrowserRouter&gt;,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>接着修改App.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">// 从路由中分别导出 Link, Route,Routes </span></span><br><span class="line"><span class="keyword">import</span> &#123; Link, Route,Routes &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;./components/Home&quot;</span></span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&quot;./components/About&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      	&lt;div&gt;</span><br><span class="line">             &lt;div&gt;</span><br><span class="line">                &#123;<span class="comment">/* React中使用Link实现组件跳转 */</span>&#125;</span><br><span class="line">                &lt;Link className=<span class="string">&quot;list-group-item&quot;</span> to=<span class="string">&#x27;/home&#x27;</span>&gt;Home&lt;/Link&gt;</span><br><span class="line">                &lt;Link className=<span class="string">&quot;list-group-item&quot;</span> to=<span class="string">&#x27;/about&#x27;</span>&gt;About&lt;/Link&gt;</span><br><span class="line">             &lt;/div&gt;</span><br><span class="line">             &lt;div&gt;</span><br><span class="line">                &#123;<span class="comment">/* 注册路由 */</span>&#125;</span><br><span class="line">                &lt;Route path=<span class="string">&quot;/home&quot;</span> component=&#123;Home&#125;/&gt;</span><br><span class="line">                &lt;Route path=<span class="string">&quot;/about&quot;</span> component=&#123;About&#125;/&gt;</span><br><span class="line">             &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结：</p>
<p>路由区要使用 <code>Link</code> 标签来写，并使用 <code>to</code> 属性标识要跳转的路径</p>
<p>展示区要使用 <code>Route</code> 标签来展示显示那个具体的组件</p>
<p>效果演示，可以看到点击不同的菜单，路径会发生变化，但是页面不会刷新</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/2.gif"></p>
<h3 id="路由组件和一般组件"><a href="#路由组件和一般组件" class="headerlink" title="路由组件和一般组件"></a>路由组件和一般组件</h3><ol>
<li><p>写法不同</p>
<ol>
<li>一般组件：<code>&lt;Demo&gt;&lt;/Demo&gt;</code></li>
<li>路由组件：<code>&lt;Route path=&quot;/about&quot; component=&#123;About&#125;/&gt;</code></li>
</ol>
</li>
<li><p>存放的位置不同</p>
<ol>
<li>一般组件推荐放在 <code>components</code> 文件夹下</li>
<li>路由组件推荐放在 <code>pages</code> 文件夹下</li>
</ol>
</li>
<li><p>介绍的 <code>props</code> 不同</p>
<ol>
<li><p>一般组件不会接收到默认的 <code>props</code></p>
</li>
<li><p>路由组件会接收到默认的 <code>props</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">history:</span><br><span class="line">    go: ƒ go(n)</span><br><span class="line">    goBack: ƒ goBack()</span><br><span class="line">    goForward: ƒ goForward()</span><br><span class="line">    push: ƒ push(path, state)</span><br><span class="line">    replace: ƒ replace(path, state)	</span><br><span class="line">location:</span><br><span class="line">    pathname: <span class="string">&quot;/about&quot;</span></span><br><span class="line">    search: <span class="string">&quot;&quot;</span></span><br><span class="line">    state: <span class="literal">undefined</span></span><br><span class="line">match:</span><br><span class="line">    params: &#123;&#125;</span><br><span class="line">    path: <span class="string">&quot;/about&quot;</span></span><br><span class="line">    url: <span class="string">&quot;/about&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
<h3 id="NavLink-的使用"><a href="#NavLink-的使用" class="headerlink" title="NavLink 的使用"></a><em>NavLink</em> 的使用</h3><p>使用 <code>NavLink</code> 标签替换 <code>Link</code> 标签后，当我们点击某个连接时，会默认给这个连接添加一个 <code>active</code> 的样式类</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NavLink, Route &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"></span><br><span class="line">&lt;NavLink activeClassName=<span class="string">&quot;select&quot;</span> className=<span class="string">&quot;list-group-item&quot;</span> to=<span class="string">&#x27;/home&#x27;</span>&gt;Home&lt;/NavLink&gt;</span><br><span class="line">&lt;NavLink activeClassName=<span class="string">&quot;select&quot;</span> className=<span class="string">&quot;list-group-item&quot;</span> to=<span class="string">&#x27;/about&#x27;</span>&gt;About&lt;/NavLink&gt;</span><br></pre></td></tr></table></figure>

<p>我们也可以使用 <code>activeClassName</code> 来自定义点击时添加什么类名。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.select</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: orange <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">color</span>: white <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里有个小小的坑，就是添加样式时要提高权重值，避免其他UI库的影响。</p>
<p>实现效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/3.gif"></p>
<h3 id="封装-NavLink"><a href="#封装-NavLink" class="headerlink" title="封装 NavLink"></a>封装 <em>NavLink</em></h3><p>当我们页面中有多个 <code>NavLink</code> 标签时，就需要定义多个 <code>activeClassName</code> 和 <code>className</code>，这就造成了代码的重复，接下我们对 <code>NavLink</code> 进行一个二次封装，来简化代码</p>
<p>新建 <code>src\components\MyNavLink.jsx</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; NavLink &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">MyNavLink</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">activeClassName</span>=<span class="string">&quot;select&quot;</span> <span class="attr">className</span>=<span class="string">&quot;list-group-item&quot;</span> &#123;<span class="attr">...this.props</span>&#125;/&gt;</span></span> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>MyNavLink</code> 组件中通过 <code>&#123;...this.props&#125;</code> 批量的接收到 <code>props</code> 值，并且添加到 <code>NavLink</code> 标签上</p>
<p>然后修改 <code>App</code> 组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> MyNavLink <span class="keyword">from</span> <span class="string">&quot;./components/MyNavLink&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#123;<span class="comment">/* React中使用Link实现组件跳转 */</span>&#125;</span><br><span class="line">&lt;MyNavLink to=<span class="string">&#x27;/home&#x27;</span>&gt;Home&lt;/MyNavLink&gt;</span><br><span class="line">&lt;MyNavLink to=<span class="string">&#x27;/about&#x27;</span>&gt;About&lt;/MyNavLink&gt;</span><br></pre></td></tr></table></figure>

<p>这里我们在 <code>MyNavLink</code> 标签中添加的 <code>Home</code> 和 <code>About</code> 也会被作为 <code>props</code> 参数传递个 <code>MyNavLink</code>，只不过名字为默认的 <code>children</code></p>
<p>我们可以在 <code>MyNavLink</code> 组件中打印一下传递过来的参数</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/14.png" alt="image-20211129113519943"></p>
<p>通过控制台可以发现 children 刚好就是我们在标签中写的值。这样我们通过批量接收 props 的值就可以实现 <code>NavLink</code> 的效果，同时也简化我们的代码。</p>
<h3 id="Switch-组件的使用"><a href="#Switch-组件的使用" class="headerlink" title="Switch 组件的使用"></a><em>Switch</em> 组件的使用</h3><p>react 在匹配 Route 时，如果匹配到了一个会继续往后匹配，并且会把所有匹配到的内容展示出来，这样效率不会太高，怎么才能设置匹配到一个组件后就停止匹配</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 首先引入 Switch</span></span><br><span class="line"><span class="keyword">import</span> &#123; Route, Switch &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 然后使用Switch组件包裹Route组件</span></span><br><span class="line">&lt;Switch&gt;</span><br><span class="line">    &lt;Route path=<span class="string">&quot;/home&quot;</span> component=&#123;Home&#125; /&gt;</span><br><span class="line">    &lt;Route path=<span class="string">&quot;/about&quot;</span> component=&#123;About&#125; /&gt;</span><br><span class="line">    &lt;Route path=<span class="string">&quot;/about&quot;</span> component=&#123;Test&#125; /&gt;</span><br><span class="line">&lt;/Switch&gt;</span><br></pre></td></tr></table></figure>

<p>但是通常情况下，path 和 component 是一一对应的，不会出现一对多的情况。</p>
<h3 id="解决样式丢失问题"><a href="#解决样式丢失问题" class="headerlink" title="解决样式丢失问题"></a>解决样式丢失问题</h3><p>首先我们在所有的路径前面添加一个固定的前缀</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyNavLink to=<span class="string">&#x27;/songzx/home&#x27;</span>&gt;Home&lt;/MyNavLink&gt;</span><br><span class="line">&lt;MyNavLink to=<span class="string">&#x27;/songzx/about&#x27;</span>&gt;About&lt;/MyNavLink&gt;</span><br><span class="line"></span><br><span class="line">&lt;Switch&gt;</span><br><span class="line">    &#123;<span class="comment">/* 注册路由 */</span>&#125;</span><br><span class="line">	&lt;Route path=<span class="string">&quot;/songzx/home&quot;</span> component=&#123;Home&#125; /&gt;</span><br><span class="line">    &lt;Route path=<span class="string">&quot;/songzx/about&quot;</span> component=&#123;About&#125; /&gt;</span><br><span class="line">&lt;/Switch&gt;</span><br></pre></td></tr></table></figure>

<p>这样我们在进行页面点击时会出现下面的效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/4.gif"></p>
<p>通过动画可以看到，页面在进行切换时样式正常显示，但是在刷新后，样式会丢失，这是因为我们添加看一个前缀后，请求css的路径就会变成下面的地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:3000/songzx/css/bootstrap.css</span><br></pre></td></tr></table></figure>

<p><code>http://localhost:3000</code> 对应我们的 <code>public</code> 文件夹，但是 <code>public</code> 文件夹下面并没有 <code>songzx</code> 文件夹，所有导致 <code>css</code> 文件找不到。</p>
<p>解决方法一（推荐）：</p>
<p>修改 <code>public\index.html</code> 文件中的 css 引入的路径，将原本的 <code>./</code> 换成 <code>/</code> ,这样直接从根目录下查找该 css 文件。</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/15.png"></p>
<p>解决方法二：</p>
<p>修改 <code>public\index.html</code> 文件中的 css 引入的路径，将原本的 <code>./</code> 换成 <code>%PUBLIC_URL%/</code> </p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/16.png"></p>
<p>解决方法三（不推荐）:</p>
<p>将 <code>BrowserRouter</code> 路由模式换成 <code>HashRouter</code> 路由模式，但是这样做后，浏览器路径上会多出一个 # 号，不美观</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/17.png"></p>
<p>我们按照第一种解决方法修改后，再来看页面刷新后的效果，点击刷新后，css样式不会丢失</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/5.gif"></p>
<h3 id="路由的严格匹配"><a href="#路由的严格匹配" class="headerlink" title="路由的严格匹配"></a>路由的严格匹配</h3><p>在 <code>Route</code> 标签中添加 <code>exact</code> 属性即可开启路由严格匹配</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="comment">/* React中使用Link实现组件跳转 */</span>&#125;</span><br><span class="line">&lt;MyNavLink to=<span class="string">&#x27;/home&#x27;</span>&gt;Home&lt;/MyNavLink&gt;</span><br><span class="line">&lt;MyNavLink to=<span class="string">&#x27;/about/a/b&#x27;</span>&gt;About&lt;/MyNavLink&gt;</span><br><span class="line"></span><br><span class="line">&#123;<span class="comment">/* 使用Switch组件包裹了Route组件后，匹配到一个组件就不会继续往下匹配，提高效率 */</span>&#125;</span><br><span class="line">&lt;Switch&gt;</span><br><span class="line">    &#123;<span class="comment">/* 注册路由 */</span>&#125;</span><br><span class="line">	&lt;Route exact path=<span class="string">&quot;/home&quot;</span> component=&#123;Home&#125; /&gt;</span><br><span class="line">    &lt;Route exact path=<span class="string">&quot;/about&quot;</span> component=&#123;About&#125; /&gt;</span><br><span class="line">&lt;/Switch&gt;</span><br></pre></td></tr></table></figure>

<p>开启了严格匹配后必须路径和路由一摸一样才能被匹配到。因此在不影响页面显示的情况下，不建议开启严格匹配模式。</p>
<h3 id="redirect重定向路由"><a href="#redirect重定向路由" class="headerlink" title="redirect重定向路由"></a>redirect重定向路由</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Route, Switch, Redirect &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="comment">/* 重定向路由，当页面路径都匹配不到时自动重定向到该路径 */</span>&#125;</span><br><span class="line">&lt;Redirect to=<span class="string">&quot;/home&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<p><code>Redirect</code> 重定向可以理解为一个 “兜底” 的人</p>
<h3 id="嵌套路由"><a href="#嵌套路由" class="headerlink" title="嵌套路由"></a>嵌套路由</h3><p>首先在 Home 文件夹下添加 News 和 Message 两个页面，然后修改 <code>src\pages\Home\index.jsx</code> 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> MyNavLink <span class="keyword">from</span> <span class="string">&quot;../../components/MyNavLink&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Switch, Route, Redirect &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"><span class="keyword">import</span> News <span class="keyword">from</span> <span class="string">&quot;./News&quot;</span></span><br><span class="line"><span class="keyword">import</span> Message <span class="keyword">from</span> <span class="string">&quot;./Message&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;ul <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;nav nav-tabs&quot;</span>&gt;</span><br><span class="line">                    &lt;li&gt;</span><br><span class="line">                        &lt;MyNavLink to=<span class="string">&quot;/home/news&quot;</span>&gt;News&lt;/MyNavLink&gt;</span><br><span class="line">                    &lt;/li&gt;</span><br><span class="line">                    &lt;li&gt;</span><br><span class="line">                        &lt;MyNavLink to=<span class="string">&quot;/home/message&quot;</span>&gt;Message&lt;/MyNavLink&gt;</span><br><span class="line">                    &lt;/li&gt;</span><br><span class="line">                &lt;/ul&gt;</span><br><span class="line">                &lt;Switch&gt;</span><br><span class="line">                    &lt;Route path=<span class="string">&quot;/home/news&quot;</span> component=&#123;News&#125; /&gt;</span><br><span class="line">                    &lt;Route path=<span class="string">&quot;/home/message&quot;</span> component=&#123;Message&#125; /&gt;</span><br><span class="line">                    &lt;Redirect to=<span class="string">&quot;/home/news&quot;</span> /&gt;</span><br><span class="line">                &lt;/Switch&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果演示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/6.gif"></p>
<h3 id="向路由组件传递-params-参数"><a href="#向路由组件传递-params-参数" class="headerlink" title="向路由组件传递 params 参数"></a>向路由组件传递 params 参数</h3><p>修改 <code>src\pages\Home\Message\index.jsx</code> 文件代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Detailed <span class="keyword">from</span> <span class="string">&#x27;./Detailed&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Link, Route &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Message</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        msgList: [</span><br><span class="line">            &#123;</span><br><span class="line">                id: <span class="string">&quot;01&quot;</span>,</span><br><span class="line">                title: <span class="string">&quot;消息1&quot;</span>,</span><br><span class="line">                content: <span class="string">&quot;我爱你，中国&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                id: <span class="string">&quot;02&quot;</span>,</span><br><span class="line">                title: <span class="string">&quot;消息2&quot;</span>,</span><br><span class="line">                content: <span class="string">&quot;我爱你，React&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                id: <span class="string">&quot;03&quot;</span>,</span><br><span class="line">                title: <span class="string">&quot;消息3&quot;</span>,</span><br><span class="line">                content: <span class="string">&quot;我爱你，自己&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; msgList &#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    msgList.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> (</span><br><span class="line">                            &lt;div key=&#123;item.id&#125;&gt;</span><br><span class="line">                                &lt;Link to=&#123;<span class="string">`/home/message/detailed/<span class="subst">$&#123;item.id&#125;</span>/<span class="subst">$&#123;item.title&#125;</span>/<span class="subst">$&#123;item.content&#125;</span>`</span>&#125;&gt;										&#123;item.title&#125;</span><br><span class="line">								&lt;/Link&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        )</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">                &lt;hr /&gt;</span><br><span class="line">                &lt;Route path=<span class="string">&quot;/home/message/detailed/:id/:title/:content&quot;</span> component=&#123;Detailed&#125; /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在接收参数的地方通过 <code>:id/:title/:content</code> 的方式定义了我们接收参数的 key</p>
<p>然后在 <code>Detailed</code> 组件中接收参数并使用，修改 <code>src\pages\Home\Message\Detailed\index.jsx</code> 组件如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Detailed</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.props);</span><br><span class="line">        <span class="keyword">const</span> &#123; id, title, content &#125; = <span class="built_in">this</span>.props.match.params</span><br><span class="line">        <span class="comment">// props 中 match 下面的 params 就是我们传递过来的参数</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;id:&#123;id&#125;&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;title:&#123;title&#125;&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;content:&#123;content&#125;&lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/7.gif"></p>
<h3 id="向路由组件传递-search-参数"><a href="#向路由组件传递-search-参数" class="headerlink" title="向路由组件传递 search 参数"></a>向路由组件传递 search 参数</h3><p>首先定义路由，link 传参时要指定好 key 和 value，Route 在接收路径时不需要在接收参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Link to=&#123;<span class="string">`/home/message/detailed/?id=<span class="subst">$&#123;item.id&#125;</span>&amp;title=<span class="subst">$&#123;item.title&#125;</span>&amp;content=<span class="subst">$&#123;item.content&#125;</span>`</span>&#125;&gt;</span><br><span class="line">    &#123;item.title&#125;</span><br><span class="line">&lt;/Link&gt;</span><br><span class="line"></span><br><span class="line">&lt;Route path=<span class="string">&quot;/home/message/detailed&quot;</span> component=&#123;Detailed&#125;&gt;&lt;/Route&gt;</span><br></pre></td></tr></table></figure>

<p>然后再 <code>Detailed</code> 组件中接收</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">&quot;querystring&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Detailed</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.props);</span><br><span class="line">        <span class="keyword">const</span> &#123; search &#125; = <span class="built_in">this</span>.props.location</span><br><span class="line">        <span class="comment">// 使用 qs.parse 解析传递过来的字符串格式的参数，slice(1) 是为了去掉前面的问号</span></span><br><span class="line">        <span class="keyword">const</span> &#123; id, title, content &#125; = qs.parse(search.slice(<span class="number">1</span>))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;id:&#123;id&#125;&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;title:&#123;title&#125;&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;content:&#123;content&#125;&lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们解析字符串格式的参数引入了一个React 脚手架中自带的一个库，<code>querystring</code>，这个库有两个方法：<code>parse</code> 和 <code>stringify</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> params = <span class="string">&#x27;id=1&amp;name=李四&#x27;</span></span><br><span class="line"><span class="built_in">console</span>.log(qs.parse(params)); <span class="comment">//=&gt; &#123;id: &#x27;1&#x27;, name: &#x27;李四&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> params2 = &#123; <span class="attr">carName</span>:<span class="string">&quot;bwm&quot;</span>,<span class="attr">price</span>:<span class="number">199</span> &#125;</span><br><span class="line"><span class="built_in">console</span>.log(qs.stringify(params2)); <span class="comment">//=&gt; carName=bwm&amp;price=199</span></span><br></pre></td></tr></table></figure>

<h3 id="向路由组件传递-state-参数"><a href="#向路由组件传递-state-参数" class="headerlink" title="向路由组件传递 state 参数"></a>向路由组件传递 state 参数</h3><p>首先定义路由参数,Link 组件的 to 要定义成一个对象，Route 组件无需接收参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="comment">/* 使用 state 方式传递路由参数 */</span>&#125;</span><br><span class="line">&lt;Link to=&#123;&#123;</span><br><span class="line">        pathname: <span class="string">&#x27;/home/message/detailed&#x27;</span>,</span><br><span class="line">            state: &#123;</span><br><span class="line">                id: item.id,</span><br><span class="line">                    title: item.title,</span><br><span class="line">                        content: item.content</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;&#125;&gt;</span><br><span class="line">    &#123;item.title&#125;</span><br><span class="line">&lt;/Link&gt;</span><br><span class="line"></span><br><span class="line">&#123;<span class="comment">/* 使用state的方式给路由组件传递参数 */</span>&#125;</span><br><span class="line">&lt;Route path=<span class="string">&quot;/home/message/detailed&quot;</span> component=&#123;Detailed&#125;&gt;&lt;/Route&gt;</span><br></pre></td></tr></table></figure>

<p>然后在 <code>Detailed</code> 组件中从 <code>props.location.state</code> 身上解构赋值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Detailed</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.props);</span><br><span class="line">        <span class="keyword">const</span> &#123; id, title, content &#125; = <span class="built_in">this</span>.props.location.state || &#123;&#125;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;id:&#123;id&#125;&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;title:&#123;title&#125;&lt;/p&gt;</span><br><span class="line">                &lt;p&gt;content:&#123;content&#125;&lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种传参方式不会再浏览器地址上体现参数，如下所示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/8.gif"></p>
<h3 id="路由的push模式和replace模式"><a href="#路由的push模式和replace模式" class="headerlink" title="路由的push模式和replace模式"></a>路由的push模式和replace模式</h3><p>在 <code>Link</code> 组件上添加 <code>replace</code> 属性即可开启 <code>replace</code> 模式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="comment">/* 使用 state 方式传递路由参数 */</span>&#125;</span><br><span class="line">&lt;Link to=&#123;&#123;<span class="attr">pathname</span>: <span class="string">&#x27;/home/message/detailed&#x27;</span>,<span class="attr">state</span>: &#123;<span class="attr">id</span>: item.id&#125;&#125;&#125; replace&gt;</span><br><span class="line">    &#123;item.title&#125;</span><br><span class="line">&lt;/Link&gt;</span><br></pre></td></tr></table></figure>

<p>开启点击跳转不会压入栈中，而是替换当前路由，不会留下历史记录</p>
<p>开启 replace 的效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/9.gif"></p>
<p>不开启的效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/10.gif"></p>
<h3 id="编程式路由"><a href="#编程式路由" class="headerlink" title="编程式路由"></a>编程式路由</h3><h4 id="push-模式传递-params-参数"><a href="#push-模式传递-params-参数" class="headerlink" title="push 模式传递 params 参数"></a>push 模式传递 params 参数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.props.history.push(<span class="string">`/home/message/detailed/<span class="subst">$&#123;id&#125;</span>/<span class="subst">$&#123;title&#125;</span>/<span class="subst">$&#123;content&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>

<h4 id="push-模式传递-search-参数"><a href="#push-模式传递-search-参数" class="headerlink" title="push 模式传递 search 参数"></a>push 模式传递 search 参数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.props.history.push(<span class="string">`/home/message/detailed?id=<span class="subst">$&#123;id&#125;</span>&amp;title=<span class="subst">$&#123;title&#125;</span>&amp;content=<span class="subst">$&#123;content&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>

<h4 id="push-模式传递-state-参数"><a href="#push-模式传递-state-参数" class="headerlink" title="push 模式传递 state 参数"></a>push 模式传递 state 参数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.props.history.push(<span class="string">`/home/message/detailed`</span>, &#123;</span><br><span class="line">    id, title, content</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="replace-模式传递-params-参数"><a href="#replace-模式传递-params-参数" class="headerlink" title="replace 模式传递 params 参数"></a>replace 模式传递 params 参数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.props.history.replace(<span class="string">`/home/message/detailed/<span class="subst">$&#123;id&#125;</span>/<span class="subst">$&#123;title&#125;</span>/<span class="subst">$&#123;content&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>

<h4 id="replace-模式传递-search-参数"><a href="#replace-模式传递-search-参数" class="headerlink" title="replace 模式传递 search 参数"></a>replace 模式传递 search 参数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.props.history.replace(<span class="string">`/home/message/detailed?id=<span class="subst">$&#123;id&#125;</span>&amp;title=<span class="subst">$&#123;title&#125;</span>&amp;content=<span class="subst">$&#123;content&#125;</span>`</span>)</span><br></pre></td></tr></table></figure>

<h4 id="replace-模式传递-state-参数"><a href="#replace-模式传递-state-参数" class="headerlink" title="replace 模式传递 state 参数"></a>replace 模式传递 state 参数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.props.history.replace(<span class="string">`/home/message/detailed`</span>, &#123;</span><br><span class="line">    id, title, content</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="goBack-返回"><a href="#goBack-返回" class="headerlink" title="goBack 返回"></a>goBack 返回</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.props.history.goBack()</span><br></pre></td></tr></table></figure>

<h4 id="goForward-前进"><a href="#goForward-前进" class="headerlink" title="goForward 前进"></a>goForward 前进</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.props.history.goForward()</span><br></pre></td></tr></table></figure>

<h4 id="go-跳转至指定级别"><a href="#go-跳转至指定级别" class="headerlink" title="go 跳转至指定级别"></a>go 跳转至指定级别</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前进两级</span></span><br><span class="line"><span class="built_in">this</span>.props.history.go(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 后退两级</span></span><br><span class="line"><span class="built_in">this</span>.props.history.go(-<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<h3 id="withRouter-的使用"><a href="#withRouter-的使用" class="headerlink" title="withRouter 的使用"></a>withRouter 的使用</h3><p>我们上面使用的路由方法都是在路由组件中使用的，那么在一般组件组件中能否使用 <code>history</code> 对象身上的方法呢？添加相关代码，在 Header 组件中添加</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/18.png"></p>
<p>结果如图所示，报错了</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/11.gif"></p>
<p>这是因为，一般组件并没有接收到 props 参数，而且 props 参数中也没有 history 属性，所以无法使用路由功能。我们可以通过引入 <code>withRouter</code> 方法来让一般组件拥有路由方法</p>
<p>首先引入 <code>withRouter</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// withRouter 可以加工一个一般组件，让其具有路由的相关功能</span></span><br><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br></pre></td></tr></table></figure>

<p>然后再导出的地方修改</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回的是一个加工好的新组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withRouter(Header)</span><br></pre></td></tr></table></figure>

<p>结构如图</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/19.png"></p>
<p>此时一般组件就拥有了路由功能，现在我们再次点击按钮功能就可以正常使用了</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/12.gif"></p>
<h2 id="第十三章-AntdUI的使用"><a href="#第十三章-AntdUI的使用" class="headerlink" title="第十三章 AntdUI的使用"></a>第十三章 AntdUI的使用</h2><h3 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h3><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install antd --save</span><br></pre></td></tr></table></figure>

<p>修改 <code>App.js</code> ,引入 antd 的按钮组件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Button &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Button type=<span class="string">&quot;primary&quot;</span>&gt;Button&lt;/Button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 <code>src/App.css</code>，在文件顶部引入 <code>antd/dist/antd.css</code></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;~antd/dist/antd.css&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="按需引入"><a href="#按需引入" class="headerlink" title="按需引入"></a>按需引入</h3><p>上面的引入方式在 <code>App.js</code> 文件中引入 antd 的全部样式组件，压缩后仍会有 60kb 的大小，但是我们并不会用到全部组件，所以接下来我们来配置按需加载组件</p>
<p>首先安装依赖包</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i react-app-rewired customize-cra --save</span><br></pre></td></tr></table></figure>

<p>修改 <code>package.json</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/* package.json */</span><br><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;start&quot;: &quot;react-app-rewired start&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;react-app-rewired build&quot;,</span><br><span class="line">    &quot;test&quot;: &quot;react-app-rewired test&quot;,</span><br><span class="line">    &quot;eject&quot;: &quot;react-scripts eject&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>然后在项目根目录创建一个 <code>config-overrides.js</code> 用于修改默认配置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">override</span>(<span class="params">config, env</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// do stuff with the webpack config...</span></span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>使用 babel-plugin-import，<a target="_blank" rel="noopener" href="https://github.com/ant-design/babel-plugin-import">babel-plugin-import</a> 是一个用于按需加载组件代码和样式的 babel 插件（<a target="_blank" rel="noopener" href="https://3x.ant.design/docs/react/getting-started-cn#%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD">原理</a>），现在我们尝试安装它并修改 <code>config-overrides.js</code> 文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i babel-plugin-import --save</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; override, fixBabelImports &#125; = <span class="built_in">require</span>(<span class="string">&#x27;customize-cra&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = override(</span><br><span class="line">    fixBabelImports(<span class="string">&#x27;import&#x27;</span>, &#123;</span><br><span class="line">        libraryName: <span class="string">&#x27;antd&#x27;</span>,</span><br><span class="line">        libraryDirectory: <span class="string">&#x27;es&#x27;</span>,</span><br><span class="line">        style: <span class="string">&#x27;css&#x27;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>然后移除前面在 <code>src/App.css</code> 里全量添加的 <code>@import &#39;~antd/dist/antd.css&#39;;</code></p>
<p>现在我们引入的组件会自动变成按需加载。</p>
<h3 id="引入Icon组件"><a href="#引入Icon组件" class="headerlink" title="引入Icon组件"></a>引入Icon组件</h3><p>默认下载的 antd 没有包含 Icon 组件库，所以我们在引入图标时不会显示，我们要单独安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save @ant-design/icons</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; StarOutlined, StarFilled, StarTwoTone &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&lt;StarOutlined /&gt;</span><br><span class="line">&lt;StarFilled /&gt;</span><br><span class="line">&lt;StarTwoTone twoToneColor=<span class="string">&quot;#eb2f96&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<h3 id="自定义主题"><a href="#自定义主题" class="headerlink" title="自定义主题"></a>自定义主题</h3><p>安装 </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @craco/craco craco-less --save</span><br></pre></td></tr></table></figure>

<p>修改 <code>package.json</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* package.json */</span></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">-   <span class="string">&quot;start&quot;</span>: <span class="string">&quot;react-scripts start&quot;</span>,</span><br><span class="line">-   <span class="string">&quot;build&quot;</span>: <span class="string">&quot;react-scripts build&quot;</span>,</span><br><span class="line">-   <span class="string">&quot;test&quot;</span>: <span class="string">&quot;react-scripts test&quot;</span>,</span><br><span class="line">+   <span class="string">&quot;start&quot;</span>: <span class="string">&quot;craco start&quot;</span>,</span><br><span class="line">+   <span class="string">&quot;build&quot;</span>: <span class="string">&quot;craco build&quot;</span>,</span><br><span class="line">+   <span class="string">&quot;test&quot;</span>: <span class="string">&quot;craco test&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在项目根目录创建一个 <code>craco.config.js</code> 用于修改默认配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>把 <code>src/App.css</code> 文件修改为 <code>src/App.less</code>，然后修改样式引用为 less 文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/App.js */</span></span><br><span class="line">- <span class="keyword">import</span> <span class="string">&#x27;./App.css&#x27;</span>;</span><br><span class="line">+ <span class="keyword">import</span> <span class="string">&#x27;./App.less&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/App.less */</span></span><br><span class="line">- @import &#x27;~antd/dist/antd.css&#x27;;</span><br><span class="line">+ <span class="keyword">@import</span> <span class="string">&#x27;~antd/dist/antd.less&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>修改 <code>craco.config.js</code> 文件如下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CracoLessPlugin = <span class="built_in">require</span>(<span class="string">&#x27;craco-less&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    &#123;</span><br><span class="line">      plugin: CracoLessPlugin,</span><br><span class="line">      options: &#123;</span><br><span class="line">        lessLoaderOptions: &#123;</span><br><span class="line">          lessOptions: &#123;</span><br><span class="line">            modifyVars: &#123; <span class="string">&#x27;@primary-color&#x27;</span>: <span class="string">&#x27;#1DA57A&#x27;</span> &#125;,</span><br><span class="line">            javascriptEnabled: <span class="literal">true</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这里利用了 <a target="_blank" rel="noopener" href="https://github.com/webpack/less-loader#less-options">less-loader</a> 的 <code>modifyVars</code> 来进行主题配置，变量和其他配置方式可以参考 <a target="_blank" rel="noopener" href="https://ant.design/docs/react/customize-theme-cn">配置主题</a> 文档。修改后重启 <code>yarn start</code>，如果看到一个绿色的按钮就说明配置成功了。</p>
<p><strong>注意，这种方式已经载入了所有组件的样式，不需要也无法和按需加载插件 <code>babel-plugin-import</code> 的 <code>style</code> 属性一起使用。</strong></p>
<h2 id="第十四章-redux-的使用"><a href="#第十四章-redux-的使用" class="headerlink" title="第十四章 redux 的使用"></a>第十四章 redux 的使用</h2><h3 id="什么是-redux"><a href="#什么是-redux" class="headerlink" title="什么是 redux"></a>什么是 redux</h3><ol>
<li>redux是一个专门用作状态管理的js库，不是react插件库</li>
<li>它可以用在react、vue、angular 中，但是用在 react 中的最多</li>
<li>作用：集中式的管理 react 中多个组件<strong>共享</strong>的状态</li>
</ol>
<h3 id="什么情况下需要用到-redux"><a href="#什么情况下需要用到-redux" class="headerlink" title="什么情况下需要用到 redux"></a>什么情况下需要用到 redux</h3><ol>
<li>某个组件的状态需要让其他组件随时获取到（共享）</li>
<li>一个组件需要改变另外一个组件的状态（通信）</li>
<li>总体原则：能不用就不用，但是不用的话感到困难，那么就用</li>
</ol>
<h3 id="redux-工作原理"><a href="#redux-工作原理" class="headerlink" title="redux 工作原理"></a>redux 工作原理</h3><p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/redux%E5%8E%9F%E7%90%86%E5%9B%BE.png"></p>
<ul>
<li>首先组件将状态告诉 ActionCreators ，说明自己要干什么事，具体的数据有哪些</li>
<li>然后 ActiveCreateors 会把状态打包 dispatch 分发给 Store</li>
<li>之后 Store 拿着加工好的数据给 Reducers ，给的中间会把旧的状态和要做的事情一并交给 Reduces 加工</li>
<li>Reduces 加工好后会返回新的状态交给 Store</li>
<li>之后组件通过 getState 从 Store 获取最新的状态</li>
</ul>
<h3 id="redux-三个核心概念"><a href="#redux-三个核心概念" class="headerlink" title="redux 三个核心概念"></a>redux 三个核心概念</h3><h4 id="action"><a href="#action" class="headerlink" title="action"></a>action</h4><ul>
<li>动作的对象</li>
<li>包含两个属性<ul>
<li>type：标识属性，字符串类型且唯一，必要属性</li>
<li>data：数据属性，值可以是任意类型，可选属性</li>
</ul>
</li>
<li>例子：<code>&#123;type:&#39;Add&#39;,data:2&#125;</code></li>
</ul>
<h4 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h4><ul>
<li>用于初始化状态，加工状态</li>
<li>加工时，根据旧的 state 和 action，产生新的 state 纯函数</li>
<li>reduce本质是一个函数，第一次调用时是由 store 自动触发的，传递的 preState 是一个 undefined，action 中的 type 是随机的初始值</li>
</ul>
<h4 id="store"><a href="#store" class="headerlink" title="store"></a>store</h4><ul>
<li>将 state、action、reduce 联系起来的对象</li>
<li>store.getState() 获取最新状态</li>
<li>store.dispatch() 分发状态，来告诉 reduce 方法更新状态</li>
<li>store.subscribe() 监听状态更新方法，只要 reduce 返回了新的状态就会触发这个方法</li>
</ul>
<h3 id="redux-求和精简版"><a href="#redux-求和精简版" class="headerlink" title="redux 求和精简版"></a>redux 求和精简版</h3><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i redux --save</span><br></pre></td></tr></table></figure>

<p>新建 <code>src\redux\store.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入redux</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="comment">// 引入要通知的reduces方法</span></span><br><span class="line"><span class="keyword">import</span> count_reduce <span class="keyword">from</span> <span class="string">&#x27;./count_reduce&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createStore(count_reduce)</span><br></pre></td></tr></table></figure>

<p>新建 <code>src\redux\count_reduce.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义初始化的状态值</span></span><br><span class="line"><span class="keyword">const</span> initState = <span class="number">0</span></span><br><span class="line"><span class="comment">// 默认导出加工方法</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">reduces</span>(<span class="params">preState = initState, action</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 从action中解构type和data</span></span><br><span class="line">    <span class="keyword">const</span> &#123; type, data &#125; = action</span><br><span class="line">    <span class="comment">// 根据type值判断不同的加工方法</span></span><br><span class="line">    <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;add&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> preState + data</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;subtract&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> preState - data</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> preState</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>Count.jsx</code> 组件中使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Space, Select, Button, Typography &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;../redux/store&quot;</span></span><br><span class="line"><span class="keyword">const</span> &#123; Option &#125; = Select;</span><br><span class="line"><span class="keyword">const</span> &#123; Title &#125; = Typography;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Count</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="comment">// 下拉框绑定值</span></span><br><span class="line">        selectVal: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 改变下拉触发</span></span><br><span class="line">    handleChange = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">            selectVal: +value</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 加</span></span><br><span class="line">    add = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; selectVal &#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="comment">// 调用 store.dispatch 方法派发一个事件</span></span><br><span class="line">        store.dispatch(&#123;</span><br><span class="line">            type: <span class="string">&quot;add&quot;</span>,</span><br><span class="line">            data: selectVal</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 减</span></span><br><span class="line">    subtract = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; selectVal &#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="comment">// 调用 store.dispatch 方法派发一个事件</span></span><br><span class="line">        store.dispatch(&#123;</span><br><span class="line">            type: <span class="string">&quot;subtract&quot;</span>,</span><br><span class="line">            data: selectVal</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 奇数加</span></span><br><span class="line">    addIfOdd = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; selectVal &#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="keyword">if</span> (store.getState() % <span class="number">2</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">            store.dispatch(&#123;</span><br><span class="line">                type: <span class="string">&quot;add&quot;</span>,</span><br><span class="line">                data: selectVal</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 当redux中的状态发生变化时会自动触发这个回调函数</span></span><br><span class="line">        store.subscribe(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 传递一个空对象更新渲染函数</span></span><br><span class="line">            <span class="built_in">this</span>.setState(&#123;&#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &#123;<span class="comment">/* store.getState() 从redux中获取数据 */</span>&#125;</span><br><span class="line">                    &lt;Title level=&#123;<span class="number">4</span>&#125;&gt;当前数据和：&#123;store.getState()&#125;&lt;/Title&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &lt;Space size=<span class="string">&#x27;small&#x27;</span>&gt;</span><br><span class="line">                        &lt;Select defaultValue=&#123;<span class="built_in">this</span>.state.selectVal&#125; onChange=&#123;<span class="built_in">this</span>.handleChange&#125;&gt;</span><br><span class="line">                            &lt;Option value=<span class="string">&quot;1&quot;</span>&gt;<span class="number">1</span>&lt;/Option&gt;</span><br><span class="line">                            &lt;Option value=<span class="string">&quot;2&quot;</span>&gt;<span class="number">2</span>&lt;/Option&gt;</span><br><span class="line">                            &lt;Option value=<span class="string">&quot;3&quot;</span>&gt;<span class="number">3</span>&lt;/Option&gt;</span><br><span class="line">                        &lt;/Select&gt;</span><br><span class="line">                        &lt;Button type=<span class="string">&quot;primary&quot;</span> onClick=&#123;<span class="built_in">this</span>.add&#125;&gt;加&lt;/Button&gt;</span><br><span class="line">                        &lt;Button type=<span class="string">&quot;primary&quot;</span> onClick=&#123;<span class="built_in">this</span>.subtract&#125;&gt;减&lt;/Button&gt;</span><br><span class="line">                        &lt;Button type=<span class="string">&quot;primary&quot;</span> onClick=&#123;<span class="built_in">this</span>.addIfOdd&#125;&gt;奇数加&lt;/Button&gt;</span><br><span class="line">                    &lt;/Space&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/13.gif"></p>
<p>redux中的状态发生改变后，不会自动帮我们重新渲染页面，需要我们手动调用 <code>this.setState(&#123;&#125;)</code> 重新渲染 DOM。</p>
<h3 id="redux-求和完整版"><a href="#redux-求和完整版" class="headerlink" title="redux 求和完整版"></a>redux 求和完整版</h3><p>首先新建 <code>src\redux\constant.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这个文件专门定义reduce的type值的常量</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD = <span class="string">&#x27;add&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SUBTRACT = <span class="string">&#x27;subtract&#x27;</span></span><br></pre></td></tr></table></figure>

<p>接着新建 <code>src\redux\count_action.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ADD, SUBTRACT &#125; <span class="keyword">from</span> <span class="string">&quot;./constant&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个文件专门用来返回action</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addAction = <span class="function">(<span class="params">data</span>) =&gt;</span> (&#123; <span class="attr">type</span>: ADD, <span class="attr">data</span>: data &#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> subtractAction = <span class="function">(<span class="params">data</span>) =&gt;</span> (&#123; <span class="attr">type</span>: SUBTRACT, <span class="attr">data</span>: data &#125;)</span><br></pre></td></tr></table></figure>

<p>修改 <code>src\redux\count_reduce.js</code></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/20.png"></p>
<p>对应的我们在 <code>Count</code> 组件中作出相应的修改</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">import</span> &#123; addAction, subtractAction &#125; <span class="keyword">from</span> <span class="string">&#x27;../redux/count_action&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 加</span></span><br><span class="line">add = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; selectVal &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="comment">// 调用 store.dispatch 方法派发一个事件</span></span><br><span class="line">    store.dispatch(addAction(selectVal))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 减</span></span><br><span class="line">subtract = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; selectVal &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="comment">// 调用 store.dispatch 方法派发一个事件</span></span><br><span class="line">    store.dispatch(subtractAction(selectVal))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 奇数加</span></span><br><span class="line">addIfOdd = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; selectVal &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">if</span> (store.getState() % <span class="number">2</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">        store.dispatch(addAction(selectVal))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果是和之前一样的。</p>
<h3 id="异步-action"><a href="#异步-action" class="headerlink" title="异步 action"></a>异步 action</h3><p>安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i redux-thunk --save</span><br></pre></td></tr></table></figure>

<p>修改 <code>store.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入redux</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="comment">// 引入更新状态的reduces方法</span></span><br><span class="line"><span class="keyword">import</span> count_reduce <span class="keyword">from</span> <span class="string">&#x27;./count_reduce&#x27;</span></span><br><span class="line"><span class="comment">// 引入使用异步redux的库</span></span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">&quot;redux-thunk&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createStore(count_reduce, applyMiddleware(thunk))</span><br></pre></td></tr></table></figure>

<ul>
<li>从 <code>redux</code> 中增加引入 <code>applyMiddleware</code> 函数</li>
<li><code>createStore</code> 方法增加第二个函数 <code>applyMiddleware(thunk)</code></li>
</ul>
<p>修改 <code>count_action.js</code> ,增加一个异步 <code>action</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果返回的是一个函数，则表示这个是一个异步的action</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addAsyncAction = (<span class="function">(<span class="params">data, time</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 该回调函数会接收到一个dispatch方法，可以用来触发reduce方法更新状态</span></span><br><span class="line">    <span class="comment">// 这里得 dispatch 是 store 函数调用完这个异步 action 后帮我们传递过来的，我们直接调用这个方法即可更新状态</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 异步等待之后传递一个普通对象，更新状态</span></span><br><span class="line">            dispatch(addAction(data))</span><br><span class="line">        &#125;, time)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;../redux/store&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; addAsyncAction &#125; <span class="keyword">from</span> <span class="string">&#x27;../redux/count_action&#x27;</span></span><br><span class="line"></span><br><span class="line">addIfAsync = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; selectVal &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="comment">// 调用异步的action更新状态</span></span><br><span class="line">    store.dispatch(addAsyncAction(selectVal, <span class="number">500</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结：</p>
<ul>
<li><p>如果想要使用异步 action，则需要下载 <code>redux-thunk</code>，并且从 <code>redux</code> 中引入 <code>applyMiddleware</code> 函数，然后给 <code>createStore</code> 方法增加第二个参数 <code>applyMiddleware(thunk)</code></p>
</li>
<li><p>如果 action 返回的是一个普通对象，那么这个 action 就是同步 action</p>
</li>
<li><p>如果 action 返回的是一个函数，则这个 action 就是一个异步的 action</p>
</li>
<li><p>异步 action 比较复杂，难以理解，我们可以自己写代码等待异步结果出来后调用同步 action 更新状态</p>
</li>
</ul>
<h2 id="第十五章-react-redux-使用"><a href="#第十五章-react-redux-使用" class="headerlink" title="第十五章 react-redux 使用"></a>第十五章 react-redux 使用</h2><h3 id="什么是-react-redux"><a href="#什么是-react-redux" class="headerlink" title="什么是 react-redux"></a>什么是 react-redux</h3><ul>
<li><code>react-redux</code> 是 <code>React</code> 官方推出的一个用于公共状态管理的工具</li>
</ul>
<h3 id="react-redux-工作原理图"><a href="#react-redux-工作原理图" class="headerlink" title="react-redux 工作原理图"></a>react-redux 工作原理图</h3><p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/react-redux%E6%A8%A1%E5%9E%8B%E5%9B%BE.png"></p>
<h3 id="创建容器组件"><a href="#创建容器组件" class="headerlink" title="创建容器组件"></a>创建容器组件</h3><p>安装 <code>react-redux</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install react-redux --save</span><br></pre></td></tr></table></figure>

<p>新建 <code>src\container\Count.jsx</code>，作为 <code>Count</code> 的容器组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入UI组件</span></span><br><span class="line"><span class="keyword">import</span> Count <span class="keyword">from</span> <span class="string">&quot;../pages/Count&quot;</span></span><br><span class="line"><span class="comment">// 引入连接UI组件和store的方法</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span></span><br><span class="line"><span class="comment">// 使用 connect()() 创建并暴露一个 Count 的容器组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect()(Count)</span><br></pre></td></tr></table></figure>

<p>然后在用到 <code>Count</code> UI组件的地方，将引用路径更换为 <code>Count</code> 的容器组件,同时引入 <code>store</code> 作为 <code>props</code> 参数传递给容器组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Count <span class="keyword">from</span> <span class="string">&#x27;./container/Count&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;./redux/store&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Count</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;/</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后将UI组件中所有关于原本的 <code>redux</code> 的操作删除掉即可，重新启动项目，页面正常显示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/21.png"></p>
<p>现在我们就得到了一个容器组件。</p>
<h3 id="容器组件给UI组件传递props"><a href="#容器组件给UI组件传递props" class="headerlink" title="容器组件给UI组件传递props"></a>容器组件给UI组件传递props</h3><p>修改容器组件 <code>src\container\Count.jsx</code></p>
<p>容器组件中的 <code>connect</code> 方法第一次调用可以传递两个参数，两个参数都是一个方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入UI组件</span></span><br><span class="line"><span class="keyword">import</span> Count <span class="keyword">from</span> <span class="string">&quot;../pages/Count&quot;</span></span><br><span class="line"><span class="comment">// 引入连接UI组件和store的方法</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span></span><br><span class="line"><span class="comment">// 引入用来操作对象的action</span></span><br><span class="line"><span class="keyword">import</span> &#123; addAction, subtractAction, addAsyncAction &#125; <span class="keyword">from</span> <span class="string">&quot;../redux/count_action&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1.mapStateToProps 返回的是一个普通对象</span></span><br><span class="line"><span class="comment"> * 2.返回对象的key作为props的key传递给UI组件，value作为props的value传递给UI组件</span></span><br><span class="line"><span class="comment"> * 3.接收到的state是redux中最新的状态</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> </span>state </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        count: state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1.mapDispatchToProps 返回的是一个对象，对象的属性值必须是方法</span></span><br><span class="line"><span class="comment"> * 2.方法用来操作redux中的状态</span></span><br><span class="line"><span class="comment"> * 3.mapDispatchToProps 用于传递操作状态的方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Function&#125;</span> </span>dispatch </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="variable">Object</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapDispatchToProps</span>(<span class="params">dispatch</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        addAction: <span class="function">(<span class="params">value</span>) =&gt;</span> dispatch(addAction(value)),</span><br><span class="line">        subtractAction: <span class="function">(<span class="params">value</span>) =&gt;</span> dispatch(subtractAction(value)),</span><br><span class="line">        addAsyncAction: <span class="function">(<span class="params">value, time</span>) =&gt;</span> dispatch(addAsyncAction(value, time))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 connect()() 创建并暴露一个 Count 的容器组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(Count)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后再UI组件中通过 <code>props</code> 获取从容器组件传递过来的值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">addIfAsync = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; selectVal &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="built_in">this</span>.props.addAsyncAction(selectVal, <span class="number">1000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改完成后效果一致。</p>
<h3 id="mapDispatchToProps-简写"><a href="#mapDispatchToProps-简写" class="headerlink" title="mapDispatchToProps 简写"></a>mapDispatchToProps 简写</h3><p>可以写成下面这种形成</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * mapDispatchToProps 简写形成</span></span><br><span class="line"><span class="comment"> * 我们只需要写成对象，对象的属性值是 action 方法</span></span><br><span class="line"><span class="comment"> * react-redux 会自动帮我们完成分发更新状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = &#123;</span><br><span class="line">    addAction,</span><br><span class="line">    subtractAction,</span><br><span class="line">    addAsyncAction</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 connect()() 创建并暴露一个 Count 的容器组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(Count)</span><br></pre></td></tr></table></figure>

<h3 id="状态改变自动渲染页面"><a href="#状态改变自动渲染页面" class="headerlink" title="状态改变自动渲染页面"></a>状态改变自动渲染页面</h3><p>使用了 <code>react-redux</code> 后，在 <code>index.js</code> 中添加的监听状态改变的方法就不需要写了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;./redux/store&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听redux中状态的改变，只要状态发生了改变就会触发render方法重新渲染页面</span></span><br><span class="line">- store.subscribe(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">-     ReactDOM.render(</span><br><span class="line">-         &lt;BrowserRouter&gt;</span><br><span class="line">-             <span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line">-         &lt;/BrowserRouter&gt;,</span><br><span class="line">-         <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>)</span><br><span class="line">-     );</span><br><span class="line">- &#125;)</span><br></pre></td></tr></table></figure>

<p>我们改变 redux 中的状态后页面仍然会刷新，这是因为在 connect 方法中替我们完成了页面监听的功能。</p>
<h3 id="Provider-组件使用"><a href="#Provider-组件使用" class="headerlink" title="Provider 组件使用"></a>Provider 组件使用</h3><p>之前我们需要在容器组件上一个个的添加 store 参数，如果容器组件多的话，就需要写多个 <code>store=&#123;store&#125;</code> 的props参数传递</p>
<p>有了 <code>Provider</code> 组件后我们就不要再容器组件上一个一个添加 store 了，它会自动帮我们分析全局的容器组件，我们只需要传一次 store 参数即可</p>
<p>修改 <code>src/index.js</code> </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;./redux/store&quot;</span></span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">        &lt;App /&gt;</span><br><span class="line">    &lt;/Provider&gt;,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>把我们原来在容器组件上添加的 store 参数去掉，查看效果和之前一致。</p>
<h3 id="将容器组件和UI组件二合一"><a href="#将容器组件和UI组件二合一" class="headerlink" title="将容器组件和UI组件二合一"></a>将容器组件和UI组件二合一</h3><p>上面的写法中我们将容器组件和UI组件分成了两个文件去写，这样当我们的组件比较多的时候文件定义就会比较乱，所以我们可以通过如下写法，将两个组件合成一个组件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Button, Typography &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123;addAction&#125; <span class="keyword">from</span> <span class="string">&quot;../redux/count_action&quot;</span></span><br><span class="line"><span class="keyword">const</span> &#123; Title &#125; = Typography;</span><br><span class="line"><span class="keyword">const</span> mapState = <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        count: state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> mapDispatch = &#123;</span><br><span class="line">    addAction</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExerciseCount</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    addCount = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.props.addAction(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;Title level=&#123;<span class="number">4</span>&#125;&gt;当前的和为：&#123;<span class="built_in">this</span>.props.count&#125;&lt;/Title&gt;</span><br><span class="line">                &lt;Button type=<span class="string">&#x27;primary&#x27;</span> onClick=&#123;<span class="built_in">this</span>.addCount&#125;&gt;点我加<span class="number">1</span>&lt;/Button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapState, mapDispatch)(ExerciseCount)</span><br></pre></td></tr></table></figure>

<h3 id="combineReducers-方法合并多个-reducer"><a href="#combineReducers-方法合并多个-reducer" class="headerlink" title="combineReducers 方法合并多个 reducer"></a>combineReducers 方法合并多个 reducer</h3><p>之前我们在 store 中只添加了一个 reduce，当我们多个组件都需要用到 redux 时，无法同时传递多个，我们可以借助 combineReducers 方法来实现在 store 中同时连接多个 reducer</p>
<p>修改 <code>store.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入redux</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware, combineReducers &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="comment">// 引入count的reduces方法</span></span><br><span class="line"><span class="keyword">import</span> count_reduce <span class="keyword">from</span> <span class="string">&#x27;./reduces/count&#x27;</span></span><br><span class="line"><span class="comment">// 引入person的reduces方法</span></span><br><span class="line"><span class="keyword">import</span> person_reduce <span class="keyword">from</span> <span class="string">&#x27;./reduces/person&#x27;</span></span><br><span class="line"><span class="comment">// 引入使用异步redux的库</span></span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">&quot;redux-thunk&quot;</span></span><br><span class="line"><span class="comment">// 使用 combineReducers 方法合并多个组件的 reduc 方法</span></span><br><span class="line"><span class="comment">// 这个对象是 redux 中存储的对象，通过 key value 的形式获取 redux 中的数据</span></span><br><span class="line"><span class="keyword">const</span> allReduces = combineReducers(&#123;</span><br><span class="line">    count: count_reduce,</span><br><span class="line">    persons: person_reduce</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createStore(allReduces, applyMiddleware(thunk))</span><br></pre></td></tr></table></figure>

<p>从 <code>redux</code> 增加 <code>combineReducers</code> 方法导出，然后调用 <code>combineReducers，传递一个</code> <code>reducer</code> 对象作为参数，这个方法的返回值作为 <code>createStore</code> 方法的第一个参数。另外给 <code>combineReducers</code> 方法传递的对象就会作为 <code>redux</code> 中保存数据的 <code>kye value</code>。因此我们在通过 <code>redux</code> 取值时也要修改为 <code>key  value</code> 的形式来取值。</p>
<h3 id="纯函数"><a href="#纯函数" class="headerlink" title="纯函数"></a>纯函数</h3><ul>
<li>一类特别的函数，只要输入同样的参数，必定会得到同样的输出</li>
<li>必须遵守以下的约定<ul>
<li>不得改写参数数据</li>
<li>不会产生副作用，例如网络请求，输入和输出等</li>
<li>不能调用如 Date.now() 或者 Math.random() 等不纯的方法</li>
</ul>
</li>
<li>redux 的 reducer 函数必须是一个纯函数</li>
</ul>
<h3 id="redux-开发者工具"><a href="#redux-开发者工具" class="headerlink" title="redux 开发者工具"></a>redux 开发者工具</h3><p>首先在浏览器搜索并安装插件</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/22.png"></p>
<p>然后再我们的项目中安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm i redux-devtools-extension --save</span><br></pre></td></tr></table></figure>

<p>修改 <code>store.js</code> </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 composeWithDevTools 方法</span></span><br><span class="line"><span class="keyword">import</span> &#123; composeWithDevTools &#125; <span class="keyword">from</span> <span class="string">&quot;redux-devtools-extension&quot;</span></span><br><span class="line"></span><br><span class="line">......省略其他代码</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在最后的导出方法中的第二个参数修改为 composeWithDevTools() 方法</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createStore(allReduces, composeWithDevTools(applyMiddleware(thunk)))</span><br></pre></td></tr></table></figure>

<p>然后打开浏览器，打开控制台即可查看 redux 中存储的所有状态值</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/23.png"></p>
<h3 id="抽离-reduce-引入文件"><a href="#抽离-reduce-引入文件" class="headerlink" title="抽离 reduce 引入文件"></a>抽离 reduce 引入文件</h3><p>当我们有个<code> reduce</code> 需要引入时，如果全部放在 <code>store.js</code> 文件中，这个文件会变得很难看，所以我们要单独写一个专门用于汇总 <code>reduce</code> 的文件</p>
<p>新建 <code>src\redux\reduces\index.js</code> 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这个文件用于汇总所有的reduce</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./count&quot;</span></span><br><span class="line"><span class="keyword">import</span> persons <span class="keyword">from</span> <span class="string">&quot;./person&quot;</span></span><br><span class="line"><span class="comment">// 使用 combineReducers 方法合并多个组件的 reduc 方法</span></span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123;</span><br><span class="line">    count,</span><br><span class="line">    persons</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p> 然后修改 <code>store.js</code> ,将原本引入的 <code>reduce </code>删除，替换为汇总完的文件即可。完整版的 <code>store.js</code> 代码如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入redux,createStore 用于创建一个store，applyMiddleware用于中间件实现异步action</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="comment">// 引入汇总的reduce</span></span><br><span class="line"><span class="keyword">import</span> allReduces <span class="keyword">from</span> <span class="string">&quot;../redux/reduces&quot;</span></span><br><span class="line"><span class="comment">// 引入redux开发者工具依赖的库</span></span><br><span class="line"><span class="keyword">import</span> &#123; composeWithDevTools &#125; <span class="keyword">from</span> <span class="string">&quot;redux-devtools-extension&quot;</span></span><br><span class="line"><span class="comment">// 引入使用异步redux的库</span></span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">&quot;redux-thunk&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createStore(allReduces, composeWithDevTools(applyMiddleware(thunk)))</span><br></pre></td></tr></table></figure>

<h2 id="第十六章-项目打包和预览"><a href="#第十六章-项目打包和预览" class="headerlink" title="第十六章 项目打包和预览"></a>第十六章 项目打包和预览</h2><h3 id="打包和预览"><a href="#打包和预览" class="headerlink" title="打包和预览"></a>打包和预览</h3><p>打包执行命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<p>打包完毕后会提示我们执行如下命令</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/24.png"></p>
<p>我们执行这个命令前需要全局安装 <code>serve</code> </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i serve -g</span><br></pre></td></tr></table></figure>

<p><code>serve</code> 可以让我们的任意文件夹变成服务器的根目录，可以帮助我们实现打包后的项目的快速预览</p>
<p>打包完毕后的 -s 可以省略不输入，直接输入 <code>serve build</code> 即可查看项目</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/25.png"></p>
<h3 id="配置打包目录"><a href="#配置打包目录" class="headerlink" title="配置打包目录"></a>配置打包目录</h3><p>默认打包出来我们需要吧打包文件放在服务器的根目录下使用，但是有时候我们需要吧文件放在二级目录下。这时我们需要修改 <code>package.json</code> 文件</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/26.png"></p>
<p>再配置文件内添加 <code>homepage</code> 属性，声明二级菜单的名称即可</p>
<h2 id="第十七章-React-扩展"><a href="#第十七章-React-扩展" class="headerlink" title="第十七章 React 扩展"></a>第十七章 React 扩展</h2><h3 id="setState-的两种写法"><a href="#setState-的两种写法" class="headerlink" title="setState 的两种写法"></a>setState 的两种写法</h3><p>1.对象式 setState</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 1.对象式setState</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// setState 方法接收第二个参数，当更新完毕后会触发回调</span></span><br><span class="line"><span class="built_in">this</span>.setState(&#123; <span class="attr">count</span>: count + <span class="number">1</span> &#125;,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;更新后的的count：&#x27;</span> + <span class="built_in">this</span>.state.count);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>2.函数式 setState</p>
<p>第一个传递的是一个返回值是状态改变的对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 2.函数式setState</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">this</span>.setState(<span class="function">(<span class="params">state,props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(props);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        count: state.count + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;更新后的的count：&#x27;</span> + <span class="built_in">this</span>.state.count);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="路由懒加载"><a href="#路由懒加载" class="headerlink" title="路由懒加载"></a>路由懒加载</h3><p>当我们需要显示某个组件时再去加载某个组件，以缓解第一次加载页面时的压力。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从 react 中引入自带的 lazy 方法和 Suspense 组件</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component, lazy, Suspense &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; NavLink, Route, &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./router.css&quot;</span></span><br><span class="line"><span class="keyword">import</span> Loading <span class="keyword">from</span> <span class="string">&quot;./Loading&quot;</span></span><br><span class="line"><span class="comment">// 修改路由组件的引入方式为下面的方法</span></span><br><span class="line"><span class="keyword">const</span> Home = lazy(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;./Home&quot;</span>))</span><br><span class="line"><span class="keyword">const</span> About = lazy(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;./About&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">index</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &lt;NavLink to=<span class="string">&quot;/home&quot;</span> style=&#123;&#123; <span class="string">&quot;marginRight&quot;</span>: <span class="string">&quot;20px&quot;</span> &#125;&#125;&gt;Home&lt;/NavLink&gt;</span><br><span class="line">                    &lt;NavLink to=<span class="string">&quot;/about&quot;</span>&gt;About&lt;/NavLink&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;hr /&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &#123;<span class="comment">/* 使用 Suspense 组件报告路由组件，fallback 属性定义等待加载期间显示的组件 */</span>&#125;</span><br><span class="line">                    &lt;Suspense fallback=&#123;<span class="xml"><span class="tag">&lt;<span class="name">Loading</span> /&gt;</span></span>&#125;&gt;</span><br><span class="line">                        &lt;Route path=<span class="string">&quot;/home&quot;</span> component=&#123;Home&#125; /&gt;</span><br><span class="line">                        &lt;Route path=<span class="string">&quot;/about&quot;</span> component=&#123;About&#125; /&gt;</span><br><span class="line">                    &lt;/Suspense&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>从 react 中引入自带的 lazy 方法和 Suspense 组件</li>
<li>修改路由组件的引入方式 <code>const Home = lazy(() =&gt; import(&quot;./Home&quot;))</code></li>
<li>使用 Suspense 组件报告路由组件，fallback 属性定义等待加载期间显示的组件 <code>fallback=&#123;&lt;Loading /&gt;</code></li>
</ul>
<p>这样修改后组件只会在需要时被加载，加载过的组件在第二次显示时不会二次加载</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/14.gif"></p>
<h3 id="stateHooks"><a href="#stateHooks" class="headerlink" title="stateHooks"></a>stateHooks</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> react <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stateHooks</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 使用react.useState初始化一个值，这个方法会返回一个数组，数组第一位是要定义的值，第二个是修改这个值得函数</span></span><br><span class="line">    <span class="keyword">const</span> [count,setCount] = react.useState(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> [name,setName] = react.useState(<span class="string">&#x27;Tome&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 点击加1按钮调用setCount方法，传入一个新的值来修改初始化的值</span></span><br><span class="line">    <span class="comment">// 在第一次useState后回缓存count，点击修改会重新调用当前的函数，但是不会更改count的值</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 修改函数的两种写法之一</span></span><br><span class="line">        setCount(count+<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changeName</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 修改函数的两种写法之二</span></span><br><span class="line"><span class="comment">         * 传入一个函数，这个函数会接受到之前的值，然后返回新的值覆盖之前的值</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        setName(<span class="function"><span class="params">preName</span>=&gt;</span>preName=<span class="string">&#x27;Juar&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;当前的数据和为：&#123;count&#125;&lt;/h2&gt;</span><br><span class="line">            &lt;h3&gt;我的名字是：&#123;name&#125;&lt;/h3&gt;</span><br><span class="line">            &lt;button onClick=&#123;add&#125;&gt;点我+<span class="number">1</span>&lt;/button&gt;</span><br><span class="line">            &lt;button onClick=&#123;changeName&#125;&gt;修改名字&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> stateHooks</span><br></pre></td></tr></table></figure>

<p><code>react.useState</code> 方法可以让我们在函数式组件中使用 stat，这个返回接收一个初始值，返回一个两位数的数组。数组第一位是这个初始化值的名称，第二位是修改这个值的方法。</p>
<p>在第一次useState后回缓存count，点击修改会重新调用当前的函数，但是不会更改count的值。</p>
<h3 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h3><p><code>useEffect </code> 方法可以在函数式组件中模拟声明周期的一个钩子函数。它接收两个参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> react <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stateHooks</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 使用react.useState初始化一个值，这个方法会返回一个数组，数组第一位是要定义的值，第二个是修改这个值得函数</span></span><br><span class="line">    <span class="keyword">const</span> [count, setCount] = react.useState(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">const</span> [name, setName] = react.useState(<span class="string">&#x27;Tome&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * react.useEffect 方法接收两个参数</span></span><br><span class="line"><span class="comment">     * 1.函数</span></span><br><span class="line"><span class="comment">     * 2.要监听的useState定义的stateValue，如果不传递第二个参数，则默认监听全部value</span></span><br><span class="line"><span class="comment">     *  如果传入一个空数组，则不会监听任何stateValue值得改变</span></span><br><span class="line"><span class="comment">     *  如果定义个某个stateValue，则只会监听这个值得变化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    react.useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            setCount(<span class="function"><span class="params">count</span>=&gt;</span>count+<span class="number">1</span>)</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">        <span class="comment">// 返回的方法可以当做 componentWillUnmount 钩子</span></span><br><span class="line">        <span class="keyword">return</span> <span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="comment">// 在卸载组件前清除定时器</span></span><br><span class="line">            <span class="built_in">clearInterval</span>(timer)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, [])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 点击加1按钮调用setCount方法，传入一个新的值来修改初始化的值</span></span><br><span class="line">    <span class="comment">// 在第一次useState后回缓存count，点击修改会重新调用当前的函数，但是不会更改count的值</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 修改函数的两种写法之一</span></span><br><span class="line">        setCount(count + <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changeName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 修改函数的两种写法之二</span></span><br><span class="line"><span class="comment">         * 传入一个函数，这个函数会接受到之前的值，然后返回新的值覆盖之前的值</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        setName(<span class="function"><span class="params">preName</span> =&gt;</span> preName = <span class="string">&#x27;Juar&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">unmont</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        ReactDom.unmountComponentAtNode(<span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;h2&gt;当前的数据和为：&#123;count&#125;&lt;/h2&gt;</span><br><span class="line">            &lt;h3&gt;我的名字是：&#123;name&#125;&lt;/h3&gt;</span><br><span class="line">            &lt;button onClick=&#123;add&#125;&gt;点我+<span class="number">1</span>&lt;/button&gt;</span><br><span class="line">            &lt;button onClick=&#123;changeName&#125;&gt;修改名字&lt;/button&gt;</span><br><span class="line">            &lt;button onClick=&#123;unmont&#125;&gt;卸载组件&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> stateHooks</span><br></pre></td></tr></table></figure>

<p><code>useEffect </code> 方法的几种状态</p>
<ul>
<li>只传入一个函数，则表示监听了所有 <code>stateValue</code> 值的变化，只要有值发生改变就会触发传入的函数。相当于 <code>componentDidUpdate</code> 函数</li>
<li>传递一个空的数组，不会监听任何值的改变，只会在组件第一次加载时触发。相当于 <code>componentDidMount</code></li>
<li>当传入的函数返回一个函数时，会在组件销毁前出发，因此返回的函数相当于 <code>componentWillUnmount</code></li>
</ul>
<h3 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a>useRef</h3><p><code>useRef</code> 可以让我们在函数式组件中使用 ref 获取输入框的值,用法于类式组件中的 <code>createRef</code> 一样</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> myInput = React.useRef()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getInputVal</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(myInput.current.value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;text&quot;</span> ref=&#123;myInput&#125;/&gt;</span><br><span class="line">            &lt;button onClick=&#123;getInputVal&#125;&gt;获取输入框的值&lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo</span><br></pre></td></tr></table></figure>

<h3 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h3><p>当我们不得不指定一个 div 标签的时候，可以使用 <code>Fragment</code> 来包裹页面元素，然后 react 在渲染的时候不会去渲染 <code>Fragment</code> 标签，从而来优化我们的页面结构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React,&#123;Fragment&#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;Fragment&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;text&quot;</span> /&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;text&quot;</span> /&gt;</span><br><span class="line">        &lt;/Fragment&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo</span><br></pre></td></tr></table></figure>

<p>渲染后的页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="createContext"><a href="#createContext" class="headerlink" title="createContext"></a>createContext</h3><p>在多级组件嵌套时我们可以通过 context 来跨级传递参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./index.css&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 Context 容器对象</span></span><br><span class="line"><span class="keyword">const</span> myContext = React.createContext()</span><br><span class="line"><span class="comment">// 从 myContext 身上解构出 Provider 组件，包裹住父组件，使用 value 属性将数据传递个子组件</span></span><br><span class="line"><span class="keyword">const</span> &#123; Provider, Consumer &#125; = myContext</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        name: <span class="string">&quot;Tome&quot;</span>,</span><br><span class="line">        age: <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; name, age &#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div className=<span class="string">&#x27;root&#x27;</span>&gt;</span><br><span class="line">                &lt;h2&gt;我是A组件&lt;/h2&gt;</span><br><span class="line">                &lt;div&gt;我的名字是：&#123;name&#125;，我的年龄是：&#123;age&#125;&lt;/div&gt;</span><br><span class="line">                &lt;Provider value=&#123;&#123; name, age &#125;&#125;&gt;</span><br><span class="line">                    &lt;B /&gt;</span><br><span class="line">                &lt;/Provider&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div className=<span class="string">&#x27;child&#x27;</span>&gt;</span><br><span class="line">                &lt;h2&gt;我是B组件&lt;/h2&gt;</span><br><span class="line">                &lt;C /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 在C组件中接收上面定义的myContext，必须定义为 static contextType = myContext</span></span><br><span class="line">    <span class="keyword">static</span> contextType = myContext</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 然后我们就可以使用 this.context 接收到根组件传递过来的值</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.context); <span class="comment">//=&gt; &#123;name: &#x27;Tome&#x27;, age: 10&#125;</span></span><br><span class="line">        <span class="keyword">const</span> &#123; name, age &#125; = <span class="built_in">this</span>.context</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div className=<span class="string">&#x27;grid&#x27;</span>&gt;</span><br><span class="line">                &lt;h2&gt;我是C组件&lt;/h2&gt;</span><br><span class="line">                &lt;div&gt;我从A组件接收到的名字是：&#123;name&#125;,年龄是：&#123;age&#125;&lt;/div&gt;</span><br><span class="line">                &lt;D /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">D</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div className=<span class="string">&#x27;grid2&#x27;</span>&gt;</span><br><span class="line">            &lt;h2&gt;我是D组件&lt;/h2&gt;</span><br><span class="line">            &lt;div&gt;我从A组件接收到的名字是:</span><br><span class="line">                &#123;<span class="comment">/* 在函数式组件中的使用方法 */</span>&#125;</span><br><span class="line">                &lt;Consumer&gt;</span><br><span class="line">                    &#123;</span><br><span class="line">                        context =&gt; &#123;</span><br><span class="line">                            <span class="keyword">const</span> &#123; name, age &#125; = context</span><br><span class="line">                            <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;name&#125;</span>,年龄是：<span class="subst">$&#123;age&#125;</span>`</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &lt;/Consumer&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="PureComponent"><a href="#PureComponent" class="headerlink" title="PureComponent"></a>PureComponent</h3><p>我们做组件优化时，如果状态没有发生改变，则不应该重复调用 render 函数进行重复渲染。我们可以修改组件继承自 PureComponent，它在底层做了优化，只有状态在真正发生改变时才会触发 render 方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; PureComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./index.css&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">index</span> <span class="keyword">extends</span> <span class="title">PureComponent</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        carName:<span class="string">&#x27;奔驰c63&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    changeCar = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">            carName:<span class="string">&#x27;迈巴赫&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 如果组件继承Component组件，则不管有没有发生改变，都会重复调用render方法进行渲染</span></span><br><span class="line">        <span class="comment">// 修改继承 PureComponent，则只有在state真正发生变化时才会触发render</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;更新触发&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div className=<span class="string">&#x27;parent&#x27;</span>&gt;</span><br><span class="line">                &lt;h4&gt;我的车是：&#123;<span class="built_in">this</span>.state.carName&#125;&lt;/h4&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="built_in">this</span>.changeCar&#125;&gt;点击换车&lt;/button&gt;</span><br><span class="line">                &lt;B /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">PureComponent</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;子组件render&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>(</span><br><span class="line">            &lt;div className=<span class="string">&#x27;child&#x27;</span>&gt;</span><br><span class="line">                我是子组件</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="propsRender"><a href="#propsRender" class="headerlink" title="propsRender"></a>propsRender</h3><p>通过函数调用的形式，向组件内动态传入带内容的解构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./index.css&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">index</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div className=<span class="string">&#x27;parent&#x27;</span>&gt;</span><br><span class="line">                &lt;h2&gt;propsRender&lt;/h2&gt;</span><br><span class="line">                &#123;<span class="comment">/* render 等于一个函数，返回一个组件，接收到参数传递给子组件 */</span>&#125;</span><br><span class="line">                &lt;A render=&#123;<span class="function">(<span class="params">carName</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">B</span> <span class="attr">carName</span>=<span class="string">&#123;carName&#125;</span> /&gt;</span></span>&#125;&gt;&lt;/A&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        carName: <span class="string">&quot;奔驰&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; carName &#125; = <span class="built_in">this</span>.state</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div className=<span class="string">&#x27;child1&#x27;</span>&gt;</span><br><span class="line">                我是A组件&lt;br /&gt;</span><br><span class="line">                我的汽车是：&#123;carName&#125;</span><br><span class="line">                &#123;<span class="comment">/* 在A组件中调用props上的render方法渲染返回的组件并传递参数 */</span>&#125;</span><br><span class="line">                &#123;<span class="built_in">this</span>.props.render(carName)&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div className=<span class="string">&#x27;child2&#x27;</span>&gt;</span><br><span class="line">                我是B组件&lt;br /&gt;</span><br><span class="line">                从A组件接收到的名字是：&#123;<span class="built_in">this</span>.props.carName&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/react/27.png"></p>
<h3 id="错误边界"><a href="#错误边界" class="headerlink" title="错误边界"></a>错误边界</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">&quot;./Child&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        hasError: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 只能捕获后台组件生命周期上发生的错误，不能捕获自己组件产生的错误。同时其他组件非生命周期发生的错误，</span></span><br><span class="line">    <span class="comment">// 例如：自定义的方法事件，计时器等错误不能被捕获</span></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="title">getDerivedStateFromError</span>(<span class="params">error</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;@@&#x27;</span>, error);</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            hasError: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当组件发生错误后回触发这个方法，可以在这个方法中记录错误次数</span></span><br><span class="line">    <span class="function"><span class="title">componentDidCatch</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;发生了错误，通知服务器&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div style=&#123;&#123; <span class="string">&quot;border&quot;</span>: <span class="string">&#x27;1px solid #ddd&#x27;</span>, <span class="string">&quot;padding&quot;</span>: <span class="string">&quot;20px&quot;</span> &#125;&#125;&gt;</span><br><span class="line">                &lt;h2&gt;我的Parent组件&lt;/h2&gt;</span><br><span class="line">                &#123;<span class="comment">/* 判断错误是否存在，来显示不同的组件。避免一个错误影响全局页面 */</span>&#125;</span><br><span class="line">                &#123;<span class="built_in">this</span>.state.hasError ? <span class="xml"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>网络异常，请稍后重试<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span> : <span class="xml"><span class="tag">&lt;<span class="name">Child</span> /&gt;</span></span>&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：该功能只能在生产环境下有效。本地开发环境不生效。</p>
<h3 id="组件间通信方式总结"><a href="#组件间通信方式总结" class="headerlink" title="组件间通信方式总结"></a>组件间通信方式总结</h3><p>组件间的关系</p>
<ul>
<li>父子组件</li>
<li>兄弟组件（非嵌套组件）</li>
<li>祖孙组件（跨级组件）</li>
</ul>
<p>几种通信方式</p>
<ul>
<li>props<ul>
<li>children props</li>
<li>render props</li>
</ul>
</li>
<li>消息订阅、发布<ul>
<li>pubsub-js、event 等</li>
</ul>
</li>
<li>集中式状态管理<ul>
<li>redux，dva 等</li>
</ul>
</li>
<li>conText<ul>
<li>生产者消费者模式</li>
</ul>
</li>
</ul>
<p>比较好的搭配方式</p>
<ul>
<li>父子组件：props</li>
<li>兄弟组件：消息订阅、集中式状态管理</li>
<li>祖孙组件：消息订阅、集中式状态管理、conText</li>
</ul>
<h2 id="js相关复习"><a href="#js相关复习" class="headerlink" title="js相关复习"></a>js相关复习</h2><h3 id="类的创建和继承"><a href="#类的创建和继承" class="headerlink" title="类的创建和继承"></a>类的创建和继承</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="comment">// 声明一个构造器，接受name和age两个属性</span></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name,age</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name</span><br><span class="line">        <span class="built_in">this</span>.age = age</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置speak方法</span></span><br><span class="line">    <span class="function"><span class="title">speak</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 类中方法的this指向的是类的实例化的对象</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`我叫<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>,几年<span class="subst">$&#123;<span class="built_in">this</span>.age&#125;</span>岁了`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建类的实例化对象p1</span></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> Person(<span class="string">&quot;张三&quot;</span>,<span class="number">19</span>)</span><br><span class="line"><span class="comment">// 调用类中的speak方法</span></span><br><span class="line">p1.speak() <span class="comment">//=&gt; 我叫张三,几年19岁了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个学生类继承上面的Person类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    <span class="comment">// 给Studnet类添加一个构造器方法</span></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name,age,grade</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果继承的类写了constructor方法，则在constructor方法内部第一行添加super方法，用来调用父类的constructor方法</span></span><br><span class="line">        <span class="built_in">super</span>(name,age)</span><br><span class="line">        <span class="comment">// 添加Student类独有的属性</span></span><br><span class="line">        <span class="built_in">this</span>.grade = grade</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重写父类的speak方法</span></span><br><span class="line">    <span class="function"><span class="title">speak</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`我叫<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>,几年<span class="subst">$&#123;<span class="built_in">this</span>.age&#125;</span>岁了,今年上<span class="subst">$&#123;<span class="built_in">this</span>.grade&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> s1 = <span class="keyword">new</span> Student(<span class="string">&#x27;lisi&#x27;</span>,<span class="string">&#x27;18&#x27;</span>,<span class="string">&#x27;高一&#x27;</span>)</span><br><span class="line">s1.speak() <span class="comment">//=&gt; 我叫lisi,几年18岁了,今年上高一</span></span><br></pre></td></tr></table></figure>

<h3 id="展开语法"><a href="#展开语法" class="headerlink" title="展开语法"></a>展开语法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 展开数组</span></span><br><span class="line"><span class="keyword">let</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="built_in">console</span>.log(...a); <span class="comment">//=&gt; 1 2 3 4 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 合并两个数组</span></span><br><span class="line"><span class="keyword">let</span> b = [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"><span class="built_in">console</span>.log([...a, ...b]); <span class="comment">//=&gt; [1, 2, 3, 4, 5, 6, 7, 8, 9]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法接收不定数参数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">...numbers</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 接收到的是一个数组</span></span><br><span class="line">    <span class="built_in">console</span>.log(numbers);</span><br><span class="line">    <span class="keyword">return</span> numbers.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)); <span class="comment">//=&gt; 6</span></span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">3</span>)); <span class="comment">//=&gt; 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用展开语法浅拷贝对象,这种方法只能复制对象中第一层的数据</span></span><br><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">    name: <span class="string">&quot;Tom&quot;</span>,</span><br><span class="line">    age: <span class="number">19</span>,</span><br><span class="line">    classInfo: &#123;</span><br><span class="line">        height: <span class="number">180</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> person2 = &#123;</span><br><span class="line">    ...person</span><br><span class="line">&#125;</span><br><span class="line">person.name = <span class="string">&quot;jery&quot;</span></span><br><span class="line">person.classInfo.height = <span class="number">190</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(person2); <span class="comment">//=&gt; &#123;&quot;name&quot;:&quot;Tom&quot;,&quot;age&quot;:19,&quot;classInfo&quot;:&#123;&quot;height&quot;:190&#125;&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(person); <span class="comment">//=&gt; &#123;&quot;name&quot;:&quot;jery&quot;,&quot;age&quot;:19,&quot;classInfo&quot;:&#123;&quot;height&quot;:190&#125;&#125;</span></span><br></pre></td></tr></table></figure>



</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">SZX</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://songzx0106.github.io/React/01_React/">https://songzx0106.github.io/React/01_React/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://SongZX0106.github.io" target="_blank">SZX的开发笔记</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/React/">React</a></div><div class="post_share"><div class="social-share" data-image="/images/ys08.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/share.min.css" media="print" onload="this.media='all'"><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/images/wechat.png" target="_blank"><img class="post-qr-code-img" data-lazy-src="/images/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/images/alipay.jpg" target="_blank"><img class="post-qr-code-img" data-lazy-src="/images/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/Vue/Cropper/"><img class="prev-cover" data-lazy-src="/images/ys15.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">vue裁剪图片插件</div></div></a></div><div class="next-post pull-right"><a href="/Vue/VueAdmin/"><img class="next-cover" data-lazy-src="/images/ys13.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Vue+ElementUI 搭建后台管理系统</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="/images/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">SZX</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">150</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://gitee.com/szxio"><i class="iconfont icon-gitee-fill-round"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">welcome to my blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-React-%E5%85%A5%E9%97%A8"><span class="toc-number">1.</span> <span class="toc-text">第一章 React 入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#React-%E5%AE%98%E7%BD%91"><span class="toc-number">1.1.</span> <span class="toc-text">React 官网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#React-%E7%89%B9%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">React 特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#React-%E9%AB%98%E6%95%88%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">1.3.</span> <span class="toc-text">React 高效的原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hello-React"><span class="toc-number">1.4.</span> <span class="toc-text">Hello React</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jsx%E5%A4%9A%E7%BA%A7%E5%B5%8C%E5%A5%97%E6%A0%87%E7%AD%BE%E8%AF%AD%E6%B3%95"><span class="toc-number">1.5.</span> <span class="toc-text">jsx多级嵌套标签语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jsx%E8%AF%AD%E6%B3%95"><span class="toc-number">1.6.</span> <span class="toc-text">jsx语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jsx%E7%BB%83%E4%B9%A0-%E5%8A%A8%E6%80%81%E5%BE%AA%E7%8E%AF%E6%95%B0%E7%BB%84"><span class="toc-number">1.7.</span> <span class="toc-text">jsx练习:动态循环数组</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E9%9D%A2%E5%90%91%E7%BB%84%E4%BB%B6%E7%BC%96%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">第二章 面向组件编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BB%84%E4%BB%B6"><span class="toc-number">2.1.</span> <span class="toc-text">定义函数式组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E7%B1%BB%E5%BC%8F%E7%BB%84%E4%BB%B6"><span class="toc-number">2.2.</span> <span class="toc-text">定义一个类式组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E5%AE%9E%E4%BE%8B%E5%8C%96%E7%9A%84%E4%B8%89%E5%A4%A7%E5%B1%9E%E6%80%A71-state"><span class="toc-number">2.3.</span> <span class="toc-text">组件实例化的三大属性1_state</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E7%8A%B6%E6%80%81"><span class="toc-number">2.3.1.</span> <span class="toc-text">初始化状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%BA%8B%E4%BB%B6%E7%BB%91%E5%AE%9A"><span class="toc-number">2.3.2.</span> <span class="toc-text">添加事件绑定</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setState%E6%96%B9%E6%B3%95%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">2.3.3.</span> <span class="toc-text">setState方法的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#state%E7%9A%84%E7%AE%80%E5%86%99%E5%BD%A2%E5%BC%8F"><span class="toc-number">2.3.4.</span> <span class="toc-text">state的简写形式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#state%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93"><span class="toc-number">2.3.5.</span> <span class="toc-text">state问题总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E7%A4%BA%E4%BE%8B%E7%9A%84%E4%B8%89%E5%A4%A7%E5%B1%9E%E6%80%A72-props"><span class="toc-number">2.4.</span> <span class="toc-text">组件示例的三大属性2_props</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#props%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">2.4.1.</span> <span class="toc-text">props的基本使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E4%BC%A0%E9%80%92props%E5%B1%9E%E6%80%A7"><span class="toc-number">2.4.2.</span> <span class="toc-text">批量传递props属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9props%E5%B1%9E%E6%80%A7%E8%BF%9B%E8%A1%8C%E9%99%90%E5%88%B6"><span class="toc-number">2.4.3.</span> <span class="toc-text">对props属性进行限制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#props%E9%99%90%E5%88%B6%E8%A7%84%E5%88%99%E7%9A%84%E7%AE%80%E5%86%99%E5%BD%A2%E5%BC%8F"><span class="toc-number">2.4.4.</span> <span class="toc-text">props限制规则的简写形式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%BC%8F%E7%BB%84%E4%BB%B6%E4%B8%ADconstruction%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">2.4.5.</span> <span class="toc-text">类式组件中construction的作用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E5%AE%9E%E4%BE%8B%E7%9A%84%E4%B8%89%E5%A4%A7%E5%B1%9E%E6%80%A73-refs"><span class="toc-number">2.5.</span> <span class="toc-text">组件实例的三大属性3_refs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BD%A2%E5%BC%8F%E7%9A%84ref"><span class="toc-number">2.5.1.</span> <span class="toc-text">字符串形式的ref</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9E%E8%B0%83%E5%BD%A2%E5%BC%8F%E7%9A%84ref"><span class="toc-number">2.5.2.</span> <span class="toc-text">回调形式的ref</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E5%9B%9E%E8%B0%83-refs-%E7%9A%84%E8%AF%B4%E6%98%8E"><span class="toc-number">2.5.3.</span> <span class="toc-text">关于回调 refs 的说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#createRef-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">2.5.4.</span> <span class="toc-text">createRef 的使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E5%8F%97%E6%8E%A7%E7%BB%84%E4%BB%B6"><span class="toc-number">2.6.</span> <span class="toc-text">非受控组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%97%E6%8E%A7%E7%BB%84%E4%BB%B6"><span class="toc-number">2.7.</span> <span class="toc-text">受控组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0%E5%92%8C%E5%87%BD%E6%95%B0%E6%9F%AF%E9%87%8C%E5%8C%96"><span class="toc-number">2.8.</span> <span class="toc-text">高阶函数和函数柯里化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0"><span class="toc-number">2.8.1.</span> <span class="toc-text">高阶函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%9F%AF%E9%87%8C%E5%8C%96"><span class="toc-number">2.8.2.</span> <span class="toc-text">函数柯里化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-React%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F-%E6%97%A7%E7%89%88%E6%9C%AC"><span class="toc-number">3.</span> <span class="toc-text">第三章 React生命周期(旧版本)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%88%9D%E4%BD%93%E9%AA%8C"><span class="toc-number">3.1.</span> <span class="toc-text">生命周期初体验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E5%A3%B0%E6%98%8E%E5%91%A8%E6%9C%9F"><span class="toc-number">3.2.</span> <span class="toc-text">组件声明周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E7%9A%84setState%E6%B5%81%E7%A8%8B"><span class="toc-number">3.3.</span> <span class="toc-text">组件的setState流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#forceUpdate-%E5%BC%BA%E5%88%B6%E6%9B%B4%E6%96%B0"><span class="toc-number">3.4.</span> <span class="toc-text">forceUpdate 强制更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E4%BC%A0%E5%8F%82%E6%97%B6%E7%9A%84%E6%9B%B4%E6%96%B0%E6%B5%81%E7%A8%8B"><span class="toc-number">3.5.</span> <span class="toc-text">父子组件传参时的更新流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E5%91%A8%E6%9C%9F%E6%80%BB%E7%BB%93"><span class="toc-number">3.6.</span> <span class="toc-text">声明周期总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%98%B6%E6%AE%B5"><span class="toc-number">3.6.1.</span> <span class="toc-text">初始化阶段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E9%98%B6%E6%AE%B5"><span class="toc-number">3.6.2.</span> <span class="toc-text">更新阶段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD%E9%98%B6%E6%AE%B5"><span class="toc-number">3.6.3.</span> <span class="toc-text">卸载阶段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%88%B6%E7%BB%84%E4%BB%B6%E4%BC%A0%E5%8F%82"><span class="toc-number">3.6.4.</span> <span class="toc-text">父组件传参</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E5%91%A8%E6%9C%9F%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">3.6.5.</span> <span class="toc-text">声明周期流程图</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-React%E5%A3%B0%E6%98%8E%E5%91%A8%E6%9C%9F-%E6%96%B0%E7%89%88%E6%9C%AC"><span class="toc-number">4.</span> <span class="toc-text">第四章 React声明周期(新版本)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E6%97%A7%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%8C%BA%E5%88%AB"><span class="toc-number">4.1.</span> <span class="toc-text">新旧生命周期区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getDerivedStateFromProps"><span class="toc-number">4.2.</span> <span class="toc-text">getDerivedStateFromProps</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getSnapshotBeforeUpdate"><span class="toc-number">4.3.</span> <span class="toc-text">getSnapshotBeforeUpdate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%BE"><span class="toc-number">4.4.</span> <span class="toc-text">新生命周期图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E9%81%8D%E5%8E%86%E6%97%B6key%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">第五章 遍历时key的作用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E6%8B%9FDOM%E4%B8%ADkey%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">5.1.</span> <span class="toc-text">虚拟DOM中key的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8index%E7%B4%A2%E5%BC%95%E5%80%BC%E4%BD%9C%E4%B8%BAkey%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%8F%91%E7%94%9F%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">5.2.</span> <span class="toc-text">用index索引值作为key可能会发生的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9key"><span class="toc-number">5.3.</span> <span class="toc-text">如何选择key</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-React-%E8%84%9A%E6%89%8B%E6%9E%B6"><span class="toc-number">6.</span> <span class="toc-text">第六章 React 脚手架</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#React-%E8%84%9A%E6%89%8B%E6%9E%B6"><span class="toc-number">6.1.</span> <span class="toc-text">React 脚手架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E5%90%AF%E5%8A%A8"><span class="toc-number">6.2.</span> <span class="toc-text">创建和启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#public-index-html%E6%96%87%E4%BB%B6%E7%9A%84%E8%AF%B4%E6%98%8E"><span class="toc-number">6.3.</span> <span class="toc-text">public&#x2F;index.html文件的说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#src%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="toc-number">6.4.</span> <span class="toc-text">src目录下文件说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84Hello%E7%BB%84%E4%BB%B6"><span class="toc-number">6.5.</span> <span class="toc-text">实现一个简单的Hello组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B7%E5%BC%8F%E6%96%87%E4%BB%B6%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-number">6.6.</span> <span class="toc-text">样式文件模块化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#React%E7%9B%B8%E5%85%B3%E6%8F%92%E4%BB%B6"><span class="toc-number">6.7.</span> <span class="toc-text">React相关插件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0-%E5%AE%9E%E7%8E%B0-ToDoList-%E6%A1%88%E4%BE%8B"><span class="toc-number">7.</span> <span class="toc-text">第七章 实现 ToDoList 案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%86%E5%88%86%E7%BB%84%E4%BB%B6"><span class="toc-number">7.1.</span> <span class="toc-text">拆分组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%B6%E4%BC%A0%E5%AD%90"><span class="toc-number">7.2.</span> <span class="toc-text">父传子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E4%BC%A0%E7%88%B6"><span class="toc-number">7.3.</span> <span class="toc-text">子传父</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nanoid-%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">7.4.</span> <span class="toc-text">nanoid 库的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E9%BC%A0%E6%A0%87%E7%A7%BB%E5%85%A5%E7%A7%BB%E5%87%BA%E4%BA%8B%E4%BB%B6"><span class="toc-number">7.5.</span> <span class="toc-text">添加鼠标移入移出事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%84%9A%E6%89%8B%E6%9E%B6%E6%B7%BB%E5%8A%A0propTypes"><span class="toc-number">7.6.</span> <span class="toc-text">脚手架添加propTypes</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AB%E7%AB%A0-%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F"><span class="toc-number">8.</span> <span class="toc-text">第八章 配置代理解决跨域</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86%E6%96%B9%E5%BC%8F1"><span class="toc-number">8.1.</span> <span class="toc-text">设置代理方式1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86%E6%96%B9%E5%BC%8F2"><span class="toc-number">8.2.</span> <span class="toc-text">设置代理方式2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B9%9D%E7%AB%A0-%E5%BC%80%E5%8F%91GitHub%E6%90%9C%E7%B4%A2%E6%8E%A5%E5%8F%A3"><span class="toc-number">9.</span> <span class="toc-text">第九章 开发GitHub搜索接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BAnode%E6%9C%8D%E5%8A%A1"><span class="toc-number">9.1.</span> <span class="toc-text">新建node服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E7%AB%A0-%E7%BB%84%E4%BB%B6%E4%B9%8B%E9%97%B4%E7%9A%84%E4%BA%92%E7%9B%B8%E9%80%9A%E4%BF%A1"><span class="toc-number">10.</span> <span class="toc-text">第十章 组件之间的互相通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%B6%E5%AD%90%E9%80%9A%E4%BF%A1"><span class="toc-number">10.1.</span> <span class="toc-text">父子通信</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E8%AE%A2%E9%98%85%E5%92%8C%E5%8F%91%E5%B8%83"><span class="toc-number">10.2.</span> <span class="toc-text">消息订阅和发布</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AB%A0-%E4%BD%BF%E7%94%A8-fetch-%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82"><span class="toc-number">11.</span> <span class="toc-text">第十一章 使用 fetch 发送请求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">11.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-fetch-%E5%8F%91%E9%80%81-GET-%E8%AF%B7%E6%B1%82"><span class="toc-number">11.2.</span> <span class="toc-text">使用 fetch 发送 GET 请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-fetch-%E5%8F%91%E9%80%81-POST-%E8%AF%B7%E6%B1%82"><span class="toc-number">11.3.</span> <span class="toc-text">使用 fetch 发送 POST 请求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%8C%E7%AB%A0-React-%E8%B7%AF%E7%94%B1"><span class="toc-number">12.</span> <span class="toc-text">第十二章 React 路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFSPA%E5%8D%95%E9%A1%B5%E9%9D%A2"><span class="toc-number">12.1.</span> <span class="toc-text">什么是SPA单页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%B7%AF%E7%94%B1"><span class="toc-number">12.2.</span> <span class="toc-text">什么是路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">12.3.</span> <span class="toc-text">前端路由的工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86-react-router-dom"><span class="toc-number">12.4.</span> <span class="toc-text">认识 react-router-dom</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%BB%84%E4%BB%B6%E5%92%8C%E4%B8%80%E8%88%AC%E7%BB%84%E4%BB%B6"><span class="toc-number">12.5.</span> <span class="toc-text">路由组件和一般组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NavLink-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">12.6.</span> <span class="toc-text">NavLink 的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85-NavLink"><span class="toc-number">12.7.</span> <span class="toc-text">封装 NavLink</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Switch-%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">12.8.</span> <span class="toc-text">Switch 组件的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%A0%B7%E5%BC%8F%E4%B8%A2%E5%A4%B1%E9%97%AE%E9%A2%98"><span class="toc-number">12.9.</span> <span class="toc-text">解决样式丢失问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%9A%84%E4%B8%A5%E6%A0%BC%E5%8C%B9%E9%85%8D"><span class="toc-number">12.10.</span> <span class="toc-text">路由的严格匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redirect%E9%87%8D%E5%AE%9A%E5%90%91%E8%B7%AF%E7%94%B1"><span class="toc-number">12.11.</span> <span class="toc-text">redirect重定向路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E8%B7%AF%E7%94%B1"><span class="toc-number">12.12.</span> <span class="toc-text">嵌套路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E8%B7%AF%E7%94%B1%E7%BB%84%E4%BB%B6%E4%BC%A0%E9%80%92-params-%E5%8F%82%E6%95%B0"><span class="toc-number">12.13.</span> <span class="toc-text">向路由组件传递 params 参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E8%B7%AF%E7%94%B1%E7%BB%84%E4%BB%B6%E4%BC%A0%E9%80%92-search-%E5%8F%82%E6%95%B0"><span class="toc-number">12.14.</span> <span class="toc-text">向路由组件传递 search 参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E8%B7%AF%E7%94%B1%E7%BB%84%E4%BB%B6%E4%BC%A0%E9%80%92-state-%E5%8F%82%E6%95%B0"><span class="toc-number">12.15.</span> <span class="toc-text">向路由组件传递 state 参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%9A%84push%E6%A8%A1%E5%BC%8F%E5%92%8Creplace%E6%A8%A1%E5%BC%8F"><span class="toc-number">12.16.</span> <span class="toc-text">路由的push模式和replace模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E5%BC%8F%E8%B7%AF%E7%94%B1"><span class="toc-number">12.17.</span> <span class="toc-text">编程式路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#push-%E6%A8%A1%E5%BC%8F%E4%BC%A0%E9%80%92-params-%E5%8F%82%E6%95%B0"><span class="toc-number">12.17.1.</span> <span class="toc-text">push 模式传递 params 参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#push-%E6%A8%A1%E5%BC%8F%E4%BC%A0%E9%80%92-search-%E5%8F%82%E6%95%B0"><span class="toc-number">12.17.2.</span> <span class="toc-text">push 模式传递 search 参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#push-%E6%A8%A1%E5%BC%8F%E4%BC%A0%E9%80%92-state-%E5%8F%82%E6%95%B0"><span class="toc-number">12.17.3.</span> <span class="toc-text">push 模式传递 state 参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#replace-%E6%A8%A1%E5%BC%8F%E4%BC%A0%E9%80%92-params-%E5%8F%82%E6%95%B0"><span class="toc-number">12.17.4.</span> <span class="toc-text">replace 模式传递 params 参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#replace-%E6%A8%A1%E5%BC%8F%E4%BC%A0%E9%80%92-search-%E5%8F%82%E6%95%B0"><span class="toc-number">12.17.5.</span> <span class="toc-text">replace 模式传递 search 参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#replace-%E6%A8%A1%E5%BC%8F%E4%BC%A0%E9%80%92-state-%E5%8F%82%E6%95%B0"><span class="toc-number">12.17.6.</span> <span class="toc-text">replace 模式传递 state 参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#goBack-%E8%BF%94%E5%9B%9E"><span class="toc-number">12.17.7.</span> <span class="toc-text">goBack 返回</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#goForward-%E5%89%8D%E8%BF%9B"><span class="toc-number">12.17.8.</span> <span class="toc-text">goForward 前进</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#go-%E8%B7%B3%E8%BD%AC%E8%87%B3%E6%8C%87%E5%AE%9A%E7%BA%A7%E5%88%AB"><span class="toc-number">12.17.9.</span> <span class="toc-text">go 跳转至指定级别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#withRouter-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">12.18.</span> <span class="toc-text">withRouter 的使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%89%E7%AB%A0-AntdUI%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">13.</span> <span class="toc-text">第十三章 AntdUI的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B"><span class="toc-number">13.1.</span> <span class="toc-text">快速上手</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E9%9C%80%E5%BC%95%E5%85%A5"><span class="toc-number">13.2.</span> <span class="toc-text">按需引入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5Icon%E7%BB%84%E4%BB%B6"><span class="toc-number">13.3.</span> <span class="toc-text">引入Icon组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%BB%E9%A2%98"><span class="toc-number">13.4.</span> <span class="toc-text">自定义主题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0-redux-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">14.</span> <span class="toc-text">第十四章 redux 的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-redux"><span class="toc-number">14.1.</span> <span class="toc-text">什么是 redux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E9%9C%80%E8%A6%81%E7%94%A8%E5%88%B0-redux"><span class="toc-number">14.2.</span> <span class="toc-text">什么情况下需要用到 redux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redux-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">14.3.</span> <span class="toc-text">redux 工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redux-%E4%B8%89%E4%B8%AA%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">14.4.</span> <span class="toc-text">redux 三个核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#action"><span class="toc-number">14.4.1.</span> <span class="toc-text">action</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reduce"><span class="toc-number">14.4.2.</span> <span class="toc-text">reduce</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#store"><span class="toc-number">14.4.3.</span> <span class="toc-text">store</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redux-%E6%B1%82%E5%92%8C%E7%B2%BE%E7%AE%80%E7%89%88"><span class="toc-number">14.5.</span> <span class="toc-text">redux 求和精简版</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redux-%E6%B1%82%E5%92%8C%E5%AE%8C%E6%95%B4%E7%89%88"><span class="toc-number">14.6.</span> <span class="toc-text">redux 求和完整版</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5-action"><span class="toc-number">14.7.</span> <span class="toc-text">异步 action</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%BA%94%E7%AB%A0-react-redux-%E4%BD%BF%E7%94%A8"><span class="toc-number">15.</span> <span class="toc-text">第十五章 react-redux 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-react-redux"><span class="toc-number">15.1.</span> <span class="toc-text">什么是 react-redux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#react-redux-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="toc-number">15.2.</span> <span class="toc-text">react-redux 工作原理图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8%E7%BB%84%E4%BB%B6"><span class="toc-number">15.3.</span> <span class="toc-text">创建容器组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E7%BB%84%E4%BB%B6%E7%BB%99UI%E7%BB%84%E4%BB%B6%E4%BC%A0%E9%80%92props"><span class="toc-number">15.4.</span> <span class="toc-text">容器组件给UI组件传递props</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mapDispatchToProps-%E7%AE%80%E5%86%99"><span class="toc-number">15.5.</span> <span class="toc-text">mapDispatchToProps 简写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%94%B9%E5%8F%98%E8%87%AA%E5%8A%A8%E6%B8%B2%E6%9F%93%E9%A1%B5%E9%9D%A2"><span class="toc-number">15.6.</span> <span class="toc-text">状态改变自动渲染页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Provider-%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">15.7.</span> <span class="toc-text">Provider 组件使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%AE%B9%E5%99%A8%E7%BB%84%E4%BB%B6%E5%92%8CUI%E7%BB%84%E4%BB%B6%E4%BA%8C%E5%90%88%E4%B8%80"><span class="toc-number">15.8.</span> <span class="toc-text">将容器组件和UI组件二合一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#combineReducers-%E6%96%B9%E6%B3%95%E5%90%88%E5%B9%B6%E5%A4%9A%E4%B8%AA-reducer"><span class="toc-number">15.9.</span> <span class="toc-text">combineReducers 方法合并多个 reducer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%AF%E5%87%BD%E6%95%B0"><span class="toc-number">15.10.</span> <span class="toc-text">纯函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redux-%E5%BC%80%E5%8F%91%E8%80%85%E5%B7%A5%E5%85%B7"><span class="toc-number">15.11.</span> <span class="toc-text">redux 开发者工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%BD%E7%A6%BB-reduce-%E5%BC%95%E5%85%A5%E6%96%87%E4%BB%B6"><span class="toc-number">15.12.</span> <span class="toc-text">抽离 reduce 引入文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E5%85%AD%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E5%92%8C%E9%A2%84%E8%A7%88"><span class="toc-number">16.</span> <span class="toc-text">第十六章 项目打包和预览</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E5%92%8C%E9%A2%84%E8%A7%88"><span class="toc-number">16.1.</span> <span class="toc-text">打包和预览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%89%93%E5%8C%85%E7%9B%AE%E5%BD%95"><span class="toc-number">16.2.</span> <span class="toc-text">配置打包目录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E4%B8%83%E7%AB%A0-React-%E6%89%A9%E5%B1%95"><span class="toc-number">17.</span> <span class="toc-text">第十七章 React 扩展</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#setState-%E7%9A%84%E4%B8%A4%E7%A7%8D%E5%86%99%E6%B3%95"><span class="toc-number">17.1.</span> <span class="toc-text">setState 的两种写法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="toc-number">17.2.</span> <span class="toc-text">路由懒加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stateHooks"><span class="toc-number">17.3.</span> <span class="toc-text">stateHooks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#useEffect"><span class="toc-number">17.4.</span> <span class="toc-text">useEffect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#useRef"><span class="toc-number">17.5.</span> <span class="toc-text">useRef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fragment"><span class="toc-number">17.6.</span> <span class="toc-text">Fragment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#createContext"><span class="toc-number">17.7.</span> <span class="toc-text">createContext</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PureComponent"><span class="toc-number">17.8.</span> <span class="toc-text">PureComponent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#propsRender"><span class="toc-number">17.9.</span> <span class="toc-text">propsRender</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E8%BE%B9%E7%95%8C"><span class="toc-number">17.10.</span> <span class="toc-text">错误边界</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93"><span class="toc-number">17.11.</span> <span class="toc-text">组件间通信方式总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#js%E7%9B%B8%E5%85%B3%E5%A4%8D%E4%B9%A0"><span class="toc-number">18.</span> <span class="toc-text">js相关复习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E7%BB%A7%E6%89%BF"><span class="toc-number">18.1.</span> <span class="toc-text">类的创建和继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E5%BC%80%E8%AF%AD%E6%B3%95"><span class="toc-number">18.2.</span> <span class="toc-text">展开语法</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Vue/%E4%B8%80%E4%B8%AA%E4%BC%98%E9%9B%85%E7%9A%84%E8%BD%AE%E5%BE%AA%E4%BB%A3%E7%A0%81/" title="一个优雅的轮循代码"><img data-lazy-src="/images/ys07.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="一个优雅的轮循代码"/></a><div class="content"><a class="title" href="/Vue/%E4%B8%80%E4%B8%AA%E4%BC%98%E9%9B%85%E7%9A%84%E8%BD%AE%E5%BE%AA%E4%BB%A3%E7%A0%81/" title="一个优雅的轮循代码">一个优雅的轮循代码</a><time datetime="2024-09-22T16:00:00.000Z" title="发表于 2024-09-23 00:00:00">2024-09-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/JavaScript/pm2_linux_nginx/" title="pm2 + linux + nginx"><img data-lazy-src="/images/ys19.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="pm2 + linux + nginx"/></a><div class="content"><a class="title" href="/JavaScript/pm2_linux_nginx/" title="pm2 + linux + nginx">pm2 + linux + nginx</a><time datetime="2024-09-07T16:00:00.000Z" title="发表于 2024-09-08 00:00:00">2024-09-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/JavaScript/scss%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%80%9A%E7%94%A8%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2/" title="巧用scss实现一个通用的媒介查询代码"><img data-lazy-src="/images/ys11.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="巧用scss实现一个通用的媒介查询代码"/></a><div class="content"><a class="title" href="/JavaScript/scss%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%80%9A%E7%94%A8%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2/" title="巧用scss实现一个通用的媒介查询代码">巧用scss实现一个通用的媒介查询代码</a><time datetime="2024-08-30T16:00:00.000Z" title="发表于 2024-08-31 00:00:00">2024-08-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/JavaScript/Axios%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82/" title="Axios取消请求，以及全局取消请求封装"><img data-lazy-src="/images/ys16.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Axios取消请求，以及全局取消请求封装"/></a><div class="content"><a class="title" href="/JavaScript/Axios%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82/" title="Axios取消请求，以及全局取消请求封装">Axios取消请求，以及全局取消请求封装</a><time datetime="2024-08-11T16:00:00.000Z" title="发表于 2024-08-12 00:00:00">2024-08-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Java/springboot/usercenter/" title="React + SpringBoot 开发用户中心管理系统"><img data-lazy-src="/images/ys16.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="React + SpringBoot 开发用户中心管理系统"/></a><div class="content"><a class="title" href="/Java/springboot/usercenter/" title="React + SpringBoot 开发用户中心管理系统">React + SpringBoot 开发用户中心管理系统</a><time datetime="2024-06-02T02:19:37.000Z" title="发表于 2024-06-02 10:19:37">2024-06-02</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/images/ys08.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By SZX</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">少年辛苦终身事，莫向光阴惰寸功。<a target="_blank" rel="noopener" href="https://gitee.com/szxio">My Gitee</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/instantpage.min.js" type="module"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'iJzt0X9OdhFCcdn4N0dJ86fY-gzGzoHsz',
      appKey: '8vtaRafgQSvU5ntYgszJfRW5',
      placeholder: '留下你的精彩评论',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/canvas-fluttering-ribbon.min.js"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/click-show-text.min.js" data-mobile="true" data-text="富强,民主,文明,和谐,自由,平等,公正,法制,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>