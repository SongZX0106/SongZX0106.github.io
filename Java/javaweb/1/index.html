<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Java Web | SZX的开发笔记</title><meta name="keywords" content="Java"><meta name="author" content="SZX"><meta name="copyright" content="SZX"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="课程视频地址：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1AS4y177xJ?p&#x3D;1 课程文档地址：https:&#x2F;&#x2F;heavy_code_industry.gitee.io&#x2F;code_heavy_industry&#x2F;pro001-javaweb&#x2F;lecture&#x2F; 编写静态页面使用react脚手架搭建项目 1create-react-app demo01  使用 Semi UI">
<meta property="og:type" content="article">
<meta property="og:title" content="Java Web">
<meta property="og:url" content="https://songzx0106.github.io/Java/javaweb/1/index.html">
<meta property="og:site_name" content="SZX的开发笔记">
<meta property="og:description" content="课程视频地址：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1AS4y177xJ?p&#x3D;1 课程文档地址：https:&#x2F;&#x2F;heavy_code_industry.gitee.io&#x2F;code_heavy_industry&#x2F;pro001-javaweb&#x2F;lecture&#x2F; 编写静态页面使用react脚手架搭建项目 1create-react-app demo01  使用 Semi UI">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://songzx0106.github.io/images/ys11.jpg">
<meta property="article:published_time" content="2022-05-13T07:34:32.000Z">
<meta property="article:modified_time" content="2023-04-04T07:55:05.742Z">
<meta property="article:author" content="SZX">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://songzx0106.github.io/images/ys11.jpg"><link rel="shortcut icon" href="/images/favicon.png"><link rel="canonical" href="https://songzx0106.github.io/Java/javaweb/1/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":5000,"languages":{"author":"作者: SZX","link":"链接: ","source":"来源: SZX的开发笔记","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/jquery.min.js',
    justifiedGallery: {
      js: 'https://fastly.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://fastly.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://fastly.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-04 15:55:05'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2467717_jlvw8717b8.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/images/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">140</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">34</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/ys11.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">SZX的开发笔记</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Java Web</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-13T07:34:32.000Z" title="发表于 2022-05-13 15:34:32">2022-05-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-04-04T07:55:05.742Z" title="更新于 2023-04-04 15:55:05">2023-04-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/javaweb/">javaweb</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">18k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>87分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Java Web"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>课程视频地址：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1AS4y177xJ?p=1">https://www.bilibili.com/video/BV1AS4y177xJ?p=1</a></p>
<p>课程文档地址：<a target="_blank" rel="noopener" href="https://heavy_code_industry.gitee.io/code_heavy_industry/pro001-javaweb/lecture/">https://heavy_code_industry.gitee.io/code_heavy_industry/pro001-javaweb/lecture/</a></p>
<h2 id="编写静态页面"><a href="#编写静态页面" class="headerlink" title="编写静态页面"></a>编写静态页面</h2><p>使用react脚手架搭建项目</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create-react-app demo01</span><br></pre></td></tr></table></figure>

<p>使用 Semi UI框架</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add @douyinfe/semi-ui</span><br></pre></td></tr></table></figure>

<p>编写 App.js 组件内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable no-useless-constructor */</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Table, Col, Row &#125; <span class="keyword">from</span> <span class="string">&#x27;@douyinfe/semi-ui&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; IconMember &#125; <span class="keyword">from</span> <span class="string">&#x27;@douyinfe/semi-icons&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Button &#125; <span class="keyword">from</span> <span class="string">&#x27;@douyinfe/semi-ui&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Form, useFormApi &#125; <span class="keyword">from</span> <span class="string">&#x27;@douyinfe/semi-ui&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./App.css&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Column &#125; = Table;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 设置表格初始值</span></span><br><span class="line">  <span class="keyword">const</span> [data, setData] = React.useState([])</span><br><span class="line">  <span class="comment">// 设置表单默认值</span></span><br><span class="line">  <span class="keyword">const</span> [formval, setFormVal] = React.useState(&#123;&#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 页面加载时触发</span></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    setData(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> [</span><br><span class="line">        &#123;</span><br><span class="line">          id: <span class="number">1</span>,</span><br><span class="line">          name: <span class="string">&quot;苹果&quot;</span>,</span><br><span class="line">          price: <span class="string">&#x27;20&#x27;</span>,</span><br><span class="line">          number: <span class="string">&#x27;5&#x27;</span>,</span><br><span class="line">          count: <span class="string">&#x27;100&#x27;</span></span><br><span class="line">        &#125;, &#123;</span><br><span class="line">          id: <span class="number">2</span>,</span><br><span class="line">          name: <span class="string">&quot;香蕉&quot;</span>,</span><br><span class="line">          price: <span class="string">&#x27;10&#x27;</span>,</span><br><span class="line">          number: <span class="string">&#x27;6&#x27;</span>,</span><br><span class="line">          count: <span class="string">&#x27;60&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除按钮</span></span><br><span class="line">  <span class="keyword">const</span> DeleteBtn = <span class="function">(<span class="params">text, record, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Button onClick=&#123;<span class="function">() =&gt;</span> deleteNowRow(record, index)&#125; theme=<span class="string">&#x27;solid&#x27;</span> type=<span class="string">&#x27;danger&#x27;</span>&gt;删除&lt;/Button&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除方法</span></span><br><span class="line">  <span class="keyword">const</span> deleteNowRow = <span class="function">(<span class="params">row, index</span>) =&gt;</span> &#123;</span><br><span class="line">    setData(<span class="function"><span class="params">olddata</span> =&gt;</span> &#123;</span><br><span class="line">      olddata.splice(index, <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">return</span> [...olddata]</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 表单验证</span></span><br><span class="line">  <span class="keyword">const</span> syncValidate = <span class="function">(<span class="params">values</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> errors = &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span> (!values.name) &#123;</span><br><span class="line">      errors.name = <span class="string">&#x27;请输入名称&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!values.price) &#123;</span><br><span class="line">      errors.price = <span class="string">&#x27;请输入价格&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!values.number) &#123;</span><br><span class="line">      errors.number = <span class="string">&#x27;请输入数量&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> errors;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 表单下面的操作按钮</span></span><br><span class="line">  <span class="keyword">const</span> ComponentUsingFormApi = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 获取formApi</span></span><br><span class="line">    <span class="keyword">const</span> formApi = useFormApi();</span><br><span class="line">    <span class="comment">// 添加数据</span></span><br><span class="line">    <span class="keyword">const</span> addVal = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 添加前先添加表单验证</span></span><br><span class="line">      <span class="keyword">let</span> error = syncValidate(formval)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 验证通过后再加入</span></span><br><span class="line">      <span class="keyword">if</span> (!error.name) &#123;</span><br><span class="line">        <span class="comment">// 计算小计</span></span><br><span class="line">        formval.count = +formval.price * +formval.number</span><br><span class="line">        <span class="comment">// 往表中插入输入，要返回一个新的对象才能修改数据</span></span><br><span class="line">        setData(<span class="function"><span class="params">oldval</span> =&gt;</span> [...oldval, &#123; <span class="attr">id</span>: oldval.length + <span class="number">1</span>, ...formval &#125;])</span><br><span class="line">        <span class="comment">// 添加成功后清空表单</span></span><br><span class="line">        resetVal()</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 重置数据</span></span><br><span class="line">    <span class="keyword">const</span> resetVal = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      formApi.reset()</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;&gt;</span><br><span class="line">        &lt;Button theme=<span class="string">&#x27;solid&#x27;</span> htmlType=<span class="string">&quot;submit&quot;</span> type=<span class="string">&#x27;secondary&#x27;</span> onClick=&#123;addVal&#125;&gt;添加&lt;/Button&gt;</span><br><span class="line">        &lt;Button theme=<span class="string">&#x27;solid&#x27;</span> type=<span class="string">&#x27;warning&#x27;</span> onClick=&#123;resetVal&#125; style=&#123;&#123; <span class="attr">marginLeft</span>: <span class="number">8</span> &#125;&#125;&gt;重置&lt;/Button&gt;</span><br><span class="line">      &lt;/&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;Row&gt;</span><br><span class="line">        &lt;Col span=&#123;<span class="number">20</span>&#125; offset=&#123;<span class="number">2</span>&#125; className=<span class="string">&quot;app-title&quot;</span>&gt;</span><br><span class="line">          &lt;IconMember /&gt;</span><br><span class="line">          &lt;h3&gt;商品管理系统&lt;/h3&gt;</span><br><span class="line">        &lt;/Col&gt;</span><br><span class="line">      &lt;/Row&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;Row&gt;</span><br><span class="line">        &lt;Col span=&#123;<span class="number">20</span>&#125; offset=&#123;<span class="number">2</span>&#125;&gt;</span><br><span class="line">          &lt;Table dataSource=&#123;data&#125; pagination=&#123;<span class="literal">false</span>&#125;&gt;</span><br><span class="line">            &lt;Column title=<span class="string">&quot;名称&quot;</span> dataIndex=<span class="string">&quot;name&quot;</span> key=<span class="string">&quot;name&quot;</span> /&gt;</span><br><span class="line">            &lt;Column title=<span class="string">&quot;价格&quot;</span> dataIndex=<span class="string">&quot;price&quot;</span> key=<span class="string">&quot;price&quot;</span> /&gt;</span><br><span class="line">            &lt;Column title=<span class="string">&quot;数量&quot;</span> dataIndex=<span class="string">&quot;number&quot;</span> key=<span class="string">&quot;number&quot;</span> /&gt;</span><br><span class="line">            &lt;Column title=<span class="string">&quot;小计&quot;</span> dataIndex=<span class="string">&quot;count&quot;</span> key=<span class="string">&quot;count&quot;</span> /&gt;</span><br><span class="line">            &lt;Column title=<span class="string">&quot;操作&quot;</span> dataIndex=<span class="string">&quot;operate&quot;</span> key=<span class="string">&quot;operate&quot;</span> render=&#123;DeleteBtn&#125; /&gt;</span><br><span class="line">          &lt;/Table&gt;</span><br><span class="line">        &lt;/Col&gt;</span><br><span class="line">      &lt;/Row&gt;</span><br><span class="line"></span><br><span class="line">      &lt;Row style=&#123;&#123; <span class="attr">marginTop</span>: <span class="string">&quot;15px&quot;</span> &#125;&#125;&gt;</span><br><span class="line">        &lt;Col span=&#123;<span class="number">20</span>&#125; offset=&#123;<span class="number">2</span>&#125;&gt;</span><br><span class="line">          &lt;Form initValues=&#123;formval&#125; validateFields=&#123;syncValidate&#125; onValueChange=&#123;<span class="function"><span class="params">value</span> =&gt;</span> setFormVal(<span class="function">() =&gt;</span> value)&#125; &gt;</span><br><span class="line">            &lt;Form.Input field=<span class="string">&#x27;name&#x27;</span> label=<span class="string">&#x27;名称&#x27;</span> style=&#123;&#123; <span class="attr">width</span>: <span class="number">266</span> &#125;&#125; /&gt;</span><br><span class="line">            &lt;Form.Input field=<span class="string">&#x27;price&#x27;</span> label=<span class="string">&#x27;价格&#x27;</span> style=&#123;&#123; <span class="attr">width</span>: <span class="number">266</span> &#125;&#125; /&gt;</span><br><span class="line">            &lt;Form.Input field=<span class="string">&#x27;number&#x27;</span> label=<span class="string">&#x27;数量&#x27;</span> style=&#123;&#123; <span class="attr">width</span>: <span class="number">266</span> &#125;&#125; /&gt;</span><br><span class="line">            &#123;<span class="comment">/* 表单操作按钮 */</span>&#125;</span><br><span class="line">            &lt;ComponentUsingFormApi /&gt;</span><br><span class="line">          &lt;/Form&gt;</span><br><span class="line">        &lt;/Col&gt;</span><br><span class="line">      &lt;/Row&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>

<p>然后再 index.js 中引入 App.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> reportWebVitals <span class="keyword">from</span> <span class="string">&#x27;./reportWebVitals&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;App /&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">reportWebVitals();</span><br></pre></td></tr></table></figure>

<p>启动项目</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn start</span><br></pre></td></tr></table></figure>

<p>效果展示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/javaweb2.gif" alt="javaweb2.gif"></p>
<h2 id="Tomcat-安装"><a href="#Tomcat-安装" class="headerlink" title="Tomcat 安装"></a>Tomcat 安装</h2><p>首先进入官网进行下载</p>
<p><a target="_blank" rel="noopener" href="https://tomcat.apache.org/">https://tomcat.apache.org/</a></p>
<p>这里我选择 8 版本</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317100144.png" alt="微信截图_20220317100144.png"></p>
<p>点击后页面往下滑，选择 zip 版本下载，选择压缩包下载不用安装就可使用</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317100301.png" alt="微信截图_20220317100301.png"></p>
<p>下载后解压到文件夹中，<strong>注意解压的目录不能有中文和空格</strong>，解压内容如下</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317100412.png" alt="微信截图_20220317100412.png"></p>
<p>接着点开bin目录，点击 startup.bat 运行即可</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317100518.png" alt="微信截图_20220317100518.png"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317100625.png" alt="微信截图_20220317100625.png"></p>
<p>打开浏览器，输入 localhost:8080 查看，看到如下页面表示启动成功</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317100730.png" alt="微信截图_20220317100730.png"></p>
<h2 id="部署项目到Tomcat"><a href="#部署项目到Tomcat" class="headerlink" title="部署项目到Tomcat"></a>部署项目到Tomcat</h2><p>打开 Tomcat 解压目录中的 webapps 文件夹</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317101414.png" alt="微信截图_20220317101414.png"></p>
<p>打开 ROOT 文件夹</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317101506.png" alt="微信截图_20220317101506.png"></p>
<p>保留 WEB-INF 文件夹，其余文件全部替换为我们要部署的前端项目文件</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317101648.png" alt="微信截图_20220317101648.png"></p>
<p>重新运行 startup.bat，再次输入 localhost:8080</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317101736.png" alt="微信截图_20220317101736.png"></p>
<h2 id="下载-Tomcat9"><a href="#下载-Tomcat9" class="headerlink" title="下载 Tomcat9"></a>下载 Tomcat9</h2><p>由于我使用的 java jdk版本是 java17，所以继续使用 tomcat8 的话会有问题</p>
<h2 id="在-idea-中使用-tomcat"><a href="#在-idea-中使用-tomcat" class="headerlink" title="在 idea 中使用 tomcat"></a>在 idea 中使用 tomcat</h2><p>首先新建 Java 项目，默认创建 Java 项目不包含 Web 工程，我们需要手动创建。在项目名称上右键选择 Add Framework Support</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317144529.png" alt="微信截图_20220317144529.png"></p>
<p>选择 Web Applocation，之后点击OK</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317145719.png" alt="微信截图_20220317145719.png"></p>
<p>点击OK后，项目会自动创建一个 WEB 文件夹</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317145830.png" alt="微信截图_20220317145830.png"></p>
<p>然后在和 WEB-INF 平级新建一个 hello.html,同时删除 index.jsp</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317150036.png" alt="微信截图_20220317150036.png"></p>
<p>接着点击右上角的 Add Configuration</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317150136.png" alt="微信截图_20220317150136.png"></p>
<p>在弹出的框中点击左上角 + 号</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317150230.png" alt="微信截图_20220317150230.png"></p>
<p>点开后往下滑选择 Tomcat Server  下面的 Local</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317150320.png" alt="微信截图_20220317150320.png"></p>
<p>在打开的弹框中点击 Configure</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317150541.png" alt="微信截图_20220317150541.png"></p>
<p>选择 tomcat9</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317150709.png" alt="微信截图_20220317150709.png"></p>
<p>接着点击 Deployment</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317150835.png" alt="微信截图_20220317150835.png"></p>
<p>然后再点回 Server</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317151136.png" alt="微信截图_20220317151136.png"></p>
<p>配置完成后会有一个可用的tomcat服务，点击启动debug模式运行</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317151434.png" alt="微信截图_20220317151434.png"></p>
<p>等待服务启动</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317151539.png" alt="微信截图_20220317151539.png"></p>
<p>启动成功自动打开浏览器，发现出现 404 错误，这是因为我们创建的 html 文件名字是 hello.html，需要手动的在地址后面添加 hello.html 即可</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317151510.png" alt="微信截图_20220317151510.png"></p>
<p>现在我们手动的在地址后面添加  hello.html 再次访问</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317151718.png" alt="微信截图_20220317151718.png"></p>
<p>修改代码。刷新页面即可实时查看改动效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/javaweb3.gif" alt="javaweb3.gif"></p>
<p>那么怎么样能自动打开就是加上 hello.html 后缀呢。点击右上角的编辑配置</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317151813.png" alt="微信截图_20220317151813.png"></p>
<p>修改启动地址即可</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317151911.png" alt="微信截图_20220317151911.png"></p>
<p>重新启动即可自动打开 hello.html</p>
<h2 id="使用-HttpServlet-接收表单参数"><a href="#使用-HttpServlet-接收表单参数" class="headerlink" title="使用 HttpServlet 接收表单参数"></a>使用 HttpServlet 接收表单参数</h2><h3 id="编写-form-表单"><a href="#编写-form-表单" class="headerlink" title="编写 form 表单"></a>编写 form 表单</h3><p>首先修改 hello.html 代码，添加 from 表单提交</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;add&quot;</span>&gt;</span></span><br><span class="line">        名称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>/&gt;</span> <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        价格：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;price&quot;</span>/&gt;</span> <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        数量：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;number&quot;</span>/&gt;</span> <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;添加&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="导入-tomcat-依赖"><a href="#导入-tomcat-依赖" class="headerlink" title="导入 tomcat 依赖"></a>导入 tomcat 依赖</h3><p>接着引入 HttpServlet 包，这个包不在 java的 jdk 中，需要额外引入，点击 File，选择 Project Structure</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317152558.png" alt="微信截图_20220317152558.png"></p>
<p>如图</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317153058.png" alt="微信截图_20220317153058.png"></p>
<p>点开 + 号，选择 Library</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317153159.png" alt="微信截图_20220317153159.png"></p>
<p>选择 tomcat9 导入</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317153515.png" alt="微信截图_20220317153515.png"></p>
<p>点击应用</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317153621.png" alt="微信截图_20220317153621.png"></p>
<p>此时项目中就有 tomcat9 的依赖包</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317153707.png" alt="微信截图_20220317153707.png"></p>
<h3 id="编写接收方法"><a href="#编写接收方法" class="headerlink" title="编写接收方法"></a>编写接收方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.songzx.javaweb01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-03-17 12:02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">addServer</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        String price = req.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">        String number = req.getParameter(<span class="string">&quot;number&quot;</span>);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        System.out.println(price);</span><br><span class="line">        System.out.println(number);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置-xml-参数"><a href="#配置-xml-参数" class="headerlink" title="配置 xml 参数"></a>配置 xml 参数</h3><p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317155308.png" alt="微信截图_20220317155308.png"></p>
<p>执行过程</p>
<ol>
<li>用户发送请求，action = add</li>
<li>项目中 web.xml 中找到 url-pattern = /add，对应第12行</li>
<li>找到第11行的 servlet-name = addServer</li>
<li>找到和 servlet-mapping 中 servlet-name 一致的 servlet，对应第7行</li>
<li>然后找到第8行地址所对应的 addServer 类</li>
<li>接收用户发送过来的请求</li>
</ol>
<h3 id="效果演示"><a href="#效果演示" class="headerlink" title="效果演示"></a>效果演示</h3><p>启动项目后点击表单提交，可能出现如下错误</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317161006.png" alt="微信截图_20220317161006.png"></p>
<p>这时我们要检查环境变量 JAVA_HOME 对应的值是否是 java jdk 的低版本，我这里原来是 jdk8.0，修改为 jdk17</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317160846.png" alt="微信截图_20220317160846.png"></p>
<p>然后修改 tomcat 配置，把 jre 同步修改为 jdk17 版本</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220317161212.png" alt="微信截图_20220317161212.png"></p>
<p>再次启动查看效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/javaweb4.gif" alt="javaweb4.gif"></p>
<h3 id="导入jdbc完成数据插入到数据库"><a href="#导入jdbc完成数据插入到数据库" class="headerlink" title="导入jdbc完成数据插入到数据库"></a>导入jdbc完成数据插入到数据库</h3><p>首先在  web -&gt; WEB-INF  文件夹下新建 lib 文件夹，依次导入如下 jar 包</p>
<ul>
<li>commons-dbutils-1.7.jar （操作数据库的第三jar包）</li>
<li>druid-1.1.10.jar （Druid连接池）</li>
<li>mysql-connector-java-8.0.28.jar（MySQL数据库驱动）</li>
</ul>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220318133646.png" alt="微信截图_20220318133646.png"></p>
<p>然后再项目上右键新建文件夹 <code> resource</code>，文件夹的名称固定为这个，然后再该文件夹上右键选择 Mark Directory –&gt; Sources Root</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220318133856.png" alt="微信截图_20220318133856.png"></p>
<p>接着在此文件夹下新建配置文件 <code>druid.properties</code>,</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220318134143.png" alt="微信截图_20220318134143.png"></p>
<p>编写连接数据库的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DataSource source = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStream is = JdbcUtils.class.getClassLoader().getResourceAsStream(<span class="string">&quot;druid.properties&quot;</span>);</span><br><span class="line">            Properties prop = <span class="keyword">new</span> Properties();</span><br><span class="line">            prop.load(is);</span><br><span class="line">            source = DruidDataSourceFactory.createDataSource(prop);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        Connection conn = source.getConnection();</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">closeConnection</span><span class="params">(Connection conn, Statement sta)</span></span>&#123;</span><br><span class="line">        DbUtils.closeQuietly(conn);</span><br><span class="line">        DbUtils.closeQuietly(sta);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 doPost 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">exer01</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            String price = req.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">            String number = req.getParameter(<span class="string">&quot;number&quot;</span>);</span><br><span class="line">            <span class="comment">// 转换数据格式</span></span><br><span class="line">            <span class="keyword">double</span> aDouble = Double.parseDouble(price);</span><br><span class="line">            <span class="keyword">int</span> anInt = Integer.parseInt(number);</span><br><span class="line">            <span class="comment">// 获取连接</span></span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            <span class="comment">// 编写SQL</span></span><br><span class="line">            String sql = <span class="string">&quot;insert into commodity(name,price,number) values (?,?,?)&quot;</span>;</span><br><span class="line">            <span class="comment">// 执行SQL方法</span></span><br><span class="line">            QueryRunner runner = <span class="keyword">new</span> QueryRunner();</span><br><span class="line">            <span class="keyword">int</span> isOk = runner.update(conn, sql, name, aDouble, anInt);</span><br><span class="line">            <span class="comment">// 打印结果</span></span><br><span class="line">            System.out.println(isOk &gt; <span class="number">0</span> ? <span class="string">&quot;插入成功&quot;</span> : <span class="string">&quot;插入失败&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.closeConnection(conn,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重新启动，填写表单后点击提交</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220318134829.png" alt="微信截图_20220318134829.png"></p>
<p>查询数据库，数据成功进入到表中</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220318134951.png" alt="微信截图_20220318134951.png"></p>
<h3 id="处理post接收中文乱码问题"><a href="#处理post接收中文乱码问题" class="headerlink" title="处理post接收中文乱码问题"></a>处理post接收中文乱码问题</h3><p>如图，当表单填写中文后会出现乱码问题</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220319154242.png" alt="微信截图_20220319154242.png"></p>
<p>解决方法：在 doPost 方法首行添加如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>设置字符串的格式为 utf-8 的格式，再次发送中文信息</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220319154435.png" alt="微信截图_20220319154435.png"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220319154538.png" alt="微信截图_20220319154538.png"></p>
<h2 id="Server-的生命周期"><a href="#Server-的生命周期" class="headerlink" title="Server 的生命周期"></a>Server 的生命周期</h2><ul>
<li><p>init 初始化</p>
</li>
<li><p>service 服务中</p>
</li>
<li><p>destroy 销毁</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">exer02</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">exer02</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;创建实例...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;初始化...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;正在服务...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;实例销毁&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动Tomcat服务器后，Tomcat会通过返回帮助我们创建类的实例对象，然后先调用 init 方法进行初始化，然后调用 service 方法判断请求方式，当关闭Tomcat服务器后调用 destory 方法销毁实例</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20220319165104.png" alt="微信截图_20220319165104.png"></p>
<p>默认情况下，会在第一次请求时同时进行初始化和服务操作，第二次请求开始之后不会再次初始化。所以这种模式是单例的，但同时也是线程不安全的</p>
<p>再第一次请求时进行初始化的优缺点：</p>
<ul>
<li>优点：提高程序启动的速度</li>
<li>缺点：第一次请求时效率低。可以通过修改 servlet 的初始化时机来提交第一次访问的效率</li>
</ul>
<h2 id="修改-Servlet-的初始化时机"><a href="#修改-Servlet-的初始化时机" class="headerlink" title="修改 Servlet 的初始化时机"></a>修改 Servlet 的初始化时机</h2><p>在 web.xml 中添加 <code>load-on-startup</code>，这个值越小，实例创建的时机越早.最小不能低于0</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-03-20_17-13-17.png" alt="Snipaste_2022-03-20_17-13-17.png"></p>
<p>启动服务后，观察控制台输出</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-03-20_17-14-56.png" alt="Snipaste_2022-03-20_17-14-56.png"></p>
<p>当进行第一次访问时直接就是正在服务，从而不会再第一步请求时创建实例和初始化</p>
<h2 id="Http的请求和响应"><a href="#Http的请求和响应" class="headerlink" title="Http的请求和响应"></a>Http的请求和响应</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>Http 被称为超文本传输协议</p>
<h3 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h3><p>请求包含下面三个部分</p>
<ul>
<li>请求行<ul>
<li>请求的方式</li>
<li>请求的 URL</li>
<li>请求的协议</li>
</ul>
</li>
<li>请求头<ul>
<li>浏览器版本号</li>
<li>浏览器型号</li>
<li>浏览器可以接收的数据类型</li>
<li>……</li>
</ul>
</li>
<li>请求主体<ul>
<li>get 方式：没有请求体，但是有一个 queryString</li>
<li>post方式：有请求体，form data</li>
<li>json格式，有请求体，request payload</li>
</ul>
</li>
</ul>
<h3 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h3><p>响应包含下面的三个信息</p>
<ul>
<li>响应行<ul>
<li>协议</li>
<li>响应状态码<ul>
<li>200</li>
<li>404</li>
<li>500</li>
<li>…</li>
</ul>
</li>
<li>响应状态</li>
</ul>
</li>
<li>响应头<ul>
<li>服务器信息</li>
<li>服务器发给浏览器的内容（内容媒体类型、编码、长度等）</li>
</ul>
</li>
<li>响应体<ul>
<li>响应的实际内容</li>
</ul>
</li>
</ul>
<h2 id="Http无状态"><a href="#Http无状态" class="headerlink" title="Http无状态"></a>Http无状态</h2><p>服务器无法判断两次请求是否来自不同的浏览器或者来自同一个浏览器，这种情况称为Http无状态。可以通过回话跟踪来解决</p>
<h2 id="会话跟踪"><a href="#会话跟踪" class="headerlink" title="会话跟踪"></a>会话跟踪</h2><p>简单概述：当浏览器第一次访问服务器时，服务器会自动分配一个 session id 给这个请求。当这个请求第二次来访问时，会携带者服务器分配给自己的 session id。服务器根据这个 session id 来区分每一个请求</p>
<p>可以通过代码来演示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">exer03</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        <span class="comment">// 获取 session id</span></span><br><span class="line">        String id = session.getId();</span><br><span class="line">        System.out.println(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当浏览器进行第一次访问时，服务器会自动分配一个 session id</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-03-20_18-09-14.png" alt="Snipaste_2022-03-20_18-09-14.png"></p>
<p>当浏览器继续访问时，会将这个 session id 传给服务器</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-03-20_18-10-54.png" alt="Snipaste_2022-03-20_18-10-54.png"></p>
<p>常用的 API</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取会话创建时间</span></span><br><span class="line"><span class="keyword">long</span> creationTime = session.getCreationTime();</span><br><span class="line"><span class="comment">// 获取会话是否是新的</span></span><br><span class="line"><span class="keyword">boolean</span> aNew = session.isNew();</span><br><span class="line"><span class="comment">// 获取会话最长有效期</span></span><br><span class="line"><span class="keyword">int</span> maxInactiveInterval = session.getMaxInactiveInterval();</span><br><span class="line"><span class="comment">// 设置会话最长有效期</span></span><br><span class="line">session.setMaxInactiveInterval(<span class="number">2000</span>);</span><br><span class="line"><span class="comment">// 让会话立刻失效</span></span><br><span class="line">session.invalidate();</span><br></pre></td></tr></table></figure>

<h2 id="会话保存"><a href="#会话保存" class="headerlink" title="会话保存"></a>会话保存</h2><p>在同一个会话中，我们可以保存数据。</p>
<p>分别使用两个方法：</p>
<ul>
<li><code>req.getSession().setAttribute</code></li>
<li><code>req.getSession().getAttribute</code></li>
</ul>
<p>添加数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">exer04</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 往session中添加数据</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        req.getSession().setAttribute(<span class="string">&quot;uname&quot;</span>,<span class="string">&quot;lina&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">exer05</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 读取session中的数据</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        Object uname = req.getSession().getAttribute(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        System.out.println(uname);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时我们启动 Tomcat，依次访问 exer04 和 exer05</p>
<p>当访问 exer04 后系统会帮我们保存 <code>uname</code> 的值为 <code>lina</code></p>
<p>然后访问 exer05</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-03-23_21-48-02.png" alt="Snipaste_2022-03-23_21-48-02.png"></p>
<p>成功获取到 <code>uname</code> 的值</p>
<p>然后换个浏览器访问 exer05</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-03-23_21-51-00.png" alt="Snipaste_2022-03-23_21-51-00.png"></p>
<p>由于会话不同，所以获取不到 <code>uname</code> 的值</p>
<h2 id="内部转发和重定向"><a href="#内部转发和重定向" class="headerlink" title="内部转发和重定向"></a>内部转发和重定向</h2><h3 id="内部转发"><a href="#内部转发" class="headerlink" title="内部转发"></a>内部转发</h3><p>当浏览器访问服务器时，服务器在内部转发这个请求给到另外一个服务器去处理。此时浏览器是不知道内部转发了多少次的。</p>
<p>首先编写exer06，在这个里面吧请求转发给 exer07</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">exer06</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;exer06.....&quot;</span>);</span><br><span class="line">        <span class="comment">// 内部转发给exer07，浏览器是不知道的</span></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;exer07&quot;</span>).forward(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>exer07 里面只打印一语句话</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">exer07</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;exer07.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后启动 Tomcat，访问exer06 观察结果。</p>
<p>结果可以看到 exer06 和 exer07 都会执行</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-03-23_22-19-37.png" alt="Snipaste_2022-03-23_22-19-37.png"></p>
<p>浏览器地址没有变化，并且只有一次请求</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-03-23_22-22-07.png" alt="Snipaste_2022-03-23_22-22-07.png"></p>
<h3 id="浏览器重定向"><a href="#浏览器重定向" class="headerlink" title="浏览器重定向"></a>浏览器重定向</h3><p>使用浏览器重定向浏览器的地址会发生变化，并且会发送两次请求</p>
<p>使用 <code>resp.sendRedirect(&quot;exer07&quot;);</code> 重定向</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">exer06</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;exer06.....&quot;</span>);</span><br><span class="line">        <span class="comment">// 客户端重定向到exer07</span></span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;exer07&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 exer07 打印信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">exer07</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;exer07.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动Tomcat，访问exer06</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-03-23_22-25-50.png" alt="Snipaste_2022-03-23_22-25-50.png"></p>
<p>此时浏览器的地址栏会发生改变，并且发送两次请求</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-03-23_22-27-49.png" alt="Snipaste_2022-03-23_22-27-49.png"></p>
<h2 id="thymeleaf-入门"><a href="#thymeleaf-入门" class="headerlink" title="thymeleaf 入门"></a>thymeleaf 入门</h2><h3 id="导包"><a href="#导包" class="headerlink" title="导包"></a>导包</h3><p>首先导入需要用到的包</p>
<ul>
<li>attoparser-2.0.5.RELEASE.jar</li>
<li>javassist-3.20.0-GA.jar</li>
<li>ognl-3.1.26.jar</li>
<li>slf4j-api-1.7.25.jar</li>
<li>thymeleaf-3.0.14.RELEASE.jar</li>
<li>unbescape-1.1.6.RELEASE.jar</li>
</ul>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-03-30_13-38-20.png" alt="Snipaste_2022-03-30_13-38-20.png"></p>
<p>然后再 lib_thymeleaf 文件夹右键，选择 add as library</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-03-30_13-39-40.png" alt="Snipaste_2022-03-30_13-39-40.png"></p>
<p>接着吧这个 lib 包添加到 module 中</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-03-30_13-40-39.png" alt="Snipaste_2022-03-30_13-40-39.png"></p>
<p>接着在 problems 中将所有内容添加到 web 中</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-03-30_13-41-32.png" alt="Snipaste_2022-03-30_13-41-32.png"></p>
<h3 id="引入文件"><a href="#引入文件" class="headerlink" title="引入文件"></a>引入文件</h3><p>直接复制下面的代码到 <code>myssm.ViewBaseServlet</code> 中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.songzx.myssm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.TemplateEngine;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.context.WebContext;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templatemode.TemplateMode;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.templateresolver.ServletContextTemplateResolver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-03-30 13:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewBaseServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> TemplateEngine templateEngine;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.获取ServletContext对象</span></span><br><span class="line">        ServletContext servletContext = <span class="keyword">this</span>.getServletContext();</span><br><span class="line">        <span class="comment">// 2.创建Thymeleaf解析器对象</span></span><br><span class="line">        ServletContextTemplateResolver templateResolver = <span class="keyword">new</span> ServletContextTemplateResolver(servletContext);</span><br><span class="line">        <span class="comment">// 3.给解析器对象设置参数</span></span><br><span class="line">        <span class="comment">// ①HTML是默认模式，明确设置是为了代码更容易理解</span></span><br><span class="line">        templateResolver.setTemplateMode(TemplateMode.HTML);</span><br><span class="line">        <span class="comment">// ②设置前缀</span></span><br><span class="line">        String viewPrefix = servletContext.getInitParameter(<span class="string">&quot;view-prefix&quot;</span>);</span><br><span class="line">        templateResolver.setPrefix(viewPrefix);</span><br><span class="line">        <span class="comment">// ③设置后缀</span></span><br><span class="line">        String viewSuffix = servletContext.getInitParameter(<span class="string">&quot;view-suffix&quot;</span>);</span><br><span class="line">        templateResolver.setSuffix(viewSuffix);</span><br><span class="line">        <span class="comment">// ④设置缓存过期时间（毫秒）</span></span><br><span class="line">        templateResolver.setCacheTTLMs(<span class="number">60000L</span>);</span><br><span class="line">        <span class="comment">// ⑤设置是否缓存</span></span><br><span class="line">        templateResolver.setCacheable(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// ⑥设置服务器端编码方式</span></span><br><span class="line">        templateResolver.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 4.创建模板引擎对象</span></span><br><span class="line">        templateEngine = <span class="keyword">new</span> TemplateEngine();</span><br><span class="line">        <span class="comment">// 5.给模板引擎对象设置模板解析器</span></span><br><span class="line">        templateEngine.setTemplateResolver(templateResolver);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">processTemplate</span><span class="params">(String templateName, HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.设置响应体内容类型和字符集</span></span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.创建WebContext对象</span></span><br><span class="line">        WebContext webContext = <span class="keyword">new</span> WebContext(req, resp, getServletContext());</span><br><span class="line">        <span class="comment">// 3.处理模板数据</span></span><br><span class="line">        templateEngine.process(templateName, webContext, resp.getWriter());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 demo2.java 代码，继承 ViewBaseServlet 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.songzx.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.songzx.comm.Comm;</span><br><span class="line"><span class="keyword">import</span> com.songzx.dao.CommServer;</span><br><span class="line"><span class="keyword">import</span> com.songzx.myssm.ViewBaseServlet;</span><br><span class="line"><span class="keyword">import</span> com.songzx.utils.JdbcUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-03-28 10:03</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo2</span> <span class="keyword">extends</span> <span class="title">ViewBaseServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            CommServer commServer = <span class="keyword">new</span> CommServer();</span><br><span class="line">            List&lt;Comm&gt; commList = commServer.getAllComm(conn);</span><br><span class="line">            HttpSession session = req.getSession();</span><br><span class="line">            session.setAttribute(<span class="string">&quot;commlist&quot;</span>,commList);</span><br><span class="line">            <span class="keyword">super</span>.processTemplate(<span class="string">&quot;index&quot;</span>,req,resp);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        JdbcUtils.closeConnection(conn,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置-xml"><a href="#配置-xml" class="headerlink" title="配置 xml"></a>配置 xml</h3><p>配置一个前缀，一个后缀</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>view-prefix<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>view-suffix<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>.html<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="编写-index-html"><a href="#编写-index-html" class="headerlink" title="编写 index.html"></a>编写 index.html</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello world<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>启动 Tomcat，可以看到页面虽然访问的是 index，但实际看到的是 index.html 文件</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-03-30_15-00-51.png" alt="Snipaste_2022-03-30_15-00-51.png"></p>
<h3 id="动态遍历页面数据"><a href="#动态遍历页面数据" class="headerlink" title="动态遍历页面数据"></a>动态遍历页面数据</h3><p>编写 Index.html 页面。</p>
<ul>
<li><code>th:if=&quot;$&#123;#lists.isEmpty(session.commlist)&#125;&quot;；</code>判断session.commlist 是否为空</li>
<li><code>th:unless=&quot;$&#123;#lists.isEmpty(session.commlist)&#125;&quot;；</code>判断session.commlist 是否不为空</li>
<li><code>th:each=&quot;comm : $&#123;session.commlist&#125;&quot;；</code>遍历session.commlist ，并且命名一个临时变量 comm</li>
<li><code>th:text=&quot;$&#123;comm.name&#125;&quot;</code>；设置标签的内容</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border-collapse:collapse&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px&quot;</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px&quot;</span>&gt;</span>价格<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px&quot;</span>&gt;</span>数量<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px&quot;</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.commlist)&#125;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;4&quot;</span>&gt;</span>没有库存<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:unless</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.commlist)&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;comm : $&#123;session.commlist&#125;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;comm.name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;comm.price&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;comm.number&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行 tomcat。数据库中的数据在页面中被渲染出来</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-03-30_16-53-42.png" alt="Snipaste_2022-03-30_16-53-42.png"></p>
<h2 id="Servlet-保存作用域"><a href="#Servlet-保存作用域" class="headerlink" title="Servlet 保存作用域"></a>Servlet 保存作用域</h2><h3 id="request-保存数据"><a href="#request-保存数据" class="headerlink" title="request 保存数据"></a>request 保存数据</h3><p>只在这一次的响应中有效，使用浏览器重定向时会获取不到数据，例如：</p>
<p>定义 demo01 往 request 中保存数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo01&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo1</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 向 req 中保存数据</span></span><br><span class="line">        req.setAttribute(<span class="string">&quot;uname&quot;</span>,<span class="string">&quot;lili&quot;</span>);</span><br><span class="line">        <span class="comment">// 客户端重定向</span></span><br><span class="line">        resp.sendRedirect(<span class="string">&quot;demo02&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义 demo02 读取 request 中的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo02&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo2</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取请求中保存的数据</span></span><br><span class="line">        Object uname = req.getAttribute(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;uname=&quot;</span>+uname);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动项目，控制台输出 null</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-04-07_20-16-45.png" alt="Snipaste_2022-04-07_20-16-45.png"></p>
<p>然后我们使用服务器内部转发，在另外一个接口中读取数据</p>
<p>定义 demo03</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo03&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo03</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 往当前响应中添加数据</span></span><br><span class="line">        request.setAttribute(<span class="string">&quot;uname&quot;</span>,<span class="string">&quot;lili&quot;</span>);</span><br><span class="line">        <span class="comment">// 服务端内部转发</span></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;demo04&quot;</span>).forward(request,response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义 demo04</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo04&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo04</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        Object uname = request.getAttribute(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;uname=&quot;</span> + uname);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动服务，可以发现获取到的 uname 的值</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-04-07_20-26-37.png" alt="Snipaste_2022-04-07_20-26-37.png"></p>
<h3 id="session-保存作用域"><a href="#session-保存作用域" class="headerlink" title="session 保存作用域"></a>session 保存作用域</h3><p>在 session 中保存的作用域在这一次的请求中都有效</p>
<p>定义 demo05 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo05&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo05</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 往 session 中保存数据</span></span><br><span class="line">        request.getSession().setAttribute(<span class="string">&quot;uname&quot;</span>,<span class="string">&quot;lili&quot;</span>);</span><br><span class="line">        response.sendRedirect(<span class="string">&quot;demo06&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义 demo06</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo06&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo06</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        Object uname = req.getSession().getAttribute(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;uname=&quot;</span> + uname);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-04-07_20-35-10.png" alt="Snipaste_2022-04-07_20-35-10.png"></p>
<h3 id="context-保存数据"><a href="#context-保存数据" class="headerlink" title="context 保存数据"></a>context 保存数据</h3><p>context 保存的数据在项目运行期间都有效</p>
<p>编写 demo07</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo07&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo07</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取请求上下文</span></span><br><span class="line">        ServletContext context = request.getServletContext();</span><br><span class="line">        <span class="comment">// 往上下文中保存数据</span></span><br><span class="line">        context.setAttribute(<span class="string">&quot;uname&quot;</span>,<span class="string">&quot;lili&quot;</span>);</span><br><span class="line">        <span class="comment">// 浏览器重定向</span></span><br><span class="line">        response.sendRedirect(<span class="string">&quot;demo08&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写 demo08</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo08&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo08</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取上下文</span></span><br><span class="line">        ServletContext context = req.getServletContext();</span><br><span class="line">        <span class="comment">// 从上下文中读取数据</span></span><br><span class="line">        Object uname = context.getAttribute(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        System.out.println(uname);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过上下文，只要在服务运行期间，不管那个请求进来都可以获取到 uname 的值</p>
<h2 id="使用-thymeleaf-完成增删改查案例"><a href="#使用-thymeleaf-完成增删改查案例" class="headerlink" title="使用 thymeleaf 完成增删改查案例"></a>使用 thymeleaf 完成增删改查案例</h2><h3 id="实现数据编辑功能"><a href="#实现数据编辑功能" class="headerlink" title="实现数据编辑功能"></a>实现数据编辑功能</h3><p>首先添加跳转并且传参</p>
<p>在 a 标签上添加 <code>th:href=&quot;@&#123;/edit.do(id=$&#123;comm.id&#125;)&#125;&quot;</code> </p>
<p>语法：<code>@&#123;&#125;</code> 表示根目录，<code>(id=$&#123;comm.id&#125;,xxxxx)</code> 表示传递参数，需要传递多个时用逗号隔开</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:unless</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.commlist)&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;comm : $&#123;session.commlist&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> &gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/edit.do(id=$&#123;comm.id&#125;)&#125;&quot;</span>  <span class="attr">th:text</span>=<span class="string">&quot;$&#123;comm.name&#125;&quot;</span>&gt;</span>aa<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;comm.price&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;comm.number&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加 EditService ，在这个页面中通过 id 查询该数据，然后显示 edit 页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/edit.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EditService</span> <span class="keyword">extends</span> <span class="title">ViewBaseServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 从路径中获取参数</span></span><br><span class="line">            String id = req.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="keyword">int</span> anInt = Integer.parseInt(id);</span><br><span class="line">            CommServer server = <span class="keyword">new</span> CommServer();</span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            <span class="comment">// 根据id获取数据</span></span><br><span class="line">            Comm comm = server.getCommById(conn, anInt);</span><br><span class="line">            <span class="comment">// 把数据保存在session中</span></span><br><span class="line">            req.getSession().setAttribute(<span class="string">&quot;commEdit&quot;</span>,comm);</span><br><span class="line">            <span class="comment">// 显示edit页面</span></span><br><span class="line">            <span class="keyword">super</span>.processTemplate(<span class="string">&quot;edit&quot;</span>,req,resp);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.closeConnection(conn,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写 edit.html </p>
<p>使用 <code>th:object=&quot;$&#123;session.commEdit&#125;&quot;</code> 读取在 session 中保存的 commEdit ,然后下面的都通过  <code>th:value=&quot;*&#123;id&#125;&quot;</code> 方式显示数据</p>
<p>点击提交触发表单的 post 方法，请求接口 update.do</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border-collapse:collapse&quot;</span> <span class="attr">th:object</span>=<span class="string">&quot;$&#123;session.commEdit&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;update.do&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;*&#123;id&#125;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px&quot;</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">th:value</span>=<span class="string">&quot;*&#123;name&#125;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px&quot;</span>&gt;</span>价格<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">th:value</span>=<span class="string">&quot;*&#123;price&#125;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;price&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px&quot;</span>&gt;</span>数量<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">th:value</span>=<span class="string">&quot;*&#123;number&#125;&quot;</span> <span class="attr">name</span>=<span class="string">&quot;number&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px&quot;</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加 UpdateService，在这个方法中获取表单提交方法中传递过来的表单数据，然后调用  <code>updateCommById</code> 方法完成数据更新。更新完成后使用浏览器重定向到 index，完成数据的重新渲染</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/update.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UpdateService</span> <span class="keyword">extends</span> <span class="title">ViewBaseServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.设置编码类型</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取参数id</span></span><br><span class="line">            String id = req.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="keyword">int</span> anInt = Integer.parseInt(id);</span><br><span class="line">            <span class="comment">// 获取参数name</span></span><br><span class="line">            String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="comment">// 获取参数price</span></span><br><span class="line">            String price = req.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">            <span class="keyword">double</span> aDouble = Double.parseDouble(price);</span><br><span class="line">            <span class="comment">// 获取参数number</span></span><br><span class="line">            String number = req.getParameter(<span class="string">&quot;number&quot;</span>);</span><br><span class="line">            <span class="keyword">int</span> aNumber = Integer.parseInt(number);</span><br><span class="line">            <span class="comment">// 获取连接</span></span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            <span class="comment">// 封装comm对象</span></span><br><span class="line">            Comm comm = <span class="keyword">new</span> Comm(anInt, name, aDouble, aNumber);</span><br><span class="line">            <span class="comment">// 实例化调用接口类</span></span><br><span class="line">            CommServer server = <span class="keyword">new</span> CommServer();</span><br><span class="line">            <span class="comment">// 执行更新方法</span></span><br><span class="line">            server.updateCommById(conn,comm);</span><br><span class="line">            <span class="comment">// 让浏览器重定向到index，重新渲染页面</span></span><br><span class="line">            resp.sendRedirect(<span class="string">&quot;index&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.closeConnection(conn,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果展示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/javaweb5.gif" alt="javaweb5.gif"></p>
<h3 id="数据删除"><a href="#数据删除" class="headerlink" title="数据删除"></a>数据删除</h3><p>修改 index.html</p>
<p>使用 <code>th:onclick=&quot;|deleteComm($&#123;comm.id&#125;)|&quot;</code> 两个竖线表示内部可以写 <code>$&#123;&#125;</code> 符号，会自动识别里面的内容</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:unless</span>=<span class="string">&quot;$&#123;#lists.isEmpty(session.commlist)&#125;&quot;</span> <span class="attr">th:each</span>=<span class="string">&quot;comm : $&#123;session.commlist&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> &gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/edit.do(id=$&#123;comm.id&#125;)&#125;&quot;</span>  <span class="attr">th:text</span>=<span class="string">&quot;$&#123;comm.name&#125;&quot;</span>&gt;</span>aa<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;comm.price&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;comm.number&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|deleteComm($&#123;comm.id&#125;)|&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加 <code>js/index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deleteComm</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(confirm(<span class="string">&quot;确认删除吗&quot;</span>))&#123;</span><br><span class="line">        <span class="built_in">window</span>.location.href = <span class="string">&quot;delete.do?id=&quot;</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加 <code>deleteCommById</code> 删除方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteCommById</span><span class="params">(Connection conn, <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">    String sql = <span class="string">&quot;delete from commodity where id = ?&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.execUpdate(conn,sql,id);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">        throwables.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新增 DeleteService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/delete.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeleteService</span> <span class="keyword">extends</span> <span class="title">ViewBaseServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取参数删除带过来的参数id</span></span><br><span class="line">        String id = req.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotEmpty(id))&#123;</span><br><span class="line">            <span class="keyword">int</span> aId = Integer.parseInt(id);</span><br><span class="line">            Connection conn = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn = JdbcUtils.getConnection();</span><br><span class="line">                CommServer server = <span class="keyword">new</span> CommServer();</span><br><span class="line">                <span class="comment">// 执行删除方法</span></span><br><span class="line">                server.deleteCommById(conn,aId);</span><br><span class="line">                <span class="comment">// 浏览器重定向到首页重新渲染</span></span><br><span class="line">                resp.sendRedirect(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">                throwables.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果展示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/javaweb6.gif" alt="javaweb6.gif"></p>
<h3 id="数据新增"><a href="#数据新增" class="headerlink" title="数据新增"></a>数据新增</h3><p>在 index 中添加新增按钮</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">th:onclick</span>=<span class="string">&quot;addComm()&quot;</span>&gt;</span>添加水果<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>实现 <code>addComm</code> 方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addComm</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">window</span>.location.href = <span class="string">&quot;add.do&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加 <code>AddService</code> 在这个方法中展示 add.html 页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/add.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AddService</span> <span class="keyword">extends</span> <span class="title">ViewBaseServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.processTemplate(<span class="string">&quot;add&quot;</span>,req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写 <code>add.html</code>，点击提交触发 <code>post</code> 方法，调用 <code>saveAdd.do</code> 接口</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border-collapse:collapse&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;saveAdd.do&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px&quot;</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">input</span>  <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px&quot;</span>&gt;</span>价格<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">input</span>  <span class="attr">name</span>=<span class="string">&quot;price&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px&quot;</span>&gt;</span>数量<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">input</span>  <span class="attr">name</span>=<span class="string">&quot;number&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">th</span> <span class="attr">style</span>=<span class="string">&quot;width: 200px&quot;</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>编写 <code>SaveService</code> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/saveAdd.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SaveService</span> <span class="keyword">extends</span> <span class="title">ViewBaseServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 设置字符串编码</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取表单参数</span></span><br><span class="line">        String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        String price = req.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">        <span class="keyword">double</span> dprice = Double.parseDouble(price);</span><br><span class="line">        String number = req.getParameter(<span class="string">&quot;number&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> inumber = Integer.parseInt(number);</span><br><span class="line">        <span class="comment">// 创建 comm 实例</span></span><br><span class="line">        Comm comm = <span class="keyword">new</span> Comm(name, dprice, inumber);</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            CommServer server = <span class="keyword">new</span> CommServer();</span><br><span class="line">            <span class="comment">// 执行添加方法</span></span><br><span class="line">            server.addComm(conn,comm);</span><br><span class="line">            <span class="comment">// 浏览器重定向到首页</span></span><br><span class="line">            resp.sendRedirect(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.closeConnection(conn,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加方法 <code>addComm</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addComm</span><span class="params">(Connection conn, Comm comm)</span> </span>&#123;</span><br><span class="line">    String sql = <span class="string">&quot;insert into commodity(name,price,number) values(?,?,?)&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.execUpdate(conn,sql,comm.getName(),comm.getPrice(),comm.getNumber());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">        throwables.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果展示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/javaweb7.gif" alt="javaweb7.gif"></p>
<h3 id="数据分页显示"><a href="#数据分页显示" class="headerlink" title="数据分页显示"></a>数据分页显示</h3><p>首先添加一个查询总数的方法，在 baseDAO 中添加如下方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取数据总和</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/4/12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">execQuerySize</span><span class="params">(Connection conn,String sql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    QueryRunner runner = <span class="keyword">new</span> QueryRunner();</span><br><span class="line">    ScalarHandler&lt;Long&gt; scalarHandler = <span class="keyword">new</span> ScalarHandler&lt;&gt;();</span><br><span class="line">    Long query = runner.query(conn, sql, scalarHandler);</span><br><span class="line">    <span class="keyword">return</span> query;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再 commServer 中添加实现方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">getCommSize</span><span class="params">(Connection conn)</span> </span>&#123;</span><br><span class="line">    String sql = <span class="string">&quot;select count(*) from commodity&quot;</span>;</span><br><span class="line">    <span class="keyword">long</span> l = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        l = <span class="keyword">super</span>.execQuerySize(conn, sql);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">        throwables.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改分页查询的SQL</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Comm&gt; <span class="title">getAllComm</span><span class="params">(Connection conn,<span class="keyword">int</span> pageNumber)</span> </span>&#123;</span><br><span class="line">    String sql = <span class="string">&quot;SELECT * FROM commodity limit ?,5&quot;</span>;</span><br><span class="line">    List&lt;Comm&gt; commList = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        commList = <span class="keyword">super</span>.execQuery(Comm.class, conn, sql,(pageNumber-<span class="number">1</span>) * <span class="number">5</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">        throwables.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> commList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 indexServer，添加分页逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo2</span> <span class="keyword">extends</span> <span class="title">ViewBaseServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取连接</span></span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            <span class="comment">// 实例化方法类</span></span><br><span class="line">            CommServer commServer = <span class="keyword">new</span> CommServer();</span><br><span class="line">            <span class="keyword">int</span> pageNumber = <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// 获取第几页</span></span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isNotEmpty(req.getParameter(<span class="string">&quot;page&quot;</span>)))&#123;</span><br><span class="line">                pageNumber = Integer.parseInt(req.getParameter(<span class="string">&quot;page&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 计算总页数</span></span><br><span class="line">            Long commSize = commServer.getCommSize(conn);</span><br><span class="line">            <span class="keyword">int</span> pageTotal = (<span class="keyword">int</span>)(commSize / <span class="number">5</span> + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            System.out.println(pageTotal+<span class="string">&quot;pageTotal&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取全部数据时添加一个分页</span></span><br><span class="line">            List&lt;Comm&gt; commList = commServer.getAllComm(conn,pageNumber);</span><br><span class="line">            HttpSession session = req.getSession();</span><br><span class="line">            <span class="comment">// 保存數據</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;commlist&quot;</span>,commList);</span><br><span class="line">            <span class="comment">// 保存当前是第几页</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;page&quot;</span>,pageNumber);</span><br><span class="line">            <span class="comment">// 保存总页数</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;pageTotal&quot;</span>,pageTotal);</span><br><span class="line">            <span class="keyword">super</span>.processTemplate(<span class="string">&quot;index&quot;</span>,req,resp);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        JdbcUtils.closeConnection(conn,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 index.html 中添加分页按钮</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:onclick</span>=<span class="string">&quot;pageNub(1)&quot;</span> <span class="attr">th:disabled</span>=<span class="string">&quot;|$&#123;session.page == 1&#125;|&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|pageNub($&#123;session.page-1&#125;)|&quot;</span> <span class="attr">th:disabled</span>=<span class="string">&quot;|$&#123;session.page &lt;= 1&#125;|&quot;</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|pageNub($&#123;session.page+1&#125;)|&quot;</span> <span class="attr">th:disabled</span>=<span class="string">&quot;|$&#123;session.page &gt;= session.pageTotal&#125;|&quot;</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:onclick</span>=<span class="string">&quot;|pageNub($&#123;session.pageTotal&#125;)|&quot;</span> <span class="attr">th:disabled</span>=<span class="string">&quot;|$&#123;session.page == session.pageTotal&#125;|&quot;</span>&gt;</span>尾页<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>实现 js 方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pageNub</span>(<span class="params">page</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">window</span>.location.href = <span class="string">&quot;index?page=&quot;</span> + page;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果展示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/javaweb8.gif" alt="javaweb8.gif"></p>
<h3 id="添加模糊查询功能"><a href="#添加模糊查询功能" class="headerlink" title="添加模糊查询功能"></a>添加模糊查询功能</h3><p>首先在 index.html 中添加查询表单</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/index&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;searchtag&quot;</span> <span class="attr">value</span>=<span class="string">&quot;search&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入名称查询&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;session.name&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;查询&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改 indexService </p>
<p>表单提交的是 post 方法，然后再 doPost 方法中去请求 doGet 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo2</span> <span class="keyword">extends</span> <span class="title">ViewBaseServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        doGet(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取session</span></span><br><span class="line">            HttpSession session = req.getSession();</span><br><span class="line">            <span class="comment">// 初始化页码</span></span><br><span class="line">            <span class="keyword">int</span> pageNumber = <span class="number">1</span>;</span><br><span class="line">            String name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="comment">// 如果是通过查询按钮则进入这里</span></span><br><span class="line">            String searchtag = req.getParameter(<span class="string">&quot;searchtag&quot;</span>);</span><br><span class="line">            <span class="comment">// 判断name输入框是否为空</span></span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isNotEmpty(searchtag))&#123;</span><br><span class="line">                name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                session.setAttribute(<span class="string">&quot;name&quot;</span>,name);</span><br><span class="line">                pageNumber = <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                name = (String) session.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 获取连接</span></span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            <span class="comment">// 实例化方法类</span></span><br><span class="line">            CommServer commServer = <span class="keyword">new</span> CommServer();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取第几页</span></span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isNotEmpty(req.getParameter(<span class="string">&quot;page&quot;</span>)))&#123;</span><br><span class="line">                pageNumber = Integer.parseInt(req.getParameter(<span class="string">&quot;page&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 计算总页数</span></span><br><span class="line">            Long commSize = commServer.getCommSize(conn,name);</span><br><span class="line">            <span class="keyword">int</span> pageTotal = (<span class="keyword">int</span>)((commSize - <span class="number">1</span>) / <span class="number">5</span> + <span class="number">1</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;总页数是&quot;</span> + pageTotal);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取全部数据时添加一个分页</span></span><br><span class="line">            List&lt;Comm&gt; commList = commServer.getAllComm(conn,pageNumber,name);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 保存數據</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;commlist&quot;</span>,commList);</span><br><span class="line">            <span class="comment">// 保存当前是第几页</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;page&quot;</span>,pageNumber);</span><br><span class="line">            <span class="comment">// 保存总页数</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;pageTotal&quot;</span>,pageTotal);</span><br><span class="line">            <span class="keyword">super</span>.processTemplate(<span class="string">&quot;index&quot;</span>,req,resp);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        JdbcUtils.closeConnection(conn,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为添加了查询字段，所以要同时修改 SQL 语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/4/12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Comm&gt; <span class="title">getAllComm</span><span class="params">(Connection conn,<span class="keyword">int</span> pageNumber,String keyword)</span> </span>&#123;</span><br><span class="line">    String sql = <span class="string">&quot;SELECT * FROM commodity where name like ? limit ?,5&quot;</span>;</span><br><span class="line">    List&lt;Comm&gt; commList = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        commList = <span class="keyword">super</span>.execQuery(Comm.class, conn, sql,<span class="string">&quot;%&quot;</span> + keyword + <span class="string">&quot;%&quot;</span>,(pageNumber-<span class="number">1</span>) * <span class="number">5</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">        throwables.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> commList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询数据总条数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/4/12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">getCommSize</span><span class="params">(Connection conn,String keyword)</span> </span>&#123;</span><br><span class="line">    String sql = <span class="string">&quot;select count(*) from commodity where name like ?&quot;</span>;</span><br><span class="line">    <span class="keyword">long</span> l = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        l = <span class="keyword">super</span>.execQuerySize(conn, sql,<span class="string">&quot;%&quot;</span> + keyword + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">        throwables.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果展示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-04-12_16-32-08.png" alt="Snipaste_2022-04-12_16-32-08.png"></p>
<h2 id="Servlet-Mvc"><a href="#Servlet-Mvc" class="headerlink" title="Servlet Mvc"></a>Servlet Mvc</h2><h3 id="优化1"><a href="#优化1" class="headerlink" title="优化1"></a>优化1</h3><p>我们通过上面的案例可以看到每次实现一个功能是都要新建一个 Servlet，当我们功能特别多时就要新建很多的文件。造成代码不好维护</p>
<p>我们可以吧多个 servlet 合并到一个文件中，实现代码如下</p>
<p>在这个方法类中我们只有一个 WebServlet，地址为 comm.do ，然后通过获取请求的参数 sercode 的值来调用不同的方法来实现一个接口完成多个功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/comm.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">commService</span> <span class="keyword">extends</span> <span class="title">ViewBaseServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 首先什么一个字符串默认指向index</span></span><br><span class="line">        String sercode = <span class="string">&quot;index&quot;</span>;</span><br><span class="line">        <span class="comment">// 从请求中获取参数判断请求的是那个方法</span></span><br><span class="line">        String sercode1 = req.getParameter(<span class="string">&quot;sercode&quot;</span>);</span><br><span class="line">        <span class="comment">// 判断是否为空</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotEmpty(sercode1))&#123;</span><br><span class="line">            sercode = sercode1;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 根据请求参数来调用不同的方法</span></span><br><span class="line">        <span class="keyword">switch</span> (sercode)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;index&quot;</span>:</span><br><span class="line">                index(req,resp);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;delete&quot;</span>:</span><br><span class="line">                delete(req,resp);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;edit&quot;</span>:</span><br><span class="line">                edit(req,resp);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;update&quot;</span>:</span><br><span class="line">                update(req,resp);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;showadd&quot;</span>:</span><br><span class="line">                showadd(req,resp);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;saveadd&quot;</span>:</span><br><span class="line">                saveadd(req,resp);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 首页方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">index</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取session</span></span><br><span class="line">            HttpSession session = req.getSession();</span><br><span class="line">            <span class="comment">// 初始化页码</span></span><br><span class="line">            <span class="keyword">int</span> pageNumber = <span class="number">1</span>;</span><br><span class="line">            String name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="comment">// 如果是通过查询按钮则进入这里</span></span><br><span class="line">            String searchtag = req.getParameter(<span class="string">&quot;searchtag&quot;</span>);</span><br><span class="line">            <span class="comment">// 判断name输入框是否为空</span></span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isNotEmpty(searchtag))&#123;</span><br><span class="line">                name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                session.setAttribute(<span class="string">&quot;name&quot;</span>,name);</span><br><span class="line">                pageNumber = <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                Object name1 = session.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span>(name1 != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    name = (String) name1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 获取连接</span></span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            <span class="comment">// 实例化方法类</span></span><br><span class="line">            CommServer commServer = <span class="keyword">new</span> CommServer();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取第几页</span></span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isNotEmpty(req.getParameter(<span class="string">&quot;page&quot;</span>)))&#123;</span><br><span class="line">                pageNumber = Integer.parseInt(req.getParameter(<span class="string">&quot;page&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 计算总页数</span></span><br><span class="line">            Long commSize = commServer.getCommSize(conn,name);</span><br><span class="line">            <span class="keyword">int</span> pageTotal = (<span class="keyword">int</span>)((commSize - <span class="number">1</span>) / <span class="number">5</span> + <span class="number">1</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;总页数是&quot;</span> + pageTotal);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取全部数据时添加一个分页</span></span><br><span class="line">            List&lt;Comm&gt; commList = commServer.getAllComm(conn,pageNumber,name);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 保存數據</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;commlist&quot;</span>,commList);</span><br><span class="line">            <span class="comment">// 保存当前是第几页</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;page&quot;</span>,pageNumber);</span><br><span class="line">            <span class="comment">// 保存总页数</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;pageTotal&quot;</span>,pageTotal);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">super</span>.processTemplate(<span class="string">&quot;index&quot;</span>,req,resp);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        JdbcUtils.closeConnection(conn,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取参数删除带过来的参数id</span></span><br><span class="line">        String id = req.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotEmpty(id))&#123;</span><br><span class="line">            <span class="keyword">int</span> aId = Integer.parseInt(id);</span><br><span class="line">            Connection conn = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn = JdbcUtils.getConnection();</span><br><span class="line">                CommServer server = <span class="keyword">new</span> CommServer();</span><br><span class="line">                <span class="comment">// 执行删除方法</span></span><br><span class="line">                server.deleteCommById(conn,aId);</span><br><span class="line">                <span class="comment">// 浏览器重定向到首页重新渲染</span></span><br><span class="line">                resp.sendRedirect(<span class="string">&quot;comm.do&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">                throwables.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查看详情</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">edit</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 从路径中获取参数</span></span><br><span class="line">            String id = req.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="keyword">int</span> anInt = Integer.parseInt(id);</span><br><span class="line">            CommServer server = <span class="keyword">new</span> CommServer();</span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            <span class="comment">// 根据id获取数据</span></span><br><span class="line">            Comm comm = server.getCommById(conn, anInt);</span><br><span class="line">            <span class="comment">// 把数据保存在session中</span></span><br><span class="line">            req.getSession().setAttribute(<span class="string">&quot;commEdit&quot;</span>,comm);</span><br><span class="line">            <span class="comment">// 显示edit页面</span></span><br><span class="line">            <span class="keyword">super</span>.processTemplate(<span class="string">&quot;edit&quot;</span>,req,resp);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.closeConnection(conn,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.设置编码类型</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取参数id</span></span><br><span class="line">            String id = req.getParameter(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="keyword">int</span> anInt = Integer.parseInt(id);</span><br><span class="line">            <span class="comment">// 获取参数name</span></span><br><span class="line">            String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="comment">// 获取参数price</span></span><br><span class="line">            String price = req.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">            <span class="keyword">double</span> aDouble = Double.parseDouble(price);</span><br><span class="line">            <span class="comment">// 获取参数number</span></span><br><span class="line">            String number = req.getParameter(<span class="string">&quot;number&quot;</span>);</span><br><span class="line">            <span class="keyword">int</span> aNumber = Integer.parseInt(number);</span><br><span class="line">            <span class="comment">// 获取连接</span></span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            <span class="comment">// 封装comm对象</span></span><br><span class="line">            Comm comm = <span class="keyword">new</span> Comm(anInt, name, aDouble, aNumber);</span><br><span class="line">            <span class="comment">// 实例化调用接口类</span></span><br><span class="line">            CommServer server = <span class="keyword">new</span> CommServer();</span><br><span class="line">            <span class="comment">// 执行更新方法</span></span><br><span class="line">            server.updateCommById(conn,comm);</span><br><span class="line">            <span class="comment">// 让浏览器重定向到index，重新渲染页面</span></span><br><span class="line">            resp.sendRedirect(<span class="string">&quot;comm.do&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.closeConnection(conn,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示添加页面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showadd</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.processTemplate(<span class="string">&quot;add&quot;</span>,req,resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 确认添加方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">saveadd</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 设置字符串编码</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取表单参数</span></span><br><span class="line">        String name = req.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        String price = req.getParameter(<span class="string">&quot;price&quot;</span>);</span><br><span class="line">        <span class="keyword">double</span> dprice = Double.parseDouble(price);</span><br><span class="line">        String number = req.getParameter(<span class="string">&quot;number&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> inumber = Integer.parseInt(number);</span><br><span class="line">        <span class="comment">// 创建 comm 实例</span></span><br><span class="line">        Comm comm = <span class="keyword">new</span> Comm(name, dprice, inumber);</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            CommServer server = <span class="keyword">new</span> CommServer();</span><br><span class="line">            <span class="comment">// 执行添加方法</span></span><br><span class="line">            server.addComm(conn,comm);</span><br><span class="line">            <span class="comment">// 浏览器重定向到首页</span></span><br><span class="line">            resp.sendRedirect(<span class="string">&quot;comm.do&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.closeConnection(conn,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="优化2"><a href="#优化2" class="headerlink" title="优化2"></a>优化2</h3><p>上面我们使用的是 Switch case 来判断参数调用方法，我们可以通过反射来获取，避免大量的判断</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过反射来动态调用方法名</span></span><br><span class="line">Method[] declaredMethods = <span class="keyword">this</span>.getClass().getDeclaredMethods();</span><br><span class="line"><span class="keyword">for</span> (Method method : declaredMethods) &#123;</span><br><span class="line">    String name = method.getName();</span><br><span class="line">    <span class="keyword">if</span>(sercode.equals(name))&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            method.invoke(<span class="keyword">this</span>,req,resp);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="最终优化版本"><a href="#最终优化版本" class="headerlink" title="最终优化版本"></a>最终优化版本</h3><p>我们将 commService 当成一个普通的类来使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.songzx.demo01;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.songzx.comm.Comm;</span><br><span class="line"><span class="keyword">import</span> com.songzx.dao.CommServer;</span><br><span class="line"><span class="keyword">import</span> com.songzx.utils.JdbcUtils;</span><br><span class="line"><span class="keyword">import</span> com.songzx.utils.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-04-13 12:01</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">commService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 首页方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(String searchtag,String name,Integer page, HttpServletRequest req)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 如果传进来的页码是null，则默认为1</span></span><br><span class="line">            <span class="keyword">if</span>(page == <span class="keyword">null</span>)&#123;</span><br><span class="line">                page = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 获取session</span></span><br><span class="line">            HttpSession session = req.getSession();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 判断name输入框是否为空</span></span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isNotEmpty(searchtag))&#123;</span><br><span class="line">                session.setAttribute(<span class="string">&quot;name&quot;</span>,name);</span><br><span class="line">                page = <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                Object name1 = session.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span>(name1 != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    name = (String) name1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 获取连接</span></span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            <span class="comment">// 实例化方法类</span></span><br><span class="line">            CommServer commServer = <span class="keyword">new</span> CommServer();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 计算总页数</span></span><br><span class="line">            Long commSize = commServer.getCommSize(conn,name);</span><br><span class="line">            <span class="keyword">int</span> pageTotal = (<span class="keyword">int</span>)((commSize - <span class="number">1</span>) / <span class="number">5</span> + <span class="number">1</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;总页数是&quot;</span> + pageTotal);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取全部数据时添加一个分页</span></span><br><span class="line">            List&lt;Comm&gt; commList = commServer.getAllComm(conn,page,name);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 保存數據</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;commlist&quot;</span>,commList);</span><br><span class="line">            <span class="comment">// 保存当前是第几页</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;page&quot;</span>,page);</span><br><span class="line">            <span class="comment">// 保存总页数</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;pageTotal&quot;</span>,pageTotal);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.closeConnection(conn,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取参数删除带过来的参数id</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotEmpty(id))&#123;</span><br><span class="line">            <span class="keyword">int</span> aId = Integer.parseInt(id);</span><br><span class="line">            Connection conn = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn = JdbcUtils.getConnection();</span><br><span class="line">                CommServer server = <span class="keyword">new</span> CommServer();</span><br><span class="line">                <span class="comment">// 执行删除方法</span></span><br><span class="line">                server.deleteCommById(conn,aId);</span><br><span class="line">                <span class="comment">// 浏览器重定向到首页重新渲染</span></span><br><span class="line">                <span class="comment">// resp.sendRedirect(&quot;comm.do&quot;);</span></span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;direct:comm.do&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">                throwables.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查看详情</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">(String id, HttpServletRequest req)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;id = &quot;</span> + id);</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> anInt = Integer.parseInt(id);</span><br><span class="line">            CommServer server = <span class="keyword">new</span> CommServer();</span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            <span class="comment">// 根据id获取数据</span></span><br><span class="line">            Comm comm = server.getCommById(conn, anInt);</span><br><span class="line">            <span class="comment">// 把数据保存在session中</span></span><br><span class="line">            req.getSession().setAttribute(<span class="string">&quot;commEdit&quot;</span>,comm);</span><br><span class="line">            <span class="comment">// 显示edit页面</span></span><br><span class="line">            <span class="comment">// super.processTemplate(&quot;edit&quot;,req,resp);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;edit&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.closeConnection(conn,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">(String id,String name,String price,String number, HttpServletRequest req)</span> <span class="keyword">throws</span>  IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.设置编码类型</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> anInt = Integer.parseInt(id);</span><br><span class="line">            <span class="keyword">double</span> aDouble = Double.parseDouble(price);</span><br><span class="line">            <span class="keyword">int</span> aNumber = Integer.parseInt(number);</span><br><span class="line">            <span class="comment">// 获取连接</span></span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            <span class="comment">// 封装comm对象</span></span><br><span class="line">            Comm comm = <span class="keyword">new</span> Comm(anInt, name, aDouble, aNumber);</span><br><span class="line">            <span class="comment">// 实例化调用接口类</span></span><br><span class="line">            CommServer server = <span class="keyword">new</span> CommServer();</span><br><span class="line">            <span class="comment">// 执行更新方法</span></span><br><span class="line">            server.updateCommById(conn,comm);</span><br><span class="line">            <span class="comment">// 让浏览器重定向到index，重新渲染页面</span></span><br><span class="line">            <span class="comment">// resp.sendRedirect(&quot;comm.do&quot;);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;direct:comm.do&quot;</span>;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.closeConnection(conn,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示添加页面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">showadd</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// super.processTemplate(&quot;add&quot;,req,resp);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;add&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 确认添加方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">saveadd</span><span class="params">(String name,String price,String number, HttpServletRequest req)</span> <span class="keyword">throws</span>  IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 设置字符串编码</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="keyword">double</span> dprice = Double.parseDouble(price);</span><br><span class="line">        <span class="keyword">int</span> inumber = Integer.parseInt(number);</span><br><span class="line">        <span class="comment">// 创建 comm 实例</span></span><br><span class="line">        Comm comm = <span class="keyword">new</span> Comm(name, dprice, inumber);</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conn = JdbcUtils.getConnection();</span><br><span class="line">            CommServer server = <span class="keyword">new</span> CommServer();</span><br><span class="line">            <span class="comment">// 执行添加方法</span></span><br><span class="line">            server.addComm(conn,comm);</span><br><span class="line">            <span class="comment">// 浏览器重定向到首页</span></span><br><span class="line">            <span class="comment">// resp.sendRedirect(&quot;comm.do&quot;);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;direct:comm.do&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            JdbcUtils.closeConnection(conn,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写核心控制器，通过读取 xml 配置文件动态匹配调用的类</p>
<p>编写 xml 配置文件 applicationConentext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    说明：xml是可扩展的文本标记语言</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    映射关系：</span></span><br><span class="line"><span class="comment">        1.定义一个父标签 beans</span></span><br><span class="line"><span class="comment">        2.子标签中有id和class，一个id对应一个class对应的server</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    功能：通过请求 xxx.do 中的 xxx，找到对应的 com.songzx.demo01.xxxService</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">benas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;comm&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.songzx.demo01.commService&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">benas</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>新建 DispatcherServlet.java，这里主要步骤</p>
<ul>
<li>使用 <code>@WebServlet(&quot;*.do&quot;)</code> 拦截到所有后缀是 .do 的请求，然后根据请求名称去 xml 中找到对应的类</li>
<li>然后再 <code>service</code> 中获取映射类中的所有方法</li>
<li>通过 <code>req.getParameter(&quot;sercode&quot;);</code> 来判断当前调用的是这个类中的那个方法</li>
<li>之后通过  <code>method.getParameters();</code> 获取这个方法中接收的参数值和参数类型，遍历参数列表从 request 中获取请求中传递过来的值</li>
<li>然后通过 <code>method.invoke(contentObje, parValues);</code>调用这个方法，并传递已经获取到的所有参数值</li>
<li><code>method.invoke</code> 会吧方法的返回值返回，我们根据返回的值做出跳转逻辑判断</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.songzx.myssm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.songzx.utils.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.w3c.dom.*;</span><br><span class="line"><span class="keyword">import</span> org.xml.sax.SAXException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilder;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilderFactory;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.ParserConfigurationException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Parameter;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-04-14 21:29</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;*.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title">ViewBaseServlet</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 声明一个map存储bean的映射</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; beanMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DispatcherServlet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 解析读取xml文件</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取xml文件流</span></span><br><span class="line">            InputStream stream = <span class="keyword">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;applicationConentext.xml&quot;</span>);</span><br><span class="line">            <span class="comment">// 创建DocumentBuilderFactory对象</span></span><br><span class="line">            DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</span><br><span class="line">            <span class="comment">// 创建newDocumentBuilder对象</span></span><br><span class="line">            DocumentBuilder documentBuilder = dbf.newDocumentBuilder();</span><br><span class="line">            <span class="comment">// 创建document对象</span></span><br><span class="line">            Document document = documentBuilder.parse(stream);</span><br><span class="line">            <span class="comment">// 获取所有的bean标签</span></span><br><span class="line">            NodeList nodeList = document.getElementsByTagName(<span class="string">&quot;bean&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nodeList.getLength(); i++)&#123;</span><br><span class="line">                <span class="comment">// 获取单个的bean标签</span></span><br><span class="line">                Node bean = nodeList.item(i);</span><br><span class="line">                <span class="comment">// 判断是否是一个元素标签</span></span><br><span class="line">                <span class="keyword">if</span>(bean.getNodeType() == Node.ELEMENT_NODE)&#123;</span><br><span class="line">                    Element elementNode = (Element) bean;</span><br><span class="line">                    String id = elementNode.getAttribute(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                    String aClass = elementNode.getAttribute(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">                    <span class="comment">// 创建出id影射得到的实例</span></span><br><span class="line">                    Object beanObj = Class.forName(aClass).newInstance();</span><br><span class="line">                    <span class="comment">// 往beanMap中添加数据</span></span><br><span class="line">                    beanMap.put(id,beanObj);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParserConfigurationException | SAXException | ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;请求进来&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置编码</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取请求地址 =&gt; /hello.do -&gt; hello</span></span><br><span class="line">        String path = parseStr(req.getServletPath());</span><br><span class="line">        <span class="comment">// 根据请求的路径获取对应的实例</span></span><br><span class="line">        Object contentObje = beanMap.get(path);</span><br><span class="line">        <span class="comment">// 获取请求方法的标识</span></span><br><span class="line">        String sercode = req.getParameter(<span class="string">&quot;sercode&quot;</span>);</span><br><span class="line">        <span class="comment">// 判断标识符是否是空</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(sercode))&#123;</span><br><span class="line">            sercode = <span class="string">&quot;index&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取实例上的所有方法</span></span><br><span class="line">            Method[] methods = contentObje.getClass().getDeclaredMethods();</span><br><span class="line">            <span class="keyword">for</span> (Method method : methods)&#123;</span><br><span class="line">                <span class="comment">// 确定调用那个方法</span></span><br><span class="line">                <span class="keyword">if</span>(sercode.equals(method.getName()))&#123;</span><br><span class="line">                    method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                    <span class="comment">// 获取当前方法的参数集合</span></span><br><span class="line">                    Parameter[] parameters = method.getParameters();</span><br><span class="line">                    <span class="comment">// 遍历参数集合获取具体的值</span></span><br><span class="line">                    Object[] parValues = <span class="keyword">new</span> Object[parameters.length];</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parameters.length; i++) &#123;</span><br><span class="line">                        Parameter parameter = parameters[i];</span><br><span class="line">                        String name = parameter.getName();</span><br><span class="line">                        <span class="comment">// 特殊值判断</span></span><br><span class="line">                        <span class="keyword">if</span>(<span class="string">&quot;req&quot;</span>.equals(name))&#123;</span><br><span class="line">                            parValues[i] = req;</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;resp&quot;</span>.equals(name))&#123;</span><br><span class="line">                            parValues[i] = resp;</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;session&quot;</span>.equals(name))&#123;</span><br><span class="line">                            parValues[i] = req.getSession();</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            String typeName = parameter.getType().getName();</span><br><span class="line">                            String paraName = req.getParameter(name);</span><br><span class="line">                            parValues[i] = paraName;</span><br><span class="line">                            <span class="keyword">if</span>(<span class="string">&quot;java.lang.Integer&quot;</span>.equals(typeName) &amp;&amp; paraName != <span class="keyword">null</span>)&#123;</span><br><span class="line">                                parValues[i] = Integer.parseInt(paraName);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 获取要重定向的地址</span></span><br><span class="line">                    String directStr = (String) method.invoke(contentObje, parValues);</span><br><span class="line">                    <span class="comment">// 如果返回的地址是以 direct: 开头的表示浏览器重定向</span></span><br><span class="line">                    <span class="keyword">if</span>(directStr.startsWith(<span class="string">&quot;direct:&quot;</span>))&#123;</span><br><span class="line">                        String newDirect = directStr.substring(<span class="string">&quot;direct:&quot;</span>.length());</span><br><span class="line">                        <span class="comment">// 重新向</span></span><br><span class="line">                        resp.sendRedirect(newDirect);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="comment">// 如果不是以direct:开头的表示内部重定向</span></span><br><span class="line">                        <span class="keyword">super</span>.processTemplate(directStr,req,resp);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将 /hello.do 中的 hello 提取出来</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/14</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">parseStr</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> lastIndex = str.lastIndexOf(<span class="string">&quot;.do&quot;</span>);</span><br><span class="line">        String newstr = str.substring(<span class="number">1</span>,lastIndex);</span><br><span class="line">        <span class="keyword">return</span> newstr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，在java jdk1.8 以后，通过 <code>method.getParameters();</code> 可以获取到参数的具体名称，不再是 <code>arg0</code>，但是要设置一下，具体设置参数如下</p>
<p>添加 -parameters</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-04-20_17-05-22.png" alt="Snipaste_2022-04-20_17-05-22.png"></p>
<h2 id="Servlet常用APi"><a href="#Servlet常用APi" class="headerlink" title="Servlet常用APi"></a>Servlet常用APi</h2><h3 id="读取初始化参数-getInitParameter"><a href="#读取初始化参数-getInitParameter" class="headerlink" title="读取初始化参数 getInitParameter"></a>读取初始化参数 getInitParameter</h3><p>获取初始化参数，<code>getServletConfig</code> 使用方法</p>
<p>配置 XML 文件代码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo01<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.songzx.Servlet.demo01<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 初始化 param 参数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>uname<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>height<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>188<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo01<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/demo01<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>编写java代码，继承 HttpServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo01</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.获取 config 对象</span></span><br><span class="line">        ServletConfig config = getServletConfig();</span><br><span class="line">        <span class="comment">// 2.读取配置的参数 key</span></span><br><span class="line">        String uname = config.getInitParameter(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;uname = &quot;</span> + uname);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 可以读取多个</span></span><br><span class="line">        String height = config.getInitParameter(<span class="string">&quot;height&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;height = &quot;</span> + height);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面除了通过 XML 配置外也可以通过注解的方式来配置初始化参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(urlPatterns = &#123;&quot;/demo01&quot;&#125;,initParams = &#123;</span></span><br><span class="line"><span class="meta">        @WebInitParam(name = &quot;uname&quot;,value = &quot;张三&quot;),</span></span><br><span class="line"><span class="meta">        @WebInitParam(name = &quot;height&quot;,value = &quot;188&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo01</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.获取 config 对象</span></span><br><span class="line">        ServletConfig config = getServletConfig();</span><br><span class="line">        <span class="comment">// 2.读取配置的参数 key</span></span><br><span class="line">        String uname = config.getInitParameter(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;uname = &quot;</span> + uname);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2 可以读取多个</span></span><br><span class="line">        String height = config.getInitParameter(<span class="string">&quot;height&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;height = &quot;</span> + height);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.读取 Context</span></span><br><span class="line">        ServletContext context = getServletContext();</span><br><span class="line">        String contextName = context.getInitParameter(<span class="string">&quot;contextName&quot;</span>);</span><br><span class="line">        <span class="comment">// contextName = classpath:com.songzx.Servlet.demo01</span></span><br><span class="line">        System.out.println(<span class="string">&quot;contextName = &quot;</span> + contextName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行获取</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-04-20_18-23-42.png" alt="Snipaste_2022-04-20_18-23-42.png"></p>
<h3 id="获取上下文-getServletContext"><a href="#获取上下文-getServletContext" class="headerlink" title="获取上下文 getServletContext"></a>获取上下文 getServletContext</h3><p>获取对象上下文，在初始化 init 方法中调用 getServletContext 方法</p>
<p>配置 XML 文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 初始化 context 参数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextName<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:com.songzx.Servlet.demo01<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo01<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.songzx.Servlet.demo01<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo01<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/demo01<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>编写java代码获取</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo01</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        <span class="comment">// 3.读取 Context</span></span><br><span class="line">        ServletContext context = getServletContext();</span><br><span class="line">        String contextName = context.getInitParameter(<span class="string">&quot;contextName&quot;</span>);</span><br><span class="line">        <span class="comment">//=&gt; contextName = classpath:com.songzx.Servlet.demo01</span></span><br><span class="line">        System.out.println(<span class="string">&quot;contextName = &quot;</span> + contextName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="初识MVC"><a href="#初识MVC" class="headerlink" title="初识MVC"></a>初识MVC</h2><p>MVC：Model（模型），View（视图），Controller（控制器）</p>
<p>视图层：用于做数据展示以及和用户交互的界面</p>
<p>控制层：能够接收客户端的请求，具体的业务功能呢还要借助模型组件来完成</p>
<p>模型层：模型分为很多种，有比较简单的pojo，vo（value，object），有业务模型组件，有数据访问层</p>
<ul>
<li>pojo/vo：值对象</li>
<li>DAO：数据访问对象</li>
<li>BO：业务对象</li>
</ul>
<p>区分业务对象和数据访问对象</p>
<ul>
<li>BAO中的方法都是单精度的或者称为细粒度的。什么是单精度：一个方法只考虑一个操作，例如增删改查方法，只考虑层增删改查</li>
<li>BO中的方法属于业务方法，属于粗粒度的。一个业务方法中会包含多个BAO方法：例如注册业务<ul>
<li>首先要检查该用户是否已经注册，调用BAO中的select方法</li>
<li>然后往用户表中增加一条信息，调用BAO中的insert方法</li>
<li>往用户积分表中增加一条数据，新用户默认100积分，调用BAO中的insert方法</li>
<li>其他方法……</li>
</ul>
</li>
</ul>
<h2 id="改造水果管理系统，增加业务层"><a href="#改造水果管理系统，增加业务层" class="headerlink" title="改造水果管理系统，增加业务层"></a>改造水果管理系统，增加业务层</h2><p>添加一个接口 <code>commServer</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">commServer</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> keyword</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageNub</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;Comm&gt; <span class="title">getCommList</span><span class="params">(String keyword,Integer pageNub)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Comm <span class="title">getCommById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addComm</span><span class="params">(Comm comm)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteCommById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateCommById</span><span class="params">(Comm comm)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Integer <span class="title">getPageCount</span><span class="params">(String keyword)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加这个接口的实现类 <code>package com.songzx.service.imp.commServiceImp;</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">commServiceImp</span> <span class="keyword">implements</span> <span class="title">commServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 声明数据访问对象</span></span><br><span class="line">    <span class="keyword">private</span> CommDao commDao = <span class="keyword">new</span> CommDao();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取连接的conn</span></span><br><span class="line">    <span class="keyword">private</span> Connection conn = JdbcUtils.getConnection();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">commServiceImp</span><span class="params">()</span> <span class="keyword">throws</span> SQLException, ClassNotFoundException </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Comm&gt; <span class="title">getCommList</span><span class="params">(String keyword, Integer pageNub)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> commDao.getAllComm(conn,pageNub,keyword);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Comm <span class="title">getCommById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> commDao.getCommById(conn,id);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addComm</span><span class="params">(Comm comm)</span> </span>&#123;</span><br><span class="line">        commDao.addComm(conn,comm);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteCommById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        commDao.deleteCommById(conn,id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateCommById</span><span class="params">(Comm comm)</span> </span>&#123;</span><br><span class="line">        commDao.updateCommById(conn,comm);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getPageCount</span><span class="params">(String keyword)</span> </span>&#123;</span><br><span class="line">        Long commSize = commDao.getCommSize(conn, keyword);</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>)((commSize - <span class="number">1</span>) / <span class="number">5</span> + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后将原本的  commService 重命名为 commController，并引入 commServiceImp</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">commController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> commServiceImp server = <span class="keyword">new</span> commServiceImp();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 首页方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(String searchtag,String name,Integer page, HttpServletRequest req)</span></span>&#123;</span><br><span class="line">                <span class="comment">// 如果传进来的页码是null，则默认为1</span></span><br><span class="line">        <span class="keyword">if</span>(page == <span class="keyword">null</span>)&#123;</span><br><span class="line">            page = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取session</span></span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断name输入框是否为空</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotEmpty(searchtag))&#123;</span><br><span class="line">            session.setAttribute(<span class="string">&quot;name&quot;</span>,name);</span><br><span class="line">            page = <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            Object name1 = session.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(name1 != <span class="keyword">null</span>)&#123;</span><br><span class="line">                name = (String) name1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 计算总页数</span></span><br><span class="line">        <span class="keyword">int</span> pageTotal = server.getPageCount(name);</span><br><span class="line">        System.out.println(<span class="string">&quot;总页数是&quot;</span> + pageTotal);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取全部数据时添加一个分页</span></span><br><span class="line">        List&lt;Comm&gt; commList = server.getCommList(name,page);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存數據</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;commlist&quot;</span>,commList);</span><br><span class="line">        <span class="comment">// 保存当前是第几页</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;page&quot;</span>,page);</span><br><span class="line">        <span class="comment">// 保存总页数</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;pageTotal&quot;</span>,pageTotal);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> aId = Integer.parseInt(id);</span><br><span class="line">        <span class="comment">// 执行删除方法</span></span><br><span class="line">        server.deleteCommById(aId);</span><br><span class="line">        <span class="comment">// 浏览器重定向到首页重新渲染</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;direct:comm.do&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查看详情</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">(String id, HttpServletRequest req)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> anInt = Integer.parseInt(id);</span><br><span class="line">        <span class="comment">// 根据id获取数据</span></span><br><span class="line">        Comm comm = server.getCommById(anInt);</span><br><span class="line">        <span class="comment">// 把数据保存在session中</span></span><br><span class="line">        req.getSession().setAttribute(<span class="string">&quot;commEdit&quot;</span>,comm);</span><br><span class="line">        <span class="comment">// 显示edit页面</span></span><br><span class="line">        <span class="comment">// super.processTemplate(&quot;edit&quot;,req,resp);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;edit&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update</span><span class="params">(String id,String name,String price,String number, HttpServletRequest req)</span> <span class="keyword">throws</span>  IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 1.设置编码类型</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> anInt = Integer.parseInt(id);</span><br><span class="line">        <span class="keyword">double</span> aDouble = Double.parseDouble(price);</span><br><span class="line">        <span class="keyword">int</span> aNumber = Integer.parseInt(number);</span><br><span class="line">        <span class="comment">// 封装comm对象</span></span><br><span class="line">        Comm comm = <span class="keyword">new</span> Comm(anInt, name, aDouble, aNumber);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行更新方法</span></span><br><span class="line">        server.updateCommById(comm);</span><br><span class="line">        <span class="comment">// 让浏览器重定向到index，重新渲染页面</span></span><br><span class="line">        <span class="comment">// resp.sendRedirect(&quot;comm.do&quot;);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;direct:comm.do&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示添加页面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">showadd</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// super.processTemplate(&quot;add&quot;,req,resp);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;add&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 确认添加方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/13</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">saveadd</span><span class="params">(String name,String price,String number, HttpServletRequest req)</span> <span class="keyword">throws</span>  IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 设置字符串编码</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="keyword">double</span> dprice = Double.parseDouble(price);</span><br><span class="line">        <span class="keyword">int</span> inumber = Integer.parseInt(number);</span><br><span class="line">        <span class="comment">// 创建 comm 实例</span></span><br><span class="line">        Comm comm = <span class="keyword">new</span> Comm(name, dprice, inumber);</span><br><span class="line">        <span class="comment">// 执行添加方法</span></span><br><span class="line">        server.addComm(comm);</span><br><span class="line">        <span class="comment">// 浏览器重定向到首页</span></span><br><span class="line">        <span class="comment">// resp.sendRedirect(&quot;comm.do&quot;);</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;direct:comm.do&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样我们的业务层就添加进来了</p>
<h2 id="实现控制翻转和依赖注入"><a href="#实现控制翻转和依赖注入" class="headerlink" title="实现控制翻转和依赖注入"></a>实现控制翻转和依赖注入</h2><p>上面的代码中我们在  commController 中引用了 commServiceImp</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-04-21_17-44-41.png" alt="Snipaste_2022-04-21_17-44-41.png"></p>
<p>然后再 commServiceImp 中已用了 commDao</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-04-21_17-44-14.png" alt="Snipaste_2022-04-21_17-44-14.png"></p>
<p>这种情况在实际开发中并不推荐</p>
<p>在实际开发中我们追求高内聚，低耦合，一个类只处理和自己本身业务相关的事情，尽量不和别的模块发生关系，下面我们就通过配置XML的方式来改变这种耦合</p>
<p>在 applicationConentext.xml 文件中添加代码，在xml中声明了每个类的地址和引用属性名</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">benas</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;comm&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.songzx.controller.commController&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- property 声明了这个bean中引用的依赖，name表示声明的属性名，ref表示bean的id名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;server&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;commService&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;commService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.songzx.service.imp.commServiceImp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;commDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;commDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;commDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.songzx.dao.CommDao&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">benas</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>  然后新建 <code>com.songzx.io.beanFactory</code> 接口，根据benaid获取对应的class实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">beanFactory</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 根据benaid获取对应的class实例</span></span><br><span class="line">    <span class="function">Object <span class="title">getBean</span><span class="params">(String id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建接口实现类 <code>BeanFactoryImp</code> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanFactoryImp</span> <span class="keyword">implements</span> <span class="title">beanFactory</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;String,Object&gt; benaMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanFactoryImp</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 解析读取xml文件</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取xml文件流</span></span><br><span class="line">            InputStream stream = <span class="keyword">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;applicationConentext.xml&quot;</span>);</span><br><span class="line">            <span class="comment">// 创建DocumentBuilderFactory对象</span></span><br><span class="line">            DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</span><br><span class="line">            <span class="comment">// 创建newDocumentBuilder对象</span></span><br><span class="line">            DocumentBuilder documentBuilder = dbf.newDocumentBuilder();</span><br><span class="line">            <span class="comment">// 创建document对象</span></span><br><span class="line">            Document document = documentBuilder.parse(stream);</span><br><span class="line">            <span class="comment">// 获取所有的bean标签</span></span><br><span class="line">            NodeList nodeList = document.getElementsByTagName(<span class="string">&quot;bean&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取所有的bean对象</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nodeList.getLength(); i++)&#123;</span><br><span class="line">                <span class="comment">// 获取单个的bean标签</span></span><br><span class="line">                Node bean = nodeList.item(i);</span><br><span class="line">                <span class="comment">// 判断是否是一个元素标签</span></span><br><span class="line">                <span class="keyword">if</span>(bean.getNodeType() == Node.ELEMENT_NODE)&#123;</span><br><span class="line">                    Element elementNode = (Element) bean;</span><br><span class="line">                    String id = elementNode.getAttribute(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                    String aClass = elementNode.getAttribute(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">                    <span class="comment">// 创建出id影射得到的实例</span></span><br><span class="line">                    Object beanObj = Class.forName(aClass).newInstance();</span><br><span class="line">                    <span class="comment">// 将bena对象的实例保存到map容器中</span></span><br><span class="line">                    benaMap.put(id,beanObj);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 处理bena中间的依赖，并且实施依赖注入</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i =<span class="number">0</span>; i &lt; nodeList.getLength(); i++)&#123;</span><br><span class="line">                <span class="comment">// 获取单个的bean标签</span></span><br><span class="line">                Node bean = nodeList.item(i);</span><br><span class="line">                <span class="comment">// 判断是否是一个元素标签</span></span><br><span class="line">                <span class="keyword">if</span>(bean.getNodeType() == Node.ELEMENT_NODE)&#123;</span><br><span class="line">                    <span class="comment">// 将benaNode强转为一个元素</span></span><br><span class="line">                    Element elementNode = (Element) bean;</span><br><span class="line">                    <span class="comment">// 获取当前bena的id</span></span><br><span class="line">                    String id = elementNode.getAttribute(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                    <span class="comment">// 获取 bena 标签的子元素</span></span><br><span class="line">                    NodeList childNodes = elementNode.getChildNodes();</span><br><span class="line">                    <span class="comment">// 遍历子元素</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; childNodes.getLength(); j++) &#123;</span><br><span class="line">                        Node childItem = childNodes.item(j);</span><br><span class="line">                        <span class="keyword">if</span>(childItem.getNodeType() == Node.ELEMENT_NODE)&#123;</span><br><span class="line">                            Element eleChildNode = (Element) childItem;</span><br><span class="line">                            <span class="comment">// 获取引用属性的属性值</span></span><br><span class="line">                            String proName = eleChildNode.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                            <span class="comment">// 获取引用组件的ref名</span></span><br><span class="line">                            String proRef = eleChildNode.getAttribute(<span class="string">&quot;ref&quot;</span>);</span><br><span class="line">                            <span class="comment">// 获取引用组件的对象</span></span><br><span class="line">                            Object proObj = benaMap.get(proRef);</span><br><span class="line">                            <span class="comment">// 获取自身组件对象</span></span><br><span class="line">                            Object beanObj = benaMap.get(id);</span><br><span class="line">                            <span class="comment">// 通过反射获取声明的属性名</span></span><br><span class="line">                            Field beanKeyField = beanObj.getClass().getDeclaredField(proName);</span><br><span class="line">                            beanKeyField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                            <span class="comment">// 将引用组件的实例赋值给属性</span></span><br><span class="line">                            beanKeyField.set(beanObj,proObj);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParserConfigurationException | SAXException | ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getBean</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> benaMap.get(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后把核心控制器中关系解析 xml 的代码删除掉，修改 <code>DispatcherServlet</code> 类，去掉初始化的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;*.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DispatcherServlet</span> <span class="keyword">extends</span> <span class="title">ViewBaseServlet</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建读取xml和依赖注入的类</span></span><br><span class="line">    <span class="keyword">private</span> BeanFactoryImp beanMap = <span class="keyword">new</span> BeanFactoryImp();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;请求进来&quot;</span>);</span><br><span class="line">        <span class="comment">// 设置编码</span></span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取请求地址 =&gt; /hello.do -&gt; hello</span></span><br><span class="line">        String path = parseStr(req.getServletPath());</span><br><span class="line">        <span class="comment">// 根据请求的路径获取对应的实例</span></span><br><span class="line">        Object contentObje = beanMap.getBean(path);</span><br><span class="line">        <span class="comment">// 获取请求方法的标识</span></span><br><span class="line">        String sercode = req.getParameter(<span class="string">&quot;sercode&quot;</span>);</span><br><span class="line">        <span class="comment">// 判断标识符是否是空</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(sercode))&#123;</span><br><span class="line">            sercode = <span class="string">&quot;index&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取实例上的所有方法</span></span><br><span class="line">            Method[] methods = contentObje.getClass().getDeclaredMethods();</span><br><span class="line">            <span class="keyword">for</span> (Method method : methods)&#123;</span><br><span class="line">                <span class="comment">// 确定调用那个方法</span></span><br><span class="line">                <span class="keyword">if</span>(sercode.equals(method.getName()))&#123;</span><br><span class="line">                    method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                    <span class="comment">// 获取当前方法的参数集合</span></span><br><span class="line">                    Parameter[] parameters = method.getParameters();</span><br><span class="line">                    <span class="comment">// 遍历参数集合获取具体的值</span></span><br><span class="line">                    Object[] parValues = <span class="keyword">new</span> Object[parameters.length];</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parameters.length; i++) &#123;</span><br><span class="line">                        Parameter parameter = parameters[i];</span><br><span class="line">                        String name = parameter.getName();</span><br><span class="line">                        <span class="comment">// 特殊值判断</span></span><br><span class="line">                        <span class="keyword">if</span>(<span class="string">&quot;req&quot;</span>.equals(name))&#123;</span><br><span class="line">                            parValues[i] = req;</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;resp&quot;</span>.equals(name))&#123;</span><br><span class="line">                            parValues[i] = resp;</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;session&quot;</span>.equals(name))&#123;</span><br><span class="line">                            parValues[i] = req.getSession();</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            String typeName = parameter.getType().getName();</span><br><span class="line">                            String paraName = req.getParameter(name);</span><br><span class="line">                            parValues[i] = paraName;</span><br><span class="line">                            <span class="keyword">if</span>(<span class="string">&quot;java.lang.Integer&quot;</span>.equals(typeName) &amp;&amp; paraName != <span class="keyword">null</span>)&#123;</span><br><span class="line">                                parValues[i] = Integer.parseInt(paraName);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 获取要重定向的地址</span></span><br><span class="line">                    String directStr = (String) method.invoke(contentObje, parValues);</span><br><span class="line">                    <span class="comment">// 如果返回的地址是以 direct: 开头的表示浏览器重定向</span></span><br><span class="line">                    <span class="keyword">if</span>(directStr.startsWith(<span class="string">&quot;direct:&quot;</span>))&#123;</span><br><span class="line">                        String newDirect = directStr.substring(<span class="string">&quot;direct:&quot;</span>.length());</span><br><span class="line">                        <span class="comment">// 重新向</span></span><br><span class="line">                        resp.sendRedirect(newDirect);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="comment">// 如果不是以direct:开头的表示内部重定向</span></span><br><span class="line">                        <span class="keyword">super</span>.processTemplate(directStr,req,resp);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将 /hello.do 中的 hello 提取出来</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/14</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">parseStr</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> lastIndex = str.lastIndexOf(<span class="string">&quot;.do&quot;</span>);</span><br><span class="line">        String newstr = str.substring(<span class="number">1</span>,lastIndex);</span><br><span class="line">        <span class="keyword">return</span> newstr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><p>过滤的作用会在请求时进行拦截一次，然后放行，响应回来后再次拦截</p>
<ul>
<li>请求拦截</li>
<li>放行</li>
<li>响应拦截</li>
</ul>
<p>要实现过滤器，需要在类中实现 <code>Filter</code> 接口，<code>Filter</code> 有三个方法，表示过滤器的声明周期</p>
<ul>
<li><code>init</code> 初始化</li>
<li><code>doFilter</code> 拦截服务</li>
<li><code>destroy</code> 销毁</li>
</ul>
<p>实现过滤器</p>
<p>添加 <code>service1</code> 类，作为我们的 <code>WebServlet</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo1.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">service1</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;demo01 Service...&quot;</span>);</span><br><span class="line">        <span class="comment">// 跳转到 hello.html 页面</span></span><br><span class="line">        req.getRequestDispatcher(<span class="string">&quot;hello.html&quot;</span>).forward(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建 <code>Filter</code> 的实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;/demo1.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">filter1</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        <span class="comment">// 请求时拦截</span></span><br><span class="line">        System.out.println(<span class="string">&quot;请求拦截&quot;</span>);</span><br><span class="line">        <span class="comment">// 放行</span></span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">        <span class="comment">// 详情回来后拦截</span></span><br><span class="line">        System.out.println(<span class="string">&quot;响应拦截&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的注解声明为 <code>@WebFilter(&quot;/demo1.do&quot;)</code> ,要和 <code>@WebServlet(&quot;/demo1.do&quot;)</code> 同名，这样才能起到这个接口的拦截作用</p>
<p>然后启动服务，查看打印的顺序</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-04-21_18-12-32.png" alt="Snipaste_2022-04-21_18-12-32.png"></p>
<p>除了设置单个过滤器，也可以设置过滤器链，表示一个接口有多个过滤器</p>
<p>分别新建 <code>filter2</code>,<code>filter3</code>，编写文件代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.filters;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-04-21 18:14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebFilter(&quot;*.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">filter2</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">        System.out.println(<span class="string">&quot;AO&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.filters;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-04-21 18:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebFilter(&quot;*.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">filter3</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">        System.out.println(<span class="string">&quot;BO&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li><code>@WebFilter(&quot;*.do&quot;)</code> 也可以使用通配符，这里表示匹配所有以<code>.do</code> 结尾的请求</li>
<li>如果使用注解的方法添加过滤器，则过滤器链的调用顺序会按照文件名的字母顺序调用，如果首字母相同则按照文件顺序调用</li>
</ul>
<p>在启动服务之前将 <code>filter1</code> 中的 <code>@WebFilter(&quot;/demo1.do&quot;)</code> 注释掉，观察控制台打印的顺序</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-04-21_18-20-42.png" alt="Snipaste_2022-04-21_18-20-42.png"></p>
<h2 id="过滤器的使用"><a href="#过滤器的使用" class="headerlink" title="过滤器的使用"></a>过滤器的使用</h2><p>添加过滤器，设置请求编码为 UTF-8</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(&quot;*.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">requestFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        Filter.<span class="keyword">super</span>.init(filterConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        <span class="comment">// 在请求进来时设置一下请求编码</span></span><br><span class="line">        HttpServletRequest request =  (HttpServletRequest) servletRequest;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Filter.<span class="keyword">super</span>.destroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后就可以去掉 <code>DispatcherServlet</code> 中关于设置编码的操作</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-04-21_18-46-31.png" alt="Snipaste_2022-04-21_18-46-31.png"></p>
<h2 id="使用过滤器添加事务管理"><a href="#使用过滤器添加事务管理" class="headerlink" title="使用过滤器添加事务管理"></a>使用过滤器添加事务管理</h2><p>新建 <code>com.songzx.trans.Transmanager</code> 类，这个类有三个方法，专门负责事务的开启和提交</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Transmanager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 开启事务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/23</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">beginTrans</span><span class="params">()</span> <span class="keyword">throws</span> SQLException, ClassNotFoundException </span>&#123;</span><br><span class="line">        JdbcUtils.getConnection().setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 提交事务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/23</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">commit</span><span class="params">()</span> <span class="keyword">throws</span> SQLException, ClassNotFoundException </span>&#123;</span><br><span class="line">        JdbcUtils.getConnection().commit();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 回滚事务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/23</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">rollback</span><span class="params">()</span> <span class="keyword">throws</span> SQLException, ClassNotFoundException </span>&#123;</span><br><span class="line">        JdbcUtils.getConnection().rollback();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为事务要使用同一个连接，所以要修改 <code>JdbcUtils</code>,使用 <code>ThreadLocal</code> 保存全局唯一的 <code>Connection</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Connection&gt; threadLocal = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException, ClassNotFoundException </span>&#123;</span><br><span class="line">        <span class="comment">// 优先从本地线程获取连接</span></span><br><span class="line">        Connection conn = threadLocal.get();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(conn != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> conn;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 1.连接的三个基本信息</span></span><br><span class="line">            String url = <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/javaweb&quot;</span>;</span><br><span class="line">            String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">            String password = <span class="string">&quot;abc123&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.获取 driver 运行时类</span></span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.获取连接</span></span><br><span class="line">            Connection connection = DriverManager.getConnection(url, user, password);</span><br><span class="line"></span><br><span class="line">            threadLocal.set(connection);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> threadLocal.get();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">closeConnection</span><span class="params">(Connection conn, Statement state)</span></span>&#123;</span><br><span class="line">        DbUtils.closeQuietly(conn);</span><br><span class="line">        DbUtils.closeQuietly(state);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后新建过滤器 <code>com.songzx.filter.connectionFilter</code>,拦截所有以为 .do 结尾的请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.songzx.filter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.songzx.trans.Transmanager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-04-23 22:27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebFilter(&quot;*.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">connectionFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        Filter.<span class="keyword">super</span>.init(filterConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 开启事务</span></span><br><span class="line">            Transmanager.beginTrans();</span><br><span class="line">            System.out.println(<span class="string">&quot;开启事务&quot;</span>);</span><br><span class="line">            <span class="comment">// 放行</span></span><br><span class="line">            filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">            <span class="comment">// 提交</span></span><br><span class="line">            Transmanager.commit();</span><br><span class="line">            System.out.println(<span class="string">&quot;提交事务&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">// 程序出错回滚</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Transmanager.rollback();</span><br><span class="line">                System.out.println(<span class="string">&quot;回滚事务&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception classNotFoundException) &#123;</span><br><span class="line">                classNotFoundException.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Filter.<span class="keyword">super</span>.destroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：我们在过滤器中使用 try catch 来监听内部错误，这就要求我们需要在方法内部抛出异常，不能在方法里面处理异常，要不然过滤器监听不到错误，无法执行回滚操作</p>
<h2 id="监听器"><a href="#监听器" class="headerlink" title="监听器"></a>监听器</h2><p><code>ServletContextListener</code> 可以监听上下文的创建和销毁</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextEvent;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-04-24 14:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServerContextListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上下文被创建时触发</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Songzx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2022/4/24</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent servletContextEvent)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;上下文被初始化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent servletContextEvent)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;上下文销毁&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="添加jar包"><a href="#添加jar包" class="headerlink" title="添加jar包"></a>添加jar包</h2><p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-04-30_19-42-46.png" alt="Snipaste_2022-04-30_19-42-46.png"></p>
<p>按照文件目录创建文件夹，然后把对应文件夹内的文件加载到其中</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-05-01_15-20-26.png" alt="Snipaste_2022-05-01_15-20-26.png"></p>
<p>然后选择 Build Artifact</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-05-01_15-22-08.png" alt="Snipaste_2022-05-01_15-22-08.png"></p>
<p>选择刚刚打包的文件进行build</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-05-01_15-22-59.png" alt="Snipaste_2022-05-01_15-22-59.png"></p>
<p>随后会生成一个 jar 包，我们引用即可</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-05-01_15-24-07.png" alt="Snipaste_2022-05-01_15-24-07.png"></p>
<h2 id="IDEA导出jar包插件"><a href="#IDEA导出jar包插件" class="headerlink" title="IDEA导出jar包插件"></a>IDEA导出jar包插件</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zhyhang/article/details/89060408">https://blog.csdn.net/zhyhang/article/details/89060408</a></p>
<h2 id="使用过滤器处理登录验证"><a href="#使用过滤器处理登录验证" class="headerlink" title="使用过滤器处理登录验证"></a>使用过滤器处理登录验证</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.z_filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebInitParam;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-05-04 17:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(</span></span><br><span class="line"><span class="meta">        // 需要拦截的页面</span></span><br><span class="line"><span class="meta">        urlPatterns = &#123;&quot;*.do&quot;,&quot;*.html&quot;&#125;,</span></span><br><span class="line"><span class="meta">        initParams = &#123;</span></span><br><span class="line"><span class="meta">                // 配置访问白名单</span></span><br><span class="line"><span class="meta">                @WebInitParam(</span></span><br><span class="line"><span class="meta">                        name = &quot;bai&quot;,</span></span><br><span class="line"><span class="meta">                        value =</span></span><br><span class="line"><span class="meta">                                &quot;/pro11/router.do?operate=page&amp;path=pages/user/login,&quot; +</span></span><br><span class="line"><span class="meta">                                        &quot;/pro11/user.do?null&quot;)</span></span><br><span class="line"><span class="meta">        &#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; baiList = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取配置的初始化参数</span></span><br><span class="line">        String pathval = filterConfig.getInitParameter(<span class="string">&quot;bai&quot;</span>);</span><br><span class="line">        <span class="comment">// 使用逗号分隔，获取一个字符串数组</span></span><br><span class="line">        String[] split = pathval.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="comment">// 将数组转成字符串集合</span></span><br><span class="line">        baiList = Arrays.asList(split);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) servletRequest;</span><br><span class="line">        HttpServletResponse response = (HttpServletResponse) servletResponse;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 封装当前请求的路径</span></span><br><span class="line">        String uri = request.getRequestURI();</span><br><span class="line">        String query = request.getQueryString();</span><br><span class="line">        String paht= uri + <span class="string">&quot;?&quot;</span> + query;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;paht = &quot;</span> + paht);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断路径是否在白名单中,如果在白名单中，则放行</span></span><br><span class="line">        <span class="keyword">if</span>(baiList.contains(paht))&#123;</span><br><span class="line">            filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 如果不在白名单中，则去session中判断是否存在登录信息</span></span><br><span class="line">            HttpSession session = request.getSession();</span><br><span class="line">            Object userInfo = session.getAttribute(<span class="string">&quot;userInfo&quot;</span>);</span><br><span class="line">            <span class="comment">// 如果登录信息为空，则强制跳转到登录页面</span></span><br><span class="line">            <span class="keyword">if</span>(userInfo == <span class="keyword">null</span>)&#123;</span><br><span class="line">                response.sendRedirect(<span class="string">&quot;router.do?operate=page&amp;path=pages/user/login&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">// 如果存在，表示用户已经登录，正常放行</span></span><br><span class="line">                filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="java处理浮点数精度问题"><a href="#java处理浮点数精度问题" class="headerlink" title="java处理浮点数精度问题"></a>java处理浮点数精度问题</h2><p>首先看问题</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-05-04_17-40-35.png" alt="Snipaste_2022-05-04_17-40-35.png"></p>
<p>当我们直接使用Double类型和一个整数类型做乘法运算时，可能会出现精度问题，如上图所示，有很多的小数位</p>
<p>解决办法，使用 BigDecimal，BigDecimal 只接受字符串类型，所以我们要把 Doubel 和 int 都转成字符串来计算</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-05-04_17-44-04.png" alt="Snipaste_2022-05-04_17-44-04.png"></p>
<h2 id="使用-kaptcha-生成验证码"><a href="#使用-kaptcha-生成验证码" class="headerlink" title="使用 kaptcha 生成验证码"></a>使用 kaptcha 生成验证码</h2><p>首先导入jar包： <code>kaptcha-2.3.2.jar</code>，下载地址：<a target="_blank" rel="noopener" href="https://www.jb51.net/softs/546820.html">https://www.jb51.net/softs/546820.html</a></p>
<p>然后在 <code>web.xml</code> 中添加配置代码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.google.code.kaptcha.servlet.KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/kaptcha.jpg<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 <code>index.html</code> 页面中使用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;kaptcha.jpg&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>kaptcha 在生成验证码的同时，会在 session 中保存一份当前的验证码数据，session 的 key 为：<code>KAPTCHA_SESSION_KEY</code> ，我们可以通过读取 session 来校验前端输入的验证码是否正确</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/verificationCode.do&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VerificationCode</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        Object kaptcha_session_key = session.getAttribute(<span class="string">&quot;KAPTCHA_SESSION_KEY&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;kaptcha_session_key = &quot;</span> + kaptcha_session_key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行代码效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-05-08_17-58-55.png" alt="Snipaste_2022-05-08_17-58-55.png"></p>
<p>关于 kaptcha 的更多配置属性</p>
<table>
<thead>
<tr>
<th><strong>Constant</strong></th>
<th><strong>描述</strong></th>
<th><strong>默认值</strong></th>
</tr>
</thead>
<tbody><tr>
<td>kaptcha.border</td>
<td>图片边框，合法值：yes , no</td>
<td>yes</td>
</tr>
<tr>
<td>kaptcha.border.color</td>
<td>边框颜色，合法值： r,g,b (and optional alpha) 或者 white,black,blue.</td>
<td>black</td>
</tr>
<tr>
<td>kaptcha.border.thickness</td>
<td>边框厚度，合法值：&gt;0</td>
<td>1</td>
</tr>
<tr>
<td>kaptcha.image.width</td>
<td>图片宽</td>
<td>200</td>
</tr>
<tr>
<td>kaptcha.image.height</td>
<td>图片高</td>
<td>50</td>
</tr>
<tr>
<td>kaptcha.producer.impl</td>
<td>图片实现类</td>
<td>com.google.code.kaptcha.impl.DefaultKaptcha</td>
</tr>
<tr>
<td>kaptcha.textproducer.impl</td>
<td>文本实现类</td>
<td>com.google.code.kaptcha.text.impl.DefaultTextCreator</td>
</tr>
<tr>
<td>kaptcha.textproducer.char.string</td>
<td>文本集合，验证码值从此集合中获取</td>
<td>abcde2345678gfynmnpwx</td>
</tr>
<tr>
<td>kaptcha.textproducer.char.length</td>
<td>验证码长度</td>
<td>5</td>
</tr>
<tr>
<td>kaptcha.textproducer.font.names</td>
<td>字体</td>
<td>Arial, Courier</td>
</tr>
<tr>
<td>kaptcha.textproducer.font.size</td>
<td>字体大小</td>
<td>40px</td>
</tr>
<tr>
<td>kaptcha.textproducer.font.color</td>
<td>字体颜色，合法值： r,g,b  或者 white,black,blue.</td>
<td>black</td>
</tr>
<tr>
<td>kaptcha.textproducer.char.space</td>
<td>文字间隔</td>
<td>2</td>
</tr>
<tr>
<td>kaptcha.noise.impl</td>
<td>干扰实现类</td>
<td>com.google.code.kaptcha.impl.DefaultNoise</td>
</tr>
<tr>
<td>kaptcha.noise.color</td>
<td>干扰颜色，合法值： r,g,b 或者 white,black,blue.</td>
<td>black</td>
</tr>
<tr>
<td>kaptcha.obscurificator.impl</td>
<td>图片样式： 水纹com.google.code.kaptcha.impl.WaterRipple 鱼眼com.google.code.kaptcha.impl.FishEyeGimpy 阴影com.google.code.kaptcha.impl.ShadowGimpy</td>
<td>com.google.code.kaptcha.impl.WaterRipple</td>
</tr>
<tr>
<td>kaptcha.background.impl</td>
<td>背景实现类</td>
<td>com.google.code.kaptcha.impl.DefaultBackground</td>
</tr>
<tr>
<td>kaptcha.background.clear.from</td>
<td>背景颜色渐变，开始颜色</td>
<td>light grey</td>
</tr>
<tr>
<td>kaptcha.background.clear.to</td>
<td>背景颜色渐变，结束颜色</td>
<td>white</td>
</tr>
<tr>
<td>kaptcha.word.impl</td>
<td>文字渲染器</td>
<td>com.google.code.kaptcha.text.impl.DefaultWordRenderer</td>
</tr>
<tr>
<td>kaptcha.session.key</td>
<td>session key</td>
<td>KAPTCHA_SESSION_KEY</td>
</tr>
<tr>
<td>kaptcha.session.date</td>
<td>session date</td>
<td>KAPTCHA_SESSION_DATE</td>
</tr>
</tbody></table>
<p>配置属性的使用方法，以设置文字大小为例</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.google.code.kaptcha.servlet.KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 边框颜色 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.border.color<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>blue<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 边框厚度 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>kaptcha.border.thickness<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>KaptchaServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/kaptcha.jpg<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/images/Snipaste_2022-05-08_18-08-43.png" alt="Snipaste_2022-05-08_18-08-43.png"></p>
<h2 id="使用axios发送数据响应普通文本"><a href="#使用axios发送数据响应普通文本" class="headerlink" title="使用axios发送数据响应普通文本"></a>使用axios发送数据响应普通文本</h2><p>首先前端发送请求</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;name&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;姓名&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;pwd&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;submt&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">                el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">                data: &#123;</span><br><span class="line"><span class="javascript">                    name: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                    pwd: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line">                &#125;,</span><br><span class="line">                methods: &#123;</span><br><span class="line"><span class="javascript">                    submt: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                        axios.post(<span class="string">&#x27;getUserInfo&#x27;</span>, &#123;</span></span><br><span class="line"><span class="javascript">                                name: <span class="built_in">this</span>.name,</span></span><br><span class="line"><span class="javascript">                                pwd: <span class="built_in">this</span>.pwd</span></span><br><span class="line">                            &#125;)</span><br><span class="line"><span class="javascript">                            .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                                <span class="built_in">console</span>.log(response.data);</span></span><br><span class="line">                            &#125;)</span><br><span class="line"><span class="javascript">                            .catch(<span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                                <span class="built_in">console</span>.log(error);</span></span><br><span class="line">                            &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>java接收请求并响应</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.axios;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-05-08 21:21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/getUserInfo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo01</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        resp.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        PrintWriter out = resp.getWriter();</span><br><span class="line">        out.write(<span class="string">&quot;接收到值&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="接收和返回JSON数据"><a href="#接收和返回JSON数据" class="headerlink" title="接收和返回JSON数据"></a>接收和返回JSON数据</h2><p>首先前端发送请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;title&gt;Title&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;.&#x2F;js&#x2F;vue.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;.&#x2F;js&#x2F;axios.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">  &lt;input v-model&#x3D;&quot;name&quot; placeholder&#x3D;&quot;姓名&quot; &#x2F;&gt;&lt;br&gt;</span><br><span class="line">  &lt;input v-model&#x3D;&quot;pwd&quot; placeholder&#x3D;&quot;密码&quot; &#x2F;&gt;&lt;br&gt;</span><br><span class="line">  &lt;button v-on:click&#x3D;&quot;submt&quot;&gt;提交&lt;&#x2F;button&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  window.onload &#x3D; function () &#123;</span><br><span class="line">    var app &#x3D; new Vue(&#123;</span><br><span class="line">      el: &#39;#app&#39;,</span><br><span class="line">      data: &#123;</span><br><span class="line">        name: &#39;&#39;,</span><br><span class="line">        pwd: &#39;&#39;,</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        submt: function () &#123;</span><br><span class="line">          axios.post(&#39;demo02&#39;, &#123;</span><br><span class="line">            name: this.name,</span><br><span class="line">            pwd: this.pwd</span><br><span class="line">          &#125;)</span><br><span class="line">                  .then(function (response) &#123;</span><br><span class="line">                    console.log(response.data);</span><br><span class="line">                    app.name &#x3D; response.data.name</span><br><span class="line">                    app.pwd &#x3D; response.data.pwd</span><br><span class="line">                  &#125;)</span><br><span class="line">                  .catch(function (error) &#123;</span><br><span class="line">                    console.log(error);</span><br><span class="line">                  &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>后端创建一个 User 的 pojo 类，属性名和前端传递过来的一样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.pojo;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-05-08 22:51</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    String pwd;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPwd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPwd</span><span class="params">(String pwd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pwd = pwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, pwd=&#x27;&quot;</span> + pwd + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>后端接收请求：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.axios;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"><span class="keyword">import</span> com.szx.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-05-08 22:40</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/demo02&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo02</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        StringBuffer stringBuffer = <span class="keyword">new</span> StringBuffer(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        BufferedReader bufferedReader = req.getReader();</span><br><span class="line">        String jsonstr = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">while</span> ((jsonstr = bufferedReader.readLine()) != <span class="keyword">null</span>)&#123;</span><br><span class="line">            stringBuffer.append(jsonstr);</span><br><span class="line">        &#125;</span><br><span class="line">        jsonstr = stringBuffer.toString();</span><br><span class="line">        System.out.println(<span class="string">&quot;jsonstr = &quot;</span> + jsonstr);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将获取到的JSON字符串转成Java对象</span></span><br><span class="line">        Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">        User user = gson.fromJson(jsonstr, User.class);</span><br><span class="line">        System.out.println(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将Java对象转成前端需要的JSON</span></span><br><span class="line">        user.setName(<span class="string">&quot;鸠摩智&quot;</span>);</span><br><span class="line">        user.setPwd(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        String userJson = gson.toJson(user);</span><br><span class="line">        resp.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        resp.setContentType(<span class="string">&quot;application/json;utf-8&quot;</span>);</span><br><span class="line">        resp.getWriter().write(userJson);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面代码中使用到了 <code>gson-2.8.6.jar</code>，下载地址：<a target="_blank" rel="noopener" href="https://search.maven.org/artifact/com.google.code.gson/gson/2.8.6/jar">https://search.maven.org/artifact/com.google.code.gson/gson/2.8.6/jar</a></p>
<p>Gson 有两个核心方法：</p>
<ul>
<li><code>gson.fromJson</code> ，把 JSON 字符串转成 Java 类</li>
<li><code>gson.toJson</code> ，把 Java 类转成 JSON 字符串传递给前端，再次之前要设置 <code> resp.setContentType(&quot;application/json;utf-8&quot;);</code>，来明确告诉浏览器发送的是一个 JSON 数据，这样浏览器会自动的把 JSON 字符串格式转成 JSON 数据，前端就不需要手动去格式化 JSON 字符串</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">SZX</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://songzx0106.github.io/Java/javaweb/1/">https://songzx0106.github.io/Java/javaweb/1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://SongZX0106.github.io" target="_blank">SZX的开发笔记</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a></div><div class="post_share"><div class="social-share" data-image="/images/ys11.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/share.min.css" media="print" onload="this.media='all'"><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/images/wechat.png" target="_blank"><img class="post-qr-code-img" data-lazy-src="/images/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/images/alipay.jpg" target="_blank"><img class="post-qr-code-img" data-lazy-src="/images/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/Java/Spring5/1/"><img class="prev-cover" data-lazy-src="/images/ys15.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Java Spring5</div></div></a></div><div class="next-post pull-right"><a href="/JavaScript/doubel/"><img class="next-cover" data-lazy-src="/images/ys18.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">js解决浮点数精度问题.</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/Java/Maven/20230206090754/" title="使用Java将Word文档转PDF"><img class="cover" data-lazy-src="/images/ys18.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-06</div><div class="title">使用Java将Word文档转PDF</div></div></a></div><div><a href="/Java/Maven/1/" title="Maven入门"><img class="cover" data-lazy-src="/images/ys03.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-28</div><div class="title">Maven入门</div></div></a></div><div><a href="/Java/Spring5/1/" title="Java Spring5"><img class="cover" data-lazy-src="/images/ys15.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-24</div><div class="title">Java Spring5</div></div></a></div><div><a href="/Java/Spring5/2/" title="Spring注解开发"><img class="cover" data-lazy-src="/images/ys19.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-13</div><div class="title">Spring注解开发</div></div></a></div><div><a href="/Java/MybatisPlus/1/" title="MybatisPlus入门"><img class="cover" data-lazy-src="/images/ys06.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-18</div><div class="title">MybatisPlus入门</div></div></a></div><div><a href="/Java/basics/01Java语言概述/" title="01Java语言概述"><img class="cover" data-lazy-src="/images/ys13.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-12</div><div class="title">01Java语言概述</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="/images/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">SZX</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">140</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">34</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://gitee.com/szxio"><i class="iconfont icon-gitee-fill-round"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">welcome to my blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2"><span class="toc-number">1.</span> <span class="toc-text">编写静态页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tomcat-%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">Tomcat 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE%E5%88%B0Tomcat"><span class="toc-number">3.</span> <span class="toc-text">部署项目到Tomcat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD-Tomcat9"><span class="toc-number">4.</span> <span class="toc-text">下载 Tomcat9</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8-idea-%E4%B8%AD%E4%BD%BF%E7%94%A8-tomcat"><span class="toc-number">5.</span> <span class="toc-text">在 idea 中使用 tomcat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-HttpServlet-%E6%8E%A5%E6%94%B6%E8%A1%A8%E5%8D%95%E5%8F%82%E6%95%B0"><span class="toc-number">6.</span> <span class="toc-text">使用 HttpServlet 接收表单参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99-form-%E8%A1%A8%E5%8D%95"><span class="toc-number">6.1.</span> <span class="toc-text">编写 form 表单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5-tomcat-%E4%BE%9D%E8%B5%96"><span class="toc-number">6.2.</span> <span class="toc-text">导入 tomcat 依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E6%8E%A5%E6%94%B6%E6%96%B9%E6%B3%95"><span class="toc-number">6.3.</span> <span class="toc-text">编写接收方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-xml-%E5%8F%82%E6%95%B0"><span class="toc-number">6.4.</span> <span class="toc-text">配置 xml 参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%88%E6%9E%9C%E6%BC%94%E7%A4%BA"><span class="toc-number">6.5.</span> <span class="toc-text">效果演示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5jdbc%E5%AE%8C%E6%88%90%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">6.6.</span> <span class="toc-text">导入jdbc完成数据插入到数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86post%E6%8E%A5%E6%94%B6%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98"><span class="toc-number">6.7.</span> <span class="toc-text">处理post接收中文乱码问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Server-%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">7.</span> <span class="toc-text">Server 的生命周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-Servlet-%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E6%97%B6%E6%9C%BA"><span class="toc-number">8.</span> <span class="toc-text">修改 Servlet 的初始化时机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Http%E7%9A%84%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94"><span class="toc-number">9.</span> <span class="toc-text">Http的请求和响应</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">9.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82"><span class="toc-number">9.2.</span> <span class="toc-text">请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94"><span class="toc-number">9.3.</span> <span class="toc-text">响应</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Http%E6%97%A0%E7%8A%B6%E6%80%81"><span class="toc-number">10.</span> <span class="toc-text">Http无状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E8%B7%9F%E8%B8%AA"><span class="toc-number">11.</span> <span class="toc-text">会话跟踪</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E4%BF%9D%E5%AD%98"><span class="toc-number">12.</span> <span class="toc-text">会话保存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E8%BD%AC%E5%8F%91%E5%92%8C%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">13.</span> <span class="toc-text">内部转发和重定向</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E8%BD%AC%E5%8F%91"><span class="toc-number">13.1.</span> <span class="toc-text">内部转发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">13.2.</span> <span class="toc-text">浏览器重定向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#thymeleaf-%E5%85%A5%E9%97%A8"><span class="toc-number">14.</span> <span class="toc-text">thymeleaf 入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%8C%85"><span class="toc-number">14.1.</span> <span class="toc-text">导包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5%E6%96%87%E4%BB%B6"><span class="toc-number">14.2.</span> <span class="toc-text">引入文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-xml"><span class="toc-number">14.3.</span> <span class="toc-text">配置 xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99-index-html"><span class="toc-number">14.4.</span> <span class="toc-text">编写 index.html</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E9%81%8D%E5%8E%86%E9%A1%B5%E9%9D%A2%E6%95%B0%E6%8D%AE"><span class="toc-number">14.5.</span> <span class="toc-text">动态遍历页面数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Servlet-%E4%BF%9D%E5%AD%98%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">15.</span> <span class="toc-text">Servlet 保存作用域</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#request-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE"><span class="toc-number">15.1.</span> <span class="toc-text">request 保存数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#session-%E4%BF%9D%E5%AD%98%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">15.2.</span> <span class="toc-text">session 保存作用域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#context-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE"><span class="toc-number">15.3.</span> <span class="toc-text">context 保存数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-thymeleaf-%E5%AE%8C%E6%88%90%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E6%A1%88%E4%BE%8B"><span class="toc-number">16.</span> <span class="toc-text">使用 thymeleaf 完成增删改查案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E7%BC%96%E8%BE%91%E5%8A%9F%E8%83%BD"><span class="toc-number">16.1.</span> <span class="toc-text">实现数据编辑功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%88%A0%E9%99%A4"><span class="toc-number">16.2.</span> <span class="toc-text">数据删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%96%B0%E5%A2%9E"><span class="toc-number">16.3.</span> <span class="toc-text">数据新增</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E9%A1%B5%E6%98%BE%E7%A4%BA"><span class="toc-number">16.4.</span> <span class="toc-text">数据分页显示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2%E5%8A%9F%E8%83%BD"><span class="toc-number">16.5.</span> <span class="toc-text">添加模糊查询功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Servlet-Mvc"><span class="toc-number">17.</span> <span class="toc-text">Servlet Mvc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%961"><span class="toc-number">17.1.</span> <span class="toc-text">优化1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%962"><span class="toc-number">17.2.</span> <span class="toc-text">优化2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E4%BC%98%E5%8C%96%E7%89%88%E6%9C%AC"><span class="toc-number">17.3.</span> <span class="toc-text">最终优化版本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Servlet%E5%B8%B8%E7%94%A8APi"><span class="toc-number">18.</span> <span class="toc-text">Servlet常用APi</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%82%E6%95%B0-getInitParameter"><span class="toc-number">18.1.</span> <span class="toc-text">读取初始化参数 getInitParameter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E4%B8%8A%E4%B8%8B%E6%96%87-getServletContext"><span class="toc-number">18.2.</span> <span class="toc-text">获取上下文 getServletContext</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E8%AF%86MVC"><span class="toc-number">19.</span> <span class="toc-text">初识MVC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%B9%E9%80%A0%E6%B0%B4%E6%9E%9C%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%EF%BC%8C%E5%A2%9E%E5%8A%A0%E4%B8%9A%E5%8A%A1%E5%B1%82"><span class="toc-number">20.</span> <span class="toc-text">改造水果管理系统，增加业务层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%8E%A7%E5%88%B6%E7%BF%BB%E8%BD%AC%E5%92%8C%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-number">21.</span> <span class="toc-text">实现控制翻转和依赖注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">22.</span> <span class="toc-text">过滤器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">23.</span> <span class="toc-text">过滤器的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%BF%87%E6%BB%A4%E5%99%A8%E6%B7%BB%E5%8A%A0%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">24.</span> <span class="toc-text">使用过滤器添加事务管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-number">25.</span> <span class="toc-text">监听器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0jar%E5%8C%85"><span class="toc-number">26.</span> <span class="toc-text">添加jar包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IDEA%E5%AF%BC%E5%87%BAjar%E5%8C%85%E6%8F%92%E4%BB%B6"><span class="toc-number">27.</span> <span class="toc-text">IDEA导出jar包插件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%BF%87%E6%BB%A4%E5%99%A8%E5%A4%84%E7%90%86%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81"><span class="toc-number">28.</span> <span class="toc-text">使用过滤器处理登录验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#java%E5%A4%84%E7%90%86%E6%B5%AE%E7%82%B9%E6%95%B0%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98"><span class="toc-number">29.</span> <span class="toc-text">java处理浮点数精度问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-kaptcha-%E7%94%9F%E6%88%90%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">30.</span> <span class="toc-text">使用 kaptcha 生成验证码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8axios%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE%E5%93%8D%E5%BA%94%E6%99%AE%E9%80%9A%E6%96%87%E6%9C%AC"><span class="toc-number">31.</span> <span class="toc-text">使用axios发送数据响应普通文本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E6%94%B6%E5%92%8C%E8%BF%94%E5%9B%9EJSON%E6%95%B0%E6%8D%AE"><span class="toc-number">32.</span> <span class="toc-text">接收和返回JSON数据</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Vue/%E5%8A%A0%E8%BD%BD%E8%BF%9C%E7%A8%8Bvue%E6%96%87%E4%BB%B6/" title="使用 vue3-sfc-loader 在运行时动态加载 .vue 文件"><img data-lazy-src="/images/ys18.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 vue3-sfc-loader 在运行时动态加载 .vue 文件"/></a><div class="content"><a class="title" href="/Vue/%E5%8A%A0%E8%BD%BD%E8%BF%9C%E7%A8%8Bvue%E6%96%87%E4%BB%B6/" title="使用 vue3-sfc-loader 在运行时动态加载 .vue 文件">使用 vue3-sfc-loader 在运行时动态加载 .vue 文件</a><time datetime="2024-04-11T02:07:24.000Z" title="发表于 2024-04-11 10:07:24">2024-04-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/JavaScript/%E5%B7%A7%E7%94%A8CSS%E7%9A%84clamp%E5%87%BD%E6%95%B0/" title="巧用CSS的clamp函数"><img data-lazy-src="/images/ys09.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="巧用CSS的clamp函数"/></a><div class="content"><a class="title" href="/JavaScript/%E5%B7%A7%E7%94%A8CSS%E7%9A%84clamp%E5%87%BD%E6%95%B0/" title="巧用CSS的clamp函数">巧用CSS的clamp函数</a><time datetime="2024-03-14T02:04:37.000Z" title="发表于 2024-03-14 10:04:37">2024-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Vue/%E6%89%8B%E5%86%99vue3%E6%BA%90%E7%A0%81/" title="手写Vue3核心源码"><img data-lazy-src="/images/ys20.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="手写Vue3核心源码"/></a><div class="content"><a class="title" href="/Vue/%E6%89%8B%E5%86%99vue3%E6%BA%90%E7%A0%81/" title="手写Vue3核心源码">手写Vue3核心源码</a><time datetime="2024-03-09T02:40:34.000Z" title="发表于 2024-03-09 10:40:34">2024-03-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/JavaScript/%E4%BB%BFChatGPT%E5%85%89%E6%A0%87%E8%B7%9F%E9%9A%8F%E6%95%88%E6%9E%9C/" title="仿ChatGPT光标跟随效果"><img data-lazy-src="/images/ys14.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="仿ChatGPT光标跟随效果"/></a><div class="content"><a class="title" href="/JavaScript/%E4%BB%BFChatGPT%E5%85%89%E6%A0%87%E8%B7%9F%E9%9A%8F%E6%95%88%E6%9E%9C/" title="仿ChatGPT光标跟随效果">仿ChatGPT光标跟随效果</a><time datetime="2024-01-19T14:57:50.000Z" title="发表于 2024-01-19 22:57:50">2024-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Vue/20231224/" title="手写Vue2源码"><img data-lazy-src="/images/ys13.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="手写Vue2源码"/></a><div class="content"><a class="title" href="/Vue/20231224/" title="手写Vue2源码">手写Vue2源码</a><time datetime="2023-12-24T08:28:09.000Z" title="发表于 2023-12-24 16:28:09">2023-12-24</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/images/ys11.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By SZX</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">少年辛苦终身事，莫向光阴惰寸功。<a target="_blank" rel="noopener" href="https://gitee.com/szxio">My Gitee</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/instantpage.min.js" type="module"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'iJzt0X9OdhFCcdn4N0dJ86fY-gzGzoHsz',
      appKey: '8vtaRafgQSvU5ntYgszJfRW5',
      placeholder: '留下你的精彩评论',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/canvas-fluttering-ribbon.min.js"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/click-show-text.min.js" data-mobile="true" data-text="富强,民主,文明,和谐,自由,平等,公正,法制,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>