<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>React + SpringBoot 开发用户中心管理系统 | SZX的开发笔记</title><meta name="keywords" content="Java"><meta name="author" content="SZX"><meta name="copyright" content="SZX"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="技术栈前端技术栈  “react”: “^18.2.0”, ant-design-pro  后端技术栈  SpringBoot 2.6.x  项目源码地址  https:&#x2F;&#x2F;gitee.com&#x2F;szxio&#x2F;user-center  前端项目搭建快速搭建一个后端管理系统项目框架 初始化antDesignPro 官网： https:&#x2F;&#x2F;pro.ant.design&#x2F;zh-CN。开箱即用的中台前端&#x2F;设计">
<meta property="og:type" content="article">
<meta property="og:title" content="React + SpringBoot 开发用户中心管理系统">
<meta property="og:url" content="https://songzx0106.github.io/Java/springboot/usercenter/index.html">
<meta property="og:site_name" content="SZX的开发笔记">
<meta property="og:description" content="技术栈前端技术栈  “react”: “^18.2.0”, ant-design-pro  后端技术栈  SpringBoot 2.6.x  项目源码地址  https:&#x2F;&#x2F;gitee.com&#x2F;szxio&#x2F;user-center  前端项目搭建快速搭建一个后端管理系统项目框架 初始化antDesignPro 官网： https:&#x2F;&#x2F;pro.ant.design&#x2F;zh-CN。开箱即用的中台前端&#x2F;设计">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://songzx0106.github.io/images/ys16.png">
<meta property="article:published_time" content="2024-06-02T02:19:37.000Z">
<meta property="article:modified_time" content="2024-09-23T01:36:22.393Z">
<meta property="article:author" content="SZX">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://songzx0106.github.io/images/ys16.png"><link rel="shortcut icon" href="/images/favicon.png"><link rel="canonical" href="https://songzx0106.github.io/Java/springboot/usercenter/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":5000,"languages":{"author":"作者: SZX","link":"链接: ","source":"来源: SZX的开发笔记","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/jquery.min.js',
    justifiedGallery: {
      js: 'https://fastly.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://fastly.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://fastly.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-23 09:36:22'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2467717_jlvw8717b8.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/images/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">150</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/ys16.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">SZX的开发笔记</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">React + SpringBoot 开发用户中心管理系统</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-06-02T02:19:37.000Z" title="发表于 2024-06-02 10:19:37">2024-06-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-09-23T01:36:22.393Z" title="更新于 2024-09-23 09:36:22">2024-09-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/SpringBoot/">SpringBoot</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">13.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>63分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="React + SpringBoot 开发用户中心管理系统"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h2><p>前端技术栈</p>
<ul>
<li>“react”: “^18.2.0”,</li>
<li>ant-design-pro</li>
</ul>
<p>后端技术栈</p>
<ul>
<li>SpringBoot 2.6.x</li>
</ul>
<p>项目源码地址</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://gitee.com/szxio/user-center">https://gitee.com/szxio/user-center</a></li>
</ul>
<h2 id="前端项目搭建"><a href="#前端项目搭建" class="headerlink" title="前端项目搭建"></a>前端项目搭建</h2><p>快速搭建一个后端管理系统项目框架</p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>antDesignPro 官网： <a target="_blank" rel="noopener" href="https://pro.ant.design/zh-CN%E3%80%82%E5%BC%80%E7%AE%B1%E5%8D%B3%E7%94%A8%E7%9A%84%E4%B8%AD%E5%8F%B0%E5%89%8D%E7%AB%AF/%E8%AE%BE%E8%AE%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">https://pro.ant.design/zh-CN。开箱即用的中台前端/设计解决方案</a></p>
<p>我们提供了 pro-cli 来快速的初始化脚手架。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 npm</span></span><br><span class="line">npm i @ant-design/pro-cli -g</span><br><span class="line">pro create user-center</span><br><span class="line"><span class="built_in">cd</span> user-center</span><br><span class="line">pnpm install</span><br></pre></td></tr></table></figure>

<h3 id="去除国际化"><a href="#去除国际化" class="headerlink" title="去除国际化"></a>去除国际化</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm i18n-remove</span><br></pre></td></tr></table></figure>

<p>执行这个命令可以去掉项目中的国际化配置，再次启动可能会报引用错误，把多余的引用去掉即可</p>
<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm start</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240511145232628.png" alt="image-20240511145232628"></p>
<p>访问</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240511145311283.png" alt="image-20240511145311283"></p>
<h2 id="后端项目搭建"><a href="#后端项目搭建" class="headerlink" title="后端项目搭建"></a>后端项目搭建</h2><h3 id="初始化-1"><a href="#初始化-1" class="headerlink" title="初始化"></a>初始化</h3><p>使用idea开发工具自带 Spring Initializr 完成项目创建</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240511145850969.png" alt="image-20240511145850969"></p>
<p>如果Java版本无法选中8，可以切换上面的 Server URL 为阿里的源 <a target="_blank" rel="noopener" href="https://start.aliyun.com,然后就可以选择8版本了/">https://start.aliyun.com，然后就可以选择8版本了</a></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240511150017423.png" alt="image-20240511150017423"></p>
<p>接着点击 Next选择常用的开发依赖，下面我列出一些基本的依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.szx<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>user-center<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>user-center<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>user-center<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>2.6.13<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.26<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.szx.usercenter.UserCenterApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">skip</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skip</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>application.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">user-center</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 数据源配置</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/user-center?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">abc123</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 配置日期返回格式</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="comment"># 日期格式</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="comment"># 时区</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">    <span class="comment"># 非空的属性值才会被包含在结果中</span></span><br><span class="line">    <span class="attr">default-property-inclusion:</span> <span class="string">non_null</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">pathmatch:</span></span><br><span class="line">      <span class="comment"># swagger配置路径匹配规则</span></span><br><span class="line">      <span class="attr">matching-strategy:</span> <span class="string">ant_path_matcher</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**.xml</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment"># 开启控制台SQL输出</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>

<h3 id="SwaggerUI配置"><a href="#SwaggerUI配置" class="headerlink" title="SwaggerUI配置"></a>SwaggerUI配置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.usercenter.config;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2022-09-22 11:21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">webApiConfig</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">&quot;webApi&quot;</span>)</span><br><span class="line">                .apiInfo(webApiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .paths(path -&gt; !path.contains(<span class="string">&quot;/error&quot;</span>))  <span class="comment">// 过滤掉SwaggerUI自带的error路径的api</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiInfo <span class="title">webApiInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">&quot;用户中心接口文档&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MybatisPlus分页插件和自动插入当前日期"><a href="#MybatisPlus分页插件和自动插入当前日期" class="headerlink" title="MybatisPlus分页插件和自动插入当前日期"></a>MybatisPlus分页插件和自动插入当前日期</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> <span class="keyword">implements</span> <span class="title">MetaObjectHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分页插件</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title">mybatisPlusInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MybatisPlusInterceptor interceptor = <span class="keyword">new</span> MybatisPlusInterceptor();</span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> PaginationInnerInterceptor(DbType.MYSQL));</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建日期和更新日期自动更新</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">        setFieldValByName(<span class="string">&quot;createTime&quot;</span>, <span class="keyword">new</span> Date(),metaObject);</span><br><span class="line">        setFieldValByName(<span class="string">&quot;updateTime&quot;</span>,<span class="keyword">new</span> Date(),metaObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新日期自动更新</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">        setFieldValByName(<span class="string">&quot;updateTime&quot;</span>,<span class="keyword">new</span> Date(),metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="启动类设置"><a href="#启动类设置" class="headerlink" title="启动类设置"></a>启动类设置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.usercenter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ConfigurableApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.env.Environment;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.szx.usercenter.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserCenterApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">        ConfigurableApplicationContext ioc = SpringApplication.run(UserCenterApplication.class, args);</span><br><span class="line">        Environment env = ioc.getEnvironment();</span><br><span class="line">        String host = InetAddress.getLocalHost().getHostAddress();</span><br><span class="line">        String port = env.getProperty(<span class="string">&quot;server.port&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;\n    ----------------------------------------------------------\n\t&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Application &#x27;&#123;&#125;&#x27; 正在运行中... Access URLs:\n\t&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Local: \t\thttp://localhost:&#123;&#125;\n\t&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;External: \thttp://&#123;&#125;:&#123;&#125;\n\t&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;Doc: \thttp://&#123;&#125;:&#123;&#125;/doc.html\n\t&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;SwaggerDoc: \thttp://&#123;&#125;:&#123;&#125;/swagger-ui/index.html\n\t&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;----------------------------------------------------------&quot;</span>,</span><br><span class="line">                env.getProperty(<span class="string">&quot;spring.application.name&quot;</span>),</span><br><span class="line">                env.getProperty(<span class="string">&quot;server.port&quot;</span>),</span><br><span class="line">                host, port,</span><br><span class="line">                host, port,</span><br><span class="line">                host, port);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="IDEA自带的代码生成器"><a href="#IDEA自带的代码生成器" class="headerlink" title="IDEA自带的代码生成器"></a>IDEA自带的代码生成器</h3><p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240511151420847.png" alt="image-20240511151420847"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240511151606132.png" alt="image-20240511151606132"></p>
<p>注意：生成的文件会覆盖原有文件</p>
<h3 id="统一结果返回类"><a href="#统一结果返回类" class="headerlink" title="统一结果返回类"></a>统一结果返回类</h3><p>Response</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.usercenter.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonInclude;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/6/4</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span> <span class="comment">// 值等于null的属性不返回</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Response</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@title</span> 成功消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Response&lt;T&gt; <span class="title">success</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rspMsg(ResponseEnum.SUCCESS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@title</span> 失败消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Response&lt;T&gt; <span class="title">error</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rspMsg(ResponseEnum.SERVER_INNER_ERR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@title</span> 自定义消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Response&lt;T&gt; <span class="title">rspMsg</span><span class="params">(ResponseEnum responseEnum)</span> </span>&#123;</span><br><span class="line">        Response&lt;T&gt; message = <span class="keyword">new</span> Response&lt;T&gt;();</span><br><span class="line">        message.setCode(responseEnum.getCode());</span><br><span class="line">        message.setMsg(responseEnum.getMsg());</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@title</span> 自定义消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Response&lt;T&gt; <span class="title">rspMsg</span><span class="params">(String code , String msg)</span> </span>&#123;</span><br><span class="line">        Response&lt;T&gt; message = <span class="keyword">new</span> Response&lt;T&gt;();</span><br><span class="line">        message.setCode(code);</span><br><span class="line">        message.setMsg(msg);</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@title</span> 返回数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Response&lt;T&gt; <span class="title">rspData</span><span class="params">(T data)</span> </span>&#123;</span><br><span class="line">        Response&lt;T&gt; responseData = <span class="keyword">new</span> Response&lt;T&gt;();</span><br><span class="line">        responseData.setCode(ResponseEnum.SUCCESS.getCode());</span><br><span class="line">        responseData.setData(data);</span><br><span class="line">        <span class="keyword">return</span> responseData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Response&lt;T&gt; <span class="title">error</span><span class="params">(T data)</span> </span>&#123;</span><br><span class="line">        Response&lt;T&gt; responseData = <span class="keyword">new</span> Response&lt;T&gt;();</span><br><span class="line">        responseData.setCode(ResponseEnum.ERROR.getCode());</span><br><span class="line">        responseData.setData(data);</span><br><span class="line">        <span class="keyword">return</span> responseData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@title</span> 返回数据-自定义code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Response&lt;T&gt; <span class="title">rspData</span><span class="params">(String code , T data)</span> </span>&#123;</span><br><span class="line">        Response&lt;T&gt; responseData = <span class="keyword">new</span> Response&lt;T&gt;();</span><br><span class="line">        responseData.setCode(code);</span><br><span class="line">        responseData.setData(data);</span><br><span class="line">        <span class="keyword">return</span> responseData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(T data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>枚举类 ResponseEnum</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.usercenter.util;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-12-05 14:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ResponseEnum</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 可以根据自己的实际需要增加状态码</span></span><br><span class="line">    SUCCESS(<span class="string">&quot;200&quot;</span>, <span class="string">&quot;成功&quot;</span>),</span><br><span class="line">    ERROR(<span class="string">&quot;500&quot;</span>,<span class="string">&quot;系统异常&quot;</span>),</span><br><span class="line">    SERVER_INNER_ERR(<span class="string">&quot;500&quot;</span>,<span class="string">&quot;系统繁忙&quot;</span>),</span><br><span class="line">    LOGIN_EXPIRED(<span class="string">&quot;401&quot;</span>,<span class="string">&quot;登录过期&quot;</span>),</span><br><span class="line">    PARAM_LACK(<span class="string">&quot;100&quot;</span> , <span class="string">&quot;非法参数&quot;</span>),</span><br><span class="line">    OPERATION_FAILED(<span class="string">&quot;101&quot;</span> ,<span class="string">&quot;操作失败&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    ResponseEnum(String code, String msg) &#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="编写测试接口"><a href="#编写测试接口" class="headerlink" title="编写测试接口"></a>编写测试接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.usercenter.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szx.usercenter.domain.SysUser;</span><br><span class="line"><span class="keyword">import</span> com.szx.usercenter.service.SysUserService;</span><br><span class="line"><span class="keyword">import</span> com.szx.usercenter.util.Response;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2024-05-11 10:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/sysUser&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;用户管理&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SusUserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    SysUserService sysUserService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;getAllUser&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;获取所有用户&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Response&lt;List&lt;SysUser&gt;&gt; getUserList() &#123;</span><br><span class="line">        <span class="keyword">return</span> Response.rspData(sysUserService.list());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sysUser</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;登录&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">login</span><span class="params">(<span class="meta">@RequestBody</span> SysUser sysUser)</span> </span>&#123;</span><br><span class="line">        SysUser login = sysUserService.login(sysUser);</span><br><span class="line">        <span class="keyword">if</span>(login != <span class="keyword">null</span>)&#123;</span><br><span class="line">            login.setPassword(<span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">return</span> Response.rspData(login);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Response.error(<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重启项目，访问Swagger页面试试</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240511152136291.png" alt="image-20240511152136291"></p>
<p>至此后端项目搭建完成</p>
<h3 id="打包pom通用配置"><a href="#打包pom通用配置" class="headerlink" title="打包pom通用配置"></a>打包pom通用配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- 或者你使用的版本 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="SQL建表语句"><a href="#SQL建表语句" class="headerlink" title="SQL建表语句"></a>SQL建表语句</h2><p>可以复制若依的表来使用，下面是sql地址</p>
<p><a target="_blank" rel="noopener" href="https://gitee.com/y_project/RuoYi-Vue/blob/master/sql/ry_20231130.sql">https://gitee.com/y_project/RuoYi-Vue/blob/master/sql/ry_20231130.sql</a></p>
<h3 id="用户表-sys-user"><a href="#用户表-sys-user" class="headerlink" title="用户表 sys_user"></a>用户表 sys_user</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> sys_user;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_user (</span><br><span class="line">  user_id           <span class="type">bigint</span>(<span class="number">20</span>)      <span class="keyword">not</span> <span class="keyword">null</span> auto_increment    comment <span class="string">&#x27;用户ID&#x27;</span>,</span><br><span class="line">  dept_id           <span class="type">bigint</span>(<span class="number">20</span>)      <span class="keyword">default</span> <span class="keyword">null</span>               comment <span class="string">&#x27;部门ID&#x27;</span>,</span><br><span class="line">  user_name         <span class="type">varchar</span>(<span class="number">30</span>)     <span class="keyword">not</span> <span class="keyword">null</span>                   comment <span class="string">&#x27;用户账号&#x27;</span>,</span><br><span class="line">  nick_name         <span class="type">varchar</span>(<span class="number">30</span>)     <span class="keyword">not</span> <span class="keyword">null</span>                   comment <span class="string">&#x27;用户昵称&#x27;</span>,</span><br><span class="line">  user_type         <span class="type">varchar</span>(<span class="number">2</span>)      <span class="keyword">default</span> <span class="string">&#x27;00&#x27;</span>               comment <span class="string">&#x27;用户类型（00系统用户）&#x27;</span>,</span><br><span class="line">  email             <span class="type">varchar</span>(<span class="number">50</span>)     <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>                 comment <span class="string">&#x27;用户邮箱&#x27;</span>,</span><br><span class="line">  phonenumber       <span class="type">varchar</span>(<span class="number">11</span>)     <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>                 comment <span class="string">&#x27;手机号码&#x27;</span>,</span><br><span class="line">  sex               <span class="type">char</span>(<span class="number">1</span>)         <span class="keyword">default</span> <span class="string">&#x27;0&#x27;</span>                comment <span class="string">&#x27;用户性别（0男 1女 2未知）&#x27;</span>,</span><br><span class="line">  avatar            <span class="type">varchar</span>(<span class="number">100</span>)    <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>                 comment <span class="string">&#x27;头像地址&#x27;</span>,</span><br><span class="line">  password          <span class="type">varchar</span>(<span class="number">100</span>)    <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>                 comment <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">  status            <span class="type">char</span>(<span class="number">1</span>)         <span class="keyword">default</span> <span class="string">&#x27;0&#x27;</span>                comment <span class="string">&#x27;帐号状态（0正常 1停用）&#x27;</span>,</span><br><span class="line">  del_flag          <span class="type">char</span>(<span class="number">1</span>)         <span class="keyword">default</span> <span class="string">&#x27;0&#x27;</span>                comment <span class="string">&#x27;删除标志（0代表存在 2代表删除）&#x27;</span>,</span><br><span class="line">  login_ip          <span class="type">varchar</span>(<span class="number">128</span>)    <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>                 comment <span class="string">&#x27;最后登录IP&#x27;</span>,</span><br><span class="line">  login_date        datetime                                   comment <span class="string">&#x27;最后登录时间&#x27;</span>,</span><br><span class="line">  create_by         <span class="type">varchar</span>(<span class="number">64</span>)     <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>                 comment <span class="string">&#x27;创建者&#x27;</span>,</span><br><span class="line">  create_time       datetime                                   comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  update_by         <span class="type">varchar</span>(<span class="number">64</span>)     <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>                 comment <span class="string">&#x27;更新者&#x27;</span>,</span><br><span class="line">  update_time       datetime                                   comment <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  remark            <span class="type">varchar</span>(<span class="number">500</span>)    <span class="keyword">default</span> <span class="keyword">null</span>               comment <span class="string">&#x27;备注&#x27;</span>,</span><br><span class="line">  <span class="keyword">primary</span> key (user_id)</span><br><span class="line">) engine<span class="operator">=</span>innodb auto_increment<span class="operator">=</span><span class="number">100</span> comment <span class="operator">=</span> <span class="string">&#x27;用户信息表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="角色表-sys-role"><a href="#角色表-sys-role" class="headerlink" title="角色表 sys_role"></a>角色表 sys_role</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> sys_role;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_role (</span><br><span class="line">  role_id              <span class="type">bigint</span>(<span class="number">20</span>)      <span class="keyword">not</span> <span class="keyword">null</span> auto_increment    comment <span class="string">&#x27;角色ID&#x27;</span>,</span><br><span class="line">  role_name            <span class="type">varchar</span>(<span class="number">30</span>)     <span class="keyword">not</span> <span class="keyword">null</span>                   comment <span class="string">&#x27;角色名称&#x27;</span>,</span><br><span class="line">  role_key             <span class="type">varchar</span>(<span class="number">100</span>)    <span class="keyword">not</span> <span class="keyword">null</span>                   comment <span class="string">&#x27;角色权限字符串&#x27;</span>,</span><br><span class="line">  del_flag             <span class="type">char</span>(<span class="number">1</span>)         <span class="keyword">default</span> <span class="string">&#x27;0&#x27;</span>                comment <span class="string">&#x27;删除标志（0代表存在 1代表删除）&#x27;</span>,</span><br><span class="line">  create_by            <span class="type">varchar</span>(<span class="number">64</span>)     <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>                 comment <span class="string">&#x27;创建者&#x27;</span>,</span><br><span class="line">  create_time          datetime                                   comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  update_by            <span class="type">varchar</span>(<span class="number">64</span>)     <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span>                 comment <span class="string">&#x27;更新者&#x27;</span>,</span><br><span class="line">  update_time          datetime                                   comment <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  remark               <span class="type">varchar</span>(<span class="number">500</span>)    <span class="keyword">default</span> <span class="keyword">null</span>               comment <span class="string">&#x27;备注&#x27;</span>,</span><br><span class="line">  <span class="keyword">primary</span> key (role_id)</span><br><span class="line">) engine<span class="operator">=</span>innodb auto_increment<span class="operator">=</span><span class="number">100</span> comment <span class="operator">=</span> <span class="string">&#x27;角色信息表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="用户角色表-sys-user-role"><a href="#用户角色表-sys-user-role" class="headerlink" title="用户角色表 sys_user_role"></a>用户角色表 sys_user_role</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> sys_user_role;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_user_role (</span><br><span class="line">  user_id   <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;用户ID&#x27;</span>,</span><br><span class="line">  role_id   <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;角色ID&#x27;</span>,</span><br><span class="line">  <span class="keyword">primary</span> key(user_id)</span><br><span class="line">) engine<span class="operator">=</span>innodb comment <span class="operator">=</span> <span class="string">&#x27;用户和角色关联表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="角色菜单表-sys-role-menu"><a href="#角色菜单表-sys-role-menu" class="headerlink" title="角色菜单表 sys_role_menu"></a>角色菜单表 sys_role_menu</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> sys_role_menu;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_role_menu (</span><br><span class="line">  role_id   	 <span class="type">bigint</span>(<span class="number">0</span>) 	<span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;角色ID&#x27;</span>,</span><br><span class="line">  routes    	 text                comment <span class="string">&#x27;保存的routes数据&#x27;</span>,</span><br><span class="line">  checked_keys   text 				 comment <span class="string">&#x27;选中的key&#x27;</span>,</span><br><span class="line">  <span class="keyword">primary</span> key(role_id)</span><br><span class="line">) engine<span class="operator">=</span>innodb comment <span class="operator">=</span> <span class="string">&#x27;角色和菜单关联表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="密码的加密和校验"><a href="#密码的加密和校验" class="headerlink" title="密码的加密和校验"></a>密码的加密和校验</h2><p>用到了hutool包中的BCrypt加密工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.usercenter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.crypto.digest.BCrypt;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/5/12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserPasswordTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密码加密</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testJbcrypt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String passwordToHash = <span class="string">&quot;abc123&quot;</span>;</span><br><span class="line">        <span class="comment">// BCrypt.gensalt()会随机生成一个数作为盐，因此密码相同情况下，每次的密文是不一样</span></span><br><span class="line">        String hashedPassword = BCrypt.hashpw(passwordToHash, BCrypt.gensalt());</span><br><span class="line">        System.out.println(hashedPassword);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密码校验</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testJbcryptCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String passwordToCheck = <span class="string">&quot;abc123&quot;</span>;</span><br><span class="line">        String hashedPassword = <span class="string">&quot;$2a$10$wpngf2ng8ynf2WQGLSgh6.ztH7q7Bn0mhsH.7x08qLevfzISmSzd2&quot;</span>;</span><br><span class="line">        <span class="keyword">boolean</span> checkpw = BCrypt.checkpw(passwordToCheck, hashedPassword);</span><br><span class="line">        System.out.println(checkpw);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240512170629568.png" alt="image-20240512170629568"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240512170542708.png" alt="image-20240512170542708"></p>
<h2 id="后端功能开发"><a href="#后端功能开发" class="headerlink" title="后端功能开发"></a>后端功能开发</h2><h3 id="注册逻辑"><a href="#注册逻辑" class="headerlink" title="注册逻辑"></a>注册逻辑</h3><ol>
<li>用户名不能有特殊字符，并且必须超过6位数</li>
<li>密码必须超过6位数</li>
<li>用户名不能重复</li>
<li>密码加密后保存到数据库中</li>
</ol>
<h3 id="注册接口开发"><a href="#注册接口开发" class="headerlink" title="注册接口开发"></a>注册接口开发</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/sysUser&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;用户管理&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SusUserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    SysUserService sysUserService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户注册</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;用户注册&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;register&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">register</span><span class="params">(String username, String password)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sysUserService.register(username,password);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现 register 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Response <span class="title">register</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.用户名不能有特殊字符，并且必须超过6位数</span></span><br><span class="line">    <span class="keyword">if</span>(!username.matches(<span class="string">&quot;^[a-zA-Z0-9_-]&#123;6,16&#125;$&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> Response.error(<span class="string">&quot;用户名必须超过6位数,并且不能有特殊字符&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.密码必须超过6位数</span></span><br><span class="line">    <span class="keyword">if</span>(password.length() &lt; <span class="number">6</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Response.error(<span class="string">&quot;密码必须超过6位数&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.用户名不能重复</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.getOne(<span class="keyword">new</span> LambdaQueryWrapper&lt;SysUser&gt;().eq(SysUser::getUserName, username)) != <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Response.error(<span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.添加用户到表中</span></span><br><span class="line">    SysUser sysUser = <span class="keyword">new</span> SysUser();</span><br><span class="line">    sysUser.setUserName(username);</span><br><span class="line">    sysUser.setNickName(username);</span><br><span class="line">    sysUser.setPassword(BCrypt.hashpw(password, BCrypt.gensalt())); <span class="comment">// 密码加密保存</span></span><br><span class="line">    <span class="keyword">boolean</span> isOk = <span class="keyword">this</span>.save(sysUser);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> isOk ? Response.success() : Response.error(<span class="string">&quot;注册失败&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="登录逻辑"><a href="#登录逻辑" class="headerlink" title="登录逻辑"></a>登录逻辑</h3><ol>
<li>根据用户名获取数据库表中保存的用户信息</li>
<li>在用传递进来的密码和表中的密码进行密码校验</li>
<li>校验成功返回用户信息</li>
<li>否则登录失败</li>
</ol>
<h3 id="登录接口开发"><a href="#登录接口开发" class="headerlink" title="登录接口开发"></a>登录接口开发</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/sysUser&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;用户管理&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SusUserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    SysUserService sysUserService;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sysUser</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;登录&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">login</span><span class="params">(<span class="meta">@RequestBody</span> SysUser sysUser)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sysUserService.login(sysUser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>login 方法实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Response <span class="title">login</span><span class="params">(SysUser sysUser)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.获取用户填写的用户名和密码</span></span><br><span class="line">    String userName = sysUser.getUserName();</span><br><span class="line">    String password = sysUser.getPassword();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.校验用户名密码</span></span><br><span class="line">    <span class="keyword">if</span>(userName == <span class="keyword">null</span> || password == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Response.error(<span class="string">&quot;用户名或密码不能为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    SysUser one = <span class="keyword">this</span>.getOne(<span class="keyword">new</span> LambdaQueryWrapper&lt;SysUser&gt;().eq(SysUser::getUserName, userName));</span><br><span class="line">    <span class="keyword">if</span>(one == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Response.error(<span class="string">&quot;用户名不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!BCrypt.checkpw(password, one.getPassword()))&#123;</span><br><span class="line">        <span class="keyword">return</span> Response.error(<span class="string">&quot;密码错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.返回用户信息,清空返回体中的密码</span></span><br><span class="line">    one.setPassword(<span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">return</span> Response.rspData(one);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="生成Token"><a href="#生成Token" class="headerlink" title="生成Token"></a>生成Token</h3><p>给登录接口返回的内容中添加Token</p>
<p>在 login 实现方法中增加一个行代码，JwtHelper 的使用方法看的的<a target="_blank" rel="noopener" href="https://blog.csdn.net/SongZhengxing_/article/details/131379687">这个文章</a>，写的很详细</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登录</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sysUser</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Response <span class="title">login</span><span class="params">(SysUser sysUser)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.获取用户填写的用户名和密码</span></span><br><span class="line">    String userName = sysUser.getUserName();</span><br><span class="line">    String password = sysUser.getPassword();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.校验用户名密码</span></span><br><span class="line">    <span class="keyword">if</span>(userName == <span class="keyword">null</span> || password == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Response.error(<span class="string">&quot;用户名或密码不能为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    SysUser one = <span class="keyword">this</span>.getOne(<span class="keyword">new</span> LambdaQueryWrapper&lt;SysUser&gt;().eq(SysUser::getUserName, userName));</span><br><span class="line">    <span class="keyword">if</span>(one == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Response.error(<span class="string">&quot;用户名不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!BCrypt.checkpw(password, one.getPassword()))&#123;</span><br><span class="line">        <span class="keyword">return</span> Response.error(<span class="string">&quot;密码错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.返回用户信息,清空返回体中的密码</span></span><br><span class="line">    one.setPassword(<span class="keyword">null</span>);</span><br><span class="line">    <span class="comment">// 生成token</span></span><br><span class="line">    one.setToken(JwtHelper.createToken(sysUser.getUserId(), sysUser.getUserName()));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Response.rspData(one);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加Token拦截器"><a href="#添加Token拦截器" class="headerlink" title="添加Token拦截器"></a>添加Token拦截器</h3><p>编写 Token 配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.usercenter.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szx.usercenter.handle.TokenHandle;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/5/12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> TokenHandle())</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                .excludePathPatterns(</span><br><span class="line">                        <span class="string">&quot;/sysUser/login&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/sysUser/register&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/swagger-ui.html&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/swagger-ui/index.html&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/swagger-resources&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/v2/api-docs&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/v2/api-docs-ext&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/doc.html&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/swagger-resources/configuration/ui&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/swagger-resources/configuration/security&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/swagger-resources/configuration/ui&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/webjars/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/swagger-resources/**&quot;</span></span><br><span class="line">                );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TokenHandle 代码，从请求头中获取 X-Token，进行校验，如果为空或者过期，则抛出自定义全局异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.usercenter.handle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"><span class="keyword">import</span> com.szx.usercenter.util.JwtHelper;</span><br><span class="line"><span class="keyword">import</span> com.szx.usercenter.util.ResponseEnum;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.method.HandlerMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/5/12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenHandle</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!(handler <span class="keyword">instanceof</span> HandlerMethod))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 从请求头中获取token</span></span><br><span class="line">        String token = request.getHeader(<span class="string">&quot;X-Token&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取请求来源</span></span><br><span class="line">        String referer = request.getHeader(<span class="string">&quot;Referer&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> fromSwagger = referer.endsWith(<span class="string">&quot;swagger-ui/index.html&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 校验token</span></span><br><span class="line">        <span class="keyword">if</span>(!fromSwagger &amp;&amp; (StrUtil.isEmpty(token) || JwtHelper.tokenExpired(token)))&#123;</span><br><span class="line">            <span class="comment">// 如果token校验失败则抛出自定义全局异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> CenterExceptionHandler(ResponseEnum.LOGIN_EXPIRED);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义全局异常"><a href="#自定义全局异常" class="headerlink" title="自定义全局异常"></a>自定义全局异常</h3><p>新建全局异常处理类</p>
<p>GlobalExceptionHandler</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.usercenter.handle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.exceptions.ExceptionUtil;</span><br><span class="line"><span class="keyword">import</span> com.szx.usercenter.util.Response;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.log4j.Log4j2;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/5/12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 全局异常处理</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response&lt;Object&gt; <span class="title">error</span><span class="params">(Exception e)</span></span>&#123;</span><br><span class="line">        log.error(ExceptionUtil.getMessage(e));</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="comment">// 将异常转成string返回出去</span></span><br><span class="line">        <span class="keyword">return</span> Response.error(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理自定义的异常-CenterExceptionHandler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(CenterExceptionHandler.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response&lt;Object&gt;  <span class="title">businessExceptionHandler</span><span class="params">(CenterExceptionHandler e)</span></span>&#123;</span><br><span class="line">        log.error(<span class="string">&quot;CenterExceptionHandler:&quot;</span> + e.getMessage(),e);</span><br><span class="line">        <span class="keyword">return</span> Response.rspMsg(e.getCode(),e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建自定义异常处理类</p>
<p>CenterExceptionHandler</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.usercenter.handle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.szx.usercenter.util.ResponseEnum;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义全局异常处理类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/5/12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CenterExceptionHandler</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 错误码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 业务异常</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message     信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code        错误码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CenterExceptionHandler</span><span class="params">(String message, String code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 业务异常</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> errorCode 错误代码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CenterExceptionHandler</span><span class="params">(ResponseEnum errorCode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(errorCode.getMsg());</span><br><span class="line">        <span class="keyword">this</span>.code = errorCode.getCode();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 默认业务异常，状态默认500</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message 信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CenterExceptionHandler</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">        <span class="keyword">this</span>.code = ResponseEnum.ERROR.getCode();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 默认业务异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CenterExceptionHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(ResponseEnum.ERROR.getMsg());</span><br><span class="line">        <span class="keyword">this</span>.code = ResponseEnum.ERROR.getCode();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再任何需要抛出异常的地方直接使用即可</p>
<p>例如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;testError&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Response <span class="title">testError</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> CenterExceptionHandler(<span class="string">&quot;测试异常&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240512195337458.png" alt="image-20240512195337458"></p>
<h3 id="查询接口开发"><a href="#查询接口开发" class="headerlink" title="查询接口开发"></a>查询接口开发</h3><p>接口实现类 SysUserServiceImpl 添加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户信息脱敏方法</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SysUser <span class="title">getSefUser</span><span class="params">(SysUser user)</span> </span>&#123;</span><br><span class="line">    SysUser sysUser = ObjUtil.clone(user);</span><br><span class="line">    sysUser.setPassword(<span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">return</span> sysUser;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Response <span class="title">getPageUserList</span><span class="params">(SysUser sysUser)</span> </span>&#123;</span><br><span class="line">  Page&lt;SysUser&gt; sysUserPage = <span class="keyword">new</span> Page&lt;&gt;(sysUser.getCurrent(), sysUser.getPageSize());</span><br><span class="line"></span><br><span class="line">  LambdaQueryWrapper&lt;SysUser&gt; qw = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">  <span class="comment">// 用户名称查询</span></span><br><span class="line">  <span class="keyword">if</span> (StrUtil.isNotEmpty(sysUser.getUserName())) &#123;</span><br><span class="line">    qw.like(SysUser::getUserName, sysUser.getUserName());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 手机号查询</span></span><br><span class="line">  <span class="keyword">if</span> (StrUtil.isNotEmpty(sysUser.getPhonenumber())) &#123;</span><br><span class="line">    qw.like(SysUser::getPhonenumber, sysUser.getPhonenumber());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建日期查询,查询当天内的所有数据</span></span><br><span class="line">  <span class="keyword">if</span> (ObjectUtil.isNotEmpty(sysUser.getCreateTime())) &#123;</span><br><span class="line">    Date startDate = DateUtil.beginOfDay(sysUser.getCreateTime()); <span class="comment">// 将前端传来的日期转换为当天的开始时间</span></span><br><span class="line">    Date endDate = DateUtil.endOfDay(startDate);  <span class="comment">// 将结束日期设置为当天的结束时间</span></span><br><span class="line">    qw.between(SysUser::getCreateTime, startDate, endDate);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.page(sysUserPage, qw);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回的用户信息脱敏</span></span><br><span class="line">  List&lt;SysUser&gt; userList = sysUserPage.getRecords();</span><br><span class="line">  sysUserPage.setRecords(</span><br><span class="line">      userList.stream().map(user -&gt; getSefUser(user)).collect(Collectors.toList()));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> Response.rspData(sysUserPage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里前端传递过来的日期格式是字符串类型的日期，例如：2024-05-14 17:12:47，但是后端定义的 createTime 字段类型是 Date 类型，默认会出现一个类型转换错误的异常，如下图</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240517171439008.png" alt="image-20240517171439008"></p>
<p>前端传递的参数</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240517171311614.png" alt="image-20240517171311614"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240517171337859.png" alt="image-20240517171337859"></p>
<p>我们可以修改配置文件，增加一个日期转换格式的配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># 配置日期返回格式</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="comment"># 日期格式</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="comment"># 时区</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">    <span class="comment"># 非空的属性值才会被包含在结果中</span></span><br><span class="line">    <span class="attr">default-property-inclusion:</span> <span class="string">non_null</span></span><br></pre></td></tr></table></figure>

<p>重启项目，再次查询就不会报错了</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240517171617614.png" alt="image-20240517171617614"></p>
<h3 id="自动填充创建人和更新人"><a href="#自动填充创建人和更新人" class="headerlink" title="自动填充创建人和更新人"></a>自动填充创建人和更新人</h3><p>新建一个 BaseUser</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.usercenter.contance;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/5/18</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">// 这里注意添加@Component注解，交给Spring容器管理</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseUser</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String userName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再token拦截器中根据当前请求头中的tokne获取当前用户名，给BaseUser的userName赋值</p>
<p>修改 <code>TokenHandle</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.usercenter.handle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"><span class="keyword">import</span> com.szx.usercenter.contance.BaseUser;</span><br><span class="line"><span class="keyword">import</span> com.szx.usercenter.util.JwtHelper;</span><br><span class="line"><span class="keyword">import</span> com.szx.usercenter.util.ResponseEnum;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.method.HandlerMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2024/5/12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@apiNote</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenHandle</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!(handler <span class="keyword">instanceof</span> HandlerMethod)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 从请求头中获取token</span></span><br><span class="line">        String token = request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取请求来源</span></span><br><span class="line">        String referer = request.getHeader(<span class="string">&quot;Referer&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> fromSwagger = referer.endsWith(<span class="string">&quot;swagger-ui/index.html&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 校验token</span></span><br><span class="line">        <span class="keyword">if</span> (!fromSwagger &amp;&amp; (StrUtil.isEmpty(token) || JwtHelper.tokenExpired(token))) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> CenterExceptionHandler(ResponseEnum.LOGIN_EXPIRED);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取用户名</span></span><br><span class="line">        BaseUser.userName = JwtHelper.getUserName(token);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修该 <code>MybatisPlusConfig</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.szx.usercenter.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.szx.usercenter.contance.BaseUser;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> songzx</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2024-05-11 10:08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> <span class="keyword">implements</span> <span class="title">MetaObjectHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分页插件</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title">mybatisPlusInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MybatisPlusInterceptor interceptor = <span class="keyword">new</span> MybatisPlusInterceptor();</span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> PaginationInnerInterceptor(DbType.MYSQL));</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建日期和更新日期自动更新</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">        setFieldValByName(<span class="string">&quot;createTime&quot;</span>, <span class="keyword">new</span> Date(), metaObject);</span><br><span class="line">        setFieldValByName(<span class="string">&quot;createBy&quot;</span>, BaseUser.userName, metaObject);</span><br><span class="line">        setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> Date(), metaObject);</span><br><span class="line">        setFieldValByName(<span class="string">&quot;updateBy&quot;</span>, BaseUser.userName, metaObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新日期自动更新</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">        setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> Date(), metaObject);</span><br><span class="line">        setFieldValByName(<span class="string">&quot;updateBy&quot;</span>, BaseUser.userName, metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更新和创建时值自动填充</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240518111601052.png" alt="image-20240518111601052"></p>
<h2 id="前端功能开发"><a href="#前端功能开发" class="headerlink" title="前端功能开发"></a>前端功能开发</h2><h3 id="登录逻辑梳理"><a href="#登录逻辑梳理" class="headerlink" title="登录逻辑梳理"></a>登录逻辑梳理</h3><p>首先找到登录页面对应的文件，位置在<code>src/pages/User/Login/index.tsx</code>，然后观察代码，发现登录页面使用了 <code>LoginForm</code> 组件来实现的登录表单，<code>LoginForm</code> 是从 <code>@ant-design/pro-components</code> 中导出的，<a target="_blank" rel="noopener" href="https://pro-components.antdigital.dev/">ProComponents</a> 是基于 Ant Design 而开发的模板组件，提供了更高级别的抽象支持，开箱即用。可以显著地提升制作 CRUD 页面的效率，更加专注于页面。</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240512101318285.png" alt="image-20240512101318285"></p>
<p>loginForm组件使用文档：<a target="_blank" rel="noopener" href="https://pro-components.antdigital.dev/components/form">https://pro-components.antdigital.dev/components/form</a></p>
<p>点击登录会触发onFinish钩子函数，调用handleSubmit方法</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240512101903528.png" alt="image-20240512101903528"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240511180444921.png" alt="image-20240511180444921"></p>
<p>login方法在<code>src/services/ant-design-pro/api.ts</code> 文件中声明</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240512102226082.png" alt="image-20240512102226082"></p>
<p>登录成功后调用 <code>fetchUserInfo</code> 方法获取用户信息</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240512102451836.png" alt="image-20240512102451836"></p>
<p><code>useModel</code> 是 <code>@umi/max</code> 内置的<strong>数据流管理</strong><a target="_blank" rel="noopener" href="https://github.com/umijs/umi/blob/master/packages/plugins/src/model.ts">插件</a>，它是一种基于 <code>hooks</code> 范式的轻量级数据管理方案，可以在 Umi 项目中管理全局的共享数据。</p>
<p>文档地址：<a target="_blank" rel="noopener" href="https://umijs.org/docs/max/data-flow#usemodel">https://umijs.org/docs/max/data-flow#usemodel</a></p>
<p><code>useModel(&#39;@@initialState&#39;)</code> 表示读取 <code>app.tsx</code> 文件中的 <code>getInitialState</code> 方法的返回值</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;initialState, setInitialState&#125; = useModel(<span class="string">&#x27;@@initialState&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>app.tsx 文件中的 <code>getInitialState </code> 代码如下</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;currentUser <span class="keyword">as</span> queryCurrentUser&#125; <span class="keyword">from</span> <span class="string">&#x27;@/services/ant-design-pro/api&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> loginPath = <span class="string">&#x27;/user/login&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getInitialState</span>(<span class="params"></span>): <span class="title">Promise</span>&lt;</span>&#123;</span><br><span class="line">  settings?: Partial&lt;LayoutSettings&gt;;</span><br><span class="line">  currentUser?: API.CurrentUser;</span><br><span class="line">  loading?: <span class="built_in">boolean</span>;</span><br><span class="line">  fetchUserInfo?: <span class="function">() =&gt;</span> <span class="built_in">Promise</span>&lt;API.CurrentUser | <span class="literal">undefined</span>&gt;;</span><br><span class="line">&#125;&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> fetchUserInfo = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;获取用户信息&quot;</span>)</span><br><span class="line">      <span class="keyword">const</span> msg = <span class="keyword">await</span> queryCurrentUser(&#123;</span><br><span class="line">        skipErrorHandler: <span class="literal">true</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> msg.data;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      history.push(loginPath);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// 如果不是登录页面，执行</span></span><br><span class="line">  <span class="keyword">const</span> &#123;location&#125; = history;</span><br><span class="line">  <span class="keyword">if</span> (location.pathname !== loginPath) &#123;</span><br><span class="line">    <span class="keyword">const</span> currentUser = <span class="keyword">await</span> fetchUserInfo();</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      fetchUserInfo,</span><br><span class="line">      currentUser,</span><br><span class="line">      settings: defaultSettings <span class="keyword">as</span> Partial&lt;LayoutSettings&gt;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    fetchUserInfo,</span><br><span class="line">    settings: defaultSettings <span class="keyword">as</span> Partial&lt;LayoutSettings&gt;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查看 queryCurrentUser 接口地址</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240512104040157.png" alt="image-20240512104040157"></p>
<p>找到mock中对应的接口</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240512104147557.png" alt="image-20240512104147557"></p>
<p>下面我们按照这种格式编写后端接口即可</p>
<h3 id="修改响应拦截器"><a href="#修改响应拦截器" class="headerlink" title="修改响应拦截器"></a>修改响应拦截器</h3><p>找到 <code>src/requestErrorConfig.tss</code> 文件，这个文件中处理请求拦截和响应拦截</p>
<p>需要做的功能</p>
<ul>
<li>给每个请求添加一个基础路径，配合代理完成跨域处理</li>
<li>给每个请求中添加token请求头</li>
<li>判断响应结果是否成功，如果不成功弹出错误提醒</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123;RequestOptions&#125; <span class="keyword">from</span> <span class="string">&#x27;@@/plugin-request/request&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123;RequestConfig&#125; <span class="keyword">from</span> <span class="string">&#x27;@umijs/max&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;message, notification&#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;getToken&#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误处理方案： 错误类型</span></span><br><span class="line"><span class="built_in">enum</span> ErrorShowType &#123;</span><br><span class="line">  SILENT = <span class="number">0</span>,</span><br><span class="line">  WARN_MESSAGE = <span class="number">1</span>,</span><br><span class="line">  ERROR_MESSAGE = <span class="number">2</span>,</span><br><span class="line">  NOTIFICATION = <span class="number">3</span>,</span><br><span class="line">  REDIRECT = <span class="number">9</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 与后端约定的响应数据格式</span></span><br><span class="line"><span class="keyword">interface</span> ResponseStructure &#123;</span><br><span class="line">  success: <span class="built_in">boolean</span>;</span><br><span class="line">  data: <span class="built_in">any</span>;</span><br><span class="line">  errorCode?: <span class="built_in">number</span>;</span><br><span class="line">  errorMessage?: <span class="built_in">string</span>;</span><br><span class="line">  showType?: ErrorShowType;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求前缀</span></span><br><span class="line"><span class="keyword">const</span> baseURL = <span class="string">&#x27;/api&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@name </span>错误处理</span></span><br><span class="line"><span class="comment"> * pro 自带的错误处理， 可以在这里做自己的改动</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@doc </span>https://umijs.org/docs/max/request#配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> errorConfig: RequestConfig = &#123;</span><br><span class="line">  <span class="comment">// 错误处理： umi@3 的错误处理方案。</span></span><br><span class="line">  errorConfig: &#123;</span><br><span class="line">    <span class="comment">// 错误抛出</span></span><br><span class="line">    errorThrower: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; success, data, errorCode, errorMessage, showType &#125; =</span><br><span class="line">        res <span class="keyword">as</span> unknown <span class="keyword">as</span> ResponseStructure;</span><br><span class="line">      <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="keyword">const</span> error: <span class="built_in">any</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(errorMessage);</span><br><span class="line">        error.name = <span class="string">&#x27;BizError&#x27;</span>;</span><br><span class="line">        error.info = &#123; errorCode, errorMessage, showType, data &#125;;</span><br><span class="line">        <span class="keyword">throw</span> error; <span class="comment">// 抛出自制的错误</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 错误接收及处理</span></span><br><span class="line">    errorHandler: <span class="function">(<span class="params">error: <span class="built_in">any</span>, opts: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (opts?.skipErrorHandler) <span class="keyword">throw</span> error;</span><br><span class="line">      <span class="comment">// 我们的 errorThrower 抛出的错误。</span></span><br><span class="line">      <span class="keyword">if</span> (error.name === <span class="string">&#x27;BizError&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> errorInfo: ResponseStructure | <span class="literal">undefined</span> = error.info;</span><br><span class="line">        <span class="keyword">if</span> (errorInfo) &#123;</span><br><span class="line">          <span class="keyword">const</span> &#123; errorMessage, errorCode &#125; = errorInfo;</span><br><span class="line">          <span class="keyword">switch</span> (errorInfo.showType) &#123;</span><br><span class="line">            <span class="keyword">case</span> ErrorShowType.SILENT:</span><br><span class="line">              <span class="comment">// do nothing</span></span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> ErrorShowType.WARN_MESSAGE:</span><br><span class="line">              message.warning(errorMessage);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> ErrorShowType.ERROR_MESSAGE:</span><br><span class="line">              message.error(errorMessage);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> ErrorShowType.NOTIFICATION:</span><br><span class="line">              notification.open(&#123;</span><br><span class="line">                description: errorMessage,</span><br><span class="line">                message: errorCode,</span><br><span class="line">              &#125;);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> ErrorShowType.REDIRECT:</span><br><span class="line">              <span class="comment">// <span class="doctag">TODO:</span> redirect</span></span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">              message.error(errorMessage);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error.response) &#123;</span><br><span class="line">        <span class="comment">// Axios 的错误</span></span><br><span class="line">        <span class="comment">// 请求成功发出且服务器也响应了状态码，但状态代码超出了 2xx 的范围</span></span><br><span class="line">        message.error(<span class="string">`Response status:<span class="subst">$&#123;error.response.status&#125;</span>`</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error.request) &#123;</span><br><span class="line">        <span class="comment">// 请求已经成功发起，但没有收到响应</span></span><br><span class="line">        <span class="comment">// \`error.request\` 在浏览器中是 XMLHttpRequest 的实例，</span></span><br><span class="line">        <span class="comment">// 而在node.js中是 http.ClientRequest 的实例</span></span><br><span class="line">        message.error(<span class="string">&#x27;None response! Please retry.&#x27;</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 发送请求时出了点问题</span></span><br><span class="line">        message.error(error?.data || error?.msg);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 请求拦截器</span></span><br><span class="line">  requestInterceptors: [</span><br><span class="line">    (config: RequestOptions) =&gt; &#123;</span><br><span class="line">      <span class="comment">// 给请求头中加一个abc参数</span></span><br><span class="line">      config.headers.Authorization = getToken();</span><br><span class="line">      <span class="comment">// 拦截请求配置，进行个性化处理。</span></span><br><span class="line">      <span class="keyword">const</span> url = baseURL + config?.url;</span><br><span class="line">      <span class="keyword">return</span> &#123; ...config, url &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 响应拦截器</span></span><br><span class="line">  responseInterceptors: [</span><br><span class="line">    (response) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> sucCodes = [<span class="string">&#x27;200&#x27;</span>, <span class="number">200</span>];</span><br><span class="line">      <span class="comment">// 拦截响应数据，进行个性化处理</span></span><br><span class="line">      <span class="keyword">const</span> &#123; data &#125; = response <span class="keyword">as</span> unknown <span class="keyword">as</span> ResponseStructure;</span><br><span class="line">      <span class="keyword">if</span> (!sucCodes.includes(data?.code)) &#123;</span><br><span class="line">        <span class="comment">// 返回错误信息交给错误处理器</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(data);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> response;</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>用到的 <code>getToken</code> 方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置token</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">token</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setToken</span>(<span class="params">token</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">localStorage</span>.setItem(<span class="string">&#x27;token&#x27;</span>,token)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取token</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getToken</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="设置代理"><a href="#设置代理" class="headerlink" title="设置代理"></a>设置代理</h3><p>修改 <code>config/proxy.ts</code> 代码</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@name </span>代理的配置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see </span>在生产环境 代理是无法生效的，所以这里没有生产环境的配置</span></span><br><span class="line"><span class="comment"> * -------------------------------</span></span><br><span class="line"><span class="comment"> * The agent cannot take effect in the production environment</span></span><br><span class="line"><span class="comment"> * so there is no configuration of the production environment</span></span><br><span class="line"><span class="comment"> * For details, please see</span></span><br><span class="line"><span class="comment"> * https://pro.ant.design/docs/deploy</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@doc </span>https://umijs.org/docs/guides/proxy</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 如果需要自定义本地开发服务器  请取消注释按需调整</span></span><br><span class="line">  dev: &#123;</span><br><span class="line">    <span class="string">&#x27;/api/edu&#x27;</span>: &#123;</span><br><span class="line">      target: <span class="string">&#x27;http://123.60.16.27:8101&#x27;</span>,</span><br><span class="line">      changeOrigin: <span class="literal">true</span>,</span><br><span class="line">      pathRewrite: &#123; <span class="string">&#x27;/api&#x27;</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// localhost:8000/api/** -&gt; https://preview.pro.ant.design/api/**</span></span><br><span class="line">    <span class="string">&#x27;/api/&#x27;</span>: &#123;</span><br><span class="line">      <span class="comment">// 要代理的地址</span></span><br><span class="line">      target: <span class="string">&#x27;http://localhost:8080&#x27;</span>,</span><br><span class="line">      <span class="comment">// 配置了这个可以从 http 代理到 https</span></span><br><span class="line">      <span class="comment">// 依赖 origin 的功能可能需要这个，比如 cookie</span></span><br><span class="line">      changeOrigin: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 去掉真实请求地址中的/api</span></span><br><span class="line">      pathRewrite: &#123; <span class="string">&#x27;/api&#x27;</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@name </span>详细的代理配置</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@doc </span>https://github.com/chimurai/http-proxy-middleware</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  test: &#123;</span><br><span class="line">    <span class="comment">// localhost:8000/api/** -&gt; https://preview.pro.ant.design/api/**</span></span><br><span class="line">    <span class="string">&#x27;/api/&#x27;</span>: &#123;</span><br><span class="line">      target: <span class="string">&#x27;https://proapi.azurewebsites.net&#x27;</span>,</span><br><span class="line">      changeOrigin: <span class="literal">true</span>,</span><br><span class="line">      pathRewrite: &#123; <span class="string">&#x27;^&#x27;</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  pre: &#123;</span><br><span class="line">    <span class="string">&#x27;/api/&#x27;</span>: &#123;</span><br><span class="line">      target: <span class="string">&#x27;your pre url&#x27;</span>,</span><br><span class="line">      changeOrigin: <span class="literal">true</span>,</span><br><span class="line">      pathRewrite: &#123; <span class="string">&#x27;^&#x27;</span>: <span class="string">&#x27;&#x27;</span> &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h3><p>找到 <code>src/access.ts</code> 文件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">access</span>(<span class="params">initialState: &#123; currentUser?: API.CurrentUser &#125; | <span class="literal">undefined</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;currentUser&#125; = initialState ?? &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    canAdmin: currentUser &amp;&amp; currentUser.access?.includes(<span class="string">&quot;admin&quot;</span>),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>access 方法的 initialState 参数就是 <code>app.tsx</code> 文件中的 getInitialState 方法的返回值，这里是 Umi 框架帮我们封装好的</p>
<p>参考文档：<a target="_blank" rel="noopener" href="https://pro.ant.design/zh-CN/docs/authority-management">权限管理 - Ant Design Pro</a></p>
<h3 id="登录功能实现"><a href="#登录功能实现" class="headerlink" title="登录功能实现"></a>登录功能实现</h3><p>修改 <code>src/pages/Login/index.tsx</code> 文件代码，删除多余代码</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Footer &#125; <span class="keyword">from</span> <span class="string">&#x27;@/components&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; login &#125; <span class="keyword">from</span> <span class="string">&#x27;@/services/ant-design-pro/api&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; LockOutlined, UserOutlined &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; LoginForm, ProFormText &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/pro-components&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; history, useModel, Helmet &#125; <span class="keyword">from</span> <span class="string">&#x27;@umijs/max&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; message, Tabs &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Settings <span class="keyword">from</span> <span class="string">&#x27;../../../config/defaultSettings&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; flushSync &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; setToken &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ForgotPasswordForm <span class="keyword">from</span> <span class="string">&#x27;@/pages/Login/ForgotPasswordForm&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> useStyles <span class="keyword">from</span> <span class="string">&#x27;./useStyles.less&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getUserRole = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> [<span class="string">&#x27;admin&#x27;</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Login: React.FC = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [<span class="keyword">type</span>, setType] = useState&lt;<span class="built_in">string</span>&gt;(<span class="string">&#x27;account&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> &#123; initialState, setInitialState &#125; = useModel(<span class="string">&#x27;@@initialState&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> [forgotPassword, setForgotPassword] = useState(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> fetchUserInfo = <span class="keyword">async</span> (data) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (data) &#123;</span><br><span class="line">      <span class="keyword">let</span> roles = <span class="keyword">await</span> getUserRole();</span><br><span class="line">      flushSync(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 更新全局保存的用户信息</span></span><br><span class="line">        setInitialState(<span class="function">(<span class="params">s</span>) =&gt;</span> (&#123;</span><br><span class="line">          ...s,</span><br><span class="line">          currentUser: &#123;</span><br><span class="line">            ...data,</span><br><span class="line">            access: roles,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;));</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> handleSubmit = <span class="keyword">async</span> (values) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    <span class="keyword">let</span> &#123; data &#125; = <span class="keyword">await</span> login(&#123;</span><br><span class="line">      userName: values.username,</span><br><span class="line">      password: values.password,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (data.token) &#123;</span><br><span class="line">      setToken(data.token);</span><br><span class="line">      <span class="keyword">const</span> defaultLoginSuccessMessage = <span class="string">&#x27;登录成功！&#x27;</span>;</span><br><span class="line">      message.success(defaultLoginSuccessMessage);</span><br><span class="line">      <span class="keyword">await</span> fetchUserInfo(data);</span><br><span class="line">      <span class="keyword">const</span> urlParams = <span class="keyword">new</span> URL(<span class="built_in">window</span>.location.href).searchParams;</span><br><span class="line">      history.push(urlParams.get(<span class="string">&#x27;redirect&#x27;</span>) || <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> updatePasswordStatus = <span class="function">(<span class="params">flag</span>) =&gt;</span> &#123;</span><br><span class="line">    setForgotPassword(flag);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=&#123;useStyles.container&#125;&gt;</span><br><span class="line">      &lt;Helmet&gt;</span><br><span class="line">        &lt;title&gt;</span><br><span class="line">          &#123;<span class="string">&#x27;登录&#x27;</span>&#125;- &#123;Settings.title&#125;</span><br><span class="line">        &lt;/title&gt;</span><br><span class="line">      &lt;/Helmet&gt;</span><br><span class="line"></span><br><span class="line">      &#123;<span class="comment">/*忘记密码，重置密码表单*/</span>&#125;</span><br><span class="line">      &#123;forgotPassword &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">ForgotPasswordForm</span> <span class="attr">updatePasswordStatus</span>=<span class="string">&#123;updatePasswordStatus&#125;</span> /&gt;</span></span>&#125;</span><br><span class="line"></span><br><span class="line">      &#123;!forgotPassword &amp;&amp; (</span><br><span class="line">        &lt;div style=&#123;&#123; <span class="attr">marginTop</span>: <span class="string">&#x27;5%&#x27;</span> &#125;&#125;&gt;</span><br><span class="line">          &lt;LoginForm</span><br><span class="line">            contentStyle=&#123;&#123;</span><br><span class="line">              minWidth: <span class="number">280</span>,</span><br><span class="line">              maxWidth: <span class="string">&#x27;75vw&#x27;</span>,</span><br><span class="line">            &#125;&#125;</span><br><span class="line">            logo=&#123;<span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">&quot;logo&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/logo.svg&quot;</span> /&gt;</span></span>&#125;</span><br><span class="line">            title=<span class="string">&quot;用户管理中心&quot;</span></span><br><span class="line">            initialValues=&#123;&#123;</span><br><span class="line">              autoLogin: <span class="literal">false</span>,</span><br><span class="line">              username: <span class="string">&#x27;admin001&#x27;</span>,</span><br><span class="line">              password: <span class="string">&#x27;Abc123&#x27;</span>,</span><br><span class="line">            &#125;&#125;</span><br><span class="line">            onFinish=&#123;<span class="keyword">async</span> (values) =&gt; &#123;</span><br><span class="line">              <span class="keyword">await</span> handleSubmit(values <span class="keyword">as</span> API.LoginParams);</span><br><span class="line">            &#125;&#125;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;Tabs</span><br><span class="line">              activeKey=&#123;<span class="keyword">type</span>&#125;</span><br><span class="line">              onChange=&#123;setType&#125;</span><br><span class="line">              centered</span><br><span class="line">              items=&#123;[</span><br><span class="line">                &#123;</span><br><span class="line">                  key: <span class="string">&#x27;account&#x27;</span>,</span><br><span class="line">                  label: <span class="string">&#x27;账户密码登录&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">              ]&#125;</span><br><span class="line">            /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;&gt;</span><br><span class="line">              &lt;ProFormText</span><br><span class="line">                name=<span class="string">&quot;username&quot;</span></span><br><span class="line">                fieldProps=&#123;&#123;</span><br><span class="line">                  size: <span class="string">&#x27;large&#x27;</span>,</span><br><span class="line">                  prefix: <span class="xml"><span class="tag">&lt;<span class="name">UserOutlined</span> /&gt;</span></span>,</span><br><span class="line">                &#125;&#125;</span><br><span class="line">                placeholder=&#123;<span class="string">&#x27;请输入用户名&#x27;</span>&#125;</span><br><span class="line">                rules=&#123;[</span><br><span class="line">                  &#123;</span><br><span class="line">                    required: <span class="literal">true</span>,</span><br><span class="line">                    message: <span class="string">&#x27;用户名是必填项！&#x27;</span>,</span><br><span class="line">                  &#125;,</span><br><span class="line">                ]&#125;</span><br><span class="line">              /&gt;</span><br><span class="line">              &lt;ProFormText.Password</span><br><span class="line">                name=<span class="string">&quot;password&quot;</span></span><br><span class="line">                fieldProps=&#123;&#123;</span><br><span class="line">                  size: <span class="string">&#x27;large&#x27;</span>,</span><br><span class="line">                  prefix: <span class="xml"><span class="tag">&lt;<span class="name">LockOutlined</span> /&gt;</span></span>,</span><br><span class="line">                &#125;&#125;</span><br><span class="line">                placeholder=&#123;<span class="string">&#x27;请输入密码&#x27;</span>&#125;</span><br><span class="line">                rules=&#123;[</span><br><span class="line">                  &#123;</span><br><span class="line">                    required: <span class="literal">true</span>,</span><br><span class="line">                    message: <span class="string">&#x27;密码是必填项！&#x27;</span>,</span><br><span class="line">                  &#125;,</span><br><span class="line">                ]&#125;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;div</span><br><span class="line">              style=&#123;&#123;</span><br><span class="line">                marginBottom: <span class="number">24</span>,</span><br><span class="line">              &#125;&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              &lt;a</span><br><span class="line">                style=&#123;&#123;</span><br><span class="line">                  float: <span class="string">&#x27;right&#x27;</span>,</span><br><span class="line">                  marginBottom: <span class="number">20</span>,</span><br><span class="line">                &#125;&#125;</span><br><span class="line">                onClick=&#123;<span class="function">() =&gt;</span> updatePasswordStatus(<span class="literal">true</span>)&#125;</span><br><span class="line">              &gt;</span><br><span class="line">                忘记密码 ?</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/LoginForm&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      )&#125;</span><br><span class="line">      &lt;Footer /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Login;</span><br></pre></td></tr></table></figure>

<p>登录接口 <code>src/services/ant-design-pro/api.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;request&#125; <span class="keyword">from</span> <span class="string">&#x27;@umijs/max&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 登录接口  */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">body: API.LoginParams, options?: &#123; [key: <span class="built_in">string</span>]: <span class="built_in">any</span> &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;API.LoginResult&gt;(<span class="string">&#x27;/sysUser/login&#x27;</span>, &#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    data: body,</span><br><span class="line">    ...(options || &#123;&#125;),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>样式文件 <code>useStyles.less</code></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: auto;</span><br><span class="line">  <span class="attribute">background-image</span>: url(<span class="string">https://mdn.alipayobjects.com/yuyan_qk0oxh/afts/img/V-_oS6r-i7wAAAAAAAAAAAAAFl94AQBr</span>);</span><br><span class="line">  <span class="attribute">background-size</span>: <span class="number">100%</span> <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="忘记密码"><a href="#忘记密码" class="headerlink" title="忘记密码"></a>忘记密码</h3><p>新建文件 <code>src/pages/Login/ForgotPasswordForm.tsx</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Button, Form, Input, message, Tabs&#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;LockOutlined, UserOutlined&#125; <span class="keyword">from</span> <span class="string">&quot;@ant-design/icons&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;updatePasswordFun&#125; <span class="keyword">from</span> <span class="string">&quot;@/services/ant-design-pro/login&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 组件名: ForgotPasswordForm</span></span><br><span class="line"><span class="comment"> * 组件用途: 重置密码表单</span></span><br><span class="line"><span class="comment"> * 创建日期: 2024/5/14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> ForgotPasswordForm = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> onFinish = <span class="function">(<span class="params">values</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (values.password.length &lt; <span class="number">6</span>) &#123;</span><br><span class="line">      message.error(<span class="string">&quot;密码长度至少6位&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 密码必须同时包含数字和大小写字母</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="regexp">/[A-Z]/</span>.test(values.password) || !<span class="regexp">/[a-z]/</span>.test(values.password) || !<span class="regexp">/[0-9]/</span>.test(values.password)) &#123;</span><br><span class="line">      message.error(<span class="string">&quot;密码必须同时包含数字和大小写字母&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 两次密码必须一致</span></span><br><span class="line">    <span class="keyword">if</span> (values.password !== values.newPassword) &#123;</span><br><span class="line">      message.error(<span class="string">&quot;两次密码不一致&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    updatePasswordFun(values.userName, values.newPassword).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      message.success(<span class="string">&quot;更新密码成功,返回登录&quot;</span>)</span><br><span class="line">      props.updatePasswordStatus(<span class="literal">false</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=&#123;<span class="string">&quot;ant-pro-form-login-container&quot;</span>&#125; style=&#123;&#123;</span><br><span class="line">      display: <span class="string">&quot;flex&quot;</span>,</span><br><span class="line">      flexDirection: <span class="string">&quot;column&quot;</span>,</span><br><span class="line">      alignItems: <span class="string">&quot;center&quot;</span>,</span><br><span class="line">      flex: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">      height: <span class="string">&quot;auto&quot;</span></span><br><span class="line">    &#125;&#125;&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div className=<span class="string">&quot;ant-pro-form-login-header&quot;</span> style=&#123;&#123;</span><br><span class="line">        marginTop: <span class="string">&quot;5%&quot;</span></span><br><span class="line">      &#125;&#125;&gt;</span><br><span class="line">        &lt;span className=<span class="string">&quot;ant-pro-form-login-logo &quot;</span>&gt;</span><br><span class="line">          &lt;img alt=<span class="string">&quot;logo&quot;</span> src=<span class="string">&quot;/logo.svg&quot;</span>/&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">        &lt;span className=<span class="string">&quot;ant-pro-form-login-title &quot;</span>&gt;</span><br><span class="line">          用户管理中心</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;Tabs</span><br><span class="line">        activeKey=&#123;<span class="string">&quot;account&quot;</span>&#125;</span><br><span class="line">        centered</span><br><span class="line">        items=&#123;[</span><br><span class="line">          &#123;</span><br><span class="line">            key: <span class="string">&#x27;account&#x27;</span>,</span><br><span class="line">            label: <span class="string">&#x27;重置密码&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        ]&#125;</span><br><span class="line">      /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;Form</span><br><span class="line">        name=<span class="string">&quot;basic&quot;</span></span><br><span class="line">        style=&#123;&#123;</span><br><span class="line">          width: <span class="number">328</span></span><br><span class="line">        &#125;&#125;</span><br><span class="line">        initialValues=&#123;&#123;</span><br><span class="line">          remember: <span class="literal">false</span>,</span><br><span class="line">        &#125;&#125;</span><br><span class="line">        layout=<span class="string">&quot;vertical&quot;</span></span><br><span class="line">        onFinish=&#123;onFinish&#125;</span><br><span class="line">        autoComplete=<span class="string">&quot;off&quot;</span></span><br><span class="line">      &gt;</span><br><span class="line">        &lt;Form.Item</span><br><span class="line">          label=<span class="string">&quot;&quot;</span></span><br><span class="line">          name=<span class="string">&quot;userName&quot;</span></span><br><span class="line">          rules=&#123;[</span><br><span class="line">            &#123;</span><br><span class="line">              required: <span class="literal">true</span>,</span><br><span class="line">              message: <span class="string">&#x27;请输入用户名&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          ]&#125;</span><br><span class="line"></span><br><span class="line">        &gt;</span><br><span class="line">          &lt;Input</span><br><span class="line">            size=&#123;<span class="string">&#x27;large&#x27;</span>&#125;</span><br><span class="line">            prefix=&#123;</span><br><span class="line">              &lt;UserOutlined/&gt;</span><br><span class="line">            &#125;</span><br><span class="line">            placeholder=<span class="string">&quot;请输入用户名&quot;</span>/&gt;</span><br><span class="line">        &lt;/Form.Item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Form.Item</span><br><span class="line">          label=<span class="string">&quot;&quot;</span></span><br><span class="line">          name=<span class="string">&quot;password&quot;</span></span><br><span class="line">          rules=&#123;[</span><br><span class="line">            &#123;</span><br><span class="line">              required: <span class="literal">true</span>,</span><br><span class="line">              message: <span class="string">&#x27;请输入密码!&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          ]&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;Input.Password size=&#123;<span class="string">&#x27;large&#x27;</span>&#125; prefix=&#123;<span class="xml"><span class="tag">&lt;<span class="name">LockOutlined</span>/&gt;</span></span>&#125; placeholder=<span class="string">&quot;请输入密码&quot;</span>/&gt;</span><br><span class="line">        &lt;/Form.Item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Form.Item</span><br><span class="line">          label=<span class="string">&quot;&quot;</span></span><br><span class="line">          name=<span class="string">&quot;newPassword&quot;</span></span><br><span class="line">          rules=&#123;[</span><br><span class="line">            &#123;</span><br><span class="line">              required: <span class="literal">true</span>,</span><br><span class="line">              message: <span class="string">&#x27;请确认密码!&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          ]&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;Input.Password size=&#123;<span class="string">&#x27;large&#x27;</span>&#125; prefix=&#123;<span class="xml"><span class="tag">&lt;<span class="name">LockOutlined</span>/&gt;</span></span>&#125; placeholder=<span class="string">&quot;请确认密码&quot;</span>/&gt;</span><br><span class="line">        &lt;/Form.Item&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div</span><br><span class="line">          style=&#123;&#123;</span><br><span class="line">            marginBottom: <span class="number">24</span>,</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;a</span><br><span class="line">            style=&#123;&#123;</span><br><span class="line">              float: <span class="string">&#x27;right&#x27;</span>,</span><br><span class="line">              marginBottom: <span class="number">20</span></span><br><span class="line">            &#125;&#125;</span><br><span class="line">            onClick=&#123;<span class="function">() =&gt;</span> props.updatePasswordStatus(<span class="literal">false</span>)&#125;</span><br><span class="line">          &gt;</span><br><span class="line">            返回登录</span><br><span class="line">          &lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button <span class="keyword">type</span>=<span class="string">&quot;primary&quot;</span> htmlType=<span class="string">&quot;submit&quot;</span> size=<span class="string">&quot;large&quot;</span> block&gt;</span><br><span class="line">          确认</span><br><span class="line">        &lt;/Button&gt;</span><br><span class="line">      &lt;/Form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ForgotPasswordForm;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240517173734307.png" alt="image-20240517173734307"></p>
<h3 id="动态获取菜单"><a href="#动态获取菜单" class="headerlink" title="动态获取菜单"></a>动态获取菜单</h3><p>官方提供的动态菜单实现方法：<a target="_blank" rel="noopener" href="https://pro.ant.design/zh-CN/docs/advanced-menu">菜单的高级用法 - Ant Design Pro</a></p>
<p>前提说明：实现动态路由时，所有的路由都必须提前在 <code>config/routes.ts</code> 中注册好，如果动态返回了 <code>routes.ts</code> 中不存在的路由信息，页面将会无法访问，具体问题可参考（<a target="_blank" rel="noopener" href="https://github.com/ant-design/ant-design-pro/issues/11137">Issue #11137</a>）。只能动态返回 <code>routes.ts</code> 内的数据</p>
<p>修改 <code>app.tsx</code> 的 layout 方法，在配置中添加 <code>menu </code> 属性即可实现动态菜单</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ProLayout 支持的api https://procomponents.ant.design/components/layout</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> layout: RunTimeLayoutConfig = <span class="function">(<span class="params">&#123; initialState, setInitialState &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// ... 省略其他代码</span></span><br><span class="line">    menu: &#123;</span><br><span class="line">      <span class="comment">// 每当 initialState?.currentUser?.userid 发生修改时重新执行 request</span></span><br><span class="line">      params: &#123;</span><br><span class="line">        userId: initialState?.currentUser?.userId,</span><br><span class="line">        roleIds: initialState?.currentUser?.sysRoleList?.map(<span class="function">(<span class="params">item</span>) =&gt;</span> item.roleId),</span><br><span class="line">      &#125;,</span><br><span class="line">      request: <span class="keyword">async</span> (params, defaultMenuData) =&gt; &#123;</span><br><span class="line">        <span class="comment">// 调用接口获取菜单数据</span></span><br><span class="line">        <span class="keyword">let</span> &#123; data &#125; = <span class="keyword">await</span> getRoleMenuFun(params.roleIds);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (data.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> defaultMenuData;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 手动映射icon</span></span><br><span class="line">    menuDataRender: <span class="function">(<span class="params">menuData</span>) =&gt;</span> fixMenuItemIcon(menuData),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>接口返回的data菜单格式和 <code>config/routes.ts</code> 中配置的保持一致，更多配置可以参考：<a target="_blank" rel="noopener" href="https://pro.ant.design/zh-CN/blog/new-pro-use#menuitemrender-props">Pro 的 Layout 组件 - Ant Design Pro</a></p>
<p>返回内容示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: &#x27;/user/login&#x27;,</span><br><span class="line">  layout: false, // 页面是否在layout布局样式下显示，设置成false会单独显示</span><br><span class="line">  hideInMenu: true, // 是否隐藏菜单，这里只是设置不在左侧菜单列表中显示，仍可以访问</span><br><span class="line">  name: &#x27;登录&#x27;,</span><br><span class="line">  component: &#x27;./Login&#x27;,</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  path: &#x27;/welcome&#x27;,</span><br><span class="line">  name: &#x27;欢迎&#x27;,</span><br><span class="line">  icon: &#x27;smile&#x27;,</span><br><span class="line">  component: &#x27;./Welcome&#x27;,</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  path: &#x27;test&#x27;,</span><br><span class="line">  name: &#x27;一级菜单&#x27;,</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: &#x27;test1&#x27;,</span><br><span class="line">      name: &#x27;二级菜单1&#x27;,</span><br><span class="line">      routes: [</span><br><span class="line">        &#123;</span><br><span class="line">          path: &#x27;test1-1&#x27;,</span><br><span class="line">          name: &#x27;三级菜单1-1&#x27;,</span><br><span class="line">          component: &#x27;./Test&#x27;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          path: &#x27;test1-2&#x27;,</span><br><span class="line">          name: &#x27;三级菜单1-2&#x27;,</span><br><span class="line">          component: &#x27;./Test&#x27;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: &#x27;test2&#x27;,</span><br><span class="line">      name: &#x27;二级菜单2&#x27;,</span><br><span class="line">      component: &#x27;./Test&#x27;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>当我们使用了动态返回的菜单时，图标就不出现了，这时需要手动映射icon图标，可参考<a target="_blank" rel="noopener" href="https://github.com/ant-design/ant-design-pro/issues/8101">这里</a></p>
<p>添加 <code>src/utils/fixMenuItemIcon.ts</code> 文件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> allIcons <span class="keyword">from</span> <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// FIX从接口获取菜单时icon为string类型</span></span><br><span class="line"><span class="keyword">const</span> fixMenuItemIcon = <span class="function">(<span class="params">menus, iconType = <span class="string">&#x27;Outlined&#x27;</span></span>) =&gt;</span> &#123;</span><br><span class="line">  menus.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; icon, children &#125; = item;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> icon === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> fixIconName = icon.slice(<span class="number">0</span>, <span class="number">1</span>).toLocaleUpperCase() + icon.slice(<span class="number">1</span>) + iconType;</span><br><span class="line">      <span class="built_in">console</span>.log(fixIconName, <span class="string">&#x27;fixIconName&#x27;</span>);</span><br><span class="line">      item.icon = React.createElement(allIcons[fixIconName] || allIcons[icon]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// eslint-disable-next-line @typescript-eslint/no-unused-expressions</span></span><br><span class="line">    children &amp;&amp; children.length &gt; <span class="number">0</span> ? (item.children = fixMenuItemIcon(children)) : <span class="literal">null</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> menus;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> fixMenuItemIcon;</span><br></pre></td></tr></table></figure>

<p>这里二级菜单的图标没有，官方是<a target="_blank" rel="noopener" href="https://github.com/ant-design/ant-design-pro/issues/6862">这样解释的</a></p>
<p>最终实现的效果，先给管理员和普通和用户分配不同的菜单</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240521171759248.png" alt="image-20240521171759248"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240521171823525.png" alt="image-20240521171823525"></p>
<p>切换登录不同角色的用户，会显示不同的菜单</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/hmgif2.gif" alt="hmgif2"></p>
<p>实现过程中遇到的问题以及解决方法</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/ant-design/ant-design-pro/issues/11137">请问菜单从服务端获取，为什么还要在 routes 配置好全部，否则就不能正常解析 · Issue #11137 · ant-design/ant-design-pro (github.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/ant-design/ant-design-pro/issues/10728">动态菜单实现后，路由是全部的，可以通过url跳转到不显示的菜单项BUG] · Issue #10728 · ant-design/ant-design-pro (github.com)</a></li>
</ul>
<p>实现源码</p>
<p><a target="_blank" rel="noopener" href="https://gitee.com/szxio/user-center">https://gitee.com/szxio/user-center</a></p>
<h2 id="函数式组件的父子组件方法互相调用"><a href="#函数式组件的父子组件方法互相调用" class="headerlink" title="函数式组件的父子组件方法互相调用"></a>函数式组件的父子组件方法互相调用</h2><p>编写子组件 Child</p>
<p>注意：子组件需要使用 forwardRef 函数包裹，然后使用 useImperativeHandle 暴露属性和方法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;forwardRef, useImperativeHandle&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Button&#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子组件使用forwardRef函数包裹</span></span><br><span class="line"><span class="comment">// forwardRef函数接收两个参数，第一个参数是props，第二个参数是ref</span></span><br><span class="line"><span class="keyword">const</span> Child = forwardRef(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 定义方法，将来由父组件调用</span></span><br><span class="line">  <span class="keyword">const</span> getChildStr = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;子组件的getChildStr方法被触发&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;来自子组件的返回值&#x27;</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> getParentFn = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 调用父组件的方法</span></span><br><span class="line">    props?.parentAddCount?.();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// useImperativeHandle函数接收两个参数，第一个参数是ref，第二个参数是一个函数</span></span><br><span class="line">  <span class="comment">// 这个函数返回一个对象，这个对象中的属性和方法会被暴露给父组件</span></span><br><span class="line">  useImperativeHandle(ref, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      getChildStr,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=&#123;<span class="string">&#x27;p-3 bg-amber-500&#x27;</span>&#125;&gt;</span><br><span class="line">      &lt;div&gt;我是子组件&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">      &lt;Button onClick=&#123;getParentFn&#125;&gt;调用父组件方法&lt;/Button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Child;</span><br></pre></td></tr></table></figure>

<p>编写父组件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">&#x27;@/pages/test/Child&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Button &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Index = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> [count, setCount] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">let</span> childRef = useRef();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 提供给子组件调用的方法，子组件使用 prop.parentAddCount() 实现调用父组件的方法</span></span><br><span class="line">  <span class="keyword">const</span> addCount = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    setCount(count + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 调用子组件方法，使用 childRef.current 获取子组件暴露的属性和方法</span></span><br><span class="line">  <span class="keyword">const</span> getChildStr = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> childStr = childRef.current?.getChildStr();</span><br><span class="line">    <span class="built_in">console</span>.log(childStr);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;Child ref=&#123;childRef&#125; parentAddCount=&#123;addCount&#125; /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;div style=&#123;&#123; <span class="attr">marginTop</span>: <span class="number">20</span> &#125;&#125;&gt;count:&#123;count&#125;&lt;/div&gt;</span><br><span class="line">      &lt;Button onClick=&#123;getChildStr&#125;&gt;调用子组件的方法&lt;/Button&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Index;</span><br></pre></td></tr></table></figure>

<p>效果展示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240518215529255.png" alt="image-20240518215529255"></p>
<h2 id="图表-Ant-Design-Charts"><a href="#图表-Ant-Design-Charts" class="headerlink" title="图表 Ant Design Charts"></a>图表 Ant Design Charts</h2><h3 id="官网地址"><a href="#官网地址" class="headerlink" title="官网地址"></a>官网地址</h3><p><a target="_blank" rel="noopener" href="https://ant-design-charts.antgroup.com/">·可视化组件库 | AntV (antgroup.com)</a></p>
<h3 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h3><p>安装</p>
<p>我们提供了 Ant Design 的 npm 包，通过下面的命令即可完成安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm install @ant-design/charts --save</span><br><span class="line"></span><br><span class="line"><span class="comment">#yarn</span></span><br><span class="line">yarn add @ant-design/charts --save</span><br><span class="line"></span><br><span class="line"><span class="comment">#pnpm</span></span><br><span class="line">pnpm add @ant-design/charts --save</span><br></pre></td></tr></table></figure>

<p>成功安装完成之后，即可使用 <code>import</code> 或 <code>require</code> 进行引用：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Line &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/charts&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>在需求明确的情况下，也可仅引入相关子包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 统计图表</span></span><br><span class="line">npm install @ant-design/plots --save</span><br></pre></td></tr></table></figure>

<h2 id="Java操作Word文档"><a href="#Java操作Word文档" class="headerlink" title="Java操作Word文档"></a>Java操作Word文档</h2><h3 id="poi-tl介绍"><a href="#poi-tl介绍" class="headerlink" title="poi-tl介绍"></a>poi-tl介绍</h3><p>官方文档：<a target="_blank" rel="noopener" href="https://deepoove.com/poi-tl/">https://deepoove.com/poi-tl/</a></p>
<p>poi-tl（poi template language）是Word模板引擎，使用模板和数据<strong>创建很棒的Word文档</strong>。</p>
<blockquote>
<p>在文档的任何地方做任何事情（<em>Do Anything Anywhere</em>）是poi-tl的星辰大海。</p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">方案</th>
<th align="left">移植性</th>
<th align="left">功能性</th>
<th align="left">易用性</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>Poi-tl</strong></td>
<td align="left">Java跨平台</td>
<td align="left">Word模板引擎，基于Apache POI，提供更友好的API</td>
<td align="left">低代码，准备文档模板和数据即可</td>
</tr>
<tr>
<td align="left">Apache POI</td>
<td align="left">Java跨平台</td>
<td align="left">Apache项目，封装了常见的文档操作，也可以操作底层XML结构</td>
<td align="left">文档不全，这里有一个教程：<a target="_blank" rel="noopener" href="http://deepoove.com/poi-tl/apache-poi-guide.html">Apache POI Word快速入门</a></td>
</tr>
<tr>
<td align="left">Freemarker</td>
<td align="left">XML跨平台</td>
<td align="left">仅支持文本，很大的局限性</td>
<td align="left">不推荐，XML结构的代码几乎无法维护</td>
</tr>
<tr>
<td align="left">OpenOffice</td>
<td align="left">部署OpenOffice，移植性较差</td>
<td align="left">-</td>
<td align="left">需要了解OpenOffice的API</td>
</tr>
<tr>
<td align="left">HTML浏览器导出</td>
<td align="left">依赖浏览器的实现，移植性较差</td>
<td align="left">HTML不能很好的兼容Word的格式，样式糟糕</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">Jacob、winlib</td>
<td align="left">Windows平台</td>
<td align="left">-</td>
<td align="left">复杂，完全不推荐使用</td>
</tr>
</tbody></table>
<p><strong>poi-tl</strong>是一个基于Apache POI的Word模板引擎，也是一个免费开源的Java类库，你可以非常方便的加入到你的项目中，并且拥有着让人喜悦的特性。</p>
<table>
<thead>
<tr>
<th align="left">Word模板引擎功能</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">文本</td>
<td align="left">将标签渲染为文本</td>
</tr>
<tr>
<td align="left">图片</td>
<td align="left">将标签渲染为图片</td>
</tr>
<tr>
<td align="left">表格</td>
<td align="left">将标签渲染为表格</td>
</tr>
<tr>
<td align="left">列表</td>
<td align="left">将标签渲染为列表</td>
</tr>
<tr>
<td align="left">图表</td>
<td align="left">条形图（3D条形图）、柱形图（3D柱形图）、面积图（3D面积图）、折线图（3D折线图）、雷达图、饼图（3D饼图）、散点图等图表渲染</td>
</tr>
<tr>
<td align="left">If Condition判断</td>
<td align="left">根据条件隐藏或者显示某些文档内容（包括文本、段落、图片、表格、列表、图表等）</td>
</tr>
<tr>
<td align="left">Foreach Loop循环</td>
<td align="left">根据集合循环某些文档内容（包括文本、段落、图片、表格、列表、图表等）</td>
</tr>
<tr>
<td align="left">Loop表格行</td>
<td align="left">循环复制渲染表格的某一行</td>
</tr>
<tr>
<td align="left">Loop表格列</td>
<td align="left">循环复制渲染表格的某一列</td>
</tr>
<tr>
<td align="left">Loop有序列表</td>
<td align="left">支持有序列表的循环，同时支持多级列表</td>
</tr>
<tr>
<td align="left">Highlight代码高亮</td>
<td align="left">word中代码块高亮展示，支持26种语言和上百种着色样式</td>
</tr>
<tr>
<td align="left">Markdown</td>
<td align="left">将Markdown渲染为word文档</td>
</tr>
<tr>
<td align="left">Word批注</td>
<td align="left">完整的批注功能，创建批注、修改批注等</td>
</tr>
<tr>
<td align="left">Word附件</td>
<td align="left">Word中插入附件</td>
</tr>
<tr>
<td align="left">SDT内容控件</td>
<td align="left">内容控件内标签支持</td>
</tr>
<tr>
<td align="left">Textbox文本框</td>
<td align="left">文本框内标签支持</td>
</tr>
<tr>
<td align="left">图片替换</td>
<td align="left">将原有图片替换成另一张图片</td>
</tr>
<tr>
<td align="left">书签、锚点、超链接</td>
<td align="left">支持设置书签，文档内锚点和超链接功能</td>
</tr>
<tr>
<td align="left">Expression Language</td>
<td align="left">完全支持SpringEL表达式，可以扩展更多的表达式：OGNL, MVEL…</td>
</tr>
<tr>
<td align="left">样式</td>
<td align="left">模板即样式，同时代码也可以设置样式</td>
</tr>
<tr>
<td align="left">模板嵌套</td>
<td align="left">模板包含子模板，子模板再包含子模板</td>
</tr>
<tr>
<td align="left">合并</td>
<td align="left">Word合并Merge，也可以在指定位置进行合并</td>
</tr>
<tr>
<td align="left">用户自定义函数(插件)</td>
<td align="left">插件化设计，在文档任何位置执行函数</td>
</tr>
</tbody></table>
<h3 id="快速上手-1"><a href="#快速上手-1" class="headerlink" title="快速上手"></a>快速上手</h3><p>Maven</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.deepoove<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-tl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.12.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>准备一个模板文件，占位符使用双大括号占位</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">你好，我是&#123;&#123;name&#125;&#125;，今年&#123;&#123;age&#125;&#125;岁</span><br></pre></td></tr></table></figure>

<p>然后将模板放在 resources 目录下，编写代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 定义模板对应的数据</span></span><br><span class="line">  HashMap&lt;String, Object&gt; data = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  data.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line">  data.put(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加载本地模板文件</span></span><br><span class="line">  InputStream inputStream = getClass().getResourceAsStream(<span class="string">&quot;/演示模板1.docx&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 渲染模板</span></span><br><span class="line">  XWPFTemplate template = XWPFTemplate.compile(inputStream).render(data);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 写出到文件</span></span><br><span class="line">    template.writeAndClose(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;output.docx&quot;</span>));</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果展示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240523094721108.png" alt="image-20240523094721108"></p>
<h3 id="加载远程模板文件"><a href="#加载远程模板文件" class="headerlink" title="加载远程模板文件"></a>加载远程模板文件</h3><p>在实际业务场景中，模板可能会有很多，并且不会保存在本地，这时就需要加载远程模板来进行处理</p>
<p>下面是示例代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 加载远程模板</span></span><br><span class="line">    String templateUrl =</span><br><span class="line">        <span class="string">&quot;https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/%E6%BC%94%E7%A4%BA%E6%A8%A1%E6%9D%BF1.docx&quot;</span>;</span><br><span class="line">    URL url = <span class="keyword">new</span> URL(templateUrl);</span><br><span class="line">    HttpURLConnection conn = (HttpURLConnection) url.openConnection();</span><br><span class="line">    InputStream inputStream = conn.getInputStream();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义模板对应的数据</span></span><br><span class="line">    HashMap&lt;String, Object&gt; data = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    data.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    data.put(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 渲染模板</span></span><br><span class="line">    XWPFTemplate template = XWPFTemplate.compile(inputStream).render(data);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写出到文件</span></span><br><span class="line">    template.writeAndClose(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;output2.docx&quot;</span>));</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="编写接口返回处理后的文件"><a href="#编写接口返回处理后的文件" class="headerlink" title="编写接口返回处理后的文件"></a>编写接口返回处理后的文件</h3><p>下面我们来实现编写一个接口，前端访问时携带参数，后端完成编译后返回文件给前端下载</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;模板管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/word&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordController</span> </span>&#123;</span><br><span class="line">  <span class="meta">@GetMapping(&quot;getWord&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getWord</span><span class="params">(String name, Integer age, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 定义模板对应的数据</span></span><br><span class="line">    HashMap&lt;String, Object&gt; data = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    data.put(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">    data.put(<span class="string">&quot;age&quot;</span>, age);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载本地模板文件</span></span><br><span class="line">    InputStream inputStream = getClass().getResourceAsStream(<span class="string">&quot;/演示模板1.docx&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 渲染模板</span></span><br><span class="line">    XWPFTemplate template = XWPFTemplate.compile(inputStream).render(data);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置响应头，指定文件类型和内容长度</span></span><br><span class="line">    response.setContentType(</span><br><span class="line">        <span class="string">&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;</span>);</span><br><span class="line">    response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment; filename=output.docx&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将生成的文件直接写出到HTTP响应输出流</span></span><br><span class="line">    OutputStream outputStream = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      outputStream = response.getOutputStream();</span><br><span class="line">      template.write(outputStream);</span><br><span class="line">      outputStream.flush();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 关闭资源</span></span><br><span class="line">      template.close();</span><br><span class="line">      outputStream.close();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前端代码编写</p>
<p>定义接口地址，并且请求中声明 responseType</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">&#x27;@umijs/max&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 下载报告</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getWordFun</span>(<span class="params">age, name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(<span class="string">`/word/getWord?age=<span class="subst">$&#123;age&#125;</span>&amp;name=<span class="subst">$&#123;name&#125;</span>`</span>, &#123;</span><br><span class="line">    method: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    responseType: <span class="string">&#x27;blob&#x27;</span>, <span class="comment">// 使用blob下载</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后响应拦截器中判断 responseType</p>
<p><code>requestErrorConfig.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@name </span>错误处理</span></span><br><span class="line"><span class="comment"> * pro 自带的错误处理， 可以在这里做自己的改动</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@doc </span>https://umijs.org/docs/max/request#配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> errorConfig: RequestConfig = &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 响应拦截器</span></span><br><span class="line">  responseInterceptors: [</span><br><span class="line">    (response) =&gt; &#123;</span><br><span class="line">      <span class="comment">// 拦截响应数据，进行个性化处理</span></span><br><span class="line">      <span class="keyword">const</span> res = response <span class="keyword">as</span> unknown <span class="keyword">as</span> ResponseStructure;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 判断流数据</span></span><br><span class="line">      <span class="keyword">if</span> (res.request.responseType === <span class="string">&#x27;blob&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 判断状态码</span></span><br><span class="line">      <span class="keyword">if</span> (!sucCodes.includes(res.data?.code)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(res.data);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> response;</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>编写页面代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ProForm, ProFormDigit, ProFormText &#125; <span class="keyword">from</span> <span class="string">&#x27;@ant-design/pro-components&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getWordFun &#125; <span class="keyword">from</span> <span class="string">&#x27;@/services/ant-design-pro/reportApi&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Report = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> onFinish = <span class="keyword">async</span> (values) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> getWordFun(values.age, values.name);</span><br><span class="line">    <span class="comment">// 接收流文件数据并下载</span></span><br><span class="line">    <span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([res], &#123;</span><br><span class="line">      type: res.type,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> link = <span class="built_in">document</span>.createElement(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    link.href = URL.createObjectURL(blob);</span><br><span class="line">    link.download = <span class="string">&#x27;test.docx&#x27;</span>;</span><br><span class="line">    link.click();</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;ProForm title=<span class="string">&quot;新建表单&quot;</span> onFinish=&#123;onFinish&#125;&gt;</span><br><span class="line">        &lt;ProFormText name=<span class="string">&quot;name&quot;</span> label=<span class="string">&quot;名称&quot;</span> placeholder=<span class="string">&quot;请输入名称&quot;</span> /&gt;</span><br><span class="line">        &lt;ProFormDigit type=&#123;<span class="string">&#x27;number&#x27;</span>&#125; name=<span class="string">&quot;age&quot;</span> label=<span class="string">&quot;年龄&quot;</span> placeholder=<span class="string">&quot;请输入年龄&quot;</span> /&gt;</span><br><span class="line">      &lt;/ProForm&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Report;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240523132308219.png" alt="image-20240523132308219"></p>
<p>下载的文件内容</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240523101613378.png" alt="image-20240523101613378"></p>
<h3 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h3><blockquote>
<p><code>图片标签以@开始：&#123;&#123;@var&#125;&#125;</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 定义模板对应的数据</span></span><br><span class="line">  HashMap&lt;String, Object&gt; data = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  data.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line">  data.put(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line">  data.put(<span class="string">&quot;img&quot;</span>, Pictures.ofUrl(<span class="string">&quot;http://deepoove.com/images/icecream.png&quot;</span>)</span><br><span class="line">          .size(<span class="number">100</span>, <span class="number">100</span>).create());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加载本地模板文件</span></span><br><span class="line">  InputStream inputStream = getClass().getResourceAsStream(<span class="string">&quot;/演示模板1.docx&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 渲染模板</span></span><br><span class="line">  XWPFTemplate template = XWPFTemplate.compile(inputStream).render(data);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 写出到文件</span></span><br><span class="line">    template.writeAndClose(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;output.docx&quot;</span>));</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240523134209524.png" alt="image-20240523134209524"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240523134123298.png" alt="image-20240523134123298"></p>
<h3 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h3><blockquote>
<p><code>表格标签以#开始：&#123;&#123;#var&#125;&#125;</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 插入表格</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 定义模板对应的数据</span></span><br><span class="line">  HashMap&lt;String, Object&gt; data = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">  data.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line">  data.put(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line">  data.put(</span><br><span class="line">      <span class="string">&quot;img&quot;</span>, Pictures.ofUrl(<span class="string">&quot;http://deepoove.com/images/icecream.png&quot;</span>).size(<span class="number">100</span>, <span class="number">100</span>).create());</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 第0行居中且背景为蓝色的表格</span></span><br><span class="line">  RowRenderData row0 =</span><br><span class="line">      Rows.of(<span class="string">&quot;学历&quot;</span>, <span class="string">&quot;时间&quot;</span>).textColor(<span class="string">&quot;FFFFFF&quot;</span>).bgColor(<span class="string">&quot;4472C4&quot;</span>).center().create();</span><br><span class="line">  RowRenderData row1 = Rows.create(<span class="string">&quot;本科&quot;</span>, <span class="string">&quot;2015~2019&quot;</span>);</span><br><span class="line">  RowRenderData row2 = Rows.create(<span class="string">&quot;研究生&quot;</span>, <span class="string">&quot;2019~2021&quot;</span>);</span><br><span class="line">  data.put(<span class="string">&quot;eduList&quot;</span>, Tables.create(row0, row1, row2));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加载本地模板文件</span></span><br><span class="line">  InputStream inputStream = getClass().getResourceAsStream(<span class="string">&quot;/演示模板1.docx&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 渲染模板</span></span><br><span class="line">  XWPFTemplate template = XWPFTemplate.compile(inputStream).render(data);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 写出到文件</span></span><br><span class="line">    template.writeAndClose(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;output.docx&quot;</span>));</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240523135141764.png" alt="image-20240523135141764"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240523135112583.png" alt="image-20240523135112583"></p>
<h3 id="表格行循环"><a href="#表格行循环" class="headerlink" title="表格行循环"></a>表格行循环</h3><p>我们希望根据一个集合的内容来决定表格的行数，这是就用到表格行循环</p>
<blockquote>
<p>货物明细需要展示所有货物，<code>&#123;&#123;goods&#125;&#125;</code> 是个标准的标签，将 <code>&#123;&#123;goods&#125;&#125;</code> <strong>置于循环行的上一行</strong>，循环行设置要循环的标签和内容，注意此时的标签应该使用 <code>[]</code> ，以此来区别poi-tl的默认标签语法。</p>
</blockquote>
<p>示例代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 循环行表格</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Good good = <span class="keyword">new</span> Good();</span><br><span class="line">    good.setName(<span class="string">&quot;小米14&quot;</span>);</span><br><span class="line">    good.setPrice(<span class="string">&quot;4599&quot;</span>);</span><br><span class="line">    good.setColor(<span class="string">&quot;黑色&quot;</span>);</span><br><span class="line">    good.setTime(<span class="string">&quot;2024-05-23&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Good good2 = <span class="keyword">new</span> Good();</span><br><span class="line">    good2.setName(<span class="string">&quot;苹果15&quot;</span>);</span><br><span class="line">    good2.setPrice(<span class="string">&quot;7599&quot;</span>);</span><br><span class="line">    good2.setColor(<span class="string">&quot;黑色&quot;</span>);</span><br><span class="line">    good2.setTime(<span class="string">&quot;2024-05-23&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Good good3 = <span class="keyword">new</span> Good();</span><br><span class="line">    good3.setName(<span class="string">&quot;华为Meta60&quot;</span>);</span><br><span class="line">    good3.setPrice(<span class="string">&quot;7999&quot;</span>);</span><br><span class="line">    good3.setColor(<span class="string">&quot;白色&quot;</span>);</span><br><span class="line">    good3.setTime(<span class="string">&quot;2024-05-23&quot;</span>);</span><br><span class="line"></span><br><span class="line">    ArrayList&lt;Good&gt; goods = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    goods.add(good);</span><br><span class="line">    goods.add(good2);</span><br><span class="line">    goods.add(good3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义模板对应的数据</span></span><br><span class="line">    HashMap&lt;String, Object&gt; data = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    data.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    data.put(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    data.put(</span><br><span class="line">        <span class="string">&quot;img&quot;</span>, Pictures.ofUrl(<span class="string">&quot;http://deepoove.com/images/icecream.png&quot;</span>).size(<span class="number">100</span>, <span class="number">100</span>).create());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第0行居中且背景为蓝色的表格</span></span><br><span class="line">    RowRenderData row0 =</span><br><span class="line">        Rows.of(<span class="string">&quot;学历&quot;</span>, <span class="string">&quot;时间&quot;</span>).textColor(<span class="string">&quot;FFFFFF&quot;</span>).bgColor(<span class="string">&quot;4472C4&quot;</span>).center().create();</span><br><span class="line">    RowRenderData row1 = Rows.create(<span class="string">&quot;本科&quot;</span>, <span class="string">&quot;2015~2019&quot;</span>);</span><br><span class="line">    RowRenderData row2 = Rows.create(<span class="string">&quot;研究生&quot;</span>, <span class="string">&quot;2019~2021&quot;</span>);</span><br><span class="line">    data.put(<span class="string">&quot;eduList&quot;</span>, Tables.create(row0, row1, row2));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加采购列表数据</span></span><br><span class="line">    data.put(<span class="string">&quot;goods&quot;</span>, goods);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载本地模板文件</span></span><br><span class="line">    InputStream inputStream = getClass().getResourceAsStream(<span class="string">&quot;/演示模板1.docx&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义行循环插件</span></span><br><span class="line">    LoopRowTableRenderPolicy policy = <span class="keyword">new</span> LoopRowTableRenderPolicy();</span><br><span class="line">    <span class="comment">// 绑定插件</span></span><br><span class="line">    Configure config = Configure.builder().bind(<span class="string">&quot;goods&quot;</span>, policy).build();</span><br><span class="line">    <span class="comment">// 渲染模板</span></span><br><span class="line">    XWPFTemplate template = XWPFTemplate.compile(inputStream, config).render(data);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 写出到文件</span></span><br><span class="line">        template.writeAndClose(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;output.docx&quot;</span>));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Good</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> String price;</span><br><span class="line">  <span class="keyword">private</span> String color;</span><br><span class="line">  <span class="keyword">private</span> String time;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240523142134632.png"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240523142219092.png" alt="image-20240523142219092"></p>
<h2 id="项目线上部署"><a href="#项目线上部署" class="headerlink" title="项目线上部署"></a>项目线上部署</h2><h3 id="Docker部署"><a href="#Docker部署" class="headerlink" title="Docker部署"></a>Docker部署</h3><p>首先编写Dockerfile</p>
<h4 id="Java的Dockerfile"><a href="#Java的Dockerfile" class="headerlink" title="Java的Dockerfile"></a>Java的Dockerfile</h4><p>方式一：基于已经打包的jar包编写DockerFile</p>
<p>从阿里镜像获取源地址，以获取更快的下载速度</p>
<p>访问：<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances/artifact">https://cr.console.aliyun.com/cn-hangzhou/instances/artifact</a></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240525171839394.png" alt="image-20240525171839394"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240525171950744.png" alt="image-20240525171950744"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以从阿里云的容器镜像服务中 找到openjdk，选择相对应的版本</span></span><br><span class="line">FROM anolis-registry.cn-zhangjiakou.cr.aliyuncs.com/openanolis/openjdk:8-8.6</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里就是进入创建好的目录</span></span><br><span class="line">WORKDIR /app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将打包后的jar包复制到指定目录(这里我是复制到了创建好的工作目录)下，并重命名</span></span><br><span class="line">COPY ./user-center-0.0.1-SNAPSHOT.jar ./user-center-0.0.1-SNAPSHOT.jar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行命令</span></span><br><span class="line">CMD [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/app/user-center-0.0.1-SNAPSHOT.jar&quot;</span>,<span class="string">&quot;--spring.profiles.active=prod&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>方式二：只上传代码，其他都交给Docker</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM maven:3.8.1-jdk-8-slim as builder</span><br><span class="line"></span><br><span class="line">WORKDIR /app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制代码到容器</span></span><br><span class="line">COPY pom.xml .</span><br><span class="line">COPY src ./src</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打包并跳过Test检查</span></span><br><span class="line">RUN mvn package -DskipTests</span><br><span class="line"></span><br><span class="line">CMD [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/app/target/user-center-0.0.1-SNAPSHOT.jar&quot;</span>,<span class="string">&quot;--spring.profiles.active=prod&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>构建镜像</p>
<p>将Dockerfile和源码放在平级，然后运行下面命令构建镜像</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t user-center:1.0.0 .</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240525181335994.png" alt="image-20240525181335994"></p>
<p>启动镜像</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name=user-center -p 8080:8080 user-center:1.0.0</span><br></pre></td></tr></table></figure>

<h4 id="前端Dockerfile"><a href="#前端Dockerfile" class="headerlink" title="前端Dockerfile"></a>前端Dockerfile</h4><p>方式一：在镜像中进行打包</p>
<p>参考文章：<a target="_blank" rel="noopener" href="https://blog.51cto.com/u_16099258/10476241">https://blog.51cto.com/u_16099258/10476241</a></p>
<p>编写 Dockerfile</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一阶段：构建前端产出物</span></span><br><span class="line">FROM node:20.11.1 AS builder</span><br><span class="line"></span><br><span class="line">WORKDIR /visualization</span><br><span class="line">COPY . .</span><br><span class="line">RUN npm install -g pnpm --registry=https://registry.npmmirror.com/</span><br><span class="line">RUN pnpm install &amp;&amp; pnpm run build</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二阶段：生成最终容器映像</span></span><br><span class="line">FROM nginx</span><br><span class="line"></span><br><span class="line">COPY docker/nginx.conf /etc/nginx/conf.d/default.conf</span><br><span class="line">COPY docker/docker-entrypoint.sh /docker-entrypoint.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">WORKDIR /home/visualization</span><br><span class="line">COPY --from=builder /visualization/dist .</span><br><span class="line"></span><br><span class="line">RUN chmod +x /docker-entrypoint.sh</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240526112246307.png" alt="image-20240526112246307"></p>
<p>在根目录新建 docker 文件夹，放两个文件</p>
<blockquote>
<p>1、新建nginx.conf文件，用于配置前端项目访问nginx配置文件<br>2、新建docker-entrypoint.sh文件，执行脚本动态修改nginx.conf中的代理请求地址</p>
<p>nginx.conf内容<br>~根据项目情况做出修改，gzip配置前端无则可删除<br>~ /dev是前端代理跨域的基准地址，要保持统一，代理到后端的地址，做代理的目的是后面可以根据容器run动态改变proxy_pass地址<br>~如果项目无https则可删除443监听</p>
<p>~有https则需要配置证书ssl_certificate、ssl_certificate_key，此文件的路径为后面 运行容器时(run) -v将宿主机的目录映射至容器，就是容器的目录</p>
</blockquote>
<p>新建nginx.conf文件</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line">    <span class="comment"># gzip config</span></span><br><span class="line"><span class="comment">#     gzip off;</span></span><br><span class="line"><span class="comment">#     gzip_min_length 1k;</span></span><br><span class="line"><span class="comment">#     gzip_comp_level 9;</span></span><br><span class="line"><span class="comment">#     gzip_types text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml;</span></span><br><span class="line"><span class="comment">#     gzip_vary off;</span></span><br><span class="line"><span class="comment">#     gzip_disable &quot;MSIE [1-6]\.&quot;;</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span>   /home/visualization;</span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        <span class="attribute">try_files</span> $uri $uri/ /index.html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span><span class="regexp"> ^~/api/</span> &#123;</span><br><span class="line">      <span class="comment"># 代理</span></span><br><span class="line">      <span class="attribute">proxy_pass</span> http://cx5k97.natappfree.cc/;</span><br><span class="line"></span><br><span class="line">      <span class="attribute">access_log</span> /var/log/nginx/dev_access.log;</span><br><span class="line">      <span class="attribute">error_log</span> /var/log/nginx/dev_error.log;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建docker-entrypoint.sh文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">API_BASE_PATH=<span class="variable">$API_BASE_PATH</span>;</span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$API_BASE_PATH</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    API_BASE_PATH=<span class="string">&quot;https://xxx.xxx/&quot;</span>;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">apiUrl=<span class="string">&quot;proxy_pass  <span class="variable">$API_BASE_PATH</span>;&quot;</span></span><br><span class="line">sed -i <span class="string">&#x27;22c &#x27;</span><span class="string">&quot;<span class="variable">$apiUrl</span>&quot;</span><span class="string">&#x27;&#x27;</span> /etc/nginx/conf.d/default.conf</span><br><span class="line">sed -i <span class="string">&#x27;75c &#x27;</span><span class="string">&quot;<span class="variable">$apiUrl</span>&quot;</span><span class="string">&#x27;&#x27;</span> /etc/nginx/conf.d/default.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 变量CERT判断是否需要证书https, $CERT存在则不需要</span></span><br><span class="line">certOr=<span class="string">&quot;#&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$CERT</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line"> sed -i <span class="string">&#x27;45c &#x27;</span><span class="string">&quot;<span class="variable">$certOr</span>&quot;</span><span class="string">&#x27;&#x27;</span> /etc/nginx/conf.d/default.conf</span><br><span class="line"> sed -i <span class="string">&#x27;46c &#x27;</span><span class="string">&quot;<span class="variable">$certOr</span>&quot;</span><span class="string">&#x27;&#x27;</span> /etc/nginx/conf.d/default.conf</span><br><span class="line"> sed -i <span class="string">&#x27;60c &#x27;</span><span class="string">&quot;<span class="variable">$certOr</span>&quot;</span><span class="string">&#x27;&#x27;</span> /etc/nginx/conf.d/default.conf</span><br><span class="line"> sed -i <span class="string">&#x27;61c &#x27;</span><span class="string">&quot;<span class="variable">$certOr</span>&quot;</span><span class="string">&#x27;&#x27;</span> /etc/nginx/conf.d/default.conf</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">nginx -g <span class="string">&quot;daemon off;&quot;</span></span><br></pre></td></tr></table></figure>

<p>然后在根目录新建 <code>.dockerignore</code>，忽略文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dependency directory</span></span><br><span class="line"><span class="comment"># https://www.npmjs.org/doc/misc/npm-faq.html#should-i-check-my-node_modules-folder-into-git</span></span><br><span class="line">node_modules</span><br><span class="line">.DS_Store</span><br><span class="line">dist</span><br><span class="line"></span><br><span class="line"><span class="comment"># node-waf configuration</span></span><br><span class="line">.lock-wscript</span><br><span class="line"></span><br><span class="line"><span class="comment"># Compiled binary addons (http://nodejs.org/api/addons.html)</span></span><br><span class="line">build/Release</span><br><span class="line">.dockerignore</span><br><span class="line">Dockerfile</span><br><span class="line">*docker-compose*</span><br><span class="line"></span><br><span class="line"><span class="comment"># Logs</span></span><br><span class="line">logs</span><br><span class="line">*.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Runtime data</span></span><br><span class="line">.idea</span><br><span class="line">.vscode</span><br><span class="line">*.suo</span><br><span class="line">*.ntvs*</span><br><span class="line">*.njsproj</span><br><span class="line">*.sln</span><br><span class="line">*.sw*</span><br><span class="line">pids</span><br><span class="line">*.pid</span><br><span class="line">*.seed</span><br><span class="line">.git</span><br><span class="line">.hg</span><br><span class="line">.svn</span><br></pre></td></tr></table></figure>

<p>构建结果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240526093128275.png" alt="image-20240526093128275"></p>
<p>运行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//方式一：</span><br><span class="line">// contanier_hello为容器名称</span><br><span class="line">// -p 9090:80  将容器里面的80端口映射到宿主机的8080端口，80端口就是nginx里面配置，多个端口多个配置，必须确保服务器已经开了此端口</span><br><span class="line">docker run -d --name user-center-web -p 8000:80 user-center-web:1.0.0</span><br><span class="line"></span><br><span class="line">//方式二：</span><br><span class="line">// 运行容器的时候改变nginx代理地址</span><br><span class="line">// -e API_BASE_PATH就是上面sh文件中定义的变量 把nginx的后端接口地址改为http://www.baidu.com，这个地址一定不要格式错误，不然nginx会解析不出来</span><br><span class="line"></span><br><span class="line">docker run -d --name user-center-web -p 80:80 -e <span class="string">&quot;API_BASE_PATH=http://8g6igw.natappfree.cc/&quot;</span> user-center-web:1.0.0</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">SZX</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://songzx0106.github.io/Java/springboot/usercenter/">https://songzx0106.github.io/Java/springboot/usercenter/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://SongZX0106.github.io" target="_blank">SZX的开发笔记</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a></div><div class="post_share"><div class="social-share" data-image="/images/ys16.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/share.min.css" media="print" onload="this.media='all'"><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/images/wechat.png" target="_blank"><img class="post-qr-code-img" data-lazy-src="/images/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/images/alipay.jpg" target="_blank"><img class="post-qr-code-img" data-lazy-src="/images/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/JavaScript/Axios%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82/"><img class="prev-cover" data-lazy-src="/images/ys16.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Axios取消请求，以及全局取消请求封装</div></div></a></div><div class="next-post pull-right"><a href="/JavaScript/%E5%B0%81%E8%A3%85websocket/"><img class="next-cover" data-lazy-src="/images/ys08.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">封装一个websocket，支持断网重连、心跳检测，拿来开箱即用</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/Java/java实现短信发送/" title="Java实现短信发送并校验，华为云短信配合Redis实现发送与校验"><img class="cover" data-lazy-src="/images/ys08.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-17</div><div class="title">Java实现短信发送并校验，华为云短信配合Redis实现发送与校验</div></div></a></div><div><a href="/Java/Maven/1/" title="Maven入门"><img class="cover" data-lazy-src="/images/ys05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-28</div><div class="title">Maven入门</div></div></a></div><div><a href="/Java/Maven/20230206090754/" title="使用Java将Word文档转PDF"><img class="cover" data-lazy-src="/images/ys08.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-06</div><div class="title">使用Java将Word文档转PDF</div></div></a></div><div><a href="/Java/MybatisPlus/1/" title="MybatisPlus入门"><img class="cover" data-lazy-src="/images/ys05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-18</div><div class="title">MybatisPlus入门</div></div></a></div><div><a href="/Java/Mybatis/mybatis/" title="MyBatis入门"><img class="cover" data-lazy-src="/images/ys08.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-27</div><div class="title">MyBatis入门</div></div></a></div><div><a href="/Java/Spring5/1/" title="Java Spring5"><img class="cover" data-lazy-src="/images/ys19.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-24</div><div class="title">Java Spring5</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="/images/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">SZX</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">150</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://gitee.com/szxio"><i class="iconfont icon-gitee-fill-round"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">welcome to my blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">1.</span> <span class="toc-text">技术栈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-number">2.</span> <span class="toc-text">前端项目搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.1.</span> <span class="toc-text">初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%BB%E9%99%A4%E5%9B%BD%E9%99%85%E5%8C%96"><span class="toc-number">2.2.</span> <span class="toc-text">去除国际化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8"><span class="toc-number">2.3.</span> <span class="toc-text">启动</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">后端项目搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96-1"><span class="toc-number">3.1.</span> <span class="toc-text">初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SwaggerUI%E9%85%8D%E7%BD%AE"><span class="toc-number">3.3.</span> <span class="toc-text">SwaggerUI配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MybatisPlus%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6%E5%92%8C%E8%87%AA%E5%8A%A8%E6%8F%92%E5%85%A5%E5%BD%93%E5%89%8D%E6%97%A5%E6%9C%9F"><span class="toc-number">3.4.</span> <span class="toc-text">MybatisPlus分页插件和自动插入当前日期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E7%B1%BB%E8%AE%BE%E7%BD%AE"><span class="toc-number">3.5.</span> <span class="toc-text">启动类设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IDEA%E8%87%AA%E5%B8%A6%E7%9A%84%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8"><span class="toc-number">3.6.</span> <span class="toc-text">IDEA自带的代码生成器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E7%BB%93%E6%9E%9C%E8%BF%94%E5%9B%9E%E7%B1%BB"><span class="toc-number">3.7.</span> <span class="toc-text">统一结果返回类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.8.</span> <span class="toc-text">编写测试接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8C%85pom%E9%80%9A%E7%94%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">3.9.</span> <span class="toc-text">打包pom通用配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5"><span class="toc-number">4.</span> <span class="toc-text">SQL建表语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%A1%A8-sys-user"><span class="toc-number">4.1.</span> <span class="toc-text">用户表 sys_user</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%92%E8%89%B2%E8%A1%A8-sys-role"><span class="toc-number">4.2.</span> <span class="toc-text">角色表 sys_role</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%A7%92%E8%89%B2%E8%A1%A8-sys-user-role"><span class="toc-number">4.3.</span> <span class="toc-text">用户角色表 sys_user_role</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%92%E8%89%B2%E8%8F%9C%E5%8D%95%E8%A1%A8-sys-role-menu"><span class="toc-number">4.4.</span> <span class="toc-text">角色菜单表 sys_role_menu</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E7%9A%84%E5%8A%A0%E5%AF%86%E5%92%8C%E6%A0%A1%E9%AA%8C"><span class="toc-number">5.</span> <span class="toc-text">密码的加密和校验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E5%8A%9F%E8%83%BD%E5%BC%80%E5%8F%91"><span class="toc-number">6.</span> <span class="toc-text">后端功能开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E9%80%BB%E8%BE%91"><span class="toc-number">6.1.</span> <span class="toc-text">注册逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="toc-number">6.2.</span> <span class="toc-text">注册接口开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91"><span class="toc-number">6.3.</span> <span class="toc-text">登录逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="toc-number">6.4.</span> <span class="toc-text">登录接口开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90Token"><span class="toc-number">6.5.</span> <span class="toc-text">生成Token</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0Token%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">6.6.</span> <span class="toc-text">添加Token拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8"><span class="toc-number">6.7.</span> <span class="toc-text">自定义全局异常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="toc-number">6.8.</span> <span class="toc-text">查询接口开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85%E5%88%9B%E5%BB%BA%E4%BA%BA%E5%92%8C%E6%9B%B4%E6%96%B0%E4%BA%BA"><span class="toc-number">6.9.</span> <span class="toc-text">自动填充创建人和更新人</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E5%8A%9F%E8%83%BD%E5%BC%80%E5%8F%91"><span class="toc-number">7.</span> <span class="toc-text">前端功能开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91%E6%A2%B3%E7%90%86"><span class="toc-number">7.1.</span> <span class="toc-text">登录逻辑梳理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">7.2.</span> <span class="toc-text">修改响应拦截器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86"><span class="toc-number">7.3.</span> <span class="toc-text">设置代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">7.4.</span> <span class="toc-text">权限管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">7.5.</span> <span class="toc-text">登录功能实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%98%E8%AE%B0%E5%AF%86%E7%A0%81"><span class="toc-number">7.6.</span> <span class="toc-text">忘记密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%8E%B7%E5%8F%96%E8%8F%9C%E5%8D%95"><span class="toc-number">7.7.</span> <span class="toc-text">动态获取菜单</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BB%84%E4%BB%B6%E7%9A%84%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E6%96%B9%E6%B3%95%E4%BA%92%E7%9B%B8%E8%B0%83%E7%94%A8"><span class="toc-number">8.</span> <span class="toc-text">函数式组件的父子组件方法互相调用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E8%A1%A8-Ant-Design-Charts"><span class="toc-number">9.</span> <span class="toc-text">图表 Ant Design Charts</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%98%E7%BD%91%E5%9C%B0%E5%9D%80"><span class="toc-number">9.1.</span> <span class="toc-text">官网地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B"><span class="toc-number">9.2.</span> <span class="toc-text">快速上手</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java%E6%93%8D%E4%BD%9CWord%E6%96%87%E6%A1%A3"><span class="toc-number">10.</span> <span class="toc-text">Java操作Word文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#poi-tl%E4%BB%8B%E7%BB%8D"><span class="toc-number">10.1.</span> <span class="toc-text">poi-tl介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B-1"><span class="toc-number">10.2.</span> <span class="toc-text">快速上手</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E8%BF%9C%E7%A8%8B%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6"><span class="toc-number">10.3.</span> <span class="toc-text">加载远程模板文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E5%A4%84%E7%90%86%E5%90%8E%E7%9A%84%E6%96%87%E4%BB%B6"><span class="toc-number">10.4.</span> <span class="toc-text">编写接口返回处理后的文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87"><span class="toc-number">10.5.</span> <span class="toc-text">图片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E6%A0%BC"><span class="toc-number">10.6.</span> <span class="toc-text">表格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E6%A0%BC%E8%A1%8C%E5%BE%AA%E7%8E%AF"><span class="toc-number">10.7.</span> <span class="toc-text">表格行循环</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%BA%BF%E4%B8%8A%E9%83%A8%E7%BD%B2"><span class="toc-number">11.</span> <span class="toc-text">项目线上部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E9%83%A8%E7%BD%B2"><span class="toc-number">11.1.</span> <span class="toc-text">Docker部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Java%E7%9A%84Dockerfile"><span class="toc-number">11.1.1.</span> <span class="toc-text">Java的Dockerfile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AFDockerfile"><span class="toc-number">11.1.2.</span> <span class="toc-text">前端Dockerfile</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Vue/%E4%B8%80%E4%B8%AA%E4%BC%98%E9%9B%85%E7%9A%84%E8%BD%AE%E5%BE%AA%E4%BB%A3%E7%A0%81/" title="一个优雅的轮循代码"><img data-lazy-src="/images/ys07.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="一个优雅的轮循代码"/></a><div class="content"><a class="title" href="/Vue/%E4%B8%80%E4%B8%AA%E4%BC%98%E9%9B%85%E7%9A%84%E8%BD%AE%E5%BE%AA%E4%BB%A3%E7%A0%81/" title="一个优雅的轮循代码">一个优雅的轮循代码</a><time datetime="2024-09-22T16:00:00.000Z" title="发表于 2024-09-23 00:00:00">2024-09-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/JavaScript/pm2_linux_nginx/" title="pm2 + linux + nginx"><img data-lazy-src="/images/ys19.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="pm2 + linux + nginx"/></a><div class="content"><a class="title" href="/JavaScript/pm2_linux_nginx/" title="pm2 + linux + nginx">pm2 + linux + nginx</a><time datetime="2024-09-07T16:00:00.000Z" title="发表于 2024-09-08 00:00:00">2024-09-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/JavaScript/scss%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%80%9A%E7%94%A8%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2/" title="巧用scss实现一个通用的媒介查询代码"><img data-lazy-src="/images/ys11.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="巧用scss实现一个通用的媒介查询代码"/></a><div class="content"><a class="title" href="/JavaScript/scss%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%80%9A%E7%94%A8%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2/" title="巧用scss实现一个通用的媒介查询代码">巧用scss实现一个通用的媒介查询代码</a><time datetime="2024-08-30T16:00:00.000Z" title="发表于 2024-08-31 00:00:00">2024-08-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/JavaScript/Axios%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82/" title="Axios取消请求，以及全局取消请求封装"><img data-lazy-src="/images/ys16.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Axios取消请求，以及全局取消请求封装"/></a><div class="content"><a class="title" href="/JavaScript/Axios%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82/" title="Axios取消请求，以及全局取消请求封装">Axios取消请求，以及全局取消请求封装</a><time datetime="2024-08-11T16:00:00.000Z" title="发表于 2024-08-12 00:00:00">2024-08-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Java/springboot/usercenter/" title="React + SpringBoot 开发用户中心管理系统"><img data-lazy-src="/images/ys16.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="React + SpringBoot 开发用户中心管理系统"/></a><div class="content"><a class="title" href="/Java/springboot/usercenter/" title="React + SpringBoot 开发用户中心管理系统">React + SpringBoot 开发用户中心管理系统</a><time datetime="2024-06-02T02:19:37.000Z" title="发表于 2024-06-02 10:19:37">2024-06-02</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/images/ys16.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By SZX</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">少年辛苦终身事，莫向光阴惰寸功。<a target="_blank" rel="noopener" href="https://gitee.com/szxio">My Gitee</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/instantpage.min.js" type="module"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'iJzt0X9OdhFCcdn4N0dJ86fY-gzGzoHsz',
      appKey: '8vtaRafgQSvU5ntYgszJfRW5',
      placeholder: '留下你的精彩评论',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/canvas-fluttering-ribbon.min.js"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/click-show-text.min.js" data-mobile="true" data-text="富强,民主,文明,和谐,自由,平等,公正,法制,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>