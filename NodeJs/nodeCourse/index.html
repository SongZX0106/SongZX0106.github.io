<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>NodeJs | SZX的开发笔记</title><meta name="keywords" content="NodeJs"><meta name="author" content="SZX"><meta name="copyright" content="SZX"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="第一章node是什么 Node.js 是一个开源与跨平台的 JavaScript 运行时环境。 它是一个可用于几乎任何项目的流行工具！   Node.js 在浏览器外运行 V8 JavaScript 引擎（Google Chrome 的内核）。 这使 Node.js 表现得非常出色。   Node.js 应用程序运行于单个进程中，无需为每个请求创建新的线程。 Node.js 在其标准库中提供了一组">
<meta property="og:type" content="article">
<meta property="og:title" content="NodeJs">
<meta property="og:url" content="https://songzx0106.github.io/NodeJs/nodeCourse/index.html">
<meta property="og:site_name" content="SZX的开发笔记">
<meta property="og:description" content="第一章node是什么 Node.js 是一个开源与跨平台的 JavaScript 运行时环境。 它是一个可用于几乎任何项目的流行工具！   Node.js 在浏览器外运行 V8 JavaScript 引擎（Google Chrome 的内核）。 这使 Node.js 表现得非常出色。   Node.js 应用程序运行于单个进程中，无需为每个请求创建新的线程。 Node.js 在其标准库中提供了一组">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://songzx0106.github.io/images/ys02.jpg">
<meta property="article:published_time" content="2021-03-24T16:00:00.000Z">
<meta property="article:modified_time" content="2023-03-04T14:29:50.418Z">
<meta property="article:author" content="SZX">
<meta property="article:tag" content="NodeJs">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://songzx0106.github.io/images/ys02.jpg"><link rel="shortcut icon" href="/images/favicon.png"><link rel="canonical" href="https://songzx0106.github.io/NodeJs/nodeCourse/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":5000,"languages":{"author":"作者: SZX","link":"链接: ","source":"来源: SZX的开发笔记","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/jquery.min.js',
    justifiedGallery: {
      js: 'https://fastly.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://fastly.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://fastly.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-04 22:29:50'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2467717_jlvw8717b8.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/images/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">115</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">33</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/ys02.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">SZX的开发笔记</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">NodeJs</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-03-24T16:00:00.000Z" title="发表于 2021-03-25 00:00:00">2021-03-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-04T14:29:50.418Z" title="更新于 2023-03-04 22:29:50">2023-03-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/NodeJs%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/">NodeJs快速入门</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">16.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>66分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="NodeJs"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="第一章"><a href="#第一章" class="headerlink" title="第一章"></a>第一章</h1><h2 id="node是什么"><a href="#node是什么" class="headerlink" title="node是什么"></a>node是什么</h2><ul>
<li>Node.js 是一个开源与跨平台的 JavaScript 运行时环境。 它是一个可用于几乎任何项目的流行工具！</li>
</ul>
<ul>
<li>Node.js 在浏览器外运行 V8 JavaScript 引擎（Google Chrome 的内核）。 这使 Node.js 表现得非常出色。</li>
</ul>
<ul>
<li>Node.js 应用程序运行于单个进程中，无需为每个请求创建新的线程。 Node.js 在其标准库中提供了一组异步的 I/O 原生功能（用以防止 JavaScript 代码被阻塞），并且 Node.js 中的库通常是使用非阻塞的范式编写的（从而使阻塞行为成为例外而不是规范）。</li>
</ul>
<ul>
<li>当 Node.js 执行 I/O 操作时（例如从网络读取、访问数据库或文件系统），Node.js 会在响应返回时恢复操作，而不是阻塞线程并浪费 CPU 循环等待。</li>
</ul>
<ul>
<li>这使 Node.js 可以在一台服务器上处理数千个并发连接，而无需引入管理线程并发的负担（这可能是重大 bug 的来源）。</li>
</ul>
<ul>
<li>Node.js 具有独特的优势，因为为浏览器编写 JavaScript 的数百万前端开发者现在除了客户端代码之外还可以编写服务器端代码，而无需学习完全不同的语言。</li>
</ul>
<ul>
<li>在 Node.js 中，可以毫无问题地使用新的 ECMAScript 标准，因为不必等待所有用户更新其浏览器，你可以通过更改 Node.js 版本来决定要使用的 ECMAScript 版本，并且还可以通过运行带有标志的 Node.js 来启用特定的实验中的特性。</li>
</ul>
<h2 id="检查自己电脑是否安装了node"><a href="#检查自己电脑是否安装了node" class="headerlink" title="检查自己电脑是否安装了node"></a>检查自己电脑是否安装了node</h2><p>打开cmd输入如下命令，如果正常返回了版本号，则说明已经安装成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>

<h2 id="node学习网址"><a href="#node学习网址" class="headerlink" title="node学习网址"></a>node学习网址</h2><ul>
<li>node官方下载地址 <a target="_blank" rel="noopener" href="http://nodejs.cn/">http://nodejs.cn/</a> </li>
<li>node中文文档 <a target="_blank" rel="noopener" href="http://nodejs.cn/api/">http://nodejs.cn/api/</a></li>
<li>node中文社区 <a target="_blank" rel="noopener" href="https://cnodejs.org/">https://cnodejs.org/</a></li>
<li>node入门电子书 <a target="_blank" rel="noopener" href="https://www.nodebeginner.org/index-zh-cn.html">https://www.nodebeginner.org/index-zh-cn.html</a></li>
</ul>
<h2 id="使用-node-js-执行-js-文件"><a href="#使用-node-js-执行-js-文件" class="headerlink" title="使用 node.js 执行 js 文件"></a>使用 node.js 执行 js 文件</h2><p>在要执行的 js 文件目录下执行 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node xxx.js</span><br></pre></td></tr></table></figure>

<h2 id="使用-nodejs-读取文件"><a href="#使用-nodejs-读取文件" class="headerlink" title="使用 nodejs 读取文件"></a>使用 nodejs 读取文件</h2><p>首先需要引入 fs ，fs 是 nodejs 中专门用来处理文件的一个库。读取到的文件默认是二进制文件流，所以要用 toString() 来转一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// readFile 函数接收两个参数</span></span><br><span class="line"><span class="comment">//   要读取的文件路径</span></span><br><span class="line"><span class="comment">//   回调函数,接收两个参数</span></span><br><span class="line"><span class="comment">//      第一个是读取错误是的参数，读取错误时err为错误对象</span></span><br><span class="line"><span class="comment">//      第二是成功读取是的文件流，默认是二进制</span></span><br><span class="line"></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&quot;./01.js&quot;</span>,<span class="function">(<span class="params">err,data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;文件读取失败&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 默认读取的文件时二进制文件流，需要经过toString()转义后才能正常读取</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="title function_">toString</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="使用-nodejs-写入文件"><a href="#使用-nodejs-写入文件" class="headerlink" title="使用 nodejs 写入文件"></a>使用 nodejs 写入文件</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// writeFile 函数接收三个参数</span></span><br><span class="line"><span class="comment">//   要写入的文件路径，如果没有则自动创建，有的话自动覆盖旧的文件和内容</span></span><br><span class="line"><span class="comment">//   要写入的内容</span></span><br><span class="line"><span class="comment">//   回调函数，接收两个参数</span></span><br><span class="line"><span class="comment">//      err:写入失败时，err是一个错误对象</span></span><br><span class="line"><span class="comment">//      data:写入成功时，err是null</span></span><br><span class="line">fs.<span class="title function_">writeFile</span>(<span class="string">&quot;./writefile/errlog.txt&quot;</span>,<span class="string">&quot;这是通过node写入的错误日志&quot;</span>,<span class="function">(<span class="params">err,data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;写入文件失败&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;        </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;文件写入成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="使用-nodejs-创建一个简单的-http-服务器"><a href="#使用-nodejs-创建一个简单的-http-服务器" class="headerlink" title="使用 nodejs 创建一个简单的 http 服务器"></a>使用 nodejs 创建一个简单的 http 服务器</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.引入http服务</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.使用http创建一个httpserver，返回一个server实例</span></span><br><span class="line"><span class="keyword">var</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.写入服务器要处理的事情，分为以下几个步骤</span></span><br><span class="line"><span class="comment">//    提供服务：对数据的服务</span></span><br><span class="line"><span class="comment">//    客户端发来请求</span></span><br><span class="line"><span class="comment">//    服务端接收请求</span></span><br><span class="line"><span class="comment">//    服务端处理请求</span></span><br><span class="line"><span class="comment">//    给个反馈（发送响应）</span></span><br><span class="line"><span class="comment">//    注册 require 事件，当客户端请求过来时，自动执行这个回调函数</span></span><br><span class="line"><span class="comment">//      回调函数接收两个参数：request，response</span></span><br><span class="line"><span class="comment">//          request：请求对象，可以获取请求过来的路径信息</span></span><br><span class="line"><span class="comment">//          response：响应对象，可以给客户发送响应数据</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 获取请求的路径</span></span><br><span class="line">    <span class="keyword">let</span> url = request.<span class="property">url</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// // 根据不同的路径返回不同数据</span></span><br><span class="line">    <span class="comment">// switch (url) &#123;</span></span><br><span class="line">    <span class="comment">//     case &quot;/&quot;:</span></span><br><span class="line">    <span class="comment">//         // response.write 写入响应数据</span></span><br><span class="line">    <span class="comment">//         response.write(&quot;hello nodejs&quot;);</span></span><br><span class="line">    <span class="comment">//         break;</span></span><br><span class="line">    <span class="comment">//     case &quot;/login&quot;:</span></span><br><span class="line">    <span class="comment">//         response.write(&quot;login&quot;);</span></span><br><span class="line">    <span class="comment">//         break;</span></span><br><span class="line">    <span class="comment">//     case &quot;/user&quot;:</span></span><br><span class="line">    <span class="comment">//         response.write(&quot;user&quot;);</span></span><br><span class="line">    <span class="comment">//         break;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// // 通知浏览器，结束会话</span></span><br><span class="line">    <span class="comment">// response.end()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 上面的写法也可以简写为如下格式</span></span><br><span class="line">    <span class="keyword">if</span>(url = <span class="string">&quot;/userlist&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> userlist = [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>:<span class="string">&quot;李四&quot;</span>,</span><br><span class="line">                <span class="attr">age</span>:<span class="number">15</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>:<span class="string">&quot;张三&quot;</span>,</span><br><span class="line">                <span class="attr">age</span>:<span class="number">16</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">        <span class="comment">// 直接用end同时返回数据</span></span><br><span class="line">        response.<span class="title function_">end</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(userlist))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.设置端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3030</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务启动成功,http://localhost:3030/&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="http服务的简写形式"><a href="#http服务的简写形式" class="headerlink" title="http服务的简写形式"></a>http服务的简写形式</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> url = req.<span class="property">url</span>;</span><br><span class="line">    res.<span class="title function_">end</span>(url)</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<h2 id="nodejs-中的模块的导入和导出"><a href="#nodejs-中的模块的导入和导出" class="headerlink" title="nodejs 中的模块的导入和导出"></a>nodejs 中的模块的导入和导出</h2><p>使用 <code>require</code> 导入一个其他模块，用一个变量来接收。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 require 导入其他模块</span></span><br><span class="line"><span class="keyword">var</span> demo = <span class="built_in">require</span>(<span class="string">&quot;./06导出模块&quot;</span>)</span><br><span class="line">demo.<span class="title function_">getname</span>(<span class="string">&quot;张三&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> aaa = <span class="string">&quot;06导入模块&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(aaa);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(demo.<span class="property">aaa</span>)</span><br></pre></td></tr></table></figure>

<p>使用 <code>exports</code> 导出一个模块，可以导出方法，变量</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nodejs中两个互相引用的js如果变量名称相同不会相互受影响</span></span><br><span class="line"><span class="keyword">var</span> aaa = <span class="string">&quot;06导出&quot;</span></span><br><span class="line"><span class="comment">// 使用 exports 导出方法和变量</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getname</span> = <span class="keyword">function</span> (<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">aaa</span> = aaa;</span><br></pre></td></tr></table></figure>

<p>除了单独导出外也可以批量导出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fun1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;方法1&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fun2</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;方法2&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 模块导出</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    fun1,</span><br><span class="line">    fun2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用 <code>&#123; &#125;</code> 接收批量导出的内容，用到几个引入几个</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> &#123; fun2 &#125; = <span class="built_in">require</span>(<span class="string">&quot;./06导出模块&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">fun2</span>() <span class="comment">// 方法2</span></span><br></pre></td></tr></table></figure>

<h2 id="exports-和-module-exports-的区别"><a href="#exports-和-module-exports-的区别" class="headerlink" title="exports 和 module.exports 的区别"></a>exports 和 module.exports 的区别</h2><ul>
<li>每个模块都有一个 <code>module</code> 对象</li>
<li>module 对象中有一个 <code>exports</code> 对象</li>
<li>我们可以吧需要导出的成员都挂载到 <code>module.exports</code> 接口对象中</li>
<li>也就是 <code>module.exports.XXX = XXX</code> 的方式</li>
<li>但每次都 <code>module.exports.XXX</code> 很麻烦，点太多了</li>
<li>所以 <code>Node</code> 为了方便，同时在每一个模块对象中都提供了一个成员叫做 <code>exports</code> </li>
<li><code>exports === module.exports</code> 结果为 <code>true</code></li>
<li>所以对于 <code>module.exports.XXX</code> 的方式可以写成 <code>exports.XXX</code></li>
<li>当一个模块需要导出单个成员的时候，这个时候必须写成 <code>module.exports = XXX</code></li>
<li>不要使用 <code>exports = XXX</code>，这种方式不管用</li>
<li>因为每个模块最终向外 <code>return</code> 的是 <code>module.exports</code></li>
<li>而 <code>exports</code> 只是 <code>module.exports</code> 的引用</li>
<li>所以即便对 <code>exports = XXX</code> 重新赋值，也不影响 <code>module.exports </code></li>
<li>但是有一种赋值方式为 <code>exports = module.exports</code> 这种赋值表示重新建立起两者的引用</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">exports</span> === <span class="variable language_">module</span>.<span class="property">exports</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>


<h2 id="ip地址和端口号概念"><a href="#ip地址和端口号概念" class="headerlink" title="ip地址和端口号概念"></a>ip地址和端口号概念</h2><ul>
<li>IP地址用来定位计算机的位置</li>
<li>端口号用来定位具体的应用程序</li>
<li>所有需要联网的通信和应用程序都会占用一个端口号</li>
<li>端口号的范围是 0~65536 之间</li>
<li>在计算机中有一些默认的端口号，例如<ul>
<li>http 服务的80端口</li>
</ul>
</li>
<li>在开发过程中只会用到一些常见的端口，例如：8080，3000，8088…</li>
</ul>
<h2 id="响应式数据的content-type"><a href="#响应式数据的content-type" class="headerlink" title="响应式数据的content-type"></a>响应式数据的content-type</h2><ul>
<li>声明文本格式的数据 <code>res.Header(&quot;Content-Type&quot;,&quot;text/plain; charset=utf-8&quot;)</code></li>
<li>声明 html 格式的数据 <code>res.setHeader(&quot;Content-Type&quot;, &quot;text/html; charset=utf-8&quot;)</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="comment">// 在服务端默认发送的数据是 utf-8 格式的数据</span></span><br><span class="line">    <span class="comment">// 但是在浏览器中不知道发送过来的数据是utf8的数据，所以会按照当操作系统的默认编码区解析，最终造成乱码</span></span><br><span class="line">    <span class="comment">// 在中文操作系统中默认解析方式是 gbk</span></span><br><span class="line">    <span class="comment">// 解决方法就是告诉浏览器，我发送的是什么类型的数据，是 utf-8 的数据</span></span><br><span class="line">    <span class="comment">//  通过设置发送数据头来告诉浏览器，发送的数据格式是什么格式的数据</span></span><br><span class="line">    <span class="comment">//  res.Header(&quot;Content-Type&quot;,&quot;text/plain; charset=utf-8&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">url</span> === <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// text/plain 文本格式的数据</span></span><br><span class="line">        res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>,<span class="string">&quot;text/plain; charset=utf-8&quot;</span>)</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&quot;hello 世界&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.<span class="property">url</span> === <span class="string">&quot;/html&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// text/html html格式的数据</span></span><br><span class="line">        res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html; charset=utf-8&quot;</span>)</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&quot;&lt;h2&gt;这是html页面&lt;/h2&gt;&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<h2 id="http-fs-实现简单的页面渲染"><a href="#http-fs-实现简单的页面渲染" class="headerlink" title="http + fs 实现简单的页面渲染"></a>http + fs 实现简单的页面渲染</h2><ul>
<li>在线工具地址 <a target="_blank" rel="noopener" href="https://tool.oschina.net/">https://tool.oschina.net/</a></li>
<li>不同资源对应的 Content-Type 不一样，可以通过上面的网址查询</li>
<li>url专业术语：统一资源定位符</li>
<li>一个 url 对应一个资源<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在线工具地址 https://tool.oschina.net/</span></span><br><span class="line"><span class="comment">// 不同资源对应的 Content-Type 不一样，可以通过上面的网址查询</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> url = req.<span class="property">url</span>;</span><br><span class="line">    <span class="keyword">if</span> (url === <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// 利用 fs 读取文件，将文件内容发送个浏览器</span></span><br><span class="line">        fs.<span class="title function_">readFile</span>(<span class="string">&quot;./resources/index.html&quot;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/plain; charset=utf-8&quot;</span>)</span><br><span class="line">                res.<span class="title function_">end</span>(<span class="string">&quot;文件请求失败&quot;</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-type&quot;</span>, <span class="string">&quot;text/html; charset=utf-8&quot;</span>)</span><br><span class="line">                res.<span class="title function_">end</span>(data)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url === <span class="string">&quot;/jietu&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// url专业术语：统一资源定位符</span></span><br><span class="line">        <span class="comment">// 一个 url 最终指向一个资源</span></span><br><span class="line">        fs.<span class="title function_">readFile</span>(<span class="string">&quot;./resources/jietu.png&quot;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// data默认是二进制数据，可以通过 toString 转为咱们能识别的字符串</span></span><br><span class="line">            <span class="comment">// res.end 支持两种格式的数据类型，一种是二进制，一种是字符串</span></span><br><span class="line">            <span class="comment">// 图片不需要指定编码格式，一般需要指定编码的都是字符串需要指定</span></span><br><span class="line">            res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;image/png&quot;</span>);</span><br><span class="line">            res.<span class="title function_">end</span>(data)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;3000端口启动成功&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="path-路径操作模块"><a href="#path-路径操作模块" class="headerlink" title="path 路径操作模块"></a>path 路径操作模块</h2><p>path 用于处理文件和路径的目录，可以使用一下方式使用它</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> pathUrl = <span class="string">&#x27;D:/a-个人项目管理/nodejs学习/nodejs-learning/day01/09path模块.js&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="path-basename-获取路径中的文件名"><a href="#path-basename-获取路径中的文件名" class="headerlink" title="path.basename() 获取路径中的文件名"></a>path.basename() 获取路径中的文件名</h3><p>path.basename() 方法会返回 path 的最后一部分,第二部分表示要去掉的后缀，没有则不去掉文件后缀</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(path.<span class="title function_">basename</span>(pathUrl)); </span><br><span class="line">    <span class="comment">//=&gt; 09path模块.js   </span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(path.<span class="title function_">basename</span>(pathUrl,<span class="string">&quot;.js&quot;</span>)); </span><br><span class="line">    <span class="comment">//=&gt; 09path模块</span></span><br></pre></td></tr></table></figure>
<h3 id="path-dirname-获取路径中的目录名"><a href="#path-dirname-获取路径中的目录名" class="headerlink" title="path.dirname() 获取路径中的目录名"></a>path.dirname() 获取路径中的目录名</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(path.<span class="title function_">dirname</span>(pathUrl)); </span><br><span class="line">    <span class="comment">//=&gt; D:/a-个人项目管理/nodejs学习/nodejs-learning/day01</span></span><br></pre></td></tr></table></figure>
<h3 id="path-extname-返回-path-的扩展名"><a href="#path-extname-返回-path-的扩展名" class="headerlink" title="path.extname() 返回 path 的扩展名"></a>path.extname() 返回 path 的扩展名</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(path.<span class="title function_">extname</span>(pathUrl)); </span><br><span class="line">    <span class="comment">//=&gt; .js</span></span><br></pre></td></tr></table></figure>
<h3 id="path-parse-解析地址"><a href="#path-parse-解析地址" class="headerlink" title="path.parse() 解析地址"></a>path.parse() 解析地址</h3><p>path.parse() 方法会返回一个对象，其属性表示 path 的有效元素</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(path.<span class="title function_">parse</span>(pathUrl));</span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//   root: &#x27;D:/&#x27;,</span></span><br><span class="line">    <span class="comment">//   dir: &#x27;D:/a-个人项目管理/nodejs学习/nodejs-learning/day01&#x27;,</span></span><br><span class="line">    <span class="comment">//   base: &#x27;09path模块.js&#x27;,</span></span><br><span class="line">    <span class="comment">//   ext: &#x27;.js&#x27;,</span></span><br><span class="line">    <span class="comment">//   name: &#x27;09path模块&#x27;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="path-format-根据对象还原地址"><a href="#path-format-根据对象还原地址" class="headerlink" title="path.format() 根据对象还原地址"></a>path.format() 根据对象还原地址</h3><p>path.format() 方法从对象返回路径字符串</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(path.<span class="title function_">format</span>(path.<span class="title function_">parse</span>(pathUrl))); </span><br><span class="line">    <span class="comment">// =&gt; D:/a-个人项目管理/nodejs学习/nodejs-learning/day01\09path模块.js</span></span><br></pre></td></tr></table></figure>
<h3 id="path-join-拼接路径"><a href="#path-join-拼接路径" class="headerlink" title="path.join() 拼接路径"></a>path.join() 拼接路径</h3><p>path.join() 方法会将所有给定的 path 片段连接到一起（使用平台特定的分隔符作为定界符），然后规范化生成的路径</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(path.<span class="title function_">join</span>(<span class="string">&#x27;c:&#x27;</span>,<span class="string">&#x27;abc&#x27;</span>,<span class="string">&#x27;def&#x27;</span>)); </span><br><span class="line">    <span class="comment">// =&gt; c:\abc\def</span></span><br></pre></td></tr></table></figure>
<h3 id="path-isAbsolute-检测路径是否为绝对路径"><a href="#path-isAbsolute-检测路径是否为绝对路径" class="headerlink" title="path.isAbsolute() 检测路径是否为绝对路径"></a>path.isAbsolute() 检测路径是否为绝对路径</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// path.isAbsolute() 方法检测 path 是否为绝对路径。</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(path.<span class="title function_">isAbsolute</span>(pathUrl));</span><br><span class="line">    <span class="comment">// =&gt; true</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(path.<span class="title function_">isAbsolute</span>(<span class="string">&#x27;../day01/resources/index.html&#x27;</span>));</span><br><span class="line">    <span class="comment">// =&gt; false</span></span><br></pre></td></tr></table></figure>
<h3 id="获取当前文件所处目录的绝对路径并拼接地址"><a href="#获取当前文件所处目录的绝对路径并拼接地址" class="headerlink" title="获取当前文件所处目录的绝对路径并拼接地址"></a>获取当前文件所处目录的绝对路径并拼接地址</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;public&#x27;</span>));</span><br><span class="line">    <span class="comment">// =&gt; D:\a-个人项目管理\nodejs学习\nodejs-learning\day01\public</span></span><br></pre></td></tr></table></figure>
<h2 id="node-中的其他成员"><a href="#node-中的其他成员" class="headerlink" title="node 中的其他成员"></a>node 中的其他成员</h2><p>在每个模块中 ，除了 <code>require</code>、<code>exprots</code>等模块之外的相关 API 之外，还有两个特殊成员：</p>
<ul>
<li><code>__dirname</code>，可以用来动态的获取当前文件所属目录的绝对路径</li>
<li><code>__dilename</code>，用来动态的获取当前文件的绝对路径</li>
<li><code>__dirname</code> 和<code> __dilename</code> 获取到的路径是不受 node 命令所属路径影响的</li>
</ul>
<p>在操作文件中，使用相对路径是不可靠的，因为在 node 中操作文件的路径被设计为相对于执行 node 命令所处的路径（不是bug，人家这样设计有使用场景）</p>
<p>所以为了解决这个问题，只需要把相对路径变成绝对路径就可以了</p>
<p>所以使用 <code>__dirname</code> 和 <code>__dilename</code> 来解决这个问题</p>
<p>另外在拼接路径中，为了避免出现低级错误，常常采用 <code>path</code> 模块提供的 <code>join</code> 方法来帮助我们拼接路径</p>
<p>所以为了避免出现上面这种错误，以后在操作文件时最好都将相对路径写成绝对路径</p>
<h1 id="第二章"><a href="#第二章" class="headerlink" title="第二章"></a>第二章</h1><h2 id="代码中无分号问题"><a href="#代码中无分号问题" class="headerlink" title="代码中无分号问题"></a>代码中无分号问题</h2><p>当代码中采用没有分号的风格时需要注意以下几点即可</p>
<ul>
<li><code>[ </code> 开头</li>
<li><code>( </code> 开头</li>
<li>`  开头</li>
</ul>
<p>当一行代码是以上面三个字符开头时，需要在这行代码前加上分号，否则会报错</p>
<p>除了分号外，也可以加上 ! ~ 等</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">day</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;你好&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">day</span>()</span><br><span class="line"></span><br><span class="line">;[<span class="string">&#x27;苹果&#x27;</span>,<span class="string">&#x27;香蕉&#x27;</span>].<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(item)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">;(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;自治性任务&#x27;</span>)</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line">;<span class="string">`hello`</span>.<span class="title function_">toString</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="根据路径获取文件内容"><a href="#根据路径获取文件内容" class="headerlink" title="根据路径获取文件内容"></a>根据路径获取文件内容</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"><span class="keyword">var</span> urladd = <span class="string">&#x27;D:/000个人项目/node学习/nodejs-learning/day2/www&#x27;</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> url = req.<span class="property">url</span> === <span class="string">&#x27;/&#x27;</span> ? <span class="string">&#x27;/index.html&#x27;</span> : req.<span class="property">url</span>;</span><br><span class="line">    fs.<span class="title function_">readFile</span>(<span class="string">`<span class="subst">$&#123;urladd&#125;</span><span class="subst">$&#123;url&#125;</span>`</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">end</span>(<span class="string">&#x27;404 not found&#x27;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">end</span>(data)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;runing....&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="读取某个文件夹下的所有文件"><a href="#读取某个文件夹下的所有文件" class="headerlink" title="读取某个文件夹下的所有文件"></a>读取某个文件夹下的所有文件</h2><p>使用 <code>fs.readdir()</code> 函数读取某个文件夹下的所有文件，接受两个参数，分别如下</p>
<ul>
<li>要读取的文件夹地址</li>
<li>读取后的回调函数，有两个参数<ul>
<li>第一个是失败时的参数</li>
<li>第二个是读取成功后返回的数据，是数组格式的数据</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> server = http.<span class="title function_">createServer</span>()</span><br><span class="line"><span class="keyword">var</span> wwwDir = <span class="string">&quot;D:/000个人项目/node学习/nodejs-learning/day2/www&quot;</span></span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 使用 readdir 读取某个文件夹下的所有文件</span></span><br><span class="line">    fs.<span class="title function_">readdir</span>(wwwDir, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">end</span>(<span class="string">&quot;404 not found&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> content = <span class="string">&quot;&quot;</span></span><br><span class="line">            data.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                content += item + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">            res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/plain; charset=utf-8&quot;</span>)</span><br><span class="line">            res.<span class="title function_">end</span>(content)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;running...&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="在-node-中使用模板引擎"><a href="#在-node-中使用模板引擎" class="headerlink" title="在 node 中使用模板引擎"></a>在 node 中使用模板引擎</h2><ul>
<li>首先引入模板引擎插件<ul>
<li>安装 <code>npm install art-template</code></li>
<li>官方文档：<a target="_blank" rel="noopener" href="http://aui.github.io/art-template/zh-cn/">http://aui.github.io/art-template/zh-cn/</a></li>
</ul>
</li>
<li>安装完成后，引入模板引擎<ul>
<li><code>const template = require(&#39;art-template&#39;)</code></li>
</ul>
</li>
<li>引入 <code>fs</code> ，用来读取文件和读取目录</li>
<li>引入 <code>http</code> ，用来搭建服务，给浏览器返回页面</li>
<li>读取页面数据后继续读取文件目录，获取目录列表</li>
<li>然后键页面数据转成字符串，交给模板引擎解析数据，并将目录列表数据传给页面，循环显示出来</li>
</ul>
<p><strong>js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> artTemplate = <span class="built_in">require</span>(<span class="string">&#x27;art-template&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>()</span><br><span class="line"><span class="keyword">const</span> wwwAddr = <span class="string">&quot;./www&quot;</span></span><br><span class="line"></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./www/在node中使用模板引擎.html&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">end</span>(<span class="string">&#x27;404 not found&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 读取文件夹下的目录结构,返回是一个数组类型的数据</span></span><br><span class="line">        fs.<span class="title function_">readdir</span>(wwwAddr, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 将读取的页面二进制数据转换成字符串格式</span></span><br><span class="line">            <span class="comment">// 使用模板引擎完成页面内容替换</span></span><br><span class="line">            <span class="keyword">let</span> htmlStr = artTemplate.<span class="title function_">render</span>(data.<span class="title function_">toString</span>(), &#123;</span><br><span class="line">                <span class="attr">target</span>: data,</span><br><span class="line">                <span class="attr">arr</span>: [&#123;</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&quot;李四&quot;</span>,</span><br><span class="line">                    <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">                &#125;, &#123;</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">                    <span class="attr">age</span>: <span class="number">16</span></span><br><span class="line">                &#125;]</span><br><span class="line">            &#125;)</span><br><span class="line">            res.<span class="title function_">end</span>(htmlStr)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;running success....&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>html核心代码</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在node中使用模板引擎.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 模板引擎的循环语句，target 是循环的数组 --&gt;</span></span><br><span class="line">    &#123;&#123;each target&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>&#123;&#123;$value&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    &#123;&#123;/each&#125;&#125;</span><br><span class="line"></span><br><span class="line">    &#123;&#123;each arr&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;$value.name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;&#123;/each&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="服务端渲染和客户端渲染的区别"><a href="#服务端渲染和客户端渲染的区别" class="headerlink" title="服务端渲染和客户端渲染的区别"></a>服务端渲染和客户端渲染的区别</h2><ul>
<li><p>客户端渲染不利于 SEO 搜索引擎优化</p>
</li>
<li><p>服务端渲染可以被爬虫抓取到，客户端异步渲染很难被爬虫爬取到</p>
</li>
<li><p>所以真正的网站既不是纯异步也不是纯服务端渲染的</p>
</li>
<li><p>而是两者结合来做</p>
</li>
<li><p>例如：京东的商品列表采用的就是服务端渲染，目的为了 SEO 搜索引擎优化</p>
</li>
<li><p>而它的商品评论列表采用的就是客户端渲染，因为评论不需要 SEO 优化</p>
</li>
<li><p>两者优缺点 — 客户端渲染</p>
<ul>
<li>优点<ul>
<li>响应速度快，用户可以立马看到页面大致样式</li>
<li>用户体验好，翻页时无需重新加载页面</li>
</ul>
</li>
<li>缺点<ul>
<li>请求数据速度稍慢，需要等待页面加载完成后再去请求数据（最少两次请求）</li>
<li>不利于 SEO 优化，爬虫很难爬到，因为页面数据是异步的</li>
</ul>
</li>
</ul>
</li>
<li><p>两者优缺点 — 服务端渲染</p>
<ul>
<li>优点<ul>
<li>页面和数据一次性返回给浏览器，用户看到页面是就是已经加载好的页面</li>
<li>利于 SEO 搜索引擎优化，爬虫可以爬取到</li>
</ul>
</li>
<li>缺点<ul>
<li>加载速度慢，翻页时需要重新加载页面</li>
<li>用户体检不好</li>
</ul>
</li>
</ul>
</li>
<li><p>如何查看一个网页是服务端渲染还是客户端渲染</p>
<ul>
<li>右键查看源代码，如果网页中的数据可以在源代码中找到，说明是服务端渲染，否则是客户端渲染</li>
</ul>
</li>
</ul>
<h2 id="处理网站中的静态资源"><a href="#处理网站中的静态资源" class="headerlink" title="处理网站中的静态资源"></a>处理网站中的静态资源</h2><ul>
<li>服务端渲染页面时，静态文件资源和页面文件要放在两个单独的文件中，避免和程序运行文件放在一起<ul>
<li>页面文件放在 view 文件夹下</li>
<li>静态资源文件放在 public 文件夹下<ul>
<li>css</li>
<li>js</li>
<li>img</li>
<li>lib</li>
</ul>
</li>
</ul>
</li>
<li>页面中包含 src 和 href（不包含a标签）属性的标签在请求资源时页面加载过程中就会进行请求加载</li>
<li>服务端要根据这个资源的请求路径做处理</li>
</ul>
<p>js文件中针对静态资源的请求单独处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此处判断如果是以 /public/ 开头的，如果是则认为这个请求是要获取静态资源</span></span><br><span class="line"><span class="keyword">if</span> (url.<span class="title function_">indexOf</span>(<span class="string">&#x27;/public/&#x27;</span>) === <span class="number">0</span>) &#123;   </span><br><span class="line">    <span class="comment">// 在静态资源目录前添加一个 . ，返回读取到的静态资源</span></span><br><span class="line">    fs.<span class="title function_">readFile</span>(<span class="string">&#x27;.&#x27;</span> + url, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">end</span>(<span class="string">&#x27;404 not found&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        res.<span class="title function_">end</span>(data)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>页面中请求静态资源时就不能以路径的方法去获取，而是以 <code>url</code> 的方法去获取,让服务端去给我们返数据</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 服务端渲染页面时，读取静态文件要以一个文件开头，有服务端去处理这个请求路径 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/public/lib/bootstrap.min.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/public/css/index-css.css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="渲染评论列表"><a href="#渲染评论列表" class="headerlink" title="渲染评论列表"></a>渲染评论列表</h2><p>使用模板渲染引擎，在服务端渲染完成后返回给浏览器。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 要循环渲染的数据</span></span><br><span class="line"><span class="keyword">const</span> components = [&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;今天天气不错&quot;</span>,</span><br><span class="line">    <span class="attr">createTime</span>: <span class="string">&quot;2020-03-29&quot;</span></span><br><span class="line">&#125;,&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;张三2&quot;</span>,</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;今天天气不错&quot;</span>,</span><br><span class="line">    <span class="attr">createTime</span>: <span class="string">&quot;2020-03-29&quot;</span></span><br><span class="line">&#125;,&#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断接口路径渲染数据</span></span><br><span class="line"><span class="keyword">if</span> (url === <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">    fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./view/index.html&#x27;</span>, <span class="function">(<span class="params">err, html</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">end</span>(<span class="string">&#x27;404 not found&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 通过渲染引擎渲染数据</span></span><br><span class="line">        <span class="keyword">let</span> htmlStr = template.<span class="title function_">render</span>(html.<span class="title function_">toString</span>(), &#123;</span><br><span class="line">            <span class="attr">components</span>: components</span><br><span class="line">        &#125;)</span><br><span class="line">        res.<span class="title function_">end</span>(htmlStr)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;list-group&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;each components&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;list-group-item&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;$value.name&#125;&#125;说：&#123;&#123;$value.msg&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;pull-right&quot;</span>&gt;</span> &#123;&#123;$value.createTime&#125;&#125; <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;&#123;/each&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="使用表单默认提交和-h5-自带校验"><a href="#使用表单默认提交和-h5-自带校验" class="headerlink" title="使用表单默认提交和 h5 自带校验"></a>使用表单默认提交和 h5 自带校验</h2><ul>
<li>在 <code>form</code> 标签中设置 <code>action</code> 属性的值，表示表单数据提交的地址，浏览器会请求这个地址，并传递表单数据</li>
<li>在 <code>form</code> 标签设置 <code>method</code> 属性，表示提交的方法<ul>
<li><code>get</code></li>
<li><code>post</code></li>
</ul>
</li>
<li>在表单内部 <code>label</code> 标签上设置 <code>for</code> 属性</li>
<li>在 <code>input</code> 标签上设置 <code>id</code> 属性，和 <code>label</code> 标签上的 <code>for</code> 属性一致</li>
<li>在 <code>input</code> 标签上设置 <code>required</code> 表示必填</li>
<li>在 <code>form</code> 结构内部添加 <code>type</code> 值为 <code>submit</code> 的按钮，点击按钮完成表单提交<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/submitMsg&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;input_name&quot;</span>&gt;</span>您的昵称<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;您的昵称&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input_name&quot;</span> <span class="attr">required</span> <span class="attr">min</span>=<span class="string">&quot;2&quot;</span> <span class="attr">maxlength</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;testarea_msg&quot;</span>&gt;</span>留言内容<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;留言内容&quot;</span> <span class="attr">required</span> <span class="attr">id</span>=<span class="string">&quot;testarea_msg&quot;</span> <span class="attr">maxlength</span>=<span class="string">&quot;20&quot;</span> <span class="attr">minlength</span>=<span class="string">&quot;5&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">name</span>=<span class="string">&quot;msg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-success&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="使用-url-模块解析路径地址"><a href="#使用-url-模块解析路径地址" class="headerlink" title="使用 url 模块解析路径地址"></a>使用 url 模块解析路径地址</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 url 模块</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line"><span class="comment">// 使用 url.parse 解析路径，第二个参数为 true 可以将后面的参数转为对象格式</span></span><br><span class="line"><span class="keyword">var</span> paserurl = url.<span class="title function_">parse</span>(<span class="string">&#x27;http://127.0.0.1:3000/submitMsg?name=张三message=你今天真帅&#x27;</span>,<span class="literal">true</span>)</span><br><span class="line"><span class="comment">// 使用 JSON.stringfiy 去掉参数中的 [Object: null prototype]</span></span><br><span class="line"><span class="keyword">var</span> query = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(paserurl.<span class="property">query</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印路径中携带的查询参数 &#123;&quot;name&quot;:&quot;张三&quot;,&quot;message&quot;:&quot;你今天真帅&quot;&#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(query);</span><br></pre></td></tr></table></figure>

<h2 id="使浏览器重定向"><a href="#使浏览器重定向" class="headerlink" title="使浏览器重定向"></a>使浏览器重定向</h2><ul>
<li>浏览器什么时候会重定向<ul>
<li>接口状态返回 <code>301</code> 或者 <code>302</code> 时会重定向<ul>
<li><code>301</code>：永久重定向，第一次跳转后再次跳转时不会发送两次请求，直接重定向到新的地址</li>
<li><code>302</code>：临时重定向，表示后面会变，可以用来做页面跳转</li>
</ul>
</li>
<li>如果接口返回的状态码是 <code>301</code> 或者 <code>302</code> 时会去响应头中寻找 <code>Location</code> 指向的地址，然后自动请求这个地址，完成跳转操作</li>
</ul>
</li>
<li>node 如何让浏览器重定向<ul>
<li>设置接口返回的状态码为 <code>302</code><ul>
<li><code>res.statusCode = 302</code></li>
</ul>
</li>
<li>设置响应头中的 <code>Location</code> <ul>
<li><code>res.setHeader(&#39;Location&#39;, &#39;/&#39;)</code> 第二个参数是要重定向的地址</li>
</ul>
</li>
<li>最后结束响应<ul>
<li><code>res.end()</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>实现代码</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断请求路径，处理参数，然后进重定向操作</span></span><br><span class="line"><span class="keyword">if</span> (paseUrl.<span class="property">pathname</span> === <span class="string">&#x27;/submitMsg&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 获取到参数后添加到循环数组中</span></span><br><span class="line">    <span class="keyword">let</span> query = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(paseUrl.<span class="property">query</span>))</span><br><span class="line">    query.<span class="property">createTime</span> = <span class="string">&#x27;2020-03-20 15:56&#x27;</span></span><br><span class="line">    components.<span class="title function_">unshift</span>(query)</span><br><span class="line">    <span class="comment">// 然后对网站进行重定向处理，返回状态码为 302 时，浏览器会进行临时重定向</span></span><br><span class="line">    <span class="comment">// 然后在响应头中通过 Location 告诉客户端往哪里重定向</span></span><br><span class="line">    res.<span class="property">statusCode</span> = <span class="number">302</span>;</span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Location&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    res.<span class="title function_">end</span>()</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>
<h1 id="第三章"><a href="#第三章" class="headerlink" title="第三章"></a>第三章</h1><h2 id="require-加载规则"><a href="#require-加载规则" class="headerlink" title="require 加载规则"></a>require 加载规则</h2><ul>
<li>默认加载缓存，已经被加载过的模块不会重复加载，但是可以重复使用模块中导出的方法</li>
</ul>
<p><strong>a.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;加载了a模块&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fn = <span class="built_in">require</span>(<span class="string">&#x27;./b&#x27;</span>)</span><br><span class="line"><span class="title function_">fn</span>()</span><br></pre></td></tr></table></figure>
<p><strong>b.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;加载了b模块&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;b模块导出的方法&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>main.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./public/a&#x27;</span>)</span><br><span class="line"><span class="comment">// 优先加载缓存，b 模块在 a 模块中已经被加载过了，此时不会再打印 b 模块中的文字</span></span><br><span class="line"><span class="comment">// 此处引入 b 模块只是用 b 模块中的方法</span></span><br><span class="line"><span class="keyword">var</span> fn = <span class="built_in">require</span>(<span class="string">&#x27;./public/b&#x27;</span>)</span><br><span class="line"><span class="title function_">fn</span>()</span><br></pre></td></tr></table></figure>
<p>上面代码中 <code>main.js</code> 导入 <code>a</code> 模块，在 <code>a</code> 模块中又加载了 <code>b</code> 模块，因为 <code>b</code> 模块是被首次加载，所以会打印 <code>b</code> 模块中的代码，然后 <code>b</code> 模块导出了一个方法，最后又回到 <code>main.js</code> 的时候，<code>b</code> 模块已经被加载过了，所以不会再执行 <code>b</code> 模块的代码，但是 <code>b</code> 模块导出的方法可以使用，最终代码执行结果为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">加载了a模块</span><br><span class="line">加载了b模块</span><br><span class="line">b模块导出的方法</span><br><span class="line">b模块导出的方法</span><br></pre></td></tr></table></figure>

<h2 id="require-加载机制"><a href="#require-加载机制" class="headerlink" title="require 加载机制"></a>require 加载机制</h2><h3 id="1-加载本地文件"><a href="#1-加载本地文件" class="headerlink" title="1.加载本地文件"></a>1.加载本地文件</h3><ul>
<li><code>require(&#39;./xxx&#39;)</code> 一个点开头表示引入当前目录下的文件</li>
<li><code>require(&#39;../xxx&#39;)</code> 两个点开头表示引入上一级目录的文件</li>
<li><code>require(&#39;/xx&#39;)</code> 以 <code>/</code> 开头表示当前文件所属磁盘的根目录（几乎不用）</li>
<li><code>require(&#39;./index.js&#39;)</code> 后缀名 <code>.js</code> 可以省略</li>
</ul>
<h3 id="2-加载系统模块"><a href="#2-加载系统模块" class="headerlink" title="2.加载系统模块"></a>2.加载系统模块</h3><p>核心模块的本质也是加载本地文件，但是核心模块的代码已经被编译到了二进制文件中，我们只需要按照模块名字导入即可</p>
<ul>
<li><code>require(&#39;fs&#39;)</code></li>
<li><code>require(&#39;http&#39;)</code></li>
</ul>
<h3 id="3-加载第三方模块"><a href="#3-加载第三方模块" class="headerlink" title="3.加载第三方模块"></a>3.加载第三方模块</h3><p>第三方模块需要通过 <code>npm install xxx(第三方包名)</code> 来下载，然后通过 <code>require(&#39;第三方包名&#39;)</code> 来引入，不可能有第三方包名与系统的包名一样。引入第三方包的寻找机制如下,以<code>art-template</code>包为例：</p>
<ul>
<li><p>先找到当前文件所处目录的 <code>mode_modules</code> 文件</p>
</li>
<li><p>然后找 <code>node_modules/art-template/package.json</code> 文件</p>
</li>
<li><p>在 <code>node_modules/art-template/package.json</code> 文件中有一个 <code>mian</code> 属性</p>
</li>
<li><p><code>main</code> 属性中声明的是入口模块</p>
</li>
<li><p>之后加载使用这个第三方包</p>
</li>
<li><p>实际上最终还是加载的第三方文件</p>
</li>
<li><p>如果 <code>package.json</code> 文件不存在或者 <code>main</code> 指定的入口模块也没有</p>
</li>
<li><p>则 <code>node</code> 会自动找还目录下的 <code>index.js</code> 文件</p>
</li>
<li><p>也就是说 <code>index.js</code> 会作为一个默认的备选项</p>
</li>
<li><p>如果以上任何一个条件都不成立，则会进入上一级目录中的 <code>node_modules</code> 目录查找，如果上一级也没有，则继续往上一级查找，只到找到为止</p>
</li>
<li><p>如果没找到，则会报错</p>
</li>
</ul>
<h2 id="包文件说明"><a href="#包文件说明" class="headerlink" title="包文件说明"></a>包文件说明</h2><p>每个项目中最好都有一个 <code>package.json</code> 文件,可以简单理解为项目的说明书，这个文件中记载了项目名称，版本号，依赖包文件等。</p>
<p>首先在空白项目中执行 <code>npm init</code> 然后设置相关信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">PS D:\AA-demo练习\node-demo&gt; npm init</span><br><span class="line">This utility will walk you through creating a package.json file.</span><br><span class="line">It only covers the most common items, and tries to guess sensible defaults.</span><br><span class="line"></span><br><span class="line">See `npm help init` for definitive documentation on these fields</span><br><span class="line">and exactly what they do.</span><br><span class="line"></span><br><span class="line">Use `npm install &lt;pkg&gt;` afterwards to install a package and</span><br><span class="line">save it as a dependency in the package.json file.</span><br><span class="line"></span><br><span class="line">Press ^C at any time to quit.</span><br><span class="line">package name: (demo) my-node-demo  // 项目名称</span><br><span class="line">version: (1.0.0) 0.0.1  // 版本号</span><br><span class="line">description: 这是我的第一个node项目  // 项目描述信息</span><br><span class="line">entry point: (index.js) main.js  // 项目入口文件</span><br><span class="line">test command:  // 测试指令，暂无</span><br><span class="line">git repository:  // git 地址</span><br><span class="line">keywords:  // 项目关键字，用来发布 npm 包用，暂无</span><br><span class="line">author: szx  // 作者</span><br><span class="line">license: (ISC)  // 开源协议</span><br><span class="line">About to write to D:\AA-demo练习\node-demo\package.json:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;my-node-demo&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;0.0.1&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;这是我的第一个node项目&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;main.js&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;author&quot;: &quot;szx&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;ISC&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Is this OK? (yes) yes // 输入 yes 自动创建 package.json</span><br></pre></td></tr></table></figure>
<p>除了采用上面手动创建 <code>pacjage.json</code> 文件外，也可以使用 <code>npm init -y</code> 跳过向导，快速生成 <code>package.json</code>。</p>
<p>然后在安装第三方包是加上 <code>--save</code> 会自动在 package.json 中添加本次安装了那些包和这些包的版本号，例如输入 <code>npm install jquery --save</code>，然后打开 <code>package.json</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;jquery&quot;</span>: <span class="string">&quot;^3.6.0&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以在 <code>dependencies</code> 属性中看到本次安装了 <code>3.6</code> 版本的 <code>jquery</code>。如果我们后续包 <code>node_modules</code> 文件删除后，只需要执行 <code>npm install</code> 就可以吧项目依赖的所有包自动安装回来。</p>
<h2 id="npm-常用命令"><a href="#npm-常用命令" class="headerlink" title="npm 常用命令"></a>npm 常用命令</h2><ul>
<li><code>npm init</code><ul>
<li>初始化项目，创建 <code>package.json</code></li>
<li>还可以写：<code>npm init -y</code>跳过向导，直接生成 <code>package.json</code></li>
</ul>
</li>
<li><code>npm install</code><ul>
<li>一次性吧 <code>dependencies</code> 选项中的依赖包全部安装</li>
<li>简写：<code>npm i</code></li>
</ul>
</li>
<li><code>npm install XXX --save</code><ul>
<li>下载并保存依赖项到<code>package.json</code></li>
<li>简写：<code>npm i -S</code></li>
</ul>
</li>
<li><code>npm uninstall XXX</code><ul>
<li>只删除包，不删除依赖项</li>
<li>简写：<code>npm un</code></li>
</ul>
</li>
<li><code>npm uninstall XXX --save</code><ul>
<li>删除包的同时删除依赖项</li>
<li>简写：<code>npm un -S</code></li>
</ul>
</li>
</ul>
<h2 id="npm-配置淘宝镜像"><a href="#npm-配置淘宝镜像" class="headerlink" title="npm 配置淘宝镜像"></a>npm 配置淘宝镜像</h2><p>首先安装 <code>cnpm</code>，<code>global</code> 表示在全局安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --global cnpm</span><br></pre></td></tr></table></figure>
<p>之后使用 <code>cnpm install XXX</code> 的方式下载第三方包，如果想使用 <code>npm</code> 开头的同时，用淘宝镜像安装，可以给 <code>npm</code> 配置如下信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry https://registry.npm.taobao.org/</span><br></pre></td></tr></table></figure>
<p>这句代码表示每次下载的时候通过这个网址下载安装依赖，可以使用 <code>npm config list</code> 来查看是否配置成功</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PS D:\AA-demo练习\node-demo&gt; npm config list</span><br><span class="line">; cli configs</span><br><span class="line">metrics-registry = &quot;https://registry.npm.tao</span><br><span class="line">scope = &quot;&quot;</span><br><span class="line">user-agent = &quot;npm/6.14.11 node/v10.15.3 win3</span><br><span class="line"></span><br><span class="line">; userconfig C:\Users\Administrator\.npmrc</span><br><span class="line">home = &quot;https://npm.taobao.org&quot;</span><br><span class="line">registry = &quot;https://registry.npm.taobao.org/</span><br><span class="line"></span><br><span class="line">; node bin location = C:\Program Files\nodej</span><br><span class="line">; cwd = D:\AA-demo练习\node-demo</span><br><span class="line">; HOME = C:\Users\Administrator</span><br><span class="line">; &quot;npm config ls -l&quot; to show all defaults.</span><br></pre></td></tr></table></figure>

<h2 id="安装和使用-express"><a href="#安装和使用-express" class="headerlink" title="安装和使用 express"></a>安装和使用 express</h2><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express --save</span><br></pre></td></tr></table></figure>
<p>express 初体验</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 express</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 初始化程序</span></span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开放资源文件给浏览器 </span></span><br><span class="line"><span class="comment">// 访问如下网址可以访问该问价下的页面 http://127.0.0.1:3000/view/02view.html</span></span><br><span class="line"><span class="comment">// 无需在下面判断</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/view/&quot;</span>, express.<span class="title function_">static</span>(<span class="string">&quot;./view&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接使用 app.get 判断请求的路径</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 使用 send 给浏览器返回数据</span></span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/about&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 发送中文是无需经过编码了</span></span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;关于我&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 listen 返回端口信息</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;running&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="第四章"><a href="#第四章" class="headerlink" title="第四章"></a>第四章</h1><h2 id="express-使用"><a href="#express-使用" class="headerlink" title="express 使用"></a>express 使用</h2><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -save express</span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 app</span></span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> query = req.<span class="property">query</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(query); <span class="comment">// &#123; name: &#x27;李四&#x27; &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 send 可以自动帮助我们设置 Content-Type</span></span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;你好&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;running&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="使用-nodemon-完成更新代码后自动重启服务"><a href="#使用-nodemon-完成更新代码后自动重启服务" class="headerlink" title="使用 nodemon 完成更新代码后自动重启服务"></a>使用 nodemon 完成更新代码后自动重启服务</h2><p>安装，需要注意的是 <code>nodemon</code> 是需要全局安装的</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g nodemon</span><br></pre></td></tr></table></figure>
<p>使用 <code>nodemon</code> 运行 <code>node</code> 服务，之后保存时自动重启服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nodemon index.js</span><br></pre></td></tr></table></figure>

<h2 id="express-中的静态文件"><a href="#express-中的静态文件" class="headerlink" title="express 中的静态文件"></a>express 中的静态文件</h2><p>使用 /public 前缀地址来访问 public 目录中的文件了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/public&#x27;</span>, express.<span class="title function_">static</span>(<span class="string">&#x27;public&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>栗子</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://localhost:3000/public/images/kitten.jpg">http://localhost:3000/public/images/kitten.jpg</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:3000/public/css/style.css">http://localhost:3000/public/css/style.css</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:3000/public/js/app.js">http://localhost:3000/public/js/app.js</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:3000/public/images/bg.png">http://localhost:3000/public/images/bg.png</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:3000/public/hello.html">http://localhost:3000/public/hello.html</a></li>
</ul>
<p>不带前缀访问 public 目录中的文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&#x27;public&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>栗子</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://localhost:3000/images/kitten.jpg">http://localhost:3000/images/kitten.jpg</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:3000/css/style.css">http://localhost:3000/css/style.css</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:3000/js/app.js">http://localhost:3000/js/app.js</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:3000/images/bg.png">http://localhost:3000/images/bg.png</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:3000/hello.html">http://localhost:3000/hello.html</a></li>
</ul>
<p>通过带有 /static 前缀地址来访问 public 目录中的文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/static&#x27;</span>, express.<span class="title function_">static</span>(<span class="string">&#x27;public&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>栗子</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://localhost:3000/static/images/kitten.jpg">http://localhost:3000/static/images/kitten.jpg</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:3000/static/css/style.css">http://localhost:3000/static/css/style.css</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:3000/static/js/app.js">http://localhost:3000/static/js/app.js</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:3000/static/images/bg.png">http://localhost:3000/static/images/bg.png</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost:3000/static/hello.html">http://localhost:3000/static/hello.html</a></li>
</ul>
<h2 id="express-中使用-art-template-渲染引擎"><a href="#express-中使用-art-template-渲染引擎" class="headerlink" title="express 中使用 art-template 渲染引擎"></a>express 中使用 art-template 渲染引擎</h2><p><a target="_blank" rel="noopener" href="https://www.expressjs.com.cn/">express 中文地址</a><br><a target="_blank" rel="noopener" href="https://aui.github.io/art-template/">art-template 中文网址</a></p>
<p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install --save art-template</span><br><span class="line">npm install --save express-art-template </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">or</span></span><br><span class="line"></span><br><span class="line">npm install --save art-template express-art-template</span><br></pre></td></tr></table></figure>
<p>配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置 art-template 模板引擎</span></span><br><span class="line"><span class="comment">// 第一个参数表示，当渲染以 .art 结尾的文件时，使用 art-template 模板引擎</span></span><br><span class="line"><span class="comment">// express-art-template 是专门用来在 express 中吧 art-template 整合到 express 中</span></span><br><span class="line"><span class="comment">// 虽然外面这里不需要记载 art-template 但是也必须安装</span></span><br><span class="line"><span class="comment">// 原因就在于 express-art-template 依赖了 art-template</span></span><br><span class="line">app.<span class="title function_">engine</span>(<span class="string">&#x27;html&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;express-art-template&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// express 为 response 相应的对象提供了一个方法 render</span></span><br><span class="line"><span class="comment">// render 方法默认是不可以使用的，但是如果配置了就可以使用</span></span><br><span class="line"><span class="comment">// res.render(&#x27;html模板名称&#x27;,&#123; 模板数据 &#125;)</span></span><br><span class="line"><span class="comment">// 第一个参数默认默认会去 views 文件夹下查找文件，所以这里不用在添加 views 路径名称</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&#x27;index.html&#x27;</span>, &#123;</span><br><span class="line">        <span class="comment">// 循环数据</span></span><br><span class="line">        <span class="attr">components</span>: components</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="express-解析表单的-post-提交数据"><a href="#express-解析表单的-post-提交数据" class="headerlink" title="express 解析表单的 post 提交数据"></a>express 解析表单的 post 提交数据</h2><p>安装 <code>body-parser</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save body-parser</span><br></pre></td></tr></table></figure>
<p>使用，使用 <code>res.body</code> 获取 <code>post</code> 数据，是一个对象类型的数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置 bodyParser 获取post请求提交的数据</span></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取 post 参数</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/post&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 使用 req.body 获取 post 请求携带的参数</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="将文件直接按照-utf8-格式读取"><a href="#将文件直接按照-utf8-格式读取" class="headerlink" title="将文件直接按照 utf8 格式读取"></a>将文件直接按照 utf8 格式读取</h2><p>默认使用 <code>fs</code> 读取文件，读取到的数据是二进制的数据，需要利用 <code>toString()</code> 方法转为人可以读取内容，现在利用下列方法，可以在读取数据是返回的就是经过转换后的数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./db.json&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;server error 500&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 读取到的就是转换后的数据</span></span><br><span class="line">    consoloe.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="结合-express-配置-router-模块"><a href="#结合-express-配置-router-模块" class="headerlink" title="结合 express 配置 router 模块"></a>结合 express 配置 router 模块</h2><p>之前我们都把路径请求都写在 index.js 文件中，这样路径多的话，一个文件的体积就过于庞大，所以，我们要将路由模块单抽离出来，减少代码的复杂度，同时方便后期维护。</p>
<ul>
<li>首先新建 router.js 文件</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 配置路由模块</span></span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./db.json&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;server error 500&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        res.<span class="title function_">render</span>(<span class="string">&#x27;index.html&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">students</span>: <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data).<span class="property">students</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/post&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&#x27;post.html&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出 router</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br></pre></td></tr></table></figure>
<ul>
<li>在 index.js 文件中引入 router.js 并将 router 挂载到 app 中</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 router.js</span></span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="keyword">var</span> router = <span class="built_in">require</span>(<span class="string">&#x27;./router&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 挂载并使用</span></span><br><span class="line">app.<span class="title function_">use</span>(router)</span><br></pre></td></tr></table></figure>

<h2 id="使用回调函数获取异步数据"><a href="#使用回调函数获取异步数据" class="headerlink" title="使用回调函数获取异步数据"></a>使用回调函数获取异步数据</h2><p>1.封装读取数据的方法，接受一个函数参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 封装学生列表的增删改查方法</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> dbPath = <span class="string">&#x27;./db.json&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取所有学生数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">function</span>&#125; callback </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">find</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    fs.<span class="title function_">readFile</span>(dbPath, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 使用回调函数将异步读取到的文件数据返回出来</span></span><br><span class="line">        <span class="title function_">callback</span>(err, <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data).<span class="property">students</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出所有方法</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="comment">// 获取所有学生数据</span></span><br><span class="line">    find,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.使用封装的读取方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="comment">// 配置路由模块</span></span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line"><span class="comment">// 引入封装好的操作学生数据方法的文件</span></span><br><span class="line"><span class="keyword">var</span> student = <span class="built_in">require</span>(<span class="string">&#x27;./student&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 首页，查询学生列表</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="comment">// 使用封装的读取方法</span></span><br><span class="line">    student.<span class="title function_">find</span>(<span class="function">(<span class="params">err,data</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;server error 500&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        res.<span class="title function_">render</span>(<span class="string">&#x27;studentList.html&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">students</span>: data</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="第五章"><a href="#第五章" class="headerlink" title="第五章"></a>第五章</h1><h2 id="封装原生的-get-请求"><a href="#封装原生的-get-请求" class="headerlink" title="封装原生的 get 请求"></a>封装原生的 get 请求</h2><ul>
<li>回调函数的使用<div class="note info no-icon flat"><p>js代码默认是同步执行的，当遇到异步函数时，异步函数返回的数据在同步函数中获取不到，所以，要用到回调函数的方法，获取异步函数返回的数据。下面是一个小案例，来感受回调函数的魅力</p>
</div></li>
</ul>
<p><strong>获取倒计时1秒后的执行方法返回的数据</strong></p>
<p>错误版本</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ret = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">count</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        ret = x + y</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 由于 console.log 是同步代码，所以会优先执行，因此打印的结果是 0</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">count</span>(<span class="number">10</span>, <span class="number">20</span>)); <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
<p>正确版本</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sucCount</span>(<span class="params">x, y, callback</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        ret = x + y</span><br><span class="line">        <span class="title function_">callback</span>(ret)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用回调函数获取计算后的结果</span></span><br><span class="line"><span class="title function_">sucCount</span>(<span class="number">10</span>, <span class="number">20</span>, <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// 30</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>封装get请求</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 封装ajax请求</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">url, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line">    xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="comment">// 调用回调函数返回请求到的数据</span></span><br><span class="line">        <span class="title function_">callback</span>(res.<span class="property">currentTarget</span>.<span class="property">responseText</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 结尾的true表示异步请求，false表示为同步请求</span></span><br><span class="line">    xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>, url, <span class="literal">true</span>)</span><br><span class="line">    xhr.<span class="title function_">send</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 接收回调函数传递过来的返回参数</span></span><br><span class="line"><span class="comment">// 这里的res就是上面回调函数传递的值</span></span><br><span class="line"><span class="title function_">get</span>(<span class="string">&#x27;db.json&#x27;</span>,<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="package-lock-json-文件的作用"><a href="#package-lock-json-文件的作用" class="headerlink" title="package-lock.json 文件的作用"></a>package-lock.json 文件的作用</h2><p>如果我们的 <code>npm</code> 版本是 5 版本以上，则我们每次使用 <code>npm</code> 安装依赖时会自动生成或者更新 <code>package-lock.json</code> 文件。那么这个文件有什么用呢？</p>
<ul>
<li><code>npm5</code> 以后的版本在安装依赖时不用加 <code>--save</code> 参数，也可以自动保存依赖信息</li>
<li>当安装依赖时，会自动创建或者更新 <code>package-lock.json</code> 这个文件</li>
<li><code>package-lock.json</code> 这个文件会保存 <code>node_modules</code> 中所有的依赖的信息(版本、下载地址)<ul>
<li>这样的话 <code>npm install</code> 时的速度会提升</li>
</ul>
</li>
<li>从文件名称看 <code>lock</code> 称之为锁<ul>
<li>这个 <code>lock</code> 是用来锁定版本的</li>
<li>例如在 <code>package.json</code> 文件中某个依赖包的版本为 <code>^3.1.5</code>，这个 <code>^</code> 的意思就是这个依赖可以在 <code>3.0</code> 这个大版本中往上升级，但是不会超出 <code>3.0</code> 版本中的最高版本，不会升级为 <code>4.0</code> 版本。如果没有 <code>package-lock.json</code> 这个文件的话，在下次 <code>npm install</code> 时，如果发现这个包存在更高版本，那么 <code>npm</code> 会下载最新版本的依赖，有时候不同版本之间可能会存在不兼容的情况，所以为了避免这种情况, <code>package-lock.json</code> 中就记录了每个依赖包的具体版本号，这样在下次 <code>npm install</code> 时就会按照 <code>package-lock.json</code> 中记载的版本号来下载。也就是锁定版本，不会升级</li>
</ul>
</li>
</ul>
<h2 id="find-和-findIndex-的原理"><a href="#find-和-findIndex-的原理" class="headerlink" title="find 和 findIndex 的原理"></a>find 和 findIndex 的原理</h2><p>首先声明一个数组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> user = [</span><br><span class="line">    &#123;<span class="attr">id</span>: <span class="number">1</span>,<span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">id</span>: <span class="number">2</span>,<span class="attr">name</span>: <span class="string">&#x27;李四&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">id</span>: <span class="number">3</span>,<span class="attr">name</span>: <span class="string">&#x27;王五&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">id</span>: <span class="number">4</span>,<span class="attr">name</span>: <span class="string">&#x27;赵六&#x27;</span>&#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><code>find</code>常用来查找某个元素，找到第一个符合条件的元素后便会退出循环，并返回这个元素</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// find 原理,根据下标找元素</span></span><br><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myFind</span> = <span class="keyword">function</span> (<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="comment">// 这里的this指向user数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// 判断回调函数返回的两个参数是否相等</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">callback</span>(<span class="variable language_">this</span>[i], i)) &#123;</span><br><span class="line">            <span class="comment">// 相等返回当前元素</span></span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>[i]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="title function_">myFind</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">id</span> === <span class="number">2</span>)); <span class="comment">// &#123; id: 2, name: &#x27;李四&#x27; &#125;</span></span><br></pre></td></tr></table></figure>
<p><code>findIndex</code>常用来查找某个值在数组中的下标位置，找到第一个符合条件的元素后便会退出循环，并返回这个元素所属下标</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// findIndex 原理,根据元素找下标</span></span><br><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">myFindIndex</span> = <span class="keyword">function</span> (<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="comment">// this 指向数组自己</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// 判断回调函数返回的两个参数是否相等</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">callback</span>(<span class="variable language_">this</span>[i], i)) &#123;</span><br><span class="line">            <span class="comment">// 如果相等返回当前循环到的下标</span></span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="title function_">myFindIndex</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">name</span> === <span class="string">&#x27;李四&#x27;</span>)); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<h2 id="MongoDB-简介及安装"><a href="#MongoDB-简介及安装" class="headerlink" title="MongoDB 简介及安装"></a>MongoDB 简介及安装</h2><p><a target="_blank" rel="noopener" href="https://www.runoob.com/mongodb/mongodb-tutorial.html">MongoDB 教程</a></p>
<h4 id="关系型数据库和非关系型数据库"><a href="#关系型数据库和非关系型数据库" class="headerlink" title="关系型数据库和非关系型数据库"></a>关系型数据库和非关系型数据库</h4><ul>
<li>所有的关系型数据库都需要通过 <code>SQL</code> 语句来操作</li>
<li>所有的关系数据库在操作之前都要设计表结构</li>
<li>而且数据表支持约束<ul>
<li>唯一的</li>
<li>主键</li>
<li>默认值</li>
<li>非空</li>
<li>…</li>
</ul>
</li>
<li>非关系型数据库非常灵活</li>
<li>有的非关系型数据库就是 <code>key-value</code> 键值对</li>
<li>但是 <code>MongoDB</code> 是长得最像关系型数据库的非关系型数据库<ul>
<li>数据库 -&gt; 数据库</li>
<li>数据表 -&gt; 集合（数组）</li>
<li>表记录 -&gt; 文档对象</li>
</ul>
</li>
<li><code>MongoDB</code> 不需要设计表结构</li>
<li>可以任意的往里面存数据，没有结构性这么一说</li>
</ul>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>下载包之后一直next，然后配置环境变量，将 <code>MongoDB</code> 的安装目录中的 <code>bin</code> 文件地址配置到环境变量中，然后打开命令提示符输入 <code>mongod --version</code> 敲回车看到版本号说明安装成功</p>
<h3 id="启动和关闭-MongoDB-服务"><a href="#启动和关闭-MongoDB-服务" class="headerlink" title="启动和关闭 MongoDB 服务"></a>启动和关闭 MongoDB 服务</h3><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><p>输入命令后会看到很多前面是日期的日志，这是不要关闭窗口，表示服务启动成功</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod</span><br></pre></td></tr></table></figure>
<p><code>MongoDB</code> 默认使用执行 <code>mongod</code> 的磁盘根目录下的 <code>data\db</code> 文件夹作为自己的数据存储目录，如果要更改默认的存储目录，输入如下命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --dbpath=数据存储地址</span><br></pre></td></tr></table></figure>
<h4 id="关闭"><a href="#关闭" class="headerlink" title="关闭"></a>关闭</h4><p>直接 ctrl + c，或者直接关闭窗口</p>
<h3 id="MongoDB-基本感知"><a href="#MongoDB-基本感知" class="headerlink" title="MongoDB 基本感知"></a>MongoDB 基本感知</h3><ul>
<li><p>链接数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo</span><br></pre></td></tr></table></figure></li>
<li><p>MongoDB 创建数据库</p>
</li>
</ul>
<p>如果数据不存在会自动创建，存在则切换到该数据库下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use myusers</span><br></pre></td></tr></table></figure>
<ul>
<li><p>查看所有数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show dbs</span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">local   0.000GB</span><br></pre></td></tr></table></figure>
<p>这里看不到我们新建的数据库是因为我们还没有往数据库中插入任何输入</p>
</li>
<li><p>往数据库中插入数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.myusers.insert(&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;张三&quot;</span>&#125;)</span></span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br></pre></td></tr></table></figure>
<p>此时重新查看所有数据库就可以看到我们我们新建的 myusers 数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show dbs</span></span><br><span class="line">admin    0.000GB</span><br><span class="line">config   0.000GB</span><br><span class="line">local    0.000GB</span><br><span class="line">myusers  0.000GB</span><br></pre></td></tr></table></figure></li>
<li><p>查看某个数据库中的数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.myusers.find()</span></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;606ec04705d3413a7204af25&quot;), &quot;name&quot; : &quot;张三&quot; &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>查看 test 数据库中 kittens 表中的所有数据</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">先查看当前所在的数据库</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db</span></span><br><span class="line">test</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前数据库中所有的表</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show tables</span></span><br><span class="line">catlists</span><br><span class="line">kittens</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看 kittens 表中的所有数据</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.kittens.find()</span></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;606f9ce6ab59ee533cd898bd&quot;), &quot;name&quot; : &quot;123&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;606f9ce6ab59ee533cd898be&quot;), &quot;name&quot; : &quot;波斯猫&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;606f9d0c01e3dc4e7c5342d2&quot;), &quot;name&quot; : &quot;娃娃毛&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;606f9d0c01e3dc4e7c5342d3&quot;), &quot;name&quot; : &quot;波斯猫&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;606f9d1b8310043c1ccb3c65&quot;), &quot;name&quot; : &quot;娃娃毛&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;606f9d1b8310043c1ccb3c66&quot;), &quot;name&quot; : &quot;波斯猫&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;606f9d3bd0401a412465a801&quot;), &quot;name&quot; : &quot;娃娃毛&quot;, &quot;__v&quot; : 0 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;606f9d3bd0401a412465a802&quot;), &quot;name&quot; : &quot;波斯猫&quot;, &quot;__v&quot; : 0 &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>删除某个数据库<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前所在数据库</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db</span></span><br><span class="line">myusers</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除当前数据库</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.dropDatabase()</span></span><br><span class="line">&#123; &quot;dropped&quot; : &quot;myusers&quot;, &quot;ok&quot; : 1 &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有数据库</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show dbs</span></span><br><span class="line">admin   0.000GB</span><br><span class="line">config  0.000GB</span><br><span class="line">local   0.000GB</span><br></pre></td></tr></table></figure></li>
<li>删除集合，集合相当于数据库中的表<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建集合 runoob</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.createCollection(<span class="string">&quot;runoob&quot;</span>)</span></span><br><span class="line">&#123; &quot;ok&quot; : 1 &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有集合</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show tables</span></span><br><span class="line">myusers</span><br><span class="line">runoob</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除某个集合</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.runoob.drop()</span></span><br><span class="line">true</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看某个集合</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show tables</span></span><br><span class="line">myusers</span><br></pre></td></tr></table></figure>
<h3 id="NodeJs-中链接-MongoDB"><a href="#NodeJs-中链接-MongoDB" class="headerlink" title="NodeJs 中链接 MongoDB"></a>NodeJs 中链接 MongoDB</h3></li>
</ul>
<ol>
<li>使用 MongoDB 官方的 npm 包<ol>
<li><code>npm install mongodb</code></li>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-mongodb.html">nodejs中使用MongoDB菜鸟教程</a></li>
</ol>
</li>
<li>我们使用 mongoose<ol>
<li><code>npm install mongoose</code></li>
<li><a target="_blank" rel="noopener" href="http://www.mongoosejs.net/docs/index.html">mongoose中文文档</a></li>
</ol>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 首先引入 mongoose </span></span><br><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line"><span class="comment">// 链接本地的test数据库，connect 返回一个待定状态</span></span><br><span class="line">mongoose.<span class="title function_">connect</span>(<span class="string">&#x27;mongodb://localhost/test&#x27;</span>);</span><br><span class="line"><span class="comment">// 添加链接成功和失败的提示</span></span><br><span class="line"><span class="keyword">var</span> db = mongoose.<span class="property">connection</span>;</span><br><span class="line"><span class="comment">// 失败提示</span></span><br><span class="line">db.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="variable language_">console</span>.<span class="property">error</span>.<span class="title function_">bind</span>(<span class="variable language_">console</span>, <span class="string">&#x27;数据库链接失败&#x27;</span>));</span><br><span class="line"><span class="comment">// 成功</span></span><br><span class="line">db.<span class="title function_">once</span>(<span class="string">&#x27;open&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 链接成功后会自动执行这里面的回调方法</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;数据库链接成功&#x27;</span>);</span><br><span class="line">    <span class="comment">// 设计一个模型 kittySchema，并约定里面有一个 String 类型的 name 属性</span></span><br><span class="line">    <span class="keyword">var</span> kittySchema = mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="title class_">String</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 给这个模型添加一个方法 speak</span></span><br><span class="line">    kittySchema.<span class="property">methods</span>.<span class="property">speak</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> greeting = <span class="variable language_">this</span>.<span class="property">name</span> ? <span class="string">`my name is <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span> : <span class="string">`i dont have name`</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(greeting);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将 kittySchema 变成一个 Model</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Kitten</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;Kitten&#x27;</span>, kittySchema)</span><br><span class="line">    <span class="comment">// 添加一条数据</span></span><br><span class="line">    <span class="keyword">var</span> cat = <span class="keyword">new</span> <span class="title class_">Kitten</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;大花猫&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(cat.<span class="property">name</span>); <span class="comment">// 大花猫    </span></span><br><span class="line">    <span class="comment">// 再添加一条数据</span></span><br><span class="line">    <span class="keyword">var</span> cat2 = <span class="keyword">new</span> <span class="title class_">Kitten</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;波斯猫&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    cat2.<span class="title function_">speak</span>(); <span class="comment">// my name is 波斯猫</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 持久化保存第数据</span></span><br><span class="line">    cat.<span class="title function_">save</span>(<span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;插入数据失败&#x27;</span>);</span><br><span class="line">        res.<span class="title function_">speak</span>() <span class="comment">// my name is 大花猫</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 持久化保存数到数据库</span></span><br><span class="line">    cat2.<span class="title function_">save</span>(<span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;插入输入失败&#x27;</span>);</span><br><span class="line">        res.<span class="title function_">speak</span>() <span class="comment">// my name is 波斯猫</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查看所有保存的数据</span></span><br><span class="line">    <span class="title class_">Kitten</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;查看数据失败&#x27;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data, <span class="string">&#x27;查看所有&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取指定的数据</span></span><br><span class="line">    <span class="title class_">Kitten</span>.<span class="title function_">find</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;波斯猫&#x27;</span></span><br><span class="line">    &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;查看数据失败&#x27;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="MongoDB-数据库的基本概念"><a href="#MongoDB-数据库的基本概念" class="headerlink" title="MongoDB 数据库的基本概念"></a>MongoDB 数据库的基本概念</h3><ul>
<li>可以有多个数据库</li>
<li>一个数据库中可以有多个集合（表）</li>
<li>一个集合中可以有多个文档 （表记录）</li>
<li>文档结构很灵活，没有任何限制</li>
<li>MongoDB 非常灵活，不需要想 MySQL 一样先创建数据库、表、设计表结构<ul>
<li>这里只需要：当你插入数据的时候指定往哪个数据库中的那个集合操作就可以了</li>
<li>一切都由 MongoDB 来自动完成建库建表操作</li>
</ul>
</li>
</ul>
<p>可以用一个对象来模拟这种结构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 整个对象相当于MongoDB数据库</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 客户集合</span></span><br><span class="line">    <span class="attr">customer</span>:&#123;</span><br><span class="line">        <span class="comment">// 客户集合中的位置表</span></span><br><span class="line">        <span class="attr">positions</span>:[</span><br><span class="line">            <span class="comment">// 一个集合中可以有多个文档（表记录）</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>:<span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">                <span class="attr">address</span>:<span class="string">&#x27;上海市南京步行街&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>:<span class="string">&#x27;李四&#x27;</span>,</span><br><span class="line">                <span class="attr">address</span>:<span class="string">&#x27;北京市天安门广场&#x27;</span></span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                <span class="comment">// ......</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">        <span class="comment">// 电话表</span></span><br><span class="line">        <span class="attr">phones</span>:[</span><br><span class="line">            <span class="comment">// 一个集合中可以有多个文档（表记录）</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>:<span class="string">&#x27;张三&#x27;</span>,</span><br><span class="line">                <span class="attr">phone</span>:<span class="string">&#x27;15039188888&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">name</span>:<span class="string">&#x27;李四&#x27;</span>,</span><br><span class="line">                <span class="attr">phone</span>:<span class="string">&#x27;17666688888&#x27;</span></span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                <span class="comment">// ....</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 工单集合</span></span><br><span class="line">    <span class="attr">workOrders</span>:&#123;</span><br><span class="line">        <span class="attr">wrCode</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// ......</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="设计-schema-和发布-model"><a href="#设计-schema-和发布-model" class="headerlink" title="设计 schema 和发布 model"></a>设计 schema 和发布 model</h3><p>允许使用的 SchemaTypes 有:</p>
<ul>
<li>String</li>
<li>Number</li>
<li>Date</li>
<li>Buffer</li>
<li>Boolean</li>
<li>Mixed</li>
<li>ObjectId</li>
<li>Array<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 mongoose</span></span><br><span class="line"><span class="keyword">let</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>)</span><br><span class="line"><span class="comment">// 1.引入 schema(架构)</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Schema</span> = mongoose.<span class="property">Schema</span></span><br><span class="line"><span class="comment">// 链接数据库,即使 itusers 数据库不存在也没关系，也可以直接链接，在第一个插入数据时会自动创建这个数据库</span></span><br><span class="line">mongoose.<span class="title function_">connect</span>(<span class="string">&#x27;mongoose://localhost/itusers&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.设计集合结构（表结构）</span></span><br><span class="line"><span class="comment">// 字段名称就是表结构中的属性名称</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">UserSchema</span> = <span class="keyword">new</span> <span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="comment">// 用户名称</span></span><br><span class="line">    <span class="attr">name</span>: &#123;</span><br><span class="line">        <span class="comment">// 类型为 string</span></span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">        <span class="comment">// 这个字段必填</span></span><br><span class="line">        <span class="attr">require</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">password</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">        <span class="attr">require</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">email</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">String</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 3.将文档结构发布为模型</span></span><br><span class="line"><span class="comment"> * mongoose.model 方法接收两个参数</span></span><br><span class="line"><span class="comment"> *  第一个参数为数据库的集合名称，传入大写的名词会自动转换为小写的复数集合名称</span></span><br><span class="line"><span class="comment"> *      这个例子中的 User 会被转成 users ,也就是说生成的集合名称叫做 users</span></span><br><span class="line"><span class="comment"> *  第二个参数传入一个Schema实例 ，约定了这个集合中字段名称和文档结构</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> <span class="title class_">User</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;User&#x27;</span>,<span class="title class_">UserSchema</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="mongoose-增删改查"><a href="#mongoose-增删改查" class="headerlink" title="mongoose 增删改查"></a>mongoose 增删改查</h3><h3 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h3><p>先插入一条数据,此时的数据还没有真正的保存到数据库中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 4.有了模型后就可以对数据进行增删改查操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> useUser = <span class="keyword">new</span> <span class="title class_">User</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">    <span class="attr">password</span>:<span class="string">&#x27;admin123456&#x27;</span>,</span><br><span class="line">    <span class="attr">email</span>:<span class="string">&#x27;admin@admin.com&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>将数据保存到数据库中,持久化数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">useUser.<span class="title function_">save</span>(<span class="function">(<span class="params">err,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;保存失败&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><p>查询集合中的所有数据。语法：<code>集合名称.find(callback)</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">User</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">err,data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>查询集合中符合条件的所有数据。语法：<code>集合名称.find(查询条件,callback)</code>，查询到的数将会被放进一个数组中，查不到时返回 <code>[]</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">User</span>.<span class="title function_">find</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;张三&quot;</span>&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>查询集合中符合条件的第一条数据。语法：<code>集合名称.findOne(查询条件,callback)</code>，查询到的数据直接是一个对象，查不到时返回 <code>null</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">User</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>模糊查询一个字段</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询 name 中包含 李 的数据</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">where</span>(<span class="string">&#x27;name&#x27;</span>).<span class="title function_">regex</span>(<span class="string">&#x27;李&#x27;</span>).<span class="title function_">exec</span>(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">        [</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            _id: 607013d3485b5042c482ff52,</span></span><br><span class="line"><span class="comment">            name: &#x27;李三多&#x27;,</span></span><br><span class="line"><span class="comment">            password: &#x27;123456&#x27;,</span></span><br><span class="line"><span class="comment">            email: &#x27;admin<span class="doctag">@admin</span>.com&#x27;,</span></span><br><span class="line"><span class="comment">            __v: 0</span></span><br><span class="line"><span class="comment">        &#125;,</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            _id: 607142fca68aef2a34a8b2fe,</span></span><br><span class="line"><span class="comment">            name: &#x27;李四&#x27;,</span></span><br><span class="line"><span class="comment">            password: &#x27;admin1234&#x27;,</span></span><br><span class="line"><span class="comment">            email: &#x27;admin<span class="doctag">@admin</span>.com&#x27;,</span></span><br><span class="line"><span class="comment">            __v: 0</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        ]</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">        _id: 60714fa9ea0fd14328ab64c1,</span></span><br><span class="line"><span class="comment">        name: &#x27;小李子&#x27;,</span></span><br><span class="line"><span class="comment">        password: &#x27;123456&#x27;,</span></span><br><span class="line"><span class="comment">        email: &#x27;admin<span class="doctag">@admin</span>.com&#x27;,</span></span><br><span class="line"><span class="comment">        __v: 0</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>多条件模糊查询</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询 name 中包含 李 的，或者 password 中有 123 的</span></span><br><span class="line"><span class="keyword">var</span> _filter = &#123;</span><br><span class="line">    <span class="attr">$or</span>: [ <span class="comment">// 多字段同时匹配</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">name</span>: &#123;</span><br><span class="line">                <span class="attr">$regex</span>: <span class="string">&#x27;李&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,&#123;</span><br><span class="line">            <span class="attr">password</span>: &#123;</span><br><span class="line">                <span class="attr">$regex</span>: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// limit(10) 表示查询前10条数据</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">where</span>(_filter).<span class="title function_">limit</span>(<span class="number">10</span>).<span class="title function_">exec</span>(<span class="keyword">function</span> (<span class="params">err, doc</span>) &#123; <span class="comment">// 回调</span></span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(doc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><p>删除某个集合中符合条件的所有数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下面代码会将 User 集合中的 name 是 张三的数据全部删除</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">remove</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;删除失败&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;删除成功&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>删除集合中符合条件的第一条数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除 User 集合中 name 是 张三的第一条数据</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">deleteOne</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;张三&quot;</span>&#125;,<span class="function">(<span class="params">err,data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;删除失败&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;删除成功&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>根据id删除数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据id删除元素</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">findByIdAndRemove</span>(<span class="string">&#x27;607013d3485b5042c482ff53&#x27;</span>,<span class="function">(<span class="params">err,data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;删除失败&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;删除成功&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h3><p>根据 id 修改数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> newdata = &#123;</span><br><span class="line">    <span class="attr">password</span>:<span class="string">&#x27;admin1234&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 根据id修改数据</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">findByIdAndUpdate</span>(<span class="string">&#x27;607142fca68aef2a34a8b2fe&#x27;</span>,newdata,<span class="function">(<span class="params">err,data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;修改失败&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;修改成功&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>修改符合条件的第一条数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">User</span>.<span class="title function_">updateOne</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>&#125;, newdata, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;修改失败&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;修改成功&#x27;</span>);</span><br><span class="line">    <span class="title function_">getAllUserdata</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>模糊查询数据后修改符合条件的所有数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将数据中 name 里面包含有 李 的数据全部修改为 河南彭于晏</span></span><br><span class="line"><span class="title class_">User</span>.<span class="title function_">where</span>(<span class="string">&quot;name&quot;</span>).<span class="title function_">regex</span>(<span class="string">&#x27;李&#x27;</span>).<span class="title function_">updateMany</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;河南彭于晏&quot;</span></span><br><span class="line">&#125;).<span class="title function_">exec</span>(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Nodejs-连接-MySql"><a href="#Nodejs-连接-MySql" class="headerlink" title="Nodejs 连接 MySql"></a>Nodejs 连接 MySql</h3><p><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-mysql.html">Node.js 连接 MySQL 菜鸟教程</a></p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/mysql/mysql-tutorial.html">MySQL 菜鸟教程</a></p>
<h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mysql --save</span><br></pre></td></tr></table></figure>

<h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入操作 mysql 的包</span></span><br><span class="line"><span class="keyword">var</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>);</span><br><span class="line"><span class="comment">// 创建链接</span></span><br><span class="line"><span class="keyword">var</span> connection = mysql.<span class="title function_">createConnection</span>(&#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>, <span class="comment">// 链接名称</span></span><br><span class="line">    <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>, <span class="comment">// 用户名</span></span><br><span class="line">    <span class="attr">password</span>: <span class="string">&#x27;root&#x27;</span>, <span class="comment">// 密码</span></span><br><span class="line">    <span class="attr">database</span>: <span class="string">&#x27;students&#x27;</span> <span class="comment">// 数据库名称</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 建立连接</span></span><br><span class="line">connection.<span class="title function_">connect</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行 SQL 语句的方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">query</span>(<span class="params">sql, callback</span>) &#123;</span><br><span class="line">    connection.<span class="title function_">query</span>(sql, <span class="function">(<span class="params">error, results, fields</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (error) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务器错误&#x27;</span>, error);</span><br><span class="line">        <span class="title function_">callback</span>(results, fields)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 执行结束语句，此行代码要放在最底部</span></span><br><span class="line">connection.<span class="title function_">end</span>();</span><br></pre></td></tr></table></figure>
<h3 id="添加数据-1"><a href="#添加数据-1" class="headerlink" title="添加数据"></a>添加数据</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> addSQL1 = <span class="string">&#x27;INSERT INTO users VALUES(NULL,&quot;张三&quot;,&quot;18&quot;,&quot;0&quot;,&quot;15038888888&quot;,&quot;admin@admin.com&quot;)&#x27;</span></span><br><span class="line"><span class="keyword">let</span> addSQL2 = <span class="string">&#x27;INSERT INTO users VALUES(NULL,&quot;李四&quot;,&quot;21&quot;,&quot;1&quot;,&quot;17667666666&quot;,&quot;17667666666@163.com&quot;)&#x27;</span></span><br><span class="line"><span class="title function_">query</span>(addSQL2, <span class="function">(<span class="params">data, fields</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="修改数据-1"><a href="#修改数据-1" class="headerlink" title="修改数据"></a>修改数据</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改 sql 语句，将 id 是 2 的 name 和 age 修改</span></span><br><span class="line"><span class="keyword">var</span> updateSql = <span class="string">&#x27;UPDATE users SET name = &quot;李筱思&quot;,age = 19 WHERE id = 2&#x27;</span>;</span><br><span class="line"><span class="title function_">query</span>(updateSql, <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="删除数据-1"><a href="#删除数据-1" class="headerlink" title="删除数据"></a>删除数据</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除 sql 语句,删除 id 等于 3 的数据</span></span><br><span class="line"><span class="keyword">var</span> removeSQL = <span class="string">&#x27;DELETE FROM users WHERE id = 3&#x27;</span></span><br><span class="line"><span class="title function_">query</span>(removeSQL, <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="查询数据-1"><a href="#查询数据-1" class="headerlink" title="查询数据"></a>查询数据</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询 sql 语句</span></span><br><span class="line"><span class="keyword">let</span> searchSQL = <span class="string">&#x27;SELECT * FROM users&#x27;</span></span><br><span class="line"><span class="title function_">query</span>(searchSQL, <span class="function">(<span class="params">data, fields</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="前后模糊查询"><a href="#前后模糊查询" class="headerlink" title="前后模糊查询"></a>前后模糊查询</h3><p>模糊查询 users 表中的 name 字段，只要包含 张 的就数据就会被查询出来</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sql = <span class="string">&#x27;SELECT * FROM users WHERE name LIKE &#x27;</span>%张%<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="title function_">query</span>(sql, <span class="function">(<span class="params">data, fields</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="修改表中的列名"><a href="#修改表中的列名" class="headerlink" title="修改表中的列名"></a>修改表中的列名</h3><p>语法：<code>ALTER TABLE 表名 CHANGE 旧列名 新列名 字段类型和长度</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sql = <span class="string">&#x27;ALTER TABLE users CHANGE gerder gender VARCHAR(322)&#x27;</span></span><br><span class="line"><span class="title function_">query</span>(sql, <span class="function">(<span class="params">data, fields</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="修改表中的列的长度"><a href="#修改表中的列的长度" class="headerlink" title="修改表中的列的长度"></a>修改表中的列的长度</h3><p>语法：<code>ALTER TABLE 表名 MODIFY COLUMN 列名 字段类型和要修改的长度</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sql = <span class="string">&#x27;ALTER TABLE users MODIFY COLUMN gender VARCHAR(255)&#x27;</span></span><br><span class="line"><span class="title function_">query</span>(sql, <span class="function">(<span class="params">data, fields</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="使用-Promise-解决地狱回调问题"><a href="#使用-Promise-解决地狱回调问题" class="headerlink" title="使用 Promise 解决地狱回调问题"></a>使用 Promise 解决地狱回调问题</h3><p>什么是回调地狱，回调地狱产生的原因是由于多个异步方法深入嵌套导致，致使代码结构不好理解，下面代码就是地狱回调</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 回调地狱产生原因是由于多个异步方法相互嵌套，导致代码越嵌套越深</span></span><br><span class="line"><span class="comment">// 下面这种写法就是回调地狱</span></span><br><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="comment">// readFile 方法是异步方法，</span></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./public/a.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">    <span class="comment">// 读取 a 文件完毕后再读取 b 文件 </span></span><br><span class="line">    fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./public/b.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">        <span class="comment">// 读取 b 文件完毕后再读取 c 文件 </span></span><br><span class="line">        fs.<span class="title function_">readFile</span>(<span class="string">&#x27;./public/c.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>使用 ES6 语法中的 Promise 来解决上面的这种问题</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="comment">// 封装一个读取文件的方法，返回一个 promise</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">preadFile</span>(<span class="params">filePath</span>) &#123;</span><br><span class="line">    <span class="comment">// Promise 是一个构造函数，有三中状态：padding、resolve、reject</span></span><br><span class="line">    <span class="comment">//  padding：等待状态，在返回结果前都是 padding 状态</span></span><br><span class="line">    <span class="comment">//  resolve：成功状态</span></span><br><span class="line">    <span class="comment">//  reject：失败状态</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        fs.<span class="title function_">readFile</span>(filePath, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(data)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 链式调用</span></span><br><span class="line"><span class="title function_">preadFile</span>(<span class="string">&#x27;./public/a.txt&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">        <span class="comment">// then 中返回的内容会在下一次 then 中获取到</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">preadFile</span>(<span class="string">&#x27;./public/b.txt&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">preadFile</span>(<span class="string">&#x27;./public/c.txt&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// 上面的所有 then 中，不管是哪个 then 方法，只要有错误就会进到 catch 中，并且错误信息就是发生的错误信息</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="json-server-服务器"><a href="#json-server-服务器" class="headerlink" title="json-server 服务器"></a>json-server 服务器</h3><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>安装这个插件可以仅仅写一个 json 文件就可以启动一个数据服务，非常方便，支持输入参数查询</p>
<h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g json-server</span><br></pre></td></tr></table></figure>
<p>查看版本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json-server -v</span><br></pre></td></tr></table></figure>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>首先新建 db.json 文件，并写入如下内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;posts&quot;</span>: [&#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">        <span class="string">&quot;author&quot;</span>: <span class="string">&quot;typicode&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;json-server&quot;</span>,</span><br><span class="line">        <span class="string">&quot;author&quot;</span>: <span class="string">&quot;typicode&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;json-server&quot;</span>,</span><br><span class="line">        <span class="string">&quot;author&quot;</span>: <span class="string">&quot;typicode&quot;</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&quot;comments&quot;</span>: [&#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;body&quot;</span>: <span class="string">&quot;some comment&quot;</span>,</span><br><span class="line">        <span class="string">&quot;postId&quot;</span>: <span class="number">1</span></span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&quot;profile&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;typicode&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动服务, 加上 –watch 可以实时监控 json 文件的变化，无需重复启动服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json-server --watch .\db.json</span><br></pre></td></tr></table></figure>
<p>启动成功后默认端口是 3000，浏览器输入  <a target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000/</a> 可以看到一个页面，页面中显示了所有可以请求的路径。</p>
<p>输入 <a target="_blank" rel="noopener" href="http://localhost:3000/posts">http://localhost:3000/posts</a> 可以看到 posts 数组中的所有数据</p>
<p>输入 <a target="_blank" rel="noopener" href="http://localhost:3000/posts/1">http://localhost:3000/posts/1</a> 表示只返回 id 是 1 的数据</p>
<p>输入 <a target="_blank" rel="noopener" href="http://localhost:3000/posts?title=%E6%9D%8E%E5%9B%9B">http://localhost:3000/posts?title=李四</a> 表示只返回 title 是李四的数据</p>
<h1 id="第六章"><a href="#第六章" class="headerlink" title="第六章"></a>第六章</h1><h2 id="art-template-中的-include-extend-block"><a href="#art-template-中的-include-extend-block" class="headerlink" title="art-template 中的 include-extend-block"></a>art-template 中的 include-extend-block</h2><h3 id="子模板"><a href="#子模板" class="headerlink" title="子模板"></a>子模板</h3><p>利用子模板可以重组利用相同的页面内容</p>
<p>封装模板</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- hader.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    头部公共部分</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>引入模板，使用 include 加上空格，跟上要引入的模板路径</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- layout.html --&gt;</span></span><br><span class="line">&#123;&#123;include &#x27;./header.html&#x27;&#125;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="模板继承"><a href="#模板继承" class="headerlink" title="模板继承"></a>模板继承</h3><p>模板继承可以将一整个页面引用过来，值需要填入对应的“坑”即可</p>
<p>创建模板，其中使用 block 给孩子页面留下对应的坑，孩子只需要往坑里填内容就可以在模板上展示出来</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- layout.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/node_modules/bootstrap/dist/css/bootstrap.css&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;block &#x27;head&#x27;&#125;&#125;</span><br><span class="line">    <span class="comment">&lt;!-- 让孩子页面添加孩子自己的样式 --&gt;</span></span><br><span class="line">    &#123;&#123;/block&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 复用子模板，使用 include 引入公共模板页面 --&gt;</span></span><br><span class="line">    &#123;&#123;include &#x27;./header.html&#x27;&#125;&#125;</span><br><span class="line"></span><br><span class="line">    &#123;&#123;block &#x27;content&#x27;&#125;&#125;</span><br><span class="line">    <span class="comment">&lt;!-- 这里面的内容让继承该页面的页面去填入 --&gt;</span></span><br><span class="line">    &#123;&#123;/block&#125;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 使用 include 引入公共模板页面 --&gt;</span></span><br><span class="line">    &#123;&#123;include &#x27;./bottom.html&#x27;&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/node_modules/jquery/dist/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用模板,extend 跟上空格，后面再加上模板路径，填坑的方式和留坑的方式相同，但是名称和位置要一一对应</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 继承页面 --&gt;</span></span><br><span class="line">&#123;&#123;extend &#x27;./layout.html&#x27;&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;block &#x27;head&#x27;&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">h2</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">color</span>: pink;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">&#123;&#123;/block&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 填写继承页面留下的坑 --&gt;</span></span><br><span class="line">&#123;&#123;block &#x27;content&#x27;&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">    我是主页数据</span><br><span class="line"><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">&#123;&#123;/block&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="项目搭建"><a href="#项目搭建" class="headerlink" title="项目搭建"></a>项目搭建</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">|-- 目录结构</span><br><span class="line">    |-- main.<span class="property">js</span> <span class="comment">// 入口文件</span></span><br><span class="line">    |-- package-lock.<span class="property">json</span> <span class="comment">// 项目依赖包说明文件</span></span><br><span class="line">    |-- package.<span class="property">json</span> <span class="comment">// 项目依赖包说明文件</span></span><br><span class="line">    |-- controllers</span><br><span class="line">    |-- modules <span class="comment">// 存放数据库表信息</span></span><br><span class="line">    |-- public <span class="comment">// 存放静态资源文件</span></span><br><span class="line">    |   |-- css        </span><br><span class="line">    |   |-- img      </span><br><span class="line">    |   |-- js</span><br><span class="line">    |-- routers <span class="comment">// 设置路由文件</span></span><br><span class="line">    |-- views <span class="comment">// 视图页面</span></span><br><span class="line">        |-- <span class="number">404.</span>html</span><br><span class="line">        |-- index.<span class="property">html</span></span><br><span class="line">        |-- layout.<span class="property">html</span></span><br><span class="line">        |-- login.<span class="property">html</span></span><br><span class="line">        |-- register.<span class="property">html</span></span><br><span class="line">        |-- settings</span><br><span class="line">        |   |-- admin.<span class="property">html</span></span><br><span class="line">        |   |-- profile.<span class="property">html</span></span><br><span class="line">        |-- topic</span><br><span class="line">        |   |-- edit.<span class="property">html</span></span><br><span class="line">        |   |-- <span class="keyword">new</span>.<span class="property">html</span></span><br><span class="line">        |   |-- show.<span class="property">html</span></span><br><span class="line">        |-- _layouts <span class="comment">// 页面结构目录</span></span><br><span class="line">        |   |-- home.<span class="property">html</span></span><br><span class="line">        |-- _partials <span class="comment">// 页面组件目录</span></span><br><span class="line">            |-- footer.<span class="property">html</span></span><br><span class="line">            |-- header.<span class="property">html</span></span><br><span class="line">            |-- settings-nav.<span class="property">html</span></span><br></pre></td></tr></table></figure>

<h2 id="路由设计"><a href="#路由设计" class="headerlink" title="路由设计"></a>路由设计</h2><table>
<thead>
<tr>
<th>接口地址</th>
<th>请求方式</th>
<th>请求参数</th>
<th>是否需要登录</th>
<th>接口描述</th>
</tr>
</thead>
<tbody><tr>
<td>/</td>
<td>get</td>
<td></td>
<td></td>
<td>渲染首页页面</td>
</tr>
<tr>
<td>/homelist</td>
<td>post</td>
<td></td>
<td></td>
<td>获取首页列表数据</td>
</tr>
<tr>
<td>/register</td>
<td>get</td>
<td></td>
<td></td>
<td>渲染注册页面</td>
</tr>
<tr>
<td>/register</td>
<td>post</td>
<td>email、password、nickname</td>
<td></td>
<td>处理注册请求</td>
</tr>
<tr>
<td>/login</td>
<td>get</td>
<td></td>
<td></td>
<td>渲染登录页面</td>
</tr>
<tr>
<td>/login</td>
<td>post</td>
<td>email、password</td>
<td></td>
<td>处理登录数据</td>
</tr>
</tbody></table>
<h2 id="设计表结构-用户表"><a href="#设计表结构-用户表" class="headerlink" title="设计表结构-用户表"></a>设计表结构-用户表</h2><table>
<thead>
<tr>
<th>字段名称</th>
<th>字段类型</th>
<th>是否必填</th>
<th>默认值</th>
<th>可选值</th>
<th>字段描述</th>
</tr>
</thead>
<tbody><tr>
<td>email</td>
<td><em>String</em></td>
<td>true</td>
<td></td>
<td></td>
<td>用户名</td>
</tr>
<tr>
<td>nickname</td>
<td><em>String</em></td>
<td>true</td>
<td></td>
<td></td>
<td>昵称</td>
</tr>
<tr>
<td>password</td>
<td><em>String</em></td>
<td>true</td>
<td></td>
<td></td>
<td>密码</td>
</tr>
<tr>
<td>created_time</td>
<td><em>Date</em></td>
<td>false</td>
<td><em>Date</em>.now</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>last_modified_time</td>
<td><em>Date</em></td>
<td>false</td>
<td><em>Date</em>.now</td>
<td></td>
<td>最后修改时间</td>
</tr>
<tr>
<td>avatar</td>
<td><em>String</em></td>
<td>false</td>
<td>avatar-max-img.png</td>
<td></td>
<td>用户头像</td>
</tr>
<tr>
<td>bio</td>
<td><em>String</em></td>
<td>false</td>
<td></td>
<td></td>
<td>个人简介</td>
</tr>
<tr>
<td>gender</td>
<td><em>Number</em></td>
<td>false</td>
<td>-1</td>
<td>[-1, 0, 1]</td>
<td>性别</td>
</tr>
<tr>
<td>birthday</td>
<td><em>Date</em></td>
<td>false</td>
<td></td>
<td></td>
<td>生日</td>
</tr>
<tr>
<td>status</td>
<td><em>Number</em></td>
<td>false</td>
<td>0</td>
<td>[0, 1, 2]</td>
<td>用户状态</td>
</tr>
</tbody></table>
<h2 id="处理注册逻辑"><a href="#处理注册逻辑" class="headerlink" title="处理注册逻辑"></a>处理注册逻辑</h2><ul>
<li>首先判断用户输入的邮箱或者昵称是否在数据中已经存在<ul>
<li>如果存在则提示该昵称或者邮箱已经存在，请修改后重试</li>
<li>如果不存在进行注册处理</li>
</ul>
</li>
<li>使用 md5 加密对用户输入的密码进行加密处理，为了尽可能保证数据安装，使用双层加密</li>
<li>定义后台返回的错误状态码<ul>
<li>如果是服务器出错，返回 500 状态</li>
<li>如果接口调用成功则接口状态为200，但是要返回不同的错误码来判断逻辑业务<ul>
<li>业务处理失败 code = 1111</li>
<li>业务处理成功 code = 0000</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="mongodb-或者查询语句"><a href="#mongodb-或者查询语句" class="headerlink" title="mongodb 或者查询语句"></a>mongodb 或者查询语句</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;db.<span class="property">col</span>.<span class="title function_">find</span>(</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="attr">$or</span>: [</span><br><span class="line">         &#123;<span class="attr">key1</span>: value1&#125;, &#123;<span class="attr">key2</span>:value2&#125;</span><br><span class="line">      ]</span><br><span class="line">   &#125;</span><br><span class="line">).<span class="title function_">pretty</span>()</span><br></pre></td></tr></table></figure>

<h3 id="express-直接返回-json-格式的数据"><a href="#express-直接返回-json-格式的数据" class="headerlink" title="express 直接返回 json 格式的数据"></a>express 直接返回 json 格式的数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(err)</span><br></pre></td></tr></table></figure>

<h3 id="md5-加密数据"><a href="#md5-加密数据" class="headerlink" title="md5 加密数据"></a>md5 加密数据</h3><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install md5-node</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> md5 = <span class="built_in">require</span>(<span class="string">&#x27;md5-node&#x27;</span>)</span><br><span class="line"><span class="title function_">md5</span>(<span class="string">&#x27;123456&#x27;</span>) <span class="comment">// =&gt; e10adc3949ba59abbe56e057f20f883e</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 双层加密</span></span><br><span class="line"><span class="title function_">md5</span>(<span class="title function_">md5</span>(<span class="string">&#x27;123456&#x27;</span>)) <span class="comment">// =&gt; 14e1b600b1fd579f47433b88e8d85291</span></span><br></pre></td></tr></table></figure>
<h3 id="封装一个记录错误日志的方法"><a href="#封装一个记录错误日志的方法" class="headerlink" title="封装一个记录错误日志的方法"></a>封装一个记录错误日志的方法</h3><p>此方法接受一个错误信息，可以将这个错误信息和发生错误的时间记录到一个 txt 文件中，方便查看程序的错误信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> logPath = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;../controllers/errlog.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dateFormat</span>(<span class="params">date, format = <span class="string">&quot;YYYY-MM-DD HH:mm:ss&quot;</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> config = &#123;</span><br><span class="line">        <span class="attr">YYYY</span>: date.<span class="title function_">getFullYear</span>(),</span><br><span class="line">        <span class="attr">MM</span>: date.<span class="title function_">getMonth</span>() + <span class="number">1</span> &lt; <span class="number">10</span> ?</span><br><span class="line">            <span class="string">`0<span class="subst">$&#123;date.getMonth() + <span class="number">1</span>&#125;</span>`</span> : date.<span class="title function_">getMonth</span>() + <span class="number">1</span>,</span><br><span class="line">        <span class="attr">DD</span>: date.<span class="title function_">getDate</span>(),</span><br><span class="line">        <span class="attr">HH</span>: date.<span class="title function_">getHours</span>(),</span><br><span class="line">        <span class="attr">mm</span>: date.<span class="title function_">getMinutes</span>(),</span><br><span class="line">        <span class="attr">ss</span>: date.<span class="title function_">getSeconds</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> config) &#123;</span><br><span class="line">        format = format.<span class="title function_">replace</span>(key, config[key]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> format;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">readlog</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        fs.<span class="title function_">readFile</span>(logPath, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">resolve</span>(data)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">writelog</span>(<span class="params">log</span>) &#123;</span><br><span class="line">    <span class="title function_">readlog</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> content = res + <span class="title function_">dateFormat</span>(<span class="keyword">new</span> <span class="title class_">Date</span>()) + <span class="string">&#x27;\n&#x27;</span> + log + <span class="string">&#x27;\n\n&#x27;</span></span><br><span class="line">        fs.<span class="title function_">writeFile</span>(logPath, content, <span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;日志写入失败&#x27;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;发生错误，已将错误日志记录&#x27;</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = writelog</span><br></pre></td></tr></table></figure>

<h3 id="注册完整示例"><a href="#注册完整示例" class="headerlink" title="注册完整示例"></a>注册完整示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理注册逻辑</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/register&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 1.处理post请求发送过来的数据</span></span><br><span class="line">    <span class="comment">// 2.操作数据库</span></span><br><span class="line">    <span class="comment">// 3.发送响应</span></span><br><span class="line">    <span class="comment">//      判断当前注册信息是否存在，判断邮箱和昵称是否重复</span></span><br><span class="line">    <span class="keyword">let</span> body = req.<span class="property">body</span>    </span><br><span class="line">    <span class="comment">// 查询昵称或者邮箱是否重复</span></span><br><span class="line">    <span class="title class_">User</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">        <span class="attr">$or</span>: [&#123;</span><br><span class="line">            <span class="attr">nickname</span>: body.<span class="property">nickname</span></span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            <span class="attr">email</span>: body.<span class="property">email</span></span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 如果服务器发生错误返回500</span></span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="title function_">writelog</span>(err) <span class="comment">// 记录错误日志</span></span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(err)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果能查询到数据表示用户已经存在</span></span><br><span class="line">        <span class="keyword">if</span> (data) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">                <span class="attr">code</span>: <span class="number">1111</span>,</span><br><span class="line">                <span class="attr">message</span>: <span class="string">&#x27;该昵称或者邮箱已经存在，请修改后重试&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果不报错也没有查询到用户表示已经可以注册</span></span><br><span class="line">        <span class="comment">// 首先要对用户密码进行加密处理,使用双层加密</span></span><br><span class="line">        body.<span class="property">password</span> = <span class="title function_">md5</span>(<span class="title function_">md5</span>(body.<span class="property">password</span>))</span><br><span class="line">        <span class="comment">// 保存用户数据</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">User</span>(body).<span class="title function_">save</span>(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="title function_">writelog</span>(err) <span class="comment">// 记录错误日志</span></span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(err)</span><br><span class="line">            &#125;</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">                <span class="attr">code</span>: <span class="number">0000</span>,</span><br><span class="line">                <span class="attr">message</span>: <span class="string">&#x27;注册成功&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="利用-async-和-await-优化代码结构"><a href="#利用-async-和-await-优化代码结构" class="headerlink" title="利用 async 和 await 优化代码结构"></a>利用 async 和 await 优化代码结构</h2><p>async 和 await 是 promise 的语法糖，处理异步请求非常简单，下面是优化后的代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理注册逻辑</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/register&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 1.处理post请求发送过来的数据</span></span><br><span class="line">    <span class="comment">// 2.操作数据库</span></span><br><span class="line">    <span class="comment">// 3.发送响应</span></span><br><span class="line">    <span class="comment">//      判断当前注册信息是否存在，判断邮箱和昵称是否重复</span></span><br><span class="line">    <span class="keyword">let</span> body = req.<span class="property">body</span></span><br><span class="line">    <span class="comment">// 升级版的写法</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 先查询邮箱是否已经存在</span></span><br><span class="line">        <span class="keyword">let</span> email = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">            <span class="attr">email</span>: body.<span class="property">email</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">if</span> (email) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">                <span class="attr">code</span>: <span class="number">1111</span>,</span><br><span class="line">                <span class="attr">message</span>: <span class="string">&#x27;该邮箱已被注册&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询昵称是否存在</span></span><br><span class="line">        <span class="keyword">let</span> nickname = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">findOne</span>(&#123;</span><br><span class="line">            <span class="attr">nickname</span>: body.<span class="property">nickname</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">if</span> (nickname) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">                <span class="attr">code</span>: <span class="number">1111</span>,</span><br><span class="line">                <span class="attr">message</span>: <span class="string">&#x27;该昵称已被注册&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 加密密码并保存数据</span></span><br><span class="line">        body.<span class="property">password</span> = <span class="title function_">md5</span>(<span class="title function_">md5</span>(body.<span class="property">password</span>))</span><br><span class="line">        <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">User</span>(body).<span class="title function_">save</span>()</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">json</span>(&#123;</span><br><span class="line">            <span class="attr">code</span>: <span class="number">0000</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;注册成功&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="title function_">writelog</span>(err) <span class="comment">// 记录错误日志</span></span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="表单同步提交和异步提交"><a href="#表单同步提交和异步提交" class="headerlink" title="表单同步提交和异步提交"></a>表单同步提交和异步提交</h2><ul>
<li>同步提交页面会锁死，并且服务器返回的数据会渲染在页面上，返回上一页时上次填写的表单数据会被清空</li>
<li>异步提交时表单返回的数据不会渲染在页面上，并且提交时不会锁死页面，还可以做其他事情</li>
</ul>
<h2 id="客户端的重定向针对于异步请求无效"><a href="#客户端的重定向针对于异步请求无效" class="headerlink" title="客户端的重定向针对于异步请求无效"></a>客户端的重定向针对于异步请求无效</h2><p>当客户端是异步请求时，服务端进行重定向操作后，浏览器也会进行异步重定向，从而不会让页面发生跳转</p>
<h2 id="通过-session-保存登录状态"><a href="#通过-session-保存登录状态" class="headerlink" title="通过 session 保存登录状态"></a>通过 session 保存登录状态</h2><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express-session</span><br></pre></td></tr></table></figure>
<p>配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>) <span class="comment">// 使用 express 的 session</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置 session,要放在 app.use(router) 之前</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;  </span><br><span class="line">    <span class="comment">// 自定义的加密字符串，会在原有的加密基础上加上这个字符串加密</span></span><br><span class="line">    <span class="comment">// 可以防止客户端伪造 session ，增加安装性</span></span><br><span class="line">    <span class="attr">secret</span>: <span class="string">&#x27;keyboard cat&#x27;</span>,</span><br><span class="line">    <span class="attr">resave</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// 无论是否使用了session 都会实现默认保存一个密钥</span></span><br><span class="line">    <span class="attr">saveUninitialized</span>: <span class="literal">true</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 写入session</span></span><br><span class="line">req.<span class="property">session</span>.<span class="property">foo</span> = <span class="string">&#x27;boo&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取session</span></span><br><span class="line">req.<span class="property">session</span>.<span class="property">foo</span></span><br></pre></td></tr></table></figure>
<h2 id="中间件概念"><a href="#中间件概念" class="headerlink" title="中间件概念"></a>中间件概念</h2><p>客户端请求服务端的数据，服务端返回数据之前会对数据进行一系列的处理，每个处理过程我们称之为中间件</p>
<p>express 中添加中间件的方法，app.use</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="comment">// 设置中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;无论哪个请求进来都会进入这个中间件&#x27;</span>);</span><br><span class="line">    <span class="comment">// 如果不添加 next 则不会继续往下执行</span></span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.<span class="title function_">readFile</span>(<span class="string">&#x27;.a/.b&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="comment">// 当 next 加上了参数是会进到接受四个参数的中间件，其他的中间件不会进来</span></span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">next</span>(err)</span><br><span class="line">        &#125;</span><br><span class="line">        res.<span class="title function_">send</span>(data)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;aa&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理错误的中间件,必须接受四个参数</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;running 127.0.0.1:3000&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="在项目中添加处理404的中间件"><a href="#在项目中添加处理404的中间件" class="headerlink" title="在项目中添加处理404的中间件"></a>在项目中添加处理404的中间件</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置路由文件</span></span><br><span class="line">app.<span class="title function_">use</span>(router)</span><br><span class="line">app.<span class="title function_">use</span>(router2)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置 404 中间件,当访问的页面不再上面的路由中，则会继续往下匹配，此时会就会匹配到 app.use 这个中间件</span></span><br><span class="line"><span class="comment">// 此时可以做 404 处理</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&#x27;404.html&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="在项目中添加错误统一处理中间件"><a href="#在项目中添加错误统一处理中间件" class="headerlink" title="在项目中添加错误统一处理中间件"></a>在项目中添加错误统一处理中间件</h2><ul>
<li>注意：只有 next(err) 方法携带了错误参数并且中间件接受四个参数才会进入到错误处理的中间件中</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发生错误时，执行next方法，进入到下一个中间件中，并且携带错误参数，会进入到接受四个参数的中间件中</span></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">next</span>(err)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置处理错误的中间件,只有后台发生错误就会进来这里面</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">writelog</span>(err) <span class="comment">// 记录错误日志</span></span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">SZX</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://songzx0106.github.io/NodeJs/nodeCourse/">https://songzx0106.github.io/NodeJs/nodeCourse/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://SongZX0106.github.io" target="_blank">SZX的开发笔记</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/NodeJs/">NodeJs</a></div><div class="post_share"><div class="social-share" data-image="/images/ys02.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/share.min.css" media="print" onload="this.media='all'"><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/images/wechat.png" target="_blank"><img class="post-qr-code-img" data-lazy-src="/images/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/images/alipay.jpg" target="_blank"><img class="post-qr-code-img" data-lazy-src="/images/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/Hexo/HexoNode/"><img class="prev-cover" data-lazy-src="/images/ys12.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Hexo提示框</div></div></a></div><div class="next-post pull-right"><a href="/Tool/Tool1/"><img class="next-cover" data-lazy-src="/images/ys15.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">常用的前端方法封装（一）</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/NodeJs/koa2-mock/" title="koa2+mock实现一个数据服务器"><img class="cover" data-lazy-src="/images/ys08.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-12</div><div class="title">koa2+mock实现一个数据服务器</div></div></a></div><div><a href="/NodeJs/node爬虫/" title="从零学习node爬虫"><img class="cover" data-lazy-src="/images/ys19.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-24</div><div class="title">从零学习node爬虫</div></div></a></div><div><a href="/NodeJs/weChatServer/" title="使用NodeJs作为微信公众号后台服务器"><img class="cover" data-lazy-src="/images/ys05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-19</div><div class="title">使用NodeJs作为微信公众号后台服务器</div></div></a></div><div><a href="/NodeJs/nvm/" title="nvm管理node.js版本"><img class="cover" data-lazy-src="/images/ys20.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-15</div><div class="title">nvm管理node.js版本</div></div></a></div><div><a href="/NodeJs/pnpm/" title="pnpm - 速度快、节省磁盘空间的软件包管理器"><img class="cover" data-lazy-src="/images/ys05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-15</div><div class="title">pnpm - 速度快、节省磁盘空间的软件包管理器</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="/images/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">SZX</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">115</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">33</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://gitee.com/szxio"><i class="iconfont icon-gitee-fill-round"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">welcome to my blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0"><span class="toc-number">1.</span> <span class="toc-text">第一章</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#node%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.</span> <span class="toc-text">node是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E8%87%AA%E5%B7%B1%E7%94%B5%E8%84%91%E6%98%AF%E5%90%A6%E5%AE%89%E8%A3%85%E4%BA%86node"><span class="toc-number">1.2.</span> <span class="toc-text">检查自己电脑是否安装了node</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#node%E5%AD%A6%E4%B9%A0%E7%BD%91%E5%9D%80"><span class="toc-number">1.3.</span> <span class="toc-text">node学习网址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-node-js-%E6%89%A7%E8%A1%8C-js-%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.</span> <span class="toc-text">使用 node.js 执行 js 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-nodejs-%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="toc-number">1.5.</span> <span class="toc-text">使用 nodejs 读取文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-nodejs-%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6"><span class="toc-number">1.6.</span> <span class="toc-text">使用 nodejs 写入文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-nodejs-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84-http-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.7.</span> <span class="toc-text">使用 nodejs 创建一个简单的 http 服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#http%E6%9C%8D%E5%8A%A1%E7%9A%84%E7%AE%80%E5%86%99%E5%BD%A2%E5%BC%8F"><span class="toc-number">1.8.</span> <span class="toc-text">http服务的简写形式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nodejs-%E4%B8%AD%E7%9A%84%E6%A8%A1%E5%9D%97%E7%9A%84%E5%AF%BC%E5%85%A5%E5%92%8C%E5%AF%BC%E5%87%BA"><span class="toc-number">1.9.</span> <span class="toc-text">nodejs 中的模块的导入和导出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exports-%E5%92%8C-module-exports-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.10.</span> <span class="toc-text">exports 和 module.exports 的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ip%E5%9C%B0%E5%9D%80%E5%92%8C%E7%AB%AF%E5%8F%A3%E5%8F%B7%E6%A6%82%E5%BF%B5"><span class="toc-number">1.11.</span> <span class="toc-text">ip地址和端口号概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E5%BC%8F%E6%95%B0%E6%8D%AE%E7%9A%84content-type"><span class="toc-number">1.12.</span> <span class="toc-text">响应式数据的content-type</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#http-fs-%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93"><span class="toc-number">1.13.</span> <span class="toc-text">http + fs 实现简单的页面渲染</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#path-%E8%B7%AF%E5%BE%84%E6%93%8D%E4%BD%9C%E6%A8%A1%E5%9D%97"><span class="toc-number">1.14.</span> <span class="toc-text">path 路径操作模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#path-basename-%E8%8E%B7%E5%8F%96%E8%B7%AF%E5%BE%84%E4%B8%AD%E7%9A%84%E6%96%87%E4%BB%B6%E5%90%8D"><span class="toc-number">1.14.1.</span> <span class="toc-text">path.basename() 获取路径中的文件名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#path-dirname-%E8%8E%B7%E5%8F%96%E8%B7%AF%E5%BE%84%E4%B8%AD%E7%9A%84%E7%9B%AE%E5%BD%95%E5%90%8D"><span class="toc-number">1.14.2.</span> <span class="toc-text">path.dirname() 获取路径中的目录名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#path-extname-%E8%BF%94%E5%9B%9E-path-%E7%9A%84%E6%89%A9%E5%B1%95%E5%90%8D"><span class="toc-number">1.14.3.</span> <span class="toc-text">path.extname() 返回 path 的扩展名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#path-parse-%E8%A7%A3%E6%9E%90%E5%9C%B0%E5%9D%80"><span class="toc-number">1.14.4.</span> <span class="toc-text">path.parse() 解析地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#path-format-%E6%A0%B9%E6%8D%AE%E5%AF%B9%E8%B1%A1%E8%BF%98%E5%8E%9F%E5%9C%B0%E5%9D%80"><span class="toc-number">1.14.5.</span> <span class="toc-text">path.format() 根据对象还原地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#path-join-%E6%8B%BC%E6%8E%A5%E8%B7%AF%E5%BE%84"><span class="toc-number">1.14.6.</span> <span class="toc-text">path.join() 拼接路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#path-isAbsolute-%E6%A3%80%E6%B5%8B%E8%B7%AF%E5%BE%84%E6%98%AF%E5%90%A6%E4%B8%BA%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84"><span class="toc-number">1.14.7.</span> <span class="toc-text">path.isAbsolute() 检测路径是否为绝对路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%96%87%E4%BB%B6%E6%89%80%E5%A4%84%E7%9B%AE%E5%BD%95%E7%9A%84%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84%E5%B9%B6%E6%8B%BC%E6%8E%A5%E5%9C%B0%E5%9D%80"><span class="toc-number">1.14.8.</span> <span class="toc-text">获取当前文件所处目录的绝对路径并拼接地址</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#node-%E4%B8%AD%E7%9A%84%E5%85%B6%E4%BB%96%E6%88%90%E5%91%98"><span class="toc-number">1.15.</span> <span class="toc-text">node 中的其他成员</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0"><span class="toc-number">2.</span> <span class="toc-text">第二章</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%AD%E6%97%A0%E5%88%86%E5%8F%B7%E9%97%AE%E9%A2%98"><span class="toc-number">2.1.</span> <span class="toc-text">代码中无分号问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E8%B7%AF%E5%BE%84%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="toc-number">2.2.</span> <span class="toc-text">根据路径获取文件内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E6%9F%90%E4%B8%AA%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B%E7%9A%84%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6"><span class="toc-number">2.3.</span> <span class="toc-text">读取某个文件夹下的所有文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8-node-%E4%B8%AD%E4%BD%BF%E7%94%A8%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">2.4.</span> <span class="toc-text">在 node 中使用模板引擎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.5.</span> <span class="toc-text">服务端渲染和客户端渲染的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E7%BD%91%E7%AB%99%E4%B8%AD%E7%9A%84%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-number">2.6.</span> <span class="toc-text">处理网站中的静态资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E8%AF%84%E8%AE%BA%E5%88%97%E8%A1%A8"><span class="toc-number">2.7.</span> <span class="toc-text">渲染评论列表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%A1%A8%E5%8D%95%E9%BB%98%E8%AE%A4%E6%8F%90%E4%BA%A4%E5%92%8C-h5-%E8%87%AA%E5%B8%A6%E6%A0%A1%E9%AA%8C"><span class="toc-number">2.8.</span> <span class="toc-text">使用表单默认提交和 h5 自带校验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-url-%E6%A8%A1%E5%9D%97%E8%A7%A3%E6%9E%90%E8%B7%AF%E5%BE%84%E5%9C%B0%E5%9D%80"><span class="toc-number">2.9.</span> <span class="toc-text">使用 url 模块解析路径地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E6%B5%8F%E8%A7%88%E5%99%A8%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">2.10.</span> <span class="toc-text">使浏览器重定向</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0"><span class="toc-number">3.</span> <span class="toc-text">第三章</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#require-%E5%8A%A0%E8%BD%BD%E8%A7%84%E5%88%99"><span class="toc-number">3.1.</span> <span class="toc-text">require 加载规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#require-%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6"><span class="toc-number">3.2.</span> <span class="toc-text">require 加载机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8A%A0%E8%BD%BD%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.1.</span> <span class="toc-text">1.加载本地文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8A%A0%E8%BD%BD%E7%B3%BB%E7%BB%9F%E6%A8%A1%E5%9D%97"><span class="toc-number">3.2.2.</span> <span class="toc-text">2.加载系统模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%8A%A0%E8%BD%BD%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.加载第三方模块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%85%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="toc-number">3.3.</span> <span class="toc-text">包文件说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#npm-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.4.</span> <span class="toc-text">npm 常用命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#npm-%E9%85%8D%E7%BD%AE%E6%B7%98%E5%AE%9D%E9%95%9C%E5%83%8F"><span class="toc-number">3.5.</span> <span class="toc-text">npm 配置淘宝镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8-express"><span class="toc-number">3.6.</span> <span class="toc-text">安装和使用 express</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0"><span class="toc-number">4.</span> <span class="toc-text">第四章</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#express-%E4%BD%BF%E7%94%A8"><span class="toc-number">4.1.</span> <span class="toc-text">express 使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-nodemon-%E5%AE%8C%E6%88%90%E6%9B%B4%E6%96%B0%E4%BB%A3%E7%A0%81%E5%90%8E%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.2.</span> <span class="toc-text">使用 nodemon 完成更新代码后自动重启服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#express-%E4%B8%AD%E7%9A%84%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"><span class="toc-number">4.3.</span> <span class="toc-text">express 中的静态文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#express-%E4%B8%AD%E4%BD%BF%E7%94%A8-art-template-%E6%B8%B2%E6%9F%93%E5%BC%95%E6%93%8E"><span class="toc-number">4.4.</span> <span class="toc-text">express 中使用 art-template 渲染引擎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#express-%E8%A7%A3%E6%9E%90%E8%A1%A8%E5%8D%95%E7%9A%84-post-%E6%8F%90%E4%BA%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">4.5.</span> <span class="toc-text">express 解析表单的 post 提交数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86%E6%96%87%E4%BB%B6%E7%9B%B4%E6%8E%A5%E6%8C%89%E7%85%A7-utf8-%E6%A0%BC%E5%BC%8F%E8%AF%BB%E5%8F%96"><span class="toc-number">4.6.</span> <span class="toc-text">将文件直接按照 utf8 格式读取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E5%90%88-express-%E9%85%8D%E7%BD%AE-router-%E6%A8%A1%E5%9D%97"><span class="toc-number">4.7.</span> <span class="toc-text">结合 express 配置 router 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E8%8E%B7%E5%8F%96%E5%BC%82%E6%AD%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">4.8.</span> <span class="toc-text">使用回调函数获取异步数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0"><span class="toc-number">5.</span> <span class="toc-text">第五章</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E5%8E%9F%E7%94%9F%E7%9A%84-get-%E8%AF%B7%E6%B1%82"><span class="toc-number">5.1.</span> <span class="toc-text">封装原生的 get 请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#package-lock-json-%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">5.2.</span> <span class="toc-text">package-lock.json 文件的作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#find-%E5%92%8C-findIndex-%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">5.3.</span> <span class="toc-text">find 和 findIndex 的原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB-%E7%AE%80%E4%BB%8B%E5%8F%8A%E5%AE%89%E8%A3%85"><span class="toc-number">5.4.</span> <span class="toc-text">MongoDB 简介及安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E9%9D%9E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.4.0.1.</span> <span class="toc-text">关系型数据库和非关系型数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">5.4.0.2.</span> <span class="toc-text">安装</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%92%8C%E5%85%B3%E9%97%AD-MongoDB-%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.4.1.</span> <span class="toc-text">启动和关闭 MongoDB 服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8"><span class="toc-number">5.4.1.1.</span> <span class="toc-text">启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%97%AD"><span class="toc-number">5.4.1.2.</span> <span class="toc-text">关闭</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB-%E5%9F%BA%E6%9C%AC%E6%84%9F%E7%9F%A5"><span class="toc-number">5.4.2.</span> <span class="toc-text">MongoDB 基本感知</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NodeJs-%E4%B8%AD%E9%93%BE%E6%8E%A5-MongoDB"><span class="toc-number">5.4.3.</span> <span class="toc-text">NodeJs 中链接 MongoDB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">5.4.4.</span> <span class="toc-text">MongoDB 数据库的基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1-schema-%E5%92%8C%E5%8F%91%E5%B8%83-model"><span class="toc-number">5.4.5.</span> <span class="toc-text">设计 schema 和发布 model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mongoose-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-number">5.4.6.</span> <span class="toc-text">mongoose 增删改查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE"><span class="toc-number">5.4.7.</span> <span class="toc-text">添加数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE"><span class="toc-number">5.4.8.</span> <span class="toc-text">查询数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">5.4.9.</span> <span class="toc-text">删除数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE"><span class="toc-number">5.4.10.</span> <span class="toc-text">修改数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nodejs-%E8%BF%9E%E6%8E%A5-MySql"><span class="toc-number">5.4.11.</span> <span class="toc-text">Nodejs 连接 MySql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="toc-number">5.4.12.</span> <span class="toc-text">安装依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.4.13.</span> <span class="toc-text">连接数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE-1"><span class="toc-number">5.4.14.</span> <span class="toc-text">添加数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE-1"><span class="toc-number">5.4.15.</span> <span class="toc-text">修改数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE-1"><span class="toc-number">5.4.16.</span> <span class="toc-text">删除数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE-1"><span class="toc-number">5.4.17.</span> <span class="toc-text">查询数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.4.18.</span> <span class="toc-text">前后模糊查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8%E4%B8%AD%E7%9A%84%E5%88%97%E5%90%8D"><span class="toc-number">5.4.19.</span> <span class="toc-text">修改表中的列名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8%E4%B8%AD%E7%9A%84%E5%88%97%E7%9A%84%E9%95%BF%E5%BA%A6"><span class="toc-number">5.4.20.</span> <span class="toc-text">修改表中的列的长度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Promise-%E8%A7%A3%E5%86%B3%E5%9C%B0%E7%8B%B1%E5%9B%9E%E8%B0%83%E9%97%AE%E9%A2%98"><span class="toc-number">5.4.21.</span> <span class="toc-text">使用 Promise 解决地狱回调问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#json-server-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">5.4.22.</span> <span class="toc-text">json-server 服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">5.4.23.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-number">5.4.24.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">5.4.25.</span> <span class="toc-text">使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0"><span class="toc-number">6.</span> <span class="toc-text">第六章</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#art-template-%E4%B8%AD%E7%9A%84-include-extend-block"><span class="toc-number">6.1.</span> <span class="toc-text">art-template 中的 include-extend-block</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%A8%A1%E6%9D%BF"><span class="toc-number">6.1.1.</span> <span class="toc-text">子模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E7%BB%A7%E6%89%BF"><span class="toc-number">6.1.2.</span> <span class="toc-text">模板继承</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-number">6.2.</span> <span class="toc-text">项目搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%AE%BE%E8%AE%A1"><span class="toc-number">6.3.</span> <span class="toc-text">路由设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%A1%A8%E7%BB%93%E6%9E%84-%E7%94%A8%E6%88%B7%E8%A1%A8"><span class="toc-number">6.4.</span> <span class="toc-text">设计表结构-用户表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E6%B3%A8%E5%86%8C%E9%80%BB%E8%BE%91"><span class="toc-number">6.5.</span> <span class="toc-text">处理注册逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mongodb-%E6%88%96%E8%80%85%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5"><span class="toc-number">6.5.1.</span> <span class="toc-text">mongodb 或者查询语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#express-%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E-json-%E6%A0%BC%E5%BC%8F%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">6.5.2.</span> <span class="toc-text">express 直接返回 json 格式的数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#md5-%E5%8A%A0%E5%AF%86%E6%95%B0%E6%8D%AE"><span class="toc-number">6.5.3.</span> <span class="toc-text">md5 加密数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E4%B8%80%E4%B8%AA%E8%AE%B0%E5%BD%95%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">6.5.4.</span> <span class="toc-text">封装一个记录错误日志的方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E5%AE%8C%E6%95%B4%E7%A4%BA%E4%BE%8B"><span class="toc-number">6.5.5.</span> <span class="toc-text">注册完整示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-async-%E5%92%8C-await-%E4%BC%98%E5%8C%96%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84"><span class="toc-number">6.6.</span> <span class="toc-text">利用 async 和 await 优化代码结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E5%90%8C%E6%AD%A5%E6%8F%90%E4%BA%A4%E5%92%8C%E5%BC%82%E6%AD%A5%E6%8F%90%E4%BA%A4"><span class="toc-number">6.7.</span> <span class="toc-text">表单同步提交和异步提交</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E9%87%8D%E5%AE%9A%E5%90%91%E9%92%88%E5%AF%B9%E4%BA%8E%E5%BC%82%E6%AD%A5%E8%AF%B7%E6%B1%82%E6%97%A0%E6%95%88"><span class="toc-number">6.8.</span> <span class="toc-text">客户端的重定向针对于异步请求无效</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-session-%E4%BF%9D%E5%AD%98%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81"><span class="toc-number">6.9.</span> <span class="toc-text">通过 session 保存登录状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%A6%82%E5%BF%B5"><span class="toc-number">6.10.</span> <span class="toc-text">中间件概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%A4%84%E7%90%86404%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">6.11.</span> <span class="toc-text">在项目中添加处理404的中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%B7%BB%E5%8A%A0%E9%94%99%E8%AF%AF%E7%BB%9F%E4%B8%80%E5%A4%84%E7%90%86%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">6.12.</span> <span class="toc-text">在项目中添加错误统一处理中间件</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Vue/20230404/" title="vue3项目快速开发模板"><img data-lazy-src="/images/ys10.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="vue3项目快速开发模板"/></a><div class="content"><a class="title" href="/Vue/20230404/" title="vue3项目快速开发模板">vue3项目快速开发模板</a><time datetime="2023-04-04T07:57:48.000Z" title="发表于 2023-04-04 15:57:48">2023-04-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/JavaScript/2023313112102/" title="空值合并运算符(??) 和逻辑或运算符(||) 对比"><img data-lazy-src="/images/ys03.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="空值合并运算符(??) 和逻辑或运算符(||) 对比"/></a><div class="content"><a class="title" href="/JavaScript/2023313112102/" title="空值合并运算符(??) 和逻辑或运算符(||) 对比">空值合并运算符(??) 和逻辑或运算符(||) 对比</a><time datetime="2023-03-13T03:31:49.000Z" title="发表于 2023-03-13 11:31:49">2023-03-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Java/project/20230304/" title="谷粒学院项目笔记"><img data-lazy-src="/images/ys17.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谷粒学院项目笔记"/></a><div class="content"><a class="title" href="/Java/project/20230304/" title="谷粒学院项目笔记">谷粒学院项目笔记</a><time datetime="2023-03-04T14:43:29.000Z" title="发表于 2023-03-04 22:43:29">2023-03-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/NodeJs/pnpm/" title="pnpm - 速度快、节省磁盘空间的软件包管理器"><img data-lazy-src="/images/ys05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="pnpm - 速度快、节省磁盘空间的软件包管理器"/></a><div class="content"><a class="title" href="/NodeJs/pnpm/" title="pnpm - 速度快、节省磁盘空间的软件包管理器">pnpm - 速度快、节省磁盘空间的软件包管理器</a><time datetime="2023-02-15T02:22:33.000Z" title="发表于 2023-02-15 10:22:33">2023-02-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/NodeJs/nvm/" title="nvm管理node.js版本"><img data-lazy-src="/images/ys20.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="nvm管理node.js版本"/></a><div class="content"><a class="title" href="/NodeJs/nvm/" title="nvm管理node.js版本">nvm管理node.js版本</a><time datetime="2023-02-15T02:08:29.000Z" title="发表于 2023-02-15 10:08:29">2023-02-15</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/images/ys02.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By SZX</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">少年辛苦终身事，莫向光阴惰寸功。<a target="_blank" rel="noopener" href="https://gitee.com/szxio">My Gitee</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/instantpage.min.js" type="module"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'iJzt0X9OdhFCcdn4N0dJ86fY-gzGzoHsz',
      appKey: '8vtaRafgQSvU5ntYgszJfRW5',
      placeholder: '留下你的精彩评论',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/canvas-fluttering-ribbon.min.js"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/click-show-text.min.js" data-mobile="true" data-text="富强,民主,文明,和谐,自由,平等,公正,法制,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>