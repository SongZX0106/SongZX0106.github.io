<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Webpack5入门到原理 | SZX的开发笔记</title><meta name="keywords" content="webpack"><meta name="author" content="SZX"><meta name="copyright" content="SZX"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="尚硅谷Webpack5新版视频教程 B站直达：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV14T4y1z7sw 百度网盘：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;114lJRGua2uHBdLq_iVLOOQ 提取码：yyds 阿里云盘：https:&#x2F;&#x2F;www.aliyundrive.com&#x2F;s&#x2F;UMkmCzdWsGh（教程配套资料请从百度网盘下载） 围观尚硅谷前端">
<meta property="og:type" content="article">
<meta property="og:title" content="Webpack5入门到原理">
<meta property="og:url" content="https://songzx0106.github.io/webpack/webpack5/index.html">
<meta property="og:site_name" content="SZX的开发笔记">
<meta property="og:description" content="尚硅谷Webpack5新版视频教程 B站直达：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV14T4y1z7sw 百度网盘：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;114lJRGua2uHBdLq_iVLOOQ 提取码：yyds 阿里云盘：https:&#x2F;&#x2F;www.aliyundrive.com&#x2F;s&#x2F;UMkmCzdWsGh（教程配套资料请从百度网盘下载） 围观尚硅谷前端">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://songzx0106.github.io/images/ys05.jpg">
<meta property="article:published_time" content="2023-09-03T07:39:10.000Z">
<meta property="article:modified_time" content="2024-11-22T06:14:31.230Z">
<meta property="article:author" content="SZX">
<meta property="article:tag" content="webpack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://songzx0106.github.io/images/ys05.jpg"><link rel="shortcut icon" href="/images/favicon.png"><link rel="canonical" href="https://songzx0106.github.io/webpack/webpack5/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":5000,"languages":{"author":"作者: SZX","link":"链接: ","source":"来源: SZX的开发笔记","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/jquery.min.js',
    justifiedGallery: {
      js: 'https://fastly.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://fastly.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://fastly.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-11-22 14:14:31'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2467717_jlvw8717b8.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/images/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">153</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/ys05.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">SZX的开发笔记</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Webpack5入门到原理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-09-03T07:39:10.000Z" title="发表于 2023-09-03 15:39:10">2023-09-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-22T06:14:31.230Z" title="更新于 2024-11-22 14:14:31">2024-11-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">20.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>89分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Webpack5入门到原理"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>尚硅谷Webpack5新版视频教程</p>
<p>B站直达：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV14T4y1z7sw">https://www.bilibili.com/video/BV14T4y1z7sw</a></p>
<p>百度网盘：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/114lJRGua2uHBdLq_iVLOOQ">https://pan.baidu.com/s/114lJRGua2uHBdLq_iVLOOQ</a> 提取码：yyds</p>
<p>阿里云盘：<a target="_blank" rel="noopener" href="https://www.aliyundrive.com/s/UMkmCzdWsGh%EF%BC%88%E6%95%99%E7%A8%8B%E9%85%8D%E5%A5%97%E8%B5%84%E6%96%99%E8%AF%B7%E4%BB%8E%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E4%B8%8B%E8%BD%BD%EF%BC%89">https://www.aliyundrive.com/s/UMkmCzdWsGh（教程配套资料请从百度网盘下载）</a></p>
<p>围观尚硅谷前端课程：<a target="_blank" rel="noopener" href="http://www.atguigu.com/web">http://www.atguigu.com/web</a></p>
<p>更多尚硅谷视频教程请访问：<a target="_blank" rel="noopener" href="http://www.atguigu.com/download.shtml">http://www.atguigu.com/download.shtml</a></p>
<p>在线课程地址：<a target="_blank" rel="noopener" href="https://yk2012.github.io/sgg_webpack5/">https://yk2012.github.io/sgg_webpack5/</a></p>
<p>Webpack5中文文档：<a target="_blank" rel="noopener" href="https://webpack.docschina.org/loaders/">Loaders | webpack 中文文档 (docschina.org)</a></p>
</blockquote>
<h2 id="1-简单使用"><a href="#1-简单使用" class="headerlink" title="1. 简单使用"></a>1. 简单使用</h2><h3 id="1-1-搭建项目"><a href="#1-1-搭建项目" class="headerlink" title="1.1 搭建项目"></a>1.1 搭建项目</h3><p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230821224325473.png" alt="image-20230821224325473"></p>
<h3 id="1-2-编写JS代码"><a href="#1-2-编写JS代码" class="headerlink" title="1.2 编写JS代码"></a>1.2 编写JS代码</h3><p>count.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">count</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sum.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">...args</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> args.reduce(<span class="function">(<span class="params">a,b</span>)=&gt;</span>a+b,<span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./js/count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(count(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>))</span><br></pre></td></tr></table></figure>

<p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./src/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-运行代码"><a href="#1-3-运行代码" class="headerlink" title="1.3 运行代码"></a>1.3 运行代码</h3><p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230821224516038.png" alt="image-20230821224516038"></p>
<p>可以发现浏览器报错。默认不支持ES module语法</p>
<h3 id="1-4-初始化依赖"><a href="#1-4-初始化依赖" class="headerlink" title="1.4 初始化依赖"></a>1.4 初始化依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure>

<p>会自动生成 <strong><code>package.json</code></strong></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230821224645037.png" alt="image-20230821224645037"></p>
<p>继续安装依赖</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack webpack-cli -D</span><br></pre></td></tr></table></figure>

<h3 id="1-5-启动webpack"><a href="#1-5-启动webpack" class="headerlink" title="1.5 启动webpack"></a>1.5 启动webpack</h3><p>开发环境构建</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack ./src/main.js --mode=development</span><br></pre></td></tr></table></figure>

<p>生产环境构建</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack ./src/main.js --mode=production</span><br></pre></td></tr></table></figure>

<p>修改 main.js 文件的引用地址。浏览器正常打印</p>
<h2 id="2-基本配置"><a href="#2-基本配置" class="headerlink" title="2. 基本配置"></a>2. 基本配置</h2><h3 id="2-1-5大核心概念"><a href="#2-1-5大核心概念" class="headerlink" title="2.1 5大核心概念"></a>2.1 5大核心概念</h3><ol>
<li>entry（入口）</li>
</ol>
<p>指示 Webpack 从哪个文件开始打包</p>
<ol>
<li>output（输出）</li>
</ol>
<p>指示 Webpack 打包完的文件输出到哪里去，如何命名等</p>
<ol>
<li>loader（加载器）</li>
</ol>
<p>webpack 本身只能处理 js、json 等资源，其他资源需要借助 loader，Webpack 才能解析</p>
<ol>
<li>plugins（插件）</li>
</ol>
<p>扩展 Webpack 的功能</p>
<ol>
<li>mode（模式）</li>
</ol>
<p>主要由两种模式：</p>
<ul>
<li>开发模式：development</li>
<li>生产模式：production</li>
</ul>
<h3 id="2-2-基础配置文件"><a href="#2-2-基础配置文件" class="headerlink" title="2.2 基础配置文件"></a>2.2 基础配置文件</h3><p>在项目根目录新建文件 <code>webpack.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 入口文件，相对路径</span></span><br><span class="line">    entry: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">// 要输出到的位置，绝对路径</span></span><br><span class="line">        path: path.resolve(__dirname,<span class="string">&quot;dist&quot;</span>),</span><br><span class="line">        <span class="comment">// 文件名</span></span><br><span class="line">        filename: <span class="string">&quot;main.js&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 加载器</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            <span class="comment">// loader 的配置</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 插件</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// plugins的配置</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 模式</span></span><br><span class="line">    mode: <span class="string">&quot;development&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有了这个配置文件，我们再进行打包时只需输入如下命令即可</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure>

<p>这个命令会自动找根目录中的 webpa.config.js 文件中的配置进行打包</p>
<h2 id="3-处理样式资源"><a href="#3-处理样式资源" class="headerlink" title="3. 处理样式资源"></a>3. 处理样式资源</h2><h3 id="3-1-处理CSS资源"><a href="#3-1-处理CSS资源" class="headerlink" title="3.1 处理CSS资源"></a>3.1 处理CSS资源</h3><p>webpack默认只支持JS文件，我们编写CSS后打包会出错，我们可以通过添加loader来处理CSS资源</p>
<p>更多loader可以通过<a target="_blank" rel="noopener" href="https://webpack.docschina.org/loaders/">webpack官方文档</a>来查看</p>
<p>当我们在 main.js 中引入 css 文件后，执行打包会出现下面的错误</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230823223056375.png" alt="image-20230823223056375"></p>
<p>安装 loader</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i css-loader style-loader -D</span><br></pre></td></tr></table></figure>

<p>然后配置规则</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>此时再次执行打包即可</p>
<h3 id="3-2-处理Less资源"><a href="#3-2-处理Less资源" class="headerlink" title="3.2 处理Less资源"></a>3.2 处理Less资源</h3><p>安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install less less-loader --save-dev</span><br></pre></td></tr></table></figure>

<p>配置规则</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.less$/i</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="comment">// compiles Less to CSS</span></span><br><span class="line">          <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;less-loader&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-处理Scss资源"><a href="#3-3-处理Scss资源" class="headerlink" title="3.3 处理Scss资源"></a>3.3 处理Scss资源</h3><p>安装</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install sass-loader sass --save-dev</span><br></pre></td></tr></table></figure>

<p>配置规则</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.s[ac]ss$/i</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="comment">// 将 JS 字符串生成为 style 节点</span></span><br><span class="line">          <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">          <span class="comment">// 将 CSS 转化成 CommonJS 模块</span></span><br><span class="line">          <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">          <span class="comment">// 将 Sass 编译成 CSS</span></span><br><span class="line">          <span class="string">&#x27;sass-loader&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="4-处理图片资源"><a href="#4-处理图片资源" class="headerlink" title="4. 处理图片资源"></a>4. 处理图片资源</h2><h3 id="4-1-图片转Base64"><a href="#4-1-图片转Base64" class="headerlink" title="4.1 图片转Base64"></a>4.1 图片转Base64</h3><p>我们可以通过配置，将小于一定大小的文件转成base64处理，从而减少请求</p>
<p>添加以下配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">          test: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">          type: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">          parser: &#123;</span><br><span class="line">              dataUrlCondition: &#123;</span><br><span class="line">                  maxSize: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>转成base64后请求不会耗时间</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230824214034674.png" alt="image-20230824214034674"></p>
<h2 id="5-修改文件输出地址"><a href="#5-修改文件输出地址" class="headerlink" title="5. 修改文件输出地址"></a>5. 修改文件输出地址</h2><p>目前我们打包生成的文件都在一个文件下</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230824214711536.png" alt="image-20230824214711536"></p>
<p>我想让他变成 JS 文件在 JS 文件下，图片文件在图片文件下</p>
<p>修改配置如下</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&quot;path&quot;);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    // 入口文件，相对路径</span><br><span class="line">    entry: &quot;./src/main.js&quot;,</span><br><span class="line">    // 输出</span><br><span class="line">    output: &#123;</span><br><span class="line">        // 要输出到的位置，绝对路径</span><br><span class="line">        path: path.resolve(__dirname,&quot;dist&quot;),</span><br><span class="line">        // 文件名</span><br><span class="line"><span class="addition">+       filename: &quot;js/main.js&quot;,</span></span><br><span class="line">    &#125;,</span><br><span class="line">    // 加载器</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.(png|jpe?g|gif|webp)$/,</span><br><span class="line">                type: &quot;asset&quot;,</span><br><span class="line">                parser: &#123;</span><br><span class="line">                    dataUrlCondition: &#123;</span><br><span class="line">                        maxSize: 18 * 1024 // 小于10kb的图片会被base64处理</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line"><span class="addition">+               generator: &#123;</span></span><br><span class="line"><span class="addition">+                   // 修改图片文件的输出地址</span></span><br><span class="line"><span class="addition">+                   // hash:10 只取10位哈希值</span></span><br><span class="line"><span class="addition">+                   // ext图片后缀名</span></span><br><span class="line"><span class="addition">+                   // query 图片文件后面携带的参数</span></span><br><span class="line"><span class="addition">+                   filename: &#x27;images/[hash:10][ext][query]&#x27;</span></span><br><span class="line"><span class="addition">+               &#125;</span></span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    // 插件</span><br><span class="line">    plugins: [</span><br><span class="line">        // plugins的配置</span><br><span class="line">    ],</span><br><span class="line">    // 模式</span><br><span class="line">    mode: &quot;development&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>再次打包看效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230824220006600.png" alt="image-20230824220006600"></p>
<h2 id="6-自动清空上次打包文件"><a href="#6-自动清空上次打包文件" class="headerlink" title="6. 自动清空上次打包文件"></a>6. 自动清空上次打包文件</h2><p>在 output 下新增 clean 属性即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 入口文件，相对路径</span></span><br><span class="line">    entry: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">// 要输出到的位置，绝对路径</span></span><br><span class="line">        path: path.resolve(__dirname,<span class="string">&quot;dist&quot;</span>),</span><br><span class="line">        <span class="comment">// 文件名</span></span><br><span class="line">        filename: <span class="string">&quot;js/main.js&quot;</span>,</span><br><span class="line">        <span class="comment">// 每次打包前自动清空path对应的目录文件</span></span><br><span class="line">        clean: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-处理字体图标资源"><a href="#7-处理字体图标资源" class="headerlink" title="7. 处理字体图标资源"></a>7. 处理字体图标资源</h2><p>我们可以在 <a target="_blank" rel="noopener" href="https://www.iconfont.cn/?spm=a313x.collections_index.i3.d4d0a486a.313f3a81ethswd">阿里巴巴矢量图标库</a> 中找一些图标资源，然后加入到项目中，点击下载到本地</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230824222354716.png" alt="image-20230824222354716"></p>
<p>使用第二种方式引入</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230824222420993.png" alt="image-20230824222420993"></p>
<p>在项目中导入下载下来的 css 和图标文件</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230824222512888.png" alt="image-20230824222512888"></p>
<p>在 main.js 中引入 iconfont.css</p>
<p>然后配置规则，将字体图标打包输出到 font 文件夹中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">                type: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">                generator: &#123;</span><br><span class="line">                    filename: <span class="string">&#x27;font/[hash:10][ext][query]&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再页面中可以通过下面的方式使用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-aixin&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 30px;color: orangered&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-bianji&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-dianzan&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-dingwei&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230824222755309.png" alt="image-20230824222755309"></p>
<h2 id="8-处理其他资源"><a href="#8-处理其他资源" class="headerlink" title="8. 处理其他资源"></a>8. 处理其他资源</h2><p>其他资源我们直接在下面的规则中添加对应的文件后缀即可，webpack 会原封不动的将文件输出到指定目录</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(ttf|woff2?|mp3|mp4|word)$/</span>,</span><br><span class="line">                type: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">                generator: &#123;</span><br><span class="line">                    filename: <span class="string">&#x27;font/[hash:10][ext][query]&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-处理JS文件"><a href="#9-处理JS文件" class="headerlink" title="9. 处理JS文件"></a>9. 处理JS文件</h2><h3 id="9-1-Eslint-插件"><a href="#9-1-Eslint-插件" class="headerlink" title="9.1 Eslint 插件"></a>9.1 Eslint 插件</h3><p>可组装的 JavaScript 和 JSX 检查工具。</p>
<p>这句话意思就是：它是用来检测 js 和 jsx 语法的工具，可以配置各项功能</p>
<p>我们使用 Eslint，关键是写 Eslint 配置文件，里面写上各种 rules 规则，将来运行 Eslint 时就会以写的规则对代码进行检查</p>
<h4 id="配置文件的写法"><a href="#配置文件的写法" class="headerlink" title="配置文件的写法"></a>配置文件的写法</h4><p>配置文件有很多种写法：</p>
<ul>
<li><p>.eslintrc.*</p>
<p>：新建文件，位于项目根目录</p>
<ul>
<li><code>.eslintrc</code></li>
<li><code>.eslintrc.js</code></li>
<li><code>.eslintrc.json</code></li>
<li>区别在于配置格式不一样</li>
</ul>
</li>
<li><p><code>package.json</code> 中 <code>eslintConfig</code>：不需要创建文件，在原有文件基础上写</p>
</li>
</ul>
<p>ESLint 会查找和自动读取它们，所以以上配置文件只需要存在一个即可</p>
<h4 id="具体配置"><a href="#具体配置" class="headerlink" title="具体配置"></a>具体配置</h4><p>以 <code>.eslintrc.js</code> 为例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// 解析选项</span></span><br><span class="line">  parserOptions: &#123;&#125;,</span><br><span class="line">  <span class="comment">// 具体检查规则</span></span><br><span class="line">  rules: &#123;&#125;,</span><br><span class="line">  <span class="comment">// 继承其他规则</span></span><br><span class="line">  <span class="keyword">extends</span>: [],</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// 其他规则详见：https://eslint.bootcss.com/docs/user-guide/configuring</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>parserOptions 解析选项</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">parserOptions: &#123;</span><br><span class="line">  ecmaVersion: <span class="number">6</span>, <span class="comment">// ES 语法版本</span></span><br><span class="line">  sourceType: <span class="string">&quot;module&quot;</span>, <span class="comment">// ES 模块化</span></span><br><span class="line">  ecmaFeatures: &#123; <span class="comment">// ES 其他特性</span></span><br><span class="line">    jsx: <span class="literal">true</span> <span class="comment">// 如果是 React 项目，就需要开启 jsx 语法</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>rules 具体规则</p>
<ul>
<li><code>&quot;off&quot;</code> 或 <code>0</code> - 关闭规则</li>
<li><code>&quot;warn&quot;</code> 或 <code>1</code> - 开启规则，使用警告级别的错误：<code>warn</code> (不会导致程序退出)</li>
<li><code>&quot;error&quot;</code> 或 <code>2</code> - 开启规则，使用错误级别的错误：<code>error</code> (当被触发的时候，程序会退出)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">rules: &#123;</span><br><span class="line">  semi: <span class="string">&quot;error&quot;</span>, <span class="comment">// 禁止使用分号</span></span><br><span class="line">  <span class="string">&#x27;array-callback-return&#x27;</span>: <span class="string">&#x27;warn&#x27;</span>, <span class="comment">// 强制数组方法的回调函数中有 return 语句，否则警告</span></span><br><span class="line">  <span class="string">&#x27;default-case&#x27;</span>: [</span><br><span class="line">    <span class="string">&#x27;warn&#x27;</span>, <span class="comment">// 要求 switch 语句中有 default 分支，否则警告</span></span><br><span class="line">    &#123; <span class="attr">commentPattern</span>: <span class="string">&#x27;^no default$&#x27;</span> &#125; <span class="comment">// 允许在最后注释 no default, 就不会有警告了</span></span><br><span class="line">  ],</span><br><span class="line">  eqeqeq: [</span><br><span class="line">    <span class="string">&#x27;warn&#x27;</span>, <span class="comment">// 强制使用 === 和 !==，否则警告</span></span><br><span class="line">    <span class="string">&#x27;smart&#x27;</span> <span class="comment">// https://eslint.bootcss.com/docs/rules/eqeqeq#smart 除了少数情况下不会有警告</span></span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更多规则详见：<a target="_blank" rel="noopener" href="https://eslint.bootcss.com/docs/rules/">规则文档</a></p>
<p>extends 继承</p>
<p>开发中一点点写 rules 规则太费劲了，所以有更好的办法，继承现有的规则。</p>
<p>现有以下较为有名的规则：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://eslint.bootcss.com/docs/rules/">Eslint 官方的规则open in new window</a>：<code>eslint:recommended</code></li>
<li><a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-plugin-eslint">Vue Cli 官方的规则open in new window</a>：<code>plugin:vue/essential</code></li>
<li><a target="_blank" rel="noopener" href="https://github.com/facebook/create-react-app/tree/main/packages/eslint-config-react-app">React Cli 官方的规则open in new window</a>：<code>react-app</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="keyword">extends</span>: [<span class="string">&quot;eslint:recommended&quot;</span>],</span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="comment">// 我们的规则会覆盖掉react-app的规则</span></span><br><span class="line">    <span class="comment">// 所以想要修改规则直接改就是了</span></span><br><span class="line">    eqeqeq: [<span class="string">&quot;warn&quot;</span>, <span class="string">&quot;smart&quot;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="Esline在Webpack中的使用"><a href="#Esline在Webpack中的使用" class="headerlink" title="Esline在Webpack中的使用"></a>Esline在Webpack中的使用</h4><p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install eslint-webpack-plugin eslint --save-dev</span><br></pre></td></tr></table></figure>

<p>然后把插件添加到你的 webpack 配置。例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ESLintPlugin = <span class="built_in">require</span>(<span class="string">&#x27;eslint-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  plugins: [</span><br><span class="line">  		<span class="keyword">new</span> ESLintPlugin(&#123;</span><br><span class="line">            <span class="comment">// 指定文件的根目录</span></span><br><span class="line">            context:path.resolve(__dirname, <span class="string">&quot;src&quot;</span>),</span><br><span class="line">        &#125;)</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在根目录新建 <code>.eslintrc.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 继承 Eslint 规则</span></span><br><span class="line">    <span class="keyword">extends</span>: [<span class="string">&quot;eslint:recommended&quot;</span>],</span><br><span class="line">    env: &#123;</span><br><span class="line">        node: <span class="literal">true</span>, <span class="comment">// 启用node中全局变量</span></span><br><span class="line">        browser: <span class="literal">true</span>, <span class="comment">// 启用浏览器中全局变量</span></span><br><span class="line">    &#125;,</span><br><span class="line">    parserOptions: &#123;</span><br><span class="line">        ecmaVersion: <span class="number">6</span>,</span><br><span class="line">        sourceType: <span class="string">&quot;module&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    rules: &#123;</span><br><span class="line">        <span class="string">&quot;no-var&quot;</span>: <span class="number">2</span>, <span class="comment">// 不能使用 var 定义变量</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>我们编写一个错误的代码</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230824231332115.png" alt="image-20230824231332115"></p>
<p>在打包时会提示错误，并终止打包</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230824231322801.png" alt="image-20230824231322801"></p>
<p>在 webstorm 中可以开启 eslint 检测</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230824231406983.png" alt="image-20230824231406983"></p>
<p>这样在编写代码时就可以发现错误</p>
<h4 id="添加eslint忽略文件"><a href="#添加eslint忽略文件" class="headerlink" title="添加eslint忽略文件"></a>添加eslint忽略文件</h4><p>新建 <code>.eslintignore</code> 文件</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 忽略dist目录下所有文件</span><br><span class="line">dist</span><br></pre></td></tr></table></figure>

<h3 id="9-2-Babel-插件"><a href="#9-2-Babel-插件" class="headerlink" title="9.2 Babel 插件"></a>9.2 Babel 插件</h3><p>JavaScript 编译器。</p>
<p>主要用于将 ES6 语法编写的代码转换为向后兼容的 JavaScript 语法，以便能够运行在当前和旧版本的浏览器或其他环境中</p>
<h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><p>配置文件由很多种写法：</p>
<ul>
<li><p>```<br>babel.config.*</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  ：新建文件，位于项目根目录</span><br><span class="line"></span><br><span class="line">    - &#96;babel.config.js&#96;</span><br><span class="line">    - &#96;babel.config.json&#96;</span><br><span class="line"></span><br><span class="line">- &#96;&#96;&#96;</span><br><span class="line">  .babelrc.*</span><br></pre></td></tr></table></figure>

<p>：新建文件，位于项目根目录</p>
<ul>
<li><code>.babelrc</code></li>
<li><code>.babelrc.js</code></li>
<li><code>.babelrc.json</code></li>
</ul>
</li>
<li><p><code>package.json</code> 中 <code>babel</code>：不需要创建文件，在原有文件基础上写</p>
</li>
</ul>
<p>Babel 会查找和自动读取它们，所以以上配置文件只需要存在一个即可</p>
<h4 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h4><p>我们以 <code>babel.config.js</code> 配置文件为例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// 预设</span></span><br><span class="line">  presets: [<span class="string">&quot;@babel/preset-env&quot;</span>],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>presets 预设</p>
<p>简单理解：就是一组 Babel 插件, 扩展 Babel 功能</p>
<ul>
<li><code>@babel/preset-env</code>: 一个智能预设，允许您使用最新的 JavaScript。</li>
<li><code>@babel/preset-react</code>：一个用来编译 React jsx 语法的预设</li>
<li><code>@babel/preset-typescript</code>：一个用来编译 TypeScript 语法的预设</li>
</ul>
<h4 id="在webpack中使用"><a href="#在webpack中使用" class="headerlink" title="在webpack中使用"></a>在webpack中使用</h4><p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -D babel-loader @babel/core @babel/preset-env</span><br></pre></td></tr></table></figure>

<p>用法一：</p>
<p>在 webpack 配置对象中，需要将 babel-loader 添加到 module 列表中，就像下面这样</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.m?js$/</span>,</span><br><span class="line">      exclude: <span class="regexp">/(node_modules|bower_components)/</span>, <span class="comment">// 排除文件</span></span><br><span class="line">      use: &#123;</span><br><span class="line">        loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          presets: [<span class="string">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用法二(推荐用法)：</p>
<p>在项目根目录新建 <code>babel.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    presets: [<span class="string">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在 webpack 配置对象中添加</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.m?js$/</span>,</span><br><span class="line">      exclude: <span class="regexp">/(node_modules|bower_components)/</span>, <span class="comment">// 排除文件</span></span><br><span class="line">      use: &#123;</span><br><span class="line">        loader: <span class="string">&#x27;babel-loader&#x27;</span>,       </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打包前生成的文件代码</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230826093200339.png" alt="image-20230826093200339"></p>
<p>打包后的文件代码</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230826093532713.png" alt="image-20230826093532713"></p>
<h4 id="修改输出的结果不以箭头输出"><a href="#修改输出的结果不以箭头输出" class="headerlink" title="修改输出的结果不以箭头输出"></a>修改输出的结果不以箭头输出</h4><p>在 output 中 添加 environment 配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出</span></span><br><span class="line">output: &#123;</span><br><span class="line">    <span class="comment">// 要输出到的位置，绝对路径</span></span><br><span class="line">    path: path.resolve(__dirname,<span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="comment">// 文件名</span></span><br><span class="line">    filename: <span class="string">&quot;js/main.js&quot;</span>,</span><br><span class="line">    <span class="comment">// 每次打包前自动清空path对应的目录文件</span></span><br><span class="line">    clean: <span class="literal">true</span>,</span><br><span class="line">    </span><br><span class="line">    environment: &#123;</span><br><span class="line">        <span class="comment">// 关闭箭头函数输出</span></span><br><span class="line">        arrowFunction: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="10-处理HTML文件"><a href="#10-处理HTML文件" class="headerlink" title="10. 处理HTML文件"></a>10. 处理HTML文件</h2><p>我们希望每次打包后可以为我们自动的引入JS，通过如下方式设置</p>
<p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev html-webpack-plugin</span><br></pre></td></tr></table></figure>

<p>引入和使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">      <span class="comment">// 处理HTML文件</span></span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">          template: path.resolve(__dirname, <span class="string">&quot;index.html&quot;</span>), <span class="comment">// 使用的模板地址</span></span><br><span class="line">          title: <span class="string">&quot;学习Webpack&quot;</span>, <span class="comment">// 网站title</span></span><br><span class="line">          hash:<span class="literal">true</span>, <span class="comment">// 添加哈希值</span></span><br><span class="line">      &#125;)</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>设置了 title 后需要在模板中修改 title 的设置方式，需要动态获取</p>
<p><code>&lt;title&gt;&lt;%= htmlWebpackPlugin.options.title %&gt;&lt;/title&gt;</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&lt;%= htmlWebpackPlugin.options.title %&gt;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-aixin&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 30px;color: orangered&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-bianji&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-dianzan&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-dingwei&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;desc&quot;</span>&gt;</span>哈哈<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>更多 options 配置查看文档：<a target="_blank" rel="noopener" href="https://github.com/jantimon/html-webpack-plugin#options">https://github.com/jantimon/html-webpack-plugin#options</a></p>
<p>打包后生成的文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>学习Webpack<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">defer</span> <span class="attr">src</span>=<span class="string">&quot;js/main.js?15bb642196d30b484393&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-aixin&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 30px;color: orangered&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-bianji&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-dianzan&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;iconfont icon-dingwei&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;desc&quot;</span>&gt;</span>哈哈<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="11-搭建开发服务器"><a href="#11-搭建开发服务器" class="headerlink" title="11. 搭建开发服务器"></a>11. 搭建开发服务器</h2><p>我们次每次修改完代码后都需要重新打包，然后运行html文件才能看到效果，我们可以通过搭建开发服务器，可以实时的查看改动</p>
<p>安装</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack-dev-server -D</span><br></pre></td></tr></table></figure>

<p>添加配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开发服务器</span></span><br><span class="line">devServer: &#123;</span><br><span class="line">    host: <span class="string">&quot;localhost&quot;</span>, <span class="comment">// 启动服务器域名</span></span><br><span class="line">    port: <span class="string">&quot;3000&quot;</span>, <span class="comment">// 启动服务器端口号</span></span><br><span class="line">    open: <span class="literal">true</span>, <span class="comment">// 是否自动打开浏览器</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>然后通过如下命令启动</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack serve</span><br></pre></td></tr></table></figure>

<p>启动成功后光标会停留在下面，同时自动打开浏览器，我们修改代码后刷新浏览器会自动生效</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230826110943453.png" alt="image-20230826110943453"></p>
<h2 id="12-生产环境准备工作"><a href="#12-生产环境准备工作" class="headerlink" title="12. 生产环境准备工作"></a>12. 生产环境准备工作</h2><p>根目录新建 config 文件，将原来的 webpck.config.js 放在 config 文件中，并复制一份配置</p>
<p>修改两个配置文件名分别为</p>
<ul>
<li>webpack.dev.js</li>
<li>webpack.prod.js</li>
</ul>
<p>然后再所有的相对路径前添加 <code>../</code> 往外跳一层</p>
<p>删除 dev 配置文件中的 output 配置，因为dev环境不需要打包，删除 prod 配置中的 devServer 配置</p>
<p>设置好的配置文件分别如下</p>
<ul>
<li>webpack.dev.js</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> ESLintPlugin = <span class="built_in">require</span>(<span class="string">&#x27;eslint-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 入口文件，相对路径</span></span><br><span class="line">    entry: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">    <span class="comment">// 加载器</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">                use: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/i</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="comment">// compiles Less to CSS</span></span><br><span class="line">                    <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;less-loader&#x27;</span>,</span><br><span class="line">                ],</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.s[ac]ss$/i</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="comment">// 将 JS 字符串生成为 style 节点</span></span><br><span class="line">                    <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">                    <span class="comment">// 将 CSS 转化成 CommonJS 模块</span></span><br><span class="line">                    <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">                    <span class="comment">// 将 Sass 编译成 CSS</span></span><br><span class="line">                    <span class="string">&#x27;sass-loader&#x27;</span>,</span><br><span class="line">                ],</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">                type: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">                parser: &#123;</span><br><span class="line">                    dataUrlCondition: &#123;</span><br><span class="line">                        maxSize: <span class="number">18</span> * <span class="number">1024</span> <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                generator: &#123;</span><br><span class="line">                    <span class="comment">// 修改图片文件的输出地址</span></span><br><span class="line">                    <span class="comment">// hash:10 只取10位哈希值</span></span><br><span class="line">                    <span class="comment">// ext图片后缀名</span></span><br><span class="line">                    <span class="comment">// query 图片文件后面携带的参数</span></span><br><span class="line">                    filename: <span class="string">&#x27;images/[hash:10][ext][query]&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(ttf|woff2?|mp3|mp4|word)$/</span>,</span><br><span class="line">                type: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">                generator: &#123;</span><br><span class="line">                    filename: <span class="string">&#x27;font/[hash:10][ext][query]&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.m?js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/(node_modules|bower_components)/</span>, <span class="comment">// 排除文件</span></span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 插件</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// Eslint插件</span></span><br><span class="line">        <span class="keyword">new</span> ESLintPlugin(&#123;</span><br><span class="line">            <span class="comment">// 指定文件的根目录</span></span><br><span class="line">            context:path.resolve(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 处理HTML文件</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: path.resolve(__dirname, <span class="string">&quot;../index.html&quot;</span>), <span class="comment">// 使用的模板地址</span></span><br><span class="line">            title: <span class="string">&quot;学习Webpack&quot;</span>, <span class="comment">// 网站title</span></span><br><span class="line">            hash:<span class="literal">true</span>, <span class="comment">// 添加哈希值</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 模式</span></span><br><span class="line">    mode: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">    <span class="comment">// 开发服务器</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        host: <span class="string">&quot;localhost&quot;</span>, <span class="comment">// 启动服务器域名</span></span><br><span class="line">        port: <span class="string">&quot;3000&quot;</span>, <span class="comment">// 启动服务器端口号</span></span><br><span class="line">        open: <span class="literal">true</span>, <span class="comment">// 是否自动打开浏览器</span></span><br><span class="line">        liveReload:<span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>webpack.build.js</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> ESLintPlugin = <span class="built_in">require</span>(<span class="string">&#x27;eslint-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 入口文件，相对路径</span></span><br><span class="line">    entry: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">// 要输出到的位置，绝对路径</span></span><br><span class="line">        path: path.resolve(__dirname,<span class="string">&quot;../dist&quot;</span>),</span><br><span class="line">        <span class="comment">// 文件名</span></span><br><span class="line">        filename: <span class="string">&quot;js/main.js&quot;</span>,</span><br><span class="line">        <span class="comment">// 每次打包前自动清空path对应的目录文件</span></span><br><span class="line">        clean: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 关闭箭头函数输出</span></span><br><span class="line">        environment: &#123;</span><br><span class="line">            arrowFunction: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载器</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">                use: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/i</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="comment">// compiles Less to CSS</span></span><br><span class="line">                    <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;less-loader&#x27;</span>,</span><br><span class="line">                ],</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.s[ac]ss$/i</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="comment">// 将 JS 字符串生成为 style 节点</span></span><br><span class="line">                    <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">                    <span class="comment">// 将 CSS 转化成 CommonJS 模块</span></span><br><span class="line">                    <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">                    <span class="comment">// 将 Sass 编译成 CSS</span></span><br><span class="line">                    <span class="string">&#x27;sass-loader&#x27;</span>,</span><br><span class="line">                ],</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">                type: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">                parser: &#123;</span><br><span class="line">                    dataUrlCondition: &#123;</span><br><span class="line">                        maxSize: <span class="number">18</span> * <span class="number">1024</span> <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                generator: &#123;</span><br><span class="line">                    <span class="comment">// 修改图片文件的输出地址</span></span><br><span class="line">                    <span class="comment">// hash:10 只取10位哈希值</span></span><br><span class="line">                    <span class="comment">// ext图片后缀名</span></span><br><span class="line">                    <span class="comment">// query 图片文件后面携带的参数</span></span><br><span class="line">                    filename: <span class="string">&#x27;images/[hash:10][ext][query]&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(ttf|woff2?|mp3|mp4|word)$/</span>,</span><br><span class="line">                type: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">                generator: &#123;</span><br><span class="line">                    filename: <span class="string">&#x27;font/[hash:10][ext][query]&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.m?js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/(node_modules|bower_components)/</span>, <span class="comment">// 排除文件</span></span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 插件</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// Eslint插件</span></span><br><span class="line">        <span class="keyword">new</span> ESLintPlugin(&#123;</span><br><span class="line">            <span class="comment">// 指定文件的根目录</span></span><br><span class="line">            context:path.resolve(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 处理HTML文件</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: path.resolve(__dirname, <span class="string">&quot;../index.html&quot;</span>), <span class="comment">// 使用的模板地址</span></span><br><span class="line">            title: <span class="string">&quot;学习Webpack&quot;</span>, <span class="comment">// 网站title</span></span><br><span class="line">            hash:<span class="literal">true</span>, <span class="comment">// 添加哈希值</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 模式</span></span><br><span class="line">    mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后修改 package.json 文件，设置启动命令和打包命令</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;dev&quot;: &quot;webpack serve --config ./config/webpack.dev.js&quot;,</span><br><span class="line">  &quot;build&quot;: &quot;webpack --config ./config/webpack.prod.js&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="13-CSS处理"><a href="#13-CSS处理" class="headerlink" title="13. CSS处理"></a>13. CSS处理</h2><h3 id="13-1-提取CSS成单独文件"><a href="#13-1-提取CSS成单独文件" class="headerlink" title="13.1 提取CSS成单独文件"></a>13.1 提取CSS成单独文件</h3><p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev mini-css-extract-plugin</span><br></pre></td></tr></table></figure>

<p>需要将原来的 style-loader 换成 MiniCssExtractPlugin.loader，并在 plugins 使用插件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [<span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">      filename:<span class="string">&quot;state/css/main.css&quot;</span> <span class="comment">// 指定css文件输出位置</span></span><br><span class="line">  &#125;)],</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/i</span>,</span><br><span class="line">        use: [MiniCssExtractPlugin.loader, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>然后配合上面的 html-webpack-plugin 插件，可以自动完成资源引入</p>
<p>打包后生成的目录如下</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230826160424031.png" alt="image-20230826160424031"></p>
<h3 id="13-2-处理CSS兼容性问题"><a href="#13-2-处理CSS兼容性问题" class="headerlink" title="13.2 处理CSS兼容性问题"></a>13.2 处理CSS兼容性问题</h3><p>有些CSS样式在部分浏览器中可能会存在兼容性问题，我们通过配置可以来处理这部分的兼容问题</p>
<p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i postcss-loader postcss postcss-preset-env -D</span><br></pre></td></tr></table></figure>

<p>添加配置。这个配置必须放在 css-loader 后面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">rules:[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">        use: [MiniCssExtractPlugin.loader, <span class="string">&quot;css-loader&quot;</span>, &#123;</span><br><span class="line">            loader: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                postcssOptions: &#123;</span><br><span class="line">                    plugins: [</span><br><span class="line">                        <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">                    ],</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;],</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>在 package.json 文件中添加配置</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;browserslist&quot;: [</span><br><span class="line">    <span class="string">&quot;ie &gt;= 6&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>这个意思表示兼容到 ie6</p>
<p>我们尝试在代码中添加如下样式</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: pink;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;../images/1.png&quot;</span>);</span><br><span class="line">    <span class="attribute">transition</span>: <span class="number">0.5s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.2</span>);</span><br><span class="line">    <span class="attribute">transition</span>: <span class="number">0.5s</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后执行打包命令，查看打包后的代码</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: pink;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">../../state/images/626c3888ec.png</span>);</span><br><span class="line">    <span class="attribute">transition</span>: <span class="number">0.5s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    -ms-<span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.2</span>);</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.2</span>);</span><br><span class="line">    <span class="attribute">transition</span>: <span class="number">0.5s</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到加了一些兼容性的代码</p>
<p>但是通常情况下我们一般不考虑旧版本浏览器了，所以我们可以这样设置：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;browserslist&quot;: [</span><br><span class="line">  &quot;last 2 version&quot;,</span><br><span class="line">  &quot;&gt; 1%&quot;,</span><br><span class="line">  <span class="string">&quot;not dead&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li><code>last 2 version</code> 只考虑浏览器最近的两个版本</li>
<li><code>&gt; 1%</code> 覆盖99%的浏览器</li>
<li><code>not dead</code> 不考虑已经死掉的版本</li>
</ul>
<p>上面三个配置取交集做兼容处理</p>
<h3 id="13-3-提取重复配置"><a href="#13-3-提取重复配置" class="headerlink" title="13.3 提取重复配置"></a>13.3 提取重复配置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> ESLintPlugin = <span class="built_in">require</span>(<span class="string">&#x27;eslint-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myCssLoader</span>(<span class="params">preProcessor</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>[</span><br><span class="line">        MiniCssExtractPlugin.loader,</span><br><span class="line">        <span class="string">&quot;css-loader&quot;</span>, &#123;</span><br><span class="line">            loader: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                postcssOptions: &#123;</span><br><span class="line">                    plugins: [</span><br><span class="line">                        <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">                    ],</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        preProcessor</span><br><span class="line">    ].filter(<span class="built_in">Boolean</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 入口文件，相对路径</span></span><br><span class="line">    entry: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">// 要输出到的位置，绝对路径</span></span><br><span class="line">        path: path.resolve(__dirname,<span class="string">&quot;../dist&quot;</span>),</span><br><span class="line">        <span class="comment">// 文件名</span></span><br><span class="line">        filename: <span class="string">&quot;state/js/main.js&quot;</span>,</span><br><span class="line">        <span class="comment">// 每次打包前自动清空path对应的目录文件</span></span><br><span class="line">        clean: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 关闭箭头函数输出</span></span><br><span class="line">        environment: &#123;</span><br><span class="line">            arrowFunction: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载器</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">                use: myCssLoader(),</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/i</span>,</span><br><span class="line">                use: myCssLoader(<span class="string">&#x27;less-loader&#x27;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.s[ac]ss$/i</span>,</span><br><span class="line">                use: myCssLoader(<span class="string">&#x27;sass-loader&#x27;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">                type: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">                parser: &#123;</span><br><span class="line">                    dataUrlCondition: &#123;</span><br><span class="line">                        maxSize: <span class="number">18</span> * <span class="number">1024</span> <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                generator: &#123;</span><br><span class="line">                    <span class="comment">// 修改图片文件的输出地址</span></span><br><span class="line">                    <span class="comment">// hash:10 只取10位哈希值</span></span><br><span class="line">                    <span class="comment">// ext图片后缀名</span></span><br><span class="line">                    <span class="comment">// query 图片文件后面携带的参数</span></span><br><span class="line">                    filename: <span class="string">&#x27;state/images/[hash:10][ext][query]&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(ttf|woff2?|mp3|mp4|word)$/</span>,</span><br><span class="line">                type: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">                generator: &#123;</span><br><span class="line">                    filename: <span class="string">&#x27;state/resource/[hash:10][ext][query]&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.m?js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/(node_modules|bower_components)/</span>, <span class="comment">// 排除文件</span></span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 插件</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// Eslint插件</span></span><br><span class="line">        <span class="keyword">new</span> ESLintPlugin(&#123;</span><br><span class="line">            <span class="comment">// 指定文件的根目录</span></span><br><span class="line">            context:path.resolve(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 处理HTML文件</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: path.resolve(__dirname, <span class="string">&quot;../index.html&quot;</span>), <span class="comment">// 使用的模板地址</span></span><br><span class="line">            title: <span class="string">&quot;学习Webpack&quot;</span>, <span class="comment">// 网站title</span></span><br><span class="line">            hash:<span class="literal">true</span>, <span class="comment">// 添加哈希值</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 将CSS处理成单独文件</span></span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename:<span class="string">&quot;state/css/main.css&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 模式</span></span><br><span class="line">    mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-4-压缩CSS"><a href="#13-4-压缩CSS" class="headerlink" title="13.4 压缩CSS"></a>13.4 压缩CSS</h3><p>下载依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const CssMinimizerPlugin = require(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plugins:[</span><br><span class="line">    <span class="comment">// 压缩CSS</span></span><br><span class="line">    <span class="keyword">new</span> CssMinimizerPlugin()</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>打包看效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230826163915973.png" alt="image-20230826163915973"></p>
<h2 id="14-高级优化"><a href="#14-高级优化" class="headerlink" title="14. 高级优化"></a>14. 高级优化</h2><h3 id="14-1-提升开发体验SourceMap"><a href="#14-1-提升开发体验SourceMap" class="headerlink" title="14.1 提升开发体验SourceMap"></a>14.1 提升开发体验SourceMap</h3><p>开发时我们运行的代码是经过 webpack 编译后的，例如下面这个样子：</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230826165819723.png" alt="image-20230826165819723"></p>
<p>如果代码在某一行出现问题，我们调试起来很不方便，但是通过 SourceMap 会创建一种映射，我们可以直接定位到源代码，从而快速方便的查看是哪一行代码出问题</p>
<p>通过查看<a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/devtool/">Webpack DevTool 文档open in new window</a>可知，SourceMap 的值有很多种情况.</p>
<p>但实际开发时我们只需要关注两种情况即可：</p>
<ul>
<li>开发模式：<code>cheap-module-source-map</code><ul>
<li>优点：打包编译速度快，只包含行映射</li>
<li>缺点：没有列映射</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// 其他省略</span></span><br><span class="line">  mode: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  devtool: <span class="string">&quot;cheap-module-source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>生产模式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source-map</span><br></pre></td></tr></table></figure>

<ul>
<li>优点：包含行/列映射</li>
<li>缺点：打包编译速度更慢</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// 其他省略</span></span><br><span class="line">  mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  devtool: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="14-2-Hot热替换"><a href="#14-2-Hot热替换" class="headerlink" title="14.2 Hot热替换"></a>14.2 Hot热替换</h3><h4 id="为什么"><a href="#为什么" class="headerlink" title="为什么"></a>为什么</h4><p>开发时我们修改了其中一个模块代码，Webpack 默认会将所有模块全部重新打包编译，速度很慢。</p>
<p>所以我们需要做到修改某个模块代码，就只有这个模块代码需要重新打包编译，其他模块不变，这样打包速度就能很快。</p>
<h4 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h4><p>HotModuleReplacement（HMR/热模块替换）：在程序运行中，替换、添加或删除模块，而无需重新加载整个页面。</p>
<h4 id="怎么用"><a href="#怎么用" class="headerlink" title="怎么用"></a>怎么用</h4><ol>
<li>基本配置</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// 其他省略</span></span><br><span class="line">  devServer: &#123;</span><br><span class="line">    host: <span class="string">&quot;localhost&quot;</span>, <span class="comment">// 启动服务器域名</span></span><br><span class="line">    port: <span class="string">&quot;3000&quot;</span>, <span class="comment">// 启动服务器端口号</span></span><br><span class="line">    open: <span class="literal">true</span>, <span class="comment">// 是否自动打开浏览器</span></span><br><span class="line">    hot: <span class="literal">true</span>, <span class="comment">// 开启HMR功能（只能用于开发环境，生产环境不需要了）</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>此时 css 样式经过 style-loader 处理，已经具备 HMR 功能了。 但是 js 还不行。</p>
<ol>
<li>JS 配置</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> count <span class="keyword">from</span> <span class="string">&quot;./js/count&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&quot;./js/sum&quot;</span>;</span><br><span class="line"><span class="comment">// 引入资源，Webpack才会对其打包</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/iconfont.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./css/index.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./less/index.less&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.sass&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./sass/index.scss&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./styl/index.styl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result1 = count(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result1);</span><br><span class="line"><span class="keyword">const</span> result2 = sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否支持HMR功能</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept(<span class="string">&quot;./js/count.js&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">count</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result1 = count(<span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(result1);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">module</span>.hot.accept(<span class="string">&quot;./js/sum.js&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">sum</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result2 = sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(result2);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面这样写会很麻烦，所以实际开发我们会使用其他 loader 来解决。</p>
<p>比如：<a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-loader">vue-loaderopen in new window</a>, <a target="_blank" rel="noopener" href="https://github.com/gaearon/react-hot-loader">react-hot-loaderopen in new window</a></p>
<h3 id="14-3-oneOf"><a href="#14-3-oneOf" class="headerlink" title="14.3 oneOf"></a>14.3 oneOf</h3><h4 id="为什么-1"><a href="#为什么-1" class="headerlink" title="为什么"></a>为什么</h4><p>打包时每个文件都会经过所有 loader 处理，虽然因为 <code>test</code> 正则原因实际没有处理上，但是都要过一遍。比较慢。</p>
<h4 id="是什么-1"><a href="#是什么-1" class="headerlink" title="是什么"></a>是什么</h4><p>顾名思义就是只能匹配上一个 loader, 剩下的就不匹配了</p>
<h4 id="怎么用-1"><a href="#怎么用-1" class="headerlink" title="怎么用"></a>怎么用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> ESLintPlugin = <span class="built_in">require</span>(<span class="string">&#x27;eslint-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> CssMinimizerPlugin = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myCssLoader</span>(<span class="params">preProcessor</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>[</span><br><span class="line">        MiniCssExtractPlugin.loader,</span><br><span class="line">        <span class="string">&quot;css-loader&quot;</span>, &#123;</span><br><span class="line">            loader: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                postcssOptions: &#123;</span><br><span class="line">                    plugins: [</span><br><span class="line">                        <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">                    ],</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        preProcessor</span><br><span class="line">    ].filter(<span class="built_in">Boolean</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 入口文件，相对路径</span></span><br><span class="line">    entry: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">// 要输出到的位置，绝对路径</span></span><br><span class="line">        path: path.resolve(__dirname,<span class="string">&quot;../dist&quot;</span>),</span><br><span class="line">        <span class="comment">// 文件名</span></span><br><span class="line">        filename: <span class="string">&quot;state/js/main.js&quot;</span>,</span><br><span class="line">        <span class="comment">// 每次打包前自动清空path对应的目录文件</span></span><br><span class="line">        clean: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 关闭箭头函数输出</span></span><br><span class="line">        environment: &#123;</span><br><span class="line">            arrowFunction: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载器</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                oneOf: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">                        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">                        use: myCssLoader(),</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.less$/i</span>,</span><br><span class="line">                        use: myCssLoader(<span class="string">&#x27;less-loader&#x27;</span>)</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.s[ac]ss$/i</span>,</span><br><span class="line">                        use: myCssLoader(<span class="string">&#x27;sass-loader&#x27;</span>)</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">                        type: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">                        parser: &#123;</span><br><span class="line">                            dataUrlCondition: &#123;</span><br><span class="line">                                maxSize: <span class="number">18</span> * <span class="number">1024</span> <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        generator: &#123;</span><br><span class="line">                            <span class="comment">// 修改图片文件的输出地址</span></span><br><span class="line">                            <span class="comment">// hash:10 只取10位哈希值</span></span><br><span class="line">                            <span class="comment">// ext图片后缀名</span></span><br><span class="line">                            <span class="comment">// query 图片文件后面携带的参数</span></span><br><span class="line">                            filename: <span class="string">&#x27;state/images/[hash:10][ext][query]&#x27;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.(ttf|woff2?|mp3|mp4|word)$/</span>,</span><br><span class="line">                        type: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">                        generator: &#123;</span><br><span class="line">                            filename: <span class="string">&#x27;state/resource/[hash:10][ext][query]&#x27;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.m?js$/</span>,</span><br><span class="line">                        exclude: <span class="regexp">/(node_modules|bower_components)/</span>, <span class="comment">// 排除文件</span></span><br><span class="line">                        use: &#123;</span><br><span class="line">                            loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 插件</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// Eslint插件</span></span><br><span class="line">        <span class="keyword">new</span> ESLintPlugin(&#123;</span><br><span class="line">            <span class="comment">// 指定文件的根目录</span></span><br><span class="line">            context:path.resolve(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 处理HTML文件</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: path.resolve(__dirname, <span class="string">&quot;../index.html&quot;</span>), <span class="comment">// 使用的模板地址</span></span><br><span class="line">            title: <span class="string">&quot;学习Webpack&quot;</span>, <span class="comment">// 网站title</span></span><br><span class="line">            hash:<span class="literal">true</span>, <span class="comment">// 添加哈希值</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 将CSS处理成单独文件</span></span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename:<span class="string">&quot;state/css/main.css&quot;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 压缩CSS</span></span><br><span class="line">        <span class="keyword">new</span> CssMinimizerPlugin()</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 模式</span></span><br><span class="line">    mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">    devtool: <span class="string">&quot;source-map&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-4-Include-Exclude"><a href="#14-4-Include-Exclude" class="headerlink" title="14.4 Include/Exclude"></a>14.4 Include/Exclude</h3><h4 id="为什么-2"><a href="#为什么-2" class="headerlink" title="为什么"></a>为什么</h4><p>开发时我们需要使用第三方的库或插件，所有文件都下载到 node_modules 中了。而这些文件是不需要编译可以直接使用的。</p>
<p>所以我们在对 js 文件处理时，要排除 node_modules 下面的文件。</p>
<h4 id="是什么-2"><a href="#是什么-2" class="headerlink" title="是什么"></a>是什么</h4><ul>
<li>include</li>
</ul>
<p>包含，只处理 xxx 文件</p>
<ul>
<li>exclude</li>
</ul>
<p>排除，除了 xxx 文件以外其他文件都处理</p>
<h4 id="怎么用-2"><a href="#怎么用-2" class="headerlink" title="怎么用"></a>怎么用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> ESLintPlugin = <span class="built_in">require</span>(<span class="string">&#x27;eslint-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 入口文件，相对路径</span></span><br><span class="line">    entry: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">    <span class="comment">// 加载器</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            <span class="comment">// ....省略其他</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.m?js$/</span>,</span><br><span class="line">                <span class="comment">// exclude: /(node_modules|bower_components)/, // 排除文件</span></span><br><span class="line">                include: path.resolve(__dirname,<span class="string">&quot;../src&quot;</span>), <span class="comment">// 也可以设置只包含某个文件夹下的JS</span></span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 插件</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// Eslint插件</span></span><br><span class="line">        <span class="keyword">new</span> ESLintPlugin(&#123;</span><br><span class="line">            <span class="comment">// 指定文件的根目录</span></span><br><span class="line">            context:path.resolve(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">            exclude:[<span class="string">&quot;node_modules&quot;</span>] <span class="comment">// 排除 node_modules 文件夹下的文件，默认是node_module</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 处理HTML文件</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: path.resolve(__dirname, <span class="string">&quot;../index.html&quot;</span>), <span class="comment">// 使用的模板地址</span></span><br><span class="line">            title: <span class="string">&quot;学习Webpack&quot;</span>, <span class="comment">// 网站title</span></span><br><span class="line">            hash:<span class="literal">true</span>, <span class="comment">// 添加哈希值</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 模式</span></span><br><span class="line">    mode: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">    devtool: <span class="string">&quot;cheap-module-source-map&quot;</span>,</span><br><span class="line">    <span class="comment">// 开发服务器</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        host: <span class="string">&quot;localhost&quot;</span>, <span class="comment">// 启动服务器域名</span></span><br><span class="line">        port: <span class="string">&quot;3000&quot;</span>, <span class="comment">// 启动服务器端口号</span></span><br><span class="line">        open: <span class="literal">true</span>, <span class="comment">// 是否自动打开浏览器</span></span><br><span class="line">        hot:<span class="literal">true</span>, <span class="comment">// 热替换，改变JS或者CSS是可以不刷新页面就看到最新效果</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-5-Catch"><a href="#14-5-Catch" class="headerlink" title="14.5 Catch"></a>14.5 Catch</h3><h4 id="为什么-3"><a href="#为什么-3" class="headerlink" title="为什么"></a>为什么</h4><p>每次打包时 js 文件都要经过 Eslint 检查 和 Babel 编译，速度比较慢。</p>
<p>我们可以缓存之前的 Eslint 检查 和 Babel 编译结果，这样第二次打包时速度就会更快了</p>
<h4 id="怎么用-3"><a href="#怎么用-3" class="headerlink" title="怎么用"></a>怎么用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rules:[</span><br><span class="line">    &#123;</span><br><span class="line">        test: <span class="regexp">/\.m?js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/(node_modules|bower_components)/</span>, <span class="comment">// 排除文件</span></span><br><span class="line">        use: &#123;</span><br><span class="line">            loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                cacheDirectory: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">                cacheCompression: <span class="literal">false</span>, <span class="comment">// 缓存文件不要压缩</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><code>eslint-webpack-plugin</code> 默认已经开启了缓存</p>
<p>打包后查看 <code>node_modules/.catch</code></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230826212721210.png" alt="image-20230826212721210"></p>
<h3 id="14-6-开启多线程打包"><a href="#14-6-开启多线程打包" class="headerlink" title="14.6 开启多线程打包"></a>14.6 开启多线程打包</h3><h4 id="为什么-4"><a href="#为什么-4" class="headerlink" title="为什么"></a>为什么</h4><p>当我们项目文件足够大，数量足够多时，执行打包操作会耗时很长，这时我们就可以通过设置开启多线程打包提高打包速度</p>
<p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install terser-webpack-plugin thread-loader --save-dev</span><br></pre></td></tr></table></figure>

<p><code>terser-webpack-plugin</code> 在webpack5中默认自带，但是我们要修改默认配置开启多线程打包，所以也要重新安装一下</p>
<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/plugins/terser-webpack-plugin/#root">TerserWebpackPlugin | webpack 中文文档 (docschina.org)</a></p>
<p><code>thread-loader</code> 是用来开启多线程，放在需要开启多线程的loader前面</p>
<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/loaders/thread-loader/#root">thread-loader | webpack 中文文档 (docschina.org)</a></p>
<p>开启的线程数默认是：cpu核心数 -1</p>
<h4 id="怎么用-4"><a href="#怎么用-4" class="headerlink" title="怎么用"></a>怎么用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ESLintPlugin = <span class="built_in">require</span>(<span class="string">&#x27;eslint-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> CssMinimizerPlugin = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> TerserPlugin = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myCssLoader</span>(<span class="params">preProcessor</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>[</span><br><span class="line">        MiniCssExtractPlugin.loader,</span><br><span class="line">        <span class="string">&quot;css-loader&quot;</span>, &#123;</span><br><span class="line">            loader: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                postcssOptions: &#123;</span><br><span class="line">                    plugins: [</span><br><span class="line">                        <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">                    ],</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        preProcessor</span><br><span class="line">    ].filter(<span class="built_in">Boolean</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 入口文件，相对路径</span></span><br><span class="line">    entry: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">// 要输出到的位置，绝对路径</span></span><br><span class="line">        path: path.resolve(__dirname,<span class="string">&quot;../dist&quot;</span>),</span><br><span class="line">        <span class="comment">// 文件名</span></span><br><span class="line">        filename: <span class="string">&quot;state/js/main.js&quot;</span>,</span><br><span class="line">        <span class="comment">// 每次打包前自动清空path对应的目录文件</span></span><br><span class="line">        clean: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 关闭箭头函数输出</span></span><br><span class="line">        environment: &#123;</span><br><span class="line">            arrowFunction: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载器</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                oneOf: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">                        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">                        use: myCssLoader(),</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.less$/i</span>,</span><br><span class="line">                        use: myCssLoader(<span class="string">&#x27;less-loader&#x27;</span>)</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.s[ac]ss$/i</span>,</span><br><span class="line">                        use: myCssLoader(<span class="string">&#x27;sass-loader&#x27;</span>)</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">                        type: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">                        parser: &#123;</span><br><span class="line">                            dataUrlCondition: &#123;</span><br><span class="line">                                maxSize: <span class="number">18</span> * <span class="number">1024</span> <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        generator: &#123;</span><br><span class="line">                            <span class="comment">// 修改图片文件的输出地址</span></span><br><span class="line">                            <span class="comment">// hash:10 只取10位哈希值</span></span><br><span class="line">                            <span class="comment">// ext图片后缀名</span></span><br><span class="line">                            <span class="comment">// query 图片文件后面携带的参数</span></span><br><span class="line">                            filename: <span class="string">&#x27;state/images/[hash:10][ext][query]&#x27;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.(ttf|woff2?|mp3|mp4|word)$/</span>,</span><br><span class="line">                        type: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">                        generator: &#123;</span><br><span class="line">                            filename: <span class="string">&#x27;state/resource/[hash:10][ext][query]&#x27;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.m?js$/</span>,</span><br><span class="line">                        exclude: <span class="regexp">/(node_modules|bower_components)/</span>, <span class="comment">// 排除文件</span></span><br><span class="line">                        use: [</span><br><span class="line">                            <span class="comment">// 在需要开启多线程运行的loader前加上 thread-loader</span></span><br><span class="line">                            <span class="string">&quot;thread-loader&quot;</span>,</span><br><span class="line">                            &#123;</span><br><span class="line">                                loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                                options: &#123;</span><br><span class="line">                                    cacheDirectory: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">                                    cacheCompression: <span class="literal">false</span>, <span class="comment">// 缓存文件不要压缩</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 插件</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// Eslint插件</span></span><br><span class="line">        <span class="keyword">new</span> ESLintPlugin(&#123;</span><br><span class="line">            <span class="comment">// 指定文件的根目录</span></span><br><span class="line">            context:path.resolve(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">            threads:<span class="literal">true</span> <span class="comment">// 开启多线程，默认线程数是cpu核心数-1</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 处理HTML文件</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: path.resolve(__dirname, <span class="string">&quot;../index.html&quot;</span>), <span class="comment">// 使用的模板地址</span></span><br><span class="line">            title: <span class="string">&quot;学习Webpack&quot;</span>, <span class="comment">// 网站title</span></span><br><span class="line">            hash:<span class="literal">true</span>, <span class="comment">// 添加哈希值</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 将CSS处理成单独文件</span></span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename:<span class="string">&quot;state/css/main.css&quot;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">    optimization: &#123;</span><br><span class="line">        minimize: <span class="literal">true</span>,</span><br><span class="line">        minimizer: [</span><br><span class="line">            <span class="comment">// 压缩CSS</span></span><br><span class="line">            <span class="keyword">new</span> CssMinimizerPlugin(&#123;</span><br><span class="line">                parallel:<span class="literal">true</span>,<span class="comment">// 开启多线程</span></span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="comment">// 当生产模式会默认开启TerserPlugin，但是我们需要进行其他配置，就要重新写了</span></span><br><span class="line">            <span class="keyword">new</span> TerserPlugin(&#123;</span><br><span class="line">                parallel:<span class="literal">true</span> <span class="comment">// 开启多线程</span></span><br><span class="line">            &#125;)</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 模式</span></span><br><span class="line">    mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">    devtool: <span class="string">&quot;source-map&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-7-减少代码体积"><a href="#14-7-减少代码体积" class="headerlink" title="14.7 减少代码体积"></a>14.7 减少代码体积</h3><h4 id="为什么-5"><a href="#为什么-5" class="headerlink" title="为什么"></a>为什么</h4><p>Babel 为编译的每个文件都插入了辅助代码，使代码体积过大！</p>
<p>Babel 对一些公共方法使用了非常小的辅助代码，比如 <code>_extend</code>。默认情况下会被添加到每一个需要它的文件中。</p>
<p>你可以将这些辅助代码作为一个独立模块，来避免重复引入。</p>
<h4 id="是什么-3"><a href="#是什么-3" class="headerlink" title="是什么"></a>是什么</h4><p><code>@babel/plugin-transform-runtime</code>: 禁用了 Babel 自动对每个文件的 runtime 注入，而是引入 <code>@babel/plugin-transform-runtime</code> 并且使所有辅助代码从这里引用。</p>
<h4 id="怎么用-5"><a href="#怎么用-5" class="headerlink" title="怎么用"></a>怎么用</h4><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @babel/plugin-transform-runtime -D</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">rules:[</span><br><span class="line">    &#123;</span><br><span class="line">        test: <span class="regexp">/\.m?js$/</span>,</span><br><span class="line">        <span class="comment">// exclude: /(node_modules|bower_components)/, // 排除文件</span></span><br><span class="line">        include: path.resolve(__dirname,<span class="string">&quot;../src&quot;</span>), <span class="comment">// 也可以设置只包含某个文件夹下的JS</span></span><br><span class="line">        use: &#123;</span><br><span class="line">            loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                cacheDirectory: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">                cacheCompression: <span class="literal">false</span>, <span class="comment">// 缓存文件不要压缩</span></span><br><span class="line">                plugins: [<span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>], <span class="comment">// 减少代码体积</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="14-8-压缩图片"><a href="#14-8-压缩图片" class="headerlink" title="14.8 压缩图片"></a>14.8 压缩图片</h3><p>下载</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i image-minimizer-webpack-plugin imagemin -D</span><br></pre></td></tr></table></figure>

<p>根据情况继续下载依赖</p>
<p>无损压缩</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install imagemin-gifsicle imagemin-jpegtran imagemin-optipng imagemin-svgo -D</span><br></pre></td></tr></table></figure>

<p>有损压缩</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install imagemin-gifsicle imagemin-mozjpeg imagemin-pngquant imagemin-svgo -D</span><br></pre></td></tr></table></figure>

<p>我们使用无损压缩使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入</span></span><br><span class="line"><span class="keyword">const</span> ImageMinimizerPlugin = <span class="built_in">require</span>(<span class="string">&quot;image-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    optimization: &#123;</span><br><span class="line">        minimize: <span class="literal">true</span>,</span><br><span class="line">        minimizer: [</span><br><span class="line">            <span class="comment">// 压缩图片</span></span><br><span class="line">            <span class="keyword">new</span> ImageMinimizerPlugin(&#123;</span><br><span class="line">                minimizer: &#123;</span><br><span class="line">                    implementation: ImageMinimizerPlugin.imageminGenerate,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        plugins: [</span><br><span class="line">                            [<span class="string">&quot;gifsicle&quot;</span>, &#123; <span class="attr">interlaced</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">                            [<span class="string">&quot;jpegtran&quot;</span>, &#123; <span class="attr">progressive</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">                            [<span class="string">&quot;optipng&quot;</span>, &#123; <span class="attr">optimizationLevel</span>: <span class="number">5</span> &#125;],</span><br><span class="line">                            [</span><br><span class="line">                                <span class="string">&quot;svgo&quot;</span>,</span><br><span class="line">                                &#123;</span><br><span class="line">                                    plugins: [</span><br><span class="line">                                        <span class="string">&quot;preset-default&quot;</span>,</span><br><span class="line">                                        <span class="string">&quot;prefixIds&quot;</span>,</span><br><span class="line">                                        &#123;</span><br><span class="line">                                            name: <span class="string">&quot;sortAttrs&quot;</span>,</span><br><span class="line">                                            params: &#123;</span><br><span class="line">                                                xmlnsOrder: <span class="string">&quot;alphabetical&quot;</span>,</span><br><span class="line">                                            &#125;,</span><br><span class="line">                                        &#125;,</span><br><span class="line">                                    ],</span><br><span class="line">                                &#125;,</span><br><span class="line">                            ],</span><br><span class="line">                        ],</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;),</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 模式</span></span><br><span class="line">    mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">    devtool: <span class="string">&quot;source-map&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打包看效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230826224900002.png" alt="image-20230826224900002"></p>
<h2 id="15-提高代码运行效率"><a href="#15-提高代码运行效率" class="headerlink" title="15. 提高代码运行效率"></a>15. 提高代码运行效率</h2><h3 id="15-1-Code-Split"><a href="#15-1-Code-Split" class="headerlink" title="15.1 Code Split"></a>15.1 Code Split</h3><p>打包代码时会将所有 js 文件打包到一个文件中，体积太大了。我们如果只要渲染首页，就应该只加载首页的 js 文件，其他文件不应该加载。所以我们需要将打包生成的文件进行代码分割，生成多个 js 文件，渲染哪个页面就只加载某个 js 文件，这样加载的资源就少，速度就更快。</p>
<p>代码分割（Code Split）主要做了两件事：</p>
<ol>
<li>分割文件：将打包生成的文件进行分割，生成多个 js 文件。</li>
<li>按需加载：需要哪个文件就加载哪个文件。</li>
</ol>
<p>代码分割实现方式有不同的方式，为了更加方便体现它们之间的差异，我们会分别创建新的文件来演示</p>
<h4 id="多入口配置"><a href="#多入口配置" class="headerlink" title="多入口配置"></a>多入口配置</h4><p>需要将 entry 设置成一个对象，key 是生成的文件名，value 对应文件相对路径</p>
<p>在 output 中使用 <code>[name].js</code> 设置输出的文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        app:<span class="string">&quot;./src/app.js&quot;</span>,</span><br><span class="line">        main:<span class="string">&quot;./src/main.js&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output:&#123;</span><br><span class="line">        path:path.resolve(__dirname,<span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">        filename: <span class="string">&quot;js/[name].js&quot;</span>,</span><br><span class="line">        clean: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: path.resolve(__dirname,<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">&quot;production&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码目录结构</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">demo01             </span><br><span class="line">├── src            </span><br><span class="line">│   ├── app.js     </span><br><span class="line">│   └── main.js</span><br><span class="line">├── index.html</span><br><span class="line">├── package.json</span><br><span class="line">└── webpack.config.js</span><br></pre></td></tr></table></figure>

<p>打包后的目录</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dist          </span><br><span class="line">├── js        </span><br><span class="line">│   ├── app.js</span><br><span class="line">│   └── main.js</span><br><span class="line">└── index.html</span><br></pre></td></tr></table></figure>

<h4 id="提取重复文件"><a href="#提取重复文件" class="headerlink" title="提取重复文件"></a>提取重复文件</h4><p>在项目中如果我们有两个文件都引用了另外一个文件的内容，但是打包时会吧共同的引用的文件打包两份，这样会造成打包后的体积变大，从而降低加载速度，我们可以通过配置 <code>splitChunks</code> 来解决这种问题</p>
<p>首先创建一个 <code>sum.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">...args</span>)</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> args.reduce(<span class="function">(<span class="params">a,b</span>)=&gt;</span>a+b,<span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后 <code>app.js</code> 和 <code>main.js</code> 分别使用 sum 函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;sum&#125; <span class="keyword">from</span> <span class="string">&quot;./sum&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;app&quot;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;sum&#125; <span class="keyword">from</span> <span class="string">&quot;./sum&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;main&quot;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>))</span><br></pre></td></tr></table></figure>

<p>我们现在执行一次打包操作，看看打包后的输出是什么样子</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230827110838347.png" alt="image-20230827110838347"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230827110851500.png" alt="image-20230827110851500"></p>
<p>可以看到还是输出了两个文件，并且每个文件里面都有sum函数</p>
<p>添加以下配置信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        app:<span class="string">&quot;./src/app.js&quot;</span>,</span><br><span class="line">        main:<span class="string">&quot;./src/main.js&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output:&#123;</span><br><span class="line">        path:path.resolve(__dirname,<span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">        filename: <span class="string">&quot;js/[name].js&quot;</span>,</span><br><span class="line">        clean: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: path.resolve(__dirname,<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    optimization: &#123;</span><br><span class="line">        <span class="comment">// 代码分割配置</span></span><br><span class="line">        splitChunks: &#123;</span><br><span class="line">            chunks: <span class="string">&quot;all&quot;</span>, <span class="comment">// 对所有模块都进行分割</span></span><br><span class="line">            <span class="comment">// 以下是默认值</span></span><br><span class="line">            <span class="comment">// minSize: 20000, // 分割代码最小的大小</span></span><br><span class="line">            <span class="comment">// minRemainingSize: 0, // 类似于minSize，最后确保提取的文件大小不能为0</span></span><br><span class="line">            <span class="comment">// minChunks: 1, // 至少被引用的次数，满足条件才会代码分割</span></span><br><span class="line">            <span class="comment">// maxAsyncRequests: 30, // 按需加载时并行加载的文件的最大数量</span></span><br><span class="line">            <span class="comment">// maxInitialRequests: 30, // 入口js文件最大并行请求数量</span></span><br><span class="line">            <span class="comment">// enforceSizeThreshold: 50000, // 超过50kb一定会单独打包（此时会忽略minRemainingSize、maxAsyncRequests、maxInitialRequests）</span></span><br><span class="line">            <span class="comment">// cacheGroups: &#123; // 组，哪些模块要打包到一个组</span></span><br><span class="line">            <span class="comment">//   defaultVendors: &#123; // 组名</span></span><br><span class="line">            <span class="comment">//     test: /[\\/]node_modules[\\/]/, // 需要打包到一起的模块</span></span><br><span class="line">            <span class="comment">//     priority: -10, // 权重（越大越高）</span></span><br><span class="line">            <span class="comment">//     reuseExistingChunk: true, // 如果当前 chunk 包含已从主 bundle 中拆分出的模块，则它将被重用，而不是生成新的模块</span></span><br><span class="line">            <span class="comment">//   &#125;,</span></span><br><span class="line">            <span class="comment">//   default: &#123; // 其他没有写的配置会使用上面的默认值</span></span><br><span class="line">            <span class="comment">//     minChunks: 2, // 这里的minChunks权重更大</span></span><br><span class="line">            <span class="comment">//     priority: -20,</span></span><br><span class="line">            <span class="comment">//     reuseExistingChunk: true,</span></span><br><span class="line">            <span class="comment">//   &#125;,</span></span><br><span class="line">            <span class="comment">// &#125;,</span></span><br><span class="line">            <span class="comment">// 修改配置</span></span><br><span class="line">            cacheGroups: &#123;</span><br><span class="line">                <span class="comment">// 组，哪些模块要打包到一个组</span></span><br><span class="line">                <span class="comment">// defaultVendors: &#123; // 组名</span></span><br><span class="line">                <span class="comment">//   test: /[\\/]node_modules[\\/]/, // 需要打包到一起的模块</span></span><br><span class="line">                <span class="comment">//   priority: -10, // 权重（越大越高）</span></span><br><span class="line">                <span class="comment">//   reuseExistingChunk: true, // 如果当前 chunk 包含已从主 bundle 中拆分出的模块，则它将被重用，而不是生成新的模块</span></span><br><span class="line">                <span class="comment">// &#125;,</span></span><br><span class="line">                <span class="keyword">default</span>: &#123;</span><br><span class="line">                    <span class="comment">// 其他没有写的配置会使用上面的默认值</span></span><br><span class="line">                    minSize: <span class="number">0</span>, <span class="comment">// 我们定义的文件体积太小了，所以要改打包的最小文件体积</span></span><br><span class="line">                    minChunks: <span class="number">2</span>,</span><br><span class="line">                    priority: -<span class="number">20</span>,</span><br><span class="line">                    reuseExistingChunk: <span class="literal">true</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">&quot;production&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再次打包可以看到 sum 函数被单独打包成了一个文件</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230827111109476.png" alt="image-20230827111109476"></p>
<h4 id="按需加载"><a href="#按需加载" class="headerlink" title="按需加载"></a>按需加载</h4><p>例如页面中一个按钮，点击按钮后会调用一个函数进行加法运算，不点击按钮就不会进行加法运算。这时我们可以使用按需加载的方式来加载这个JS，如果不点击，则不会请求这个文件，从而提高页面首次加载速度</p>
<p>新建 <code>count.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> (<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>main.js</code> 中添加代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&quot;btn&quot;</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">import</span>(<span class="string">&quot;./count&quot;</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res.default(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后 <code>index.html</code> 中添加按钮</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>打包文件，打开 <code>index.html</code></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230827112722995.png" alt="image-20230827112722995"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230827112754300.png" alt="image-20230827112754300"></p>
<blockquote>
<p>Esllint 默认不支持 import 动态导入语法，在 .eslintrc.js 文件中添加配置即可</p>
</blockquote>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plugins: [<span class="string">&quot;import&quot;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="给动态生成的文件命名"><a href="#给动态生成的文件命名" class="headerlink" title="给动态生成的文件命名"></a>给动态生成的文件命名</h4><p>细心的同学已经发现，我们上面点击按钮是，动态加载了一个叫 293.js 的文件，但是我们在代码中并不是这个名，将来在我们调试的时候可能会分不清楚那个文件是我们要找的文件。</p>
<p>所以我们可以通过编写特定对的注释代码，来对动态加载的文件命名</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&quot;btn&quot;</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;count&quot; */</span> <span class="string">&quot;./js/count&quot;</span>).then(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res.default(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>固定写法，在动态加载的文件前添加 <code>/* webpackChunkName: &quot;count&quot; */</code> 这段注释。count 就是我们想要生成的文件名称</p>
<p>然后再配置文件中添加下面的代码即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chunkFilename: <span class="string">&quot;state/js/chunk/[name].js&quot;</span>,</span><br></pre></td></tr></table></figure>

<p>具体配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 入口文件，相对路径</span></span><br><span class="line">entry: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line">output: &#123;</span><br><span class="line">    <span class="comment">// 要输出到的位置，绝对路径</span></span><br><span class="line">    path: path.resolve(__dirname,<span class="string">&quot;../dist&quot;</span>),</span><br><span class="line">    <span class="comment">// 文件名</span></span><br><span class="line">    filename: <span class="string">&quot;state/js/main.js&quot;</span>,</span><br><span class="line">    <span class="comment">// 给动态生成的文件命名</span></span><br><span class="line">    chunkFilename: <span class="string">&quot;state/js/chunk/[name].js&quot;</span>,</span><br><span class="line">    <span class="comment">// 每次打包前自动清空path对应的目录文件</span></span><br><span class="line">    clean: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 关闭箭头函数输出</span></span><br><span class="line">    environment: &#123;</span><br><span class="line">        arrowFunction: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>然后打包后的文件会自动放在 chunk 文件夹下</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230827125051405.png" alt="image-20230827125051405"></p>
<h2 id="16-文件统一命名"><a href="#16-文件统一命名" class="headerlink" title="16. 文件统一命名"></a>16. 文件统一命名</h2><p>将凡是涉及到文件输出的地方，统一用 <code>[name].文件后缀</code> 的方式来命名，这样webpack会自动将源文件名设置为打包后的文件名</p>
<p>修改后的配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ESLintPlugin = <span class="built_in">require</span>(<span class="string">&#x27;eslint-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> CssMinimizerPlugin = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> TerserPlugin = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> ImageMinimizerPlugin = <span class="built_in">require</span>(<span class="string">&quot;image-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myCssLoader</span>(<span class="params">preProcessor</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>[</span><br><span class="line">        MiniCssExtractPlugin.loader,</span><br><span class="line">        <span class="string">&quot;css-loader&quot;</span>, &#123;</span><br><span class="line">            loader: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                postcssOptions: &#123;</span><br><span class="line">                    plugins: [</span><br><span class="line">                        <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">                    ],</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        preProcessor</span><br><span class="line">    ].filter(<span class="built_in">Boolean</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 入口文件，相对路径</span></span><br><span class="line">    entry: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">// 要输出到的位置，绝对路径</span></span><br><span class="line">        path: path.resolve(__dirname,<span class="string">&quot;../dist&quot;</span>),</span><br><span class="line">        <span class="comment">// 文件名</span></span><br><span class="line">        filename: <span class="string">&quot;state/js/[name].js&quot;</span>,</span><br><span class="line">        <span class="comment">// 给动态生成的文件命名</span></span><br><span class="line">        chunkFilename: <span class="string">&quot;state/js/chunk/[name].js&quot;</span>,</span><br><span class="line">        <span class="comment">// 只要是使用 type:asset 的loader统一设置输出名</span></span><br><span class="line">        <span class="comment">// hash:10 只取10位哈希值</span></span><br><span class="line">        <span class="comment">// ext文件后缀名</span></span><br><span class="line">        <span class="comment">// query 图片文件后面携带的参数</span></span><br><span class="line">        assetModuleFilename: <span class="string">&quot;state/asset/[hash:10][ext][query]&quot;</span>,</span><br><span class="line">        <span class="comment">// 每次打包前自动清空path对应的目录文件</span></span><br><span class="line">        clean: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 关闭箭头函数输出</span></span><br><span class="line">        environment: &#123;</span><br><span class="line">            arrowFunction: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载器</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                oneOf: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">                        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                        <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">                        use: myCssLoader(),</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.less$/i</span>,</span><br><span class="line">                        use: myCssLoader(<span class="string">&#x27;less-loader&#x27;</span>)</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.s[ac]ss$/i</span>,</span><br><span class="line">                        use: myCssLoader(<span class="string">&#x27;sass-loader&#x27;</span>)</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.(png|jpe?g|gif|webp)$/</span>,</span><br><span class="line">                        type: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">                        parser: &#123;</span><br><span class="line">                            dataUrlCondition: &#123;</span><br><span class="line">                                maxSize: <span class="number">18</span> * <span class="number">1024</span> <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="comment">// generator: &#123;</span></span><br><span class="line">                        <span class="comment">//     // 修改图片文件的输出地址</span></span><br><span class="line">                        <span class="comment">//     // hash:10 只取10位哈希值</span></span><br><span class="line">                        <span class="comment">//     // ext图片后缀名</span></span><br><span class="line">                        <span class="comment">//     // query 图片文件后面携带的参数</span></span><br><span class="line">                        <span class="comment">//     // filename: &#x27;state/images/[hash:10][ext][query]&#x27;</span></span><br><span class="line">                        <span class="comment">// &#125;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.(ttf|woff2?|mp3|mp4|word)$/</span>,</span><br><span class="line">                        type: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">                        <span class="comment">// generator: &#123;</span></span><br><span class="line">                        <span class="comment">//     filename: &#x27;state/resource/[hash:10][ext][query]&#x27;</span></span><br><span class="line">                        <span class="comment">// &#125;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        test: <span class="regexp">/\.m?js$/</span>,</span><br><span class="line">                        exclude: <span class="regexp">/(node_modules|bower_components)/</span>, <span class="comment">// 排除文件</span></span><br><span class="line">                        use: [</span><br><span class="line">                            <span class="comment">// 在需要开启多线程运行的loader前加上 thread-loader</span></span><br><span class="line">                            <span class="string">&quot;thread-loader&quot;</span>,</span><br><span class="line">                            &#123;</span><br><span class="line">                                loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                                options: &#123;</span><br><span class="line">                                    cacheDirectory: <span class="literal">true</span>, <span class="comment">// 开启babel编译缓存</span></span><br><span class="line">                                    cacheCompression: <span class="literal">false</span>, <span class="comment">// 缓存文件不要压缩</span></span><br><span class="line">                                    plugins: [<span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>], <span class="comment">// 减少代码体积</span></span><br><span class="line">                                &#125;,</span><br><span class="line">                            &#125;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 插件</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// Eslint插件</span></span><br><span class="line">        <span class="keyword">new</span> ESLintPlugin(&#123;</span><br><span class="line">            <span class="comment">// 指定文件的根目录</span></span><br><span class="line">            context:path.resolve(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">            threads:<span class="literal">true</span> <span class="comment">// 开启多线程，默认线程数是cpu核心数-1</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 处理HTML文件</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: path.resolve(__dirname, <span class="string">&quot;../index.html&quot;</span>), <span class="comment">// 使用的模板地址</span></span><br><span class="line">            title: <span class="string">&quot;学习Webpack&quot;</span>, <span class="comment">// 网站title</span></span><br><span class="line">            hash:<span class="literal">true</span>, <span class="comment">// 添加哈希值</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 将CSS处理成单独文件</span></span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename:<span class="string">&quot;state/css/[name].css&quot;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">    optimization: &#123;</span><br><span class="line">        minimize: <span class="literal">true</span>,</span><br><span class="line">        minimizer: [</span><br><span class="line">            <span class="comment">// 压缩CSS</span></span><br><span class="line">            <span class="keyword">new</span> CssMinimizerPlugin(&#123;</span><br><span class="line">                parallel:<span class="literal">true</span>,<span class="comment">// 开启多线程</span></span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="comment">// 当生产模式会默认开启TerserPlugin，但是我们需要进行其他配置，就要重新写了</span></span><br><span class="line">            <span class="keyword">new</span> TerserPlugin(&#123;</span><br><span class="line">                parallel:<span class="literal">true</span></span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="comment">// 压缩图片</span></span><br><span class="line">            <span class="keyword">new</span> ImageMinimizerPlugin(&#123;</span><br><span class="line">                minimizer: &#123;</span><br><span class="line">                    implementation: ImageMinimizerPlugin.imageminGenerate,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        plugins: [</span><br><span class="line">                            [<span class="string">&quot;gifsicle&quot;</span>, &#123; <span class="attr">interlaced</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">                            [<span class="string">&quot;jpegtran&quot;</span>, &#123; <span class="attr">progressive</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">                            [<span class="string">&quot;optipng&quot;</span>, &#123; <span class="attr">optimizationLevel</span>: <span class="number">5</span> &#125;],</span><br><span class="line">                            [</span><br><span class="line">                                <span class="string">&quot;svgo&quot;</span>,</span><br><span class="line">                                &#123;</span><br><span class="line">                                    plugins: [</span><br><span class="line">                                        <span class="string">&quot;preset-default&quot;</span>,</span><br><span class="line">                                        <span class="string">&quot;prefixIds&quot;</span>,</span><br><span class="line">                                        &#123;</span><br><span class="line">                                            name: <span class="string">&quot;sortAttrs&quot;</span>,</span><br><span class="line">                                            params: &#123;</span><br><span class="line">                                                xmlnsOrder: <span class="string">&quot;alphabetical&quot;</span>,</span><br><span class="line">                                            &#125;,</span><br><span class="line">                                        &#125;,</span><br><span class="line">                                    ],</span><br><span class="line">                                &#125;,</span><br><span class="line">                            ],</span><br><span class="line">                        ],</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;),</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 模式</span></span><br><span class="line">    mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">    devtool: <span class="string">&quot;source-map&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="17-Preload-Prefetch"><a href="#17-Preload-Prefetch" class="headerlink" title="17. Preload / Prefetch"></a>17. Preload / Prefetch</h2><h3 id="为什么-6"><a href="#为什么-6" class="headerlink" title="为什么"></a>为什么</h3><p>我们前面已经做了代码分割，同时会使用 import 动态导入语法来进行代码按需加载（我们也叫懒加载，比如路由懒加载就是这样实现的）。</p>
<p>但是加载速度还不够好，比如：是用户点击按钮时才加载这个资源的，如果资源体积很大，那么用户会感觉到明显卡顿效果。</p>
<p>我们想在浏览器空闲时间，加载后续需要使用的资源。我们就需要用上 <code>Preload</code> 或 <code>Prefetch</code> 技术。</p>
<h3 id="是什么-4"><a href="#是什么-4" class="headerlink" title="是什么"></a>是什么</h3><ul>
<li><code>Preload</code>：告诉浏览器立即加载资源。</li>
<li><code>Prefetch</code>：告诉浏览器在空闲时才开始加载资源。</li>
</ul>
<p>它们共同点：</p>
<ul>
<li>都只会加载资源，并不执行。</li>
<li>都有缓存。</li>
</ul>
<p>它们区别：</p>
<ul>
<li><code>Preload</code>加载优先级高，<code>Prefetch</code>加载优先级低。</li>
<li><code>Preload</code>只能加载当前页面需要使用的资源，<code>Prefetch</code>可以加载当前页面资源，也可以加载下一个页面需要使用的资源。</li>
</ul>
<p>总结：</p>
<ul>
<li>当前页面优先级高的资源用 <code>Preload</code> 加载。</li>
<li>下一个页面需要使用的资源用 <code>Prefetch</code> 加载。</li>
</ul>
<p>它们的问题：兼容性较差。</p>
<ul>
<li>我们可以去 <a target="_blank" rel="noopener" href="https://caniuse.com/">Can I Useopen in new window</a> 网站查询 API 的兼容性问题。</li>
<li><code>Preload</code> 相对于 <code>Prefetch</code> 兼容性好一点。</li>
</ul>
<h3 id="怎么用-6"><a href="#怎么用-6" class="headerlink" title="怎么用"></a>怎么用</h3><p>安装</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @vue/preload-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<p>配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PreloadWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;@vue/preload-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 插件</span></span><br><span class="line">plugins: [</span><br><span class="line">    <span class="comment">// 资源懒加载</span></span><br><span class="line">    <span class="keyword">new</span> PreloadWebpackPlugin(&#123;</span><br><span class="line">        <span class="comment">//rel: &quot;preload&quot;, // preload 兼容性更好</span></span><br><span class="line">        <span class="keyword">as</span>: <span class="string">&quot;script&quot;</span>,</span><br><span class="line">        rel: <span class="string">&#x27;prefetch&#x27;</span> <span class="comment">// prefetch 兼容性更差</span></span><br><span class="line">    &#125;)</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>配置完成后，点击按钮加载JS就会从缓存中获取，速度比较快</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230827161019364.png" alt="image-20230827161019364"></p>
<h2 id="18-contenthash"><a href="#18-contenthash" class="headerlink" title="18. contenthash"></a>18. contenthash</h2><h3 id="为什么-7"><a href="#为什么-7" class="headerlink" title="为什么"></a>为什么</h3><p>我们通过打包发现，每次打包后的文件都叫 main.js，这样浏览器在加载文件时可能会存在缓存问题，我们可以通过设置让每次打包后都加一个哈希值，这样在加载资源时就不会存在缓存问题</p>
<h3 id="是什么-5"><a href="#是什么-5" class="headerlink" title="是什么"></a>是什么</h3><p>webpack 设置哈希值有几种方式，它们都会生成一个唯一的 hash 值。</p>
<ul>
<li>fullhash（webpack4 是 hash）</li>
</ul>
<p>每次修改任何一个文件，所有文件名的 hash 至都将改变。所以一旦修改了任何一个文件，整个项目的文件缓存都将失效。</p>
<ul>
<li>chunkhash</li>
</ul>
<p>根据不同的入口文件(Entry)进行依赖文件解析、构建对应的 chunk，生成对应的哈希值。我们 js 和 css 是同一个引入，会共享一个 hash 值。</p>
<ul>
<li>contenthash</li>
</ul>
<p>根据文件内容生成 hash 值，只有文件内容变化了，hash 值才会变化。所有文件 hash 值是独享且不同的。</p>
<p>通过对比，contenthash 最适合我们使用</p>
<h3 id="怎么用-7"><a href="#怎么用-7" class="headerlink" title="怎么用"></a>怎么用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 入口文件，相对路径</span></span><br><span class="line">    entry: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">    <span class="comment">// 输出</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">// 要输出到的位置，绝对路径</span></span><br><span class="line">        path: path.resolve(__dirname,<span class="string">&quot;../dist&quot;</span>),</span><br><span class="line">        <span class="comment">// 文件名</span></span><br><span class="line">        filename: <span class="string">&quot;state/js/[name].[contenthash:8].js&quot;</span>,</span><br><span class="line">        <span class="comment">// 给动态生成的文件命名</span></span><br><span class="line">        chunkFilename: <span class="string">&quot;state/js/chunk/[name].[contenthash:8].js&quot;</span>,</span><br><span class="line">        <span class="comment">// 只要是使用 type:asset 的loader统一设置输出名</span></span><br><span class="line">        <span class="comment">// hash:10 只取10位哈希值</span></span><br><span class="line">        <span class="comment">// ext文件后缀名</span></span><br><span class="line">        <span class="comment">// query 图片文件后面携带的参数</span></span><br><span class="line">        assetModuleFilename: <span class="string">&quot;state/asset/[hash:10][ext][query]&quot;</span>,</span><br><span class="line">        <span class="comment">// 每次打包前自动清空path对应的目录文件</span></span><br><span class="line">        clean: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 关闭箭头函数输出</span></span><br><span class="line">        environment: &#123;</span><br><span class="line">            arrowFunction: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 插件</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// 将CSS处理成单独文件</span></span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename:<span class="string">&quot;state/css/[name].[contenthash:8].css&quot;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>静态资源还是使用 hash:10</p>
</blockquote>
<h2 id="19-runtimeChunk"><a href="#19-runtimeChunk" class="headerlink" title="19. runtimeChunk"></a>19. runtimeChunk</h2><h3 id="为什么-8"><a href="#为什么-8" class="headerlink" title="为什么"></a>为什么</h3><p>我们通过上面的配置设置打包哈希值，但是在某些场景下，例如：a 文件依赖了 b文件，当b文件发生变化时只改变b文件的哈希值，不要改变a文件的哈希值。这样做的目的是为了在控制缓存的前提下提高加载效率，而不是只改了一个文件，其他的文件都要发生变化。</p>
<h3 id="是什么-6"><a href="#是什么-6" class="headerlink" title="是什么"></a>是什么</h3><p>将 hash 值单独保管在一个 runtime 文件中。</p>
<p>我们最终输出三个文件：main、math、runtime。当 math 文件发送变化，变化的是 math 和 runtime 文件，main 不变。</p>
<p>runtime 文件只保存文件的 hash 值和它们与文件关系，整个文件体积就比较小，所以变化重新请求的代价也小。</p>
<h3 id="怎么用-8"><a href="#怎么用-8" class="headerlink" title="怎么用"></a>怎么用</h3><p>添加如下配置即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    optimization: &#123;</span><br><span class="line">        <span class="comment">// 提取runtime文件</span></span><br><span class="line">        runtimeChunk: &#123;</span><br><span class="line">            name: <span class="function">(<span class="params">entrypoint</span>) =&gt;</span> <span class="string">`runtime~<span class="subst">$&#123;entrypoint.name&#125;</span>`</span>, <span class="comment">// runtime文件命名规则</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改一下 count.js</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230827163828575.png" alt="image-20230827163828575"></p>
<p>然后再次打包，通过对比发现，只有count.js和runtime文件的哈希值发生改变，其他均未改变</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230827163638656.png" alt="image-20230827163638656"></p>
<h2 id="20-CoreJS"><a href="#20-CoreJS" class="headerlink" title="20. CoreJS"></a>20. CoreJS</h2><h3 id="为什么-9"><a href="#为什么-9" class="headerlink" title="为什么"></a>为什么</h3><p>过去我们使用 babel 对 js 代码进行了兼容性处理，其中使用@babel/preset-env 智能预设来处理兼容性问题。</p>
<p>它能将 ES6 的一些语法进行编译转换，比如箭头函数、点点点运算符等。但是如果是 async 函数、promise 对象、数组的一些方法（includes）等，它没办法处理。</p>
<p>所以此时我们 js 代码仍然存在兼容性问题，一旦遇到低版本浏览器会直接报错。所以我们想要将 js 兼容性问题彻底解决</p>
<h3 id="是什么-7"><a href="#是什么-7" class="headerlink" title="是什么"></a>是什么</h3><p><code>core-js</code> 是专门用来做 ES6 以及以上 API 的 <code>polyfill</code>。</p>
<p><code>polyfill</code>翻译过来叫做垫片/补丁。就是用社区上提供的一段代码，让我们在不兼容某些新特性的浏览器上，使用该新特性</p>
<h3 id="怎么用-9"><a href="#怎么用-9" class="headerlink" title="怎么用"></a>怎么用</h3><p>安装</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i core-js</span><br></pre></td></tr></table></figure>

<p>使用，修改 <code>babel.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 智能预设：能够编译ES6语法</span></span><br><span class="line">    presets: [</span><br><span class="line">        [</span><br><span class="line">            <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">            <span class="comment">// 按需加载core-js的polyfill</span></span><br><span class="line">            &#123; <span class="attr">useBuiltIns</span>: <span class="string">&quot;usage&quot;</span>, <span class="attr">corejs</span>: &#123; <span class="attr">version</span>: <span class="string">&quot;3&quot;</span>, <span class="attr">proposals</span>: <span class="literal">true</span> &#125; &#125;,</span><br><span class="line">        ],</span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="21-优化总结"><a href="#21-优化总结" class="headerlink" title="21. 优化总结"></a>21. 优化总结</h2><p>我们从 4 个角度对 webpack 和代码进行了优化：</p>
<ol>
<li>提升开发体验</li>
</ol>
<ul>
<li>使用 <code>Source Map</code> 让开发或上线时代码报错能有更加准确的错误提示。</li>
</ul>
<ol>
<li>提升 webpack 提升打包构建速度</li>
</ol>
<ul>
<li>使用 <code>HotModuleReplacement</code> 让开发时只重新编译打包更新变化了的代码，不变的代码使用缓存，从而使更新速度更快。</li>
<li>使用 <code>OneOf</code> 让资源文件一旦被某个 loader 处理了，就不会继续遍历了，打包速度更快。</li>
<li>使用 <code>Include/Exclude</code> 排除或只检测某些文件，处理的文件更少，速度更快。</li>
<li>使用 <code>Cache</code> 对 eslint 和 babel 处理的结果进行缓存，让第二次打包速度更快。</li>
<li>使用 <code>Thead</code> 多进程处理 eslint 和 babel 任务，速度更快。（需要注意的是，进程启动通信都有开销的，要在比较多代码处理时使用才有效果）</li>
</ul>
<ol>
<li>减少代码体积</li>
</ol>
<ul>
<li>使用 <code>Tree Shaking</code> 剔除了没有使用的多余代码，让代码体积更小。</li>
<li>使用 <code>@babel/plugin-transform-runtime</code> 插件对 babel 进行处理，让辅助代码从中引入，而不是每个文件都生成辅助代码，从而体积更小。</li>
<li>使用 <code>Image Minimizer</code> 对项目中图片进行压缩，体积更小，请求速度更快。（需要注意的是，如果项目中图片都是在线链接，那么就不需要了。本地项目静态图片才需要进行压缩。）</li>
</ul>
<ol>
<li>优化代码运行性能</li>
</ol>
<ul>
<li>使用 <code>Code Split</code> 对代码进行分割成多个 js 文件，从而使单个文件体积更小，并行加载 js 速度更快。并通过 import 动态导入语法进行按需加载，从而达到需要使用时才加载该资源，不用时不加载资源。</li>
<li>使用 <code>Preload / Prefetch</code> 对代码进行提前加载，等未来需要使用时就能直接使用，从而用户体验更好。</li>
<li>使用 <code>Network Cache</code> 能对输出资源文件进行更好的命名，将来好做缓存，从而用户体验更好。</li>
<li>使用 <code>Core-js</code> 对 js 进行兼容性处理，让我们代码能运行在低版本浏览器。</li>
<li>使用 <code>PWA</code> 能让代码离线也能访问，从而提升用户体验。</li>
</ul>
<h2 id="22-手动搭建Vue脚手架"><a href="#22-手动搭建Vue脚手架" class="headerlink" title="22. 手动搭建Vue脚手架"></a>22. 手动搭建Vue脚手架</h2><h3 id="22-1-项目结构"><a href="#22-1-项目结构" class="headerlink" title="22.1 项目结构"></a>22.1 项目结构</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">MyVueCli              </span><br><span class="line">├── config            </span><br><span class="line">│   └── webpack.dev.js</span><br><span class="line">│   └── webpack.prod.js</span><br><span class="line">├── public</span><br><span class="line">│   └── index.html</span><br><span class="line">├── src</span><br><span class="line">│   ├── router</span><br><span class="line">│   │   └── index.js</span><br><span class="line">│   ├── view</span><br><span class="line">│   │   ├── About</span><br><span class="line">│   │   │   └── index.vue</span><br><span class="line">│   │   └── Home</span><br><span class="line">│   │       └── index.vue</span><br><span class="line">│   ├── App.vue</span><br><span class="line">│   └── main.js</span><br><span class="line">├── .eslintrc.js</span><br><span class="line">├── babel.config.js</span><br><span class="line">└── package.json</span><br></pre></td></tr></table></figure>

<h3 id="22-2-开发模式配置"><a href="#22-2-开发模式配置" class="headerlink" title="22.2 开发模式配置"></a>22.2 开发模式配置</h3><p><code>webpack.dev.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.dev.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> ESLintWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; VueLoaderPlugin &#125; = <span class="built_in">require</span>(<span class="string">&quot;vue-loader&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; DefinePlugin &#125; = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getStyleLoaders = <span class="function">(<span class="params">preProcessor</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">&quot;vue-style-loader&quot;</span>,</span><br><span class="line">        <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">            loader: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                postcssOptions: &#123;</span><br><span class="line">                    plugins: [</span><br><span class="line">                        <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">                    ],</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        preProcessor,</span><br><span class="line">    ].filter(<span class="built_in">Boolean</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: <span class="literal">undefined</span>,</span><br><span class="line">        filename: <span class="string">&quot;static/js/[name].js&quot;</span>,</span><br><span class="line">        chunkFilename: <span class="string">&quot;static/js/[name].chunk.js&quot;</span>,</span><br><span class="line">        assetModuleFilename: <span class="string">&quot;static/js/[hash:10][ext][query]&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">                use: getStyleLoaders(),</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: getStyleLoaders(<span class="string">&quot;less-loader&quot;</span>),</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">                use: getStyleLoaders(<span class="string">&quot;sass-loader&quot;</span>),</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(png|jpe?g|gif|svg)$/</span>,</span><br><span class="line">                type: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">                parser: &#123;</span><br><span class="line">                    dataUrlCondition: &#123;</span><br><span class="line">                        maxSize: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">                type: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// vue-loader不支持oneOf</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">                loader: <span class="string">&quot;vue-loader&quot;</span>, <span class="comment">// 内部会给vue文件注入HMR功能代码</span></span><br><span class="line">                options: &#123;</span><br><span class="line">                    <span class="comment">// 开启缓存</span></span><br><span class="line">                    cacheDirectory: path.resolve(</span><br><span class="line">                        __dirname,</span><br><span class="line">                        <span class="string">&quot;node_modules/.cache/vue-loader&quot;</span></span><br><span class="line">                    ),</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> ESLintWebpackPlugin(&#123;</span><br><span class="line">            context: path.resolve(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">            exclude: <span class="string">&quot;node_modules&quot;</span>,</span><br><span class="line">            cache: <span class="literal">true</span>,</span><br><span class="line">            cacheLocation: path.resolve(</span><br><span class="line">                __dirname,</span><br><span class="line">                <span class="string">&quot;../node_modules/.cache/.eslintcache&quot;</span></span><br><span class="line">            ),</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: path.resolve(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> VueLoaderPlugin(),</span><br><span class="line">        <span class="comment">// 解决页面警告</span></span><br><span class="line">        <span class="keyword">new</span> DefinePlugin(&#123;</span><br><span class="line">            __VUE_OPTIONS_API__: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">            __VUE_PROD_DEVTOOLS__: <span class="string">&quot;false&quot;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">    optimization: &#123;</span><br><span class="line">        splitChunks: &#123;</span><br><span class="line">            chunks: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        runtimeChunk: &#123;</span><br><span class="line">            name: <span class="function">(<span class="params">entrypoint</span>) =&gt;</span> <span class="string">`runtime~<span class="subst">$&#123;entrypoint.name&#125;</span>`</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        extensions: [<span class="string">&quot;.vue&quot;</span>, <span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.json&quot;</span>], <span class="comment">// 自动补全文件扩展名，让vue可以使用</span></span><br><span class="line">    &#125;,</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        open: <span class="literal">true</span>,</span><br><span class="line">        host: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">        port: <span class="number">3000</span>,</span><br><span class="line">        hot: <span class="literal">true</span>,</span><br><span class="line">        compress: <span class="literal">true</span>,</span><br><span class="line">        historyApiFallback: <span class="literal">true</span>, <span class="comment">// 解决vue-router刷新404问题</span></span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">    devtool: <span class="string">&quot;cheap-module-source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="22-3-生产模式配置"><a href="#22-3-生产模式配置" class="headerlink" title="22.3 生产模式配置"></a>22.3 生产模式配置</h3><p><code>webpack.prod.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> ESLintWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> CssMinimizerPlugin = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> TerserWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> ImageMinimizerPlugin = <span class="built_in">require</span>(<span class="string">&quot;image-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> CopyPlugin = <span class="built_in">require</span>(<span class="string">&quot;copy-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; VueLoaderPlugin &#125; = <span class="built_in">require</span>(<span class="string">&quot;vue-loader&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; DefinePlugin &#125; = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getStyleLoaders = <span class="function">(<span class="params">preProcessor</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        MiniCssExtractPlugin.loader,</span><br><span class="line">        <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">            loader: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                postcssOptions: &#123;</span><br><span class="line">                    plugins: [</span><br><span class="line">                        <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">                    ],</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        preProcessor,</span><br><span class="line">    ].filter(<span class="built_in">Boolean</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 入口文件</span></span><br><span class="line">    entry: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">// 打包结果输出的位置</span></span><br><span class="line">        path: path.resolve(__dirname,<span class="string">&quot;dist&quot;</span>),</span><br><span class="line">        <span class="comment">// JS文件打包的命名：文件名.哈希值.js</span></span><br><span class="line">        filename: <span class="string">&quot;static/js/[name].[contenthash:10].js&quot;</span>,</span><br><span class="line">        <span class="comment">// 映射文件名</span></span><br><span class="line">        chunkFilename: <span class="string">&quot;static/js/[name].[contenthash:10].chunk.js&quot;</span>,</span><br><span class="line">        <span class="comment">// type:asset loader的文件生成名</span></span><br><span class="line">        assetModuleFilename: <span class="string">&quot;static/asset/[hash:10][ext][query]&quot;</span>,</span><br><span class="line">        <span class="comment">// 自动清理上次打包文件</span></span><br><span class="line">        clean: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">                use: getStyleLoaders(),</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: getStyleLoaders(<span class="string">&quot;less-loader&quot;</span>),</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">                use: getStyleLoaders(<span class="string">&quot;sass-loader&quot;</span>),</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(png|jpe?g|gif|svg)$/</span>,</span><br><span class="line">                type: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">                parser: &#123;</span><br><span class="line">                    dataUrlCondition: &#123;</span><br><span class="line">                        maxSize: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">                type: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(jsx|js)$/</span>,</span><br><span class="line">                include: path.resolve(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">                loader: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    cacheDirectory: <span class="literal">true</span>,</span><br><span class="line">                    cacheCompression: <span class="literal">false</span>,</span><br><span class="line">                    plugins: [</span><br><span class="line">                        <span class="comment">// &quot;@babel/plugin-transform-runtime&quot; // presets中包含了</span></span><br><span class="line">                    ],</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// vue-loader不支持oneOf</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">                loader: <span class="string">&quot;vue-loader&quot;</span>, <span class="comment">// 内部会给vue文件注入HMR功能代码</span></span><br><span class="line">                options: &#123;</span><br><span class="line">                    <span class="comment">// 开启缓存</span></span><br><span class="line">                    cacheDirectory: path.resolve(</span><br><span class="line">                        __dirname,</span><br><span class="line">                        <span class="string">&quot;node_modules/.cache/vue-loader&quot;</span></span><br><span class="line">                    ),</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// Eslint</span></span><br><span class="line">        <span class="keyword">new</span> ESLintWebpackPlugin(&#123;</span><br><span class="line">            context: path.resolve(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">            exclude: <span class="string">&quot;node_modules&quot;</span>,</span><br><span class="line">            cache: <span class="literal">true</span>,</span><br><span class="line">            cacheLocation: path.resolve(</span><br><span class="line">                __dirname,</span><br><span class="line">                <span class="string">&quot;../node_modules/.cache/.eslintcache&quot;</span></span><br><span class="line">            ),</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 自动引入js</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: path.resolve(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 复制public文件到打包目录中</span></span><br><span class="line">        <span class="keyword">new</span> CopyPlugin(&#123;</span><br><span class="line">            patterns: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">from</span>: path.resolve(__dirname, <span class="string">&quot;../public&quot;</span>),</span><br><span class="line">                    to: path.resolve(__dirname, <span class="string">&quot;../dist&quot;</span>),</span><br><span class="line">                    toType: <span class="string">&quot;dir&quot;</span>,</span><br><span class="line">                    noErrorOnMissing: <span class="literal">true</span>,</span><br><span class="line">                    globOptions: &#123;</span><br><span class="line">                        ignore: [<span class="string">&quot;**/index.html&quot;</span>],</span><br><span class="line">                    &#125;,</span><br><span class="line">                    info: &#123;</span><br><span class="line">                        minimized: <span class="literal">true</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 将CSS单独放在一个文件中</span></span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: <span class="string">&quot;static/css/[name].[contenthash:10].css&quot;</span>,</span><br><span class="line">            chunkFilename: <span class="string">&quot;static/css/[name].[contenthash:10].chunk.css&quot;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 处理vue</span></span><br><span class="line">        <span class="keyword">new</span> VueLoaderPlugin(),</span><br><span class="line">        <span class="comment">// 处理Vue的警告</span></span><br><span class="line">        <span class="keyword">new</span> DefinePlugin(&#123;</span><br><span class="line">            __VUE_OPTIONS_API__: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">            __VUE_PROD_DEVTOOLS__: <span class="string">&quot;false&quot;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">    optimization: &#123;</span><br><span class="line">        <span class="comment">// 压缩的操作</span></span><br><span class="line">        minimizer: [</span><br><span class="line">            <span class="comment">// 压缩CSS</span></span><br><span class="line">            <span class="keyword">new</span> CssMinimizerPlugin(),</span><br><span class="line">            <span class="comment">// 提取重复文件</span></span><br><span class="line">            <span class="keyword">new</span> TerserWebpackPlugin(),</span><br><span class="line">            <span class="comment">// 无损压缩图片</span></span><br><span class="line">            <span class="keyword">new</span> ImageMinimizerPlugin(&#123;</span><br><span class="line">                minimizer: &#123;</span><br><span class="line">                    implementation: ImageMinimizerPlugin.imageminGenerate,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        plugins: [</span><br><span class="line">                            [<span class="string">&quot;gifsicle&quot;</span>, &#123; <span class="attr">interlaced</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">                            [<span class="string">&quot;jpegtran&quot;</span>, &#123; <span class="attr">progressive</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">                            [<span class="string">&quot;optipng&quot;</span>, &#123; <span class="attr">optimizationLevel</span>: <span class="number">5</span> &#125;],</span><br><span class="line">                            [</span><br><span class="line">                                <span class="string">&quot;svgo&quot;</span>,</span><br><span class="line">                                &#123;</span><br><span class="line">                                    plugins: [</span><br><span class="line">                                        <span class="string">&quot;preset-default&quot;</span>,</span><br><span class="line">                                        <span class="string">&quot;prefixIds&quot;</span>,</span><br><span class="line">                                        &#123;</span><br><span class="line">                                            name: <span class="string">&quot;sortAttrs&quot;</span>,</span><br><span class="line">                                            params: &#123;</span><br><span class="line">                                                xmlnsOrder: <span class="string">&quot;alphabetical&quot;</span>,</span><br><span class="line">                                            &#125;,</span><br><span class="line">                                        &#125;,</span><br><span class="line">                                    ],</span><br><span class="line">                                &#125;,</span><br><span class="line">                            ],</span><br><span class="line">                        ],</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;),</span><br><span class="line">        ],</span><br><span class="line">        <span class="comment">// 分割代码，重复引用的文件会抽离成单独的文件</span></span><br><span class="line">        splitChunks: &#123;</span><br><span class="line">            chunks: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 缓存</span></span><br><span class="line">        runtimeChunk: &#123;</span><br><span class="line">            name: <span class="function">(<span class="params">entrypoint</span>) =&gt;</span> <span class="string">`runtime~<span class="subst">$&#123;entrypoint.name&#125;</span>`</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 导入文件自动加上后缀</span></span><br><span class="line">    resolve: &#123;</span><br><span class="line">        extensions: [<span class="string">&quot;.vue&quot;</span>, <span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.json&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 模式为开发模式</span></span><br><span class="line">    mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">    <span class="comment">// 报错提示的信息具体到行和列</span></span><br><span class="line">    devtool: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="22-4-其他文件代码"><a href="#22-4-其他文件代码" class="headerlink" title="22.4 其他文件代码"></a>22.4 其他文件代码</h3><p><code>.eslintrc.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    root: <span class="literal">true</span>,</span><br><span class="line">    env: &#123;</span><br><span class="line">        node: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">extends</span>: [<span class="string">&quot;plugin:vue/vue3-essential&quot;</span>, <span class="string">&quot;eslint:recommended&quot;</span>],</span><br><span class="line">    parserOptions: &#123;</span><br><span class="line">        parser: <span class="string">&quot;@babel/eslint-parser&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>babel.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    presets: [<span class="string">&quot;@vue/cli-plugin-babel/preset&quot;</span>],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>package.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;myvuecli&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dev&quot;</span>: <span class="string">&quot;cross-env NODE_ENV=development webpack serve --config ./config/webpack.dev.js&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;build&quot;</span>: <span class="string">&quot;cross-env NODE_ENV=production webpack --config ./config/webpack.prod.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;keywords&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;@babel/eslint-parser&quot;</span>: <span class="string">&quot;^7.22.11&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;vue&quot;</span>: <span class="string">&quot;^3.3.4&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;@vue/cli-plugin-babel&quot;</span>: <span class="string">&quot;^5.0.8&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;babel-loader&quot;</span>: <span class="string">&quot;^9.1.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;cross-env&quot;</span>: <span class="string">&quot;^7.0.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;css-loader&quot;</span>: <span class="string">&quot;^6.8.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint&quot;</span>: <span class="string">&quot;^8.48.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint-plugin-vue&quot;</span>: <span class="string">&quot;^9.17.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;eslint-webpack-plugin&quot;</span>: <span class="string">&quot;^4.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;html-webpack-plugin&quot;</span>: <span class="string">&quot;^5.5.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;less&quot;</span>: <span class="string">&quot;^3.13.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;less-loader&quot;</span>: <span class="string">&quot;^10.2.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;postcss-loader&quot;</span>: <span class="string">&quot;^7.3.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;postcss-preset-env&quot;</span>: <span class="string">&quot;^9.1.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;sass-loader&quot;</span>: <span class="string">&quot;^13.3.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;vue-loader&quot;</span>: <span class="string">&quot;^17.2.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;vue-router&quot;</span>: <span class="string">&quot;^4.2.4&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;vue-style-loader&quot;</span>: <span class="string">&quot;^4.1.3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;vue-template-compiler&quot;</span>: <span class="string">&quot;^2.7.14&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;webpack&quot;</span>: <span class="string">&quot;^5.88.2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;webpack-cli&quot;</span>: <span class="string">&quot;^5.1.4&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;webpack-dev-server&quot;</span>: <span class="string">&quot;^4.15.1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>main.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createApp&#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;./router&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = createApp(App);</span><br><span class="line">app.use(router)</span><br><span class="line">app.mount(<span class="built_in">document</span>.getElementById(<span class="string">&quot;app&quot;</span>))</span><br></pre></td></tr></table></figure>

<p><code>router/index.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createRouter,createWebHashHistory&#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createRouter(&#123;</span><br><span class="line">    history:createWebHashHistory(),</span><br><span class="line">    routes:[</span><br><span class="line">        &#123;</span><br><span class="line">            path:<span class="string">&quot;/&quot;</span>,</span><br><span class="line">            redirect:<span class="string">&quot;/home&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            path:<span class="string">&quot;/home&quot;</span>,</span><br><span class="line">            component:<span class="function">()=&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;../view/Home&quot;</span>)</span><br><span class="line">        &#125;,&#123;</span><br><span class="line">            path:<span class="string">&quot;/about&quot;</span>,</span><br><span class="line">            component:<span class="function">()=&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;../view/About&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>App.vue</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &lt;li&gt;</span><br><span class="line">      &lt;router-link to&#x3D;&quot;&#x2F;home&quot;&gt;Home&lt;&#x2F;router-link&gt;</span><br><span class="line">    &lt;&#x2F;li&gt;</span><br><span class="line">    &lt;li&gt;</span><br><span class="line">      &lt;router-link to&#x3D;&quot;&#x2F;about&quot;&gt;About&lt;&#x2F;router-link&gt;</span><br><span class="line">    &lt;&#x2F;li&gt;</span><br><span class="line">  &lt;&#x2F;ul&gt;</span><br><span class="line"></span><br><span class="line">  &lt;router-view&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped lang&#x3D;&quot;less&quot;&gt;</span><br><span class="line">ul&#123;</span><br><span class="line">  display: flex;</span><br><span class="line">  flex-direction: column;</span><br><span class="line">  gap: 15px;</span><br><span class="line">  margin: 0;</span><br><span class="line">  padding: 0;</span><br><span class="line">  li&#123;</span><br><span class="line">    margin-left: 0;</span><br><span class="line">    list-style: none;</span><br><span class="line">    line-height: 35px;</span><br><span class="line">    height: 35px;</span><br><span class="line">    background-color: pink;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="22-5-测试运行"><a href="#22-5-测试运行" class="headerlink" title="22.5 测试运行"></a>22.5 测试运行</h3><p>运行测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230827211045139.png" alt="image-20230827211045139"></p>
<p>运行效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230827211057675.png" alt="image-20230827211057675"></p>
<p>打包测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230827222309795.png" alt="image-20230827222309795"></p>
<p>打包后的文件</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230827222407506.png" alt="image-20230827222407506"></p>
<p>运行没问题</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230827222437558.png" alt="image-20230827222437558"></p>
<h3 id="22-6-合并配置"><a href="#22-6-合并配置" class="headerlink" title="22.6 合并配置"></a>22.6 合并配置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> ESLintWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;eslint-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> CssMinimizerPlugin = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> TerserWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> ImageMinimizerPlugin = <span class="built_in">require</span>(<span class="string">&quot;image-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> CopyPlugin = <span class="built_in">require</span>(<span class="string">&quot;copy-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; VueLoaderPlugin &#125; = <span class="built_in">require</span>(<span class="string">&quot;vue-loader&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; DefinePlugin &#125; = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isProduction = process.env.NODE_ENV === <span class="string">&quot;production&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getStyleLoaders = <span class="function">(<span class="params">preProcessor</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        isProduction ? MiniCssExtractPlugin.loader : <span class="string">&quot;vue-style-loader&quot;</span>,</span><br><span class="line">        <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">            loader: <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                postcssOptions: &#123;</span><br><span class="line">                    plugins: [</span><br><span class="line">                        <span class="string">&quot;postcss-preset-env&quot;</span>, <span class="comment">// 能解决大多数样式兼容性问题</span></span><br><span class="line">                    ],</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        preProcessor,</span><br><span class="line">    ].filter(<span class="built_in">Boolean</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// 入口文件</span></span><br><span class="line">    entry: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">// 打包结果输出的位置</span></span><br><span class="line">        path: isProduction ? path.resolve(__dirname,<span class="string">&quot;../dist&quot;</span>) : <span class="literal">undefined</span>,</span><br><span class="line">        <span class="comment">// JS文件打包的命名：文件名.哈希值.js</span></span><br><span class="line">        filename: isProduction ? <span class="string">&quot;static/js/[name].[contenthash:10].js&quot;</span> : <span class="string">&quot;static/js/[name].js&quot;</span>,</span><br><span class="line">        <span class="comment">// 映射文件名</span></span><br><span class="line">        chunkFilename:isProduction ? <span class="string">&quot;static/js/[name].[contenthash:10].chunk.js&quot;</span> : <span class="string">&quot;static/js/[name].chunk.js&quot;</span>,</span><br><span class="line">        <span class="comment">// type:asset loader的文件生成名</span></span><br><span class="line">        assetModuleFilename: <span class="string">&quot;static/asset/[hash:10][ext][query]&quot;</span>,</span><br><span class="line">        <span class="comment">// 自动清理上次打包文件</span></span><br><span class="line">        clean: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 用来匹配 .css 结尾的文件</span></span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="comment">// use 数组里面 Loader 执行顺序是从右到左</span></span><br><span class="line">                use: getStyleLoaders(),</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: getStyleLoaders(<span class="string">&quot;less-loader&quot;</span>),</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.s[ac]ss$/</span>,</span><br><span class="line">                use: getStyleLoaders(<span class="string">&quot;sass-loader&quot;</span>),</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(png|jpe?g|gif|svg)$/</span>,</span><br><span class="line">                type: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">                parser: &#123;</span><br><span class="line">                    dataUrlCondition: &#123;</span><br><span class="line">                        maxSize: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 小于10kb的图片会被base64处理</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(ttf|woff2?)$/</span>,</span><br><span class="line">                type: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(jsx|js)$/</span>,</span><br><span class="line">                include: path.resolve(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">                loader: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    cacheDirectory: <span class="literal">true</span>,</span><br><span class="line">                    cacheCompression: <span class="literal">false</span>,</span><br><span class="line">                    plugins: [</span><br><span class="line">                        <span class="comment">// &quot;@babel/plugin-transform-runtime&quot; // presets中包含了</span></span><br><span class="line">                    ],</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// vue-loader不支持oneOf</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">                loader: <span class="string">&quot;vue-loader&quot;</span>, <span class="comment">// 内部会给vue文件注入HMR功能代码</span></span><br><span class="line">                options: &#123;</span><br><span class="line">                    <span class="comment">// 开启缓存</span></span><br><span class="line">                    cacheDirectory: path.resolve(</span><br><span class="line">                        __dirname,</span><br><span class="line">                        <span class="string">&quot;node_modules/.cache/vue-loader&quot;</span></span><br><span class="line">                    ),</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">// Eslint</span></span><br><span class="line">        <span class="keyword">new</span> ESLintWebpackPlugin(&#123;</span><br><span class="line">            context: path.resolve(__dirname, <span class="string">&quot;../src&quot;</span>),</span><br><span class="line">            exclude: <span class="string">&quot;node_modules&quot;</span>,</span><br><span class="line">            cache: <span class="literal">true</span>,</span><br><span class="line">            cacheLocation: path.resolve(</span><br><span class="line">                __dirname,</span><br><span class="line">                <span class="string">&quot;../node_modules/.cache/.eslintcache&quot;</span></span><br><span class="line">            ),</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 自动引入js</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: path.resolve(__dirname, <span class="string">&quot;../public/index.html&quot;</span>),</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 复制public文件到打包目录中</span></span><br><span class="line">        isProduction &amp;&amp; <span class="keyword">new</span> CopyPlugin(&#123;</span><br><span class="line">            patterns: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">from</span>: path.resolve(__dirname, <span class="string">&quot;../public&quot;</span>),</span><br><span class="line">                    to: path.resolve(__dirname, <span class="string">&quot;../dist&quot;</span>),</span><br><span class="line">                    toType: <span class="string">&quot;dir&quot;</span>,</span><br><span class="line">                    noErrorOnMissing: <span class="literal">true</span>,</span><br><span class="line">                    globOptions: &#123;</span><br><span class="line">                        ignore: [<span class="string">&quot;**/index.html&quot;</span>],</span><br><span class="line">                    &#125;,</span><br><span class="line">                    info: &#123;</span><br><span class="line">                        minimized: <span class="literal">true</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 将CSS单独放在一个文件中</span></span><br><span class="line">        isProduction &amp;&amp; <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: <span class="string">&quot;static/css/[name].[contenthash:10].css&quot;</span>,</span><br><span class="line">            chunkFilename: <span class="string">&quot;static/css/[name].[contenthash:10].chunk.css&quot;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 处理vue</span></span><br><span class="line">        <span class="keyword">new</span> VueLoaderPlugin(),</span><br><span class="line">        <span class="comment">// 处理Vue的警告</span></span><br><span class="line">        <span class="keyword">new</span> DefinePlugin(&#123;</span><br><span class="line">            __VUE_OPTIONS_API__: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">            __VUE_PROD_DEVTOOLS__: <span class="string">&quot;false&quot;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">    ].filter(<span class="built_in">Boolean</span>),</span><br><span class="line">    optimization: &#123;</span><br><span class="line">        minimize: isProduction,</span><br><span class="line">        <span class="comment">// 压缩的操作</span></span><br><span class="line">        minimizer: [</span><br><span class="line">            <span class="comment">// 压缩CSS</span></span><br><span class="line">            <span class="keyword">new</span> CssMinimizerPlugin(),</span><br><span class="line">            <span class="comment">// 提取重复文件</span></span><br><span class="line">            <span class="keyword">new</span> TerserWebpackPlugin(),</span><br><span class="line">            <span class="comment">// 无损压缩图片</span></span><br><span class="line">            <span class="keyword">new</span> ImageMinimizerPlugin(&#123;</span><br><span class="line">                minimizer: &#123;</span><br><span class="line">                    implementation: ImageMinimizerPlugin.imageminGenerate,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        plugins: [</span><br><span class="line">                            [<span class="string">&quot;gifsicle&quot;</span>, &#123; <span class="attr">interlaced</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">                            [<span class="string">&quot;jpegtran&quot;</span>, &#123; <span class="attr">progressive</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">                            [<span class="string">&quot;optipng&quot;</span>, &#123; <span class="attr">optimizationLevel</span>: <span class="number">5</span> &#125;],</span><br><span class="line">                            [</span><br><span class="line">                                <span class="string">&quot;svgo&quot;</span>,</span><br><span class="line">                                &#123;</span><br><span class="line">                                    plugins: [</span><br><span class="line">                                        <span class="string">&quot;preset-default&quot;</span>,</span><br><span class="line">                                        <span class="string">&quot;prefixIds&quot;</span>,</span><br><span class="line">                                        &#123;</span><br><span class="line">                                            name: <span class="string">&quot;sortAttrs&quot;</span>,</span><br><span class="line">                                            params: &#123;</span><br><span class="line">                                                xmlnsOrder: <span class="string">&quot;alphabetical&quot;</span>,</span><br><span class="line">                                            &#125;,</span><br><span class="line">                                        &#125;,</span><br><span class="line">                                    ],</span><br><span class="line">                                &#125;,</span><br><span class="line">                            ],</span><br><span class="line">                        ],</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;),</span><br><span class="line">        ],</span><br><span class="line">        <span class="comment">// 分割代码，重复引用的文件会抽离成单独的文件</span></span><br><span class="line">        splitChunks: &#123;</span><br><span class="line">            chunks: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 缓存</span></span><br><span class="line">        runtimeChunk: &#123;</span><br><span class="line">            name: <span class="function">(<span class="params">entrypoint</span>) =&gt;</span> <span class="string">`runtime~<span class="subst">$&#123;entrypoint.name&#125;</span>`</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 导入文件自动加上后缀</span></span><br><span class="line">    resolve: &#123;</span><br><span class="line">        extensions: [<span class="string">&quot;.vue&quot;</span>, <span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.json&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 模式为开发模式</span></span><br><span class="line">    mode: isProduction ? <span class="string">&quot;production&quot;</span> : <span class="string">&quot;development&quot;</span>,</span><br><span class="line">    <span class="comment">// 报错提示的信息具体到行和列</span></span><br><span class="line">    devtool: isProduction ? <span class="string">&quot;source-map&quot;</span> : <span class="string">&quot;cheap-module-source-map&quot;</span>,</span><br><span class="line">    <span class="comment">// 运行</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        open: <span class="literal">true</span>,</span><br><span class="line">        host: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">        port: <span class="number">3000</span>,</span><br><span class="line">        hot: <span class="literal">true</span>,</span><br><span class="line">        compress: <span class="literal">true</span>,</span><br><span class="line">        historyApiFallback: <span class="literal">true</span>, <span class="comment">// 解决vue-router刷新404问题</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="23-ElementPlus按需导入"><a href="#23-ElementPlus按需导入" class="headerlink" title="23. ElementPlus按需导入"></a>23. ElementPlus按需导入</h2><p>安装 element-plus</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install element-plus --save</span><br></pre></td></tr></table></figure>

<p>安装按需导入的依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -D unplugin-vue-components unplugin-auto-import</span><br></pre></td></tr></table></figure>

<p>配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> AutoImport = <span class="built_in">require</span>(<span class="string">&#x27;unplugin-auto-import/webpack&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> Components = <span class="built_in">require</span>(<span class="string">&#x27;unplugin-vue-components/webpack&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; ElementPlusResolver &#125; = <span class="built_in">require</span>(<span class="string">&#x27;unplugin-vue-components/resolvers&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  plugins: [</span><br><span class="line">    AutoImport(&#123;</span><br><span class="line">      resolvers: [ElementPlusResolver()],</span><br><span class="line">    &#125;),</span><br><span class="line">    Components(&#123;</span><br><span class="line">      resolvers: [ElementPlusResolver()],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后页面中直接使用即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;Home&lt;&#x2F;div&gt;</span><br><span class="line">  &lt;el-button type&#x3D;&quot;primary&quot;&gt;按钮&lt;&#x2F;el-button&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230828220543058.png" alt="image-20230828220543058"></p>
<h2 id="24-loader原理"><a href="#24-loader原理" class="headerlink" title="24. loader原理"></a>24. loader原理</h2><h3 id="24-1-loader概念"><a href="#24-1-loader概念" class="headerlink" title="24.1 loader概念"></a>24.1 loader概念</h3><p>帮助 webpack 将不同类型的文件转换为 webpack 可识别的模块。</p>
<h3 id="24-2-loader的执行顺序"><a href="#24-2-loader的执行顺序" class="headerlink" title="24.2 loader的执行顺序"></a>24.2 loader的执行顺序</h3><ol>
<li>分类</li>
</ol>
<ul>
<li>pre： 前置 loader</li>
<li>normal： 普通 loader</li>
<li>inline： 内联 loader</li>
<li>post： 后置 loader</li>
</ul>
<ol>
<li>执行顺序</li>
</ol>
<ul>
<li>4 类 loader 的执行优级为：<code>pre &gt; normal &gt; inline &gt; post</code> 。</li>
<li>相同优先级的 loader 执行顺序为：<code>从右到左，从下到上</code>。</li>
</ul>
<p>例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此时loader执行顺序：loader3 - loader2 - loader1</span></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      loader: <span class="string">&quot;loader1&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      loader: <span class="string">&quot;loader2&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      loader: <span class="string">&quot;loader3&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此时loader执行顺序：loader1 - loader2 - loader3</span></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      enforce: <span class="string">&quot;pre&quot;</span>,</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      loader: <span class="string">&quot;loader1&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 没有enforce就是normal</span></span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      loader: <span class="string">&quot;loader2&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      enforce: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      loader: <span class="string">&quot;loader3&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="24-3-自定义loader"><a href="#24-3-自定义loader" class="headerlink" title="24.3 自定义loader"></a>24.3 自定义loader</h3><p>初始化项目结构</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MyLoader</span><br><span class="line">├── js</span><br><span class="line">│   └── main.js</span><br><span class="line">├── loader</span><br><span class="line">│   └── test-loader.js</span><br><span class="line">├── src</span><br><span class="line">│   └── index.html</span><br><span class="line">├── package.json</span><br><span class="line">└── webpack.config.js</span><br></pre></td></tr></table></figure>

<p><code>main.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;hello word&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>编写一个简单的loader，<code>test-loader.js</code> 代码如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">content</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;loader打印内容&quot;</span>,content)</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugins = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">&quot;./js/main.js&quot;</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">&quot;dist&quot;</span>),</span><br><span class="line">        filename: <span class="string">&quot;js/[name].[hash:10].js&quot;</span>,</span><br><span class="line">        clean: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                loader: <span class="string">&quot;./loader/test-loader.js&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugins(&#123;</span><br><span class="line">            template:path.resolve(__dirname,<span class="string">&quot;./src/index.html&quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">&quot;development&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后安装依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack webpack-cli html-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<p>然后执行打包命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure>

<p>观察输出</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230831224039986.png" alt="image-20230831224039986"></p>
<p>总结：</p>
<p>loader 接收要处理的文件的源码，在loader内部处理完毕后再返回出去</p>
<h3 id="24-4-同步loader和异步loader"><a href="#24-4-同步loader和异步loader" class="headerlink" title="24.4 同步loader和异步loader"></a>24.4 同步loader和异步loader</h3><p>新建同步loader</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// loader/async/loader1.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">content,map,meta</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;同步loader打印&quot;</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(meta)</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 第一个参数：错误信息，没有就是null，有的话传错误信息</span></span><br><span class="line"><span class="comment">     * content：要处理的源文件信息</span></span><br><span class="line"><span class="comment">     * map：继续传递source-map</span></span><br><span class="line"><span class="comment">     * meta：给下一个loader传递参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">this</span>.callback(<span class="literal">null</span>,content,map,meta)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建异步loader</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// loader/async/loader2.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">content,map,meta</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;异步loader打印&quot;</span>)</span><br><span class="line">    <span class="keyword">let</span> callback = <span class="built_in">this</span>.async()</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 第一个参数：错误信息，没有就是null，有的话传错误信息</span></span><br><span class="line"><span class="comment">     * content：要处理的源文件信息</span></span><br><span class="line"><span class="comment">     * map：继续传递source-map</span></span><br><span class="line"><span class="comment">     * meta：给下一个loader传递参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        callback(<span class="literal">null</span>,content,map, &#123;</span><br><span class="line">            name:<span class="string">&quot;我是来自异步loader的参数&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,<span class="number">2000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugins = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">&quot;./js/main.js&quot;</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">&quot;dist&quot;</span>),</span><br><span class="line">        filename: <span class="string">&quot;js/[name].[hash:10].js&quot;</span>,</span><br><span class="line">        clean: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            <span class="comment">// &#123;</span></span><br><span class="line">            <span class="comment">//     test: /\.js$/,</span></span><br><span class="line">            <span class="comment">//     loader: &quot;./loader/test-loader.js&quot;</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.js$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="string">&quot;./loader/async/loader1.js&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;./loader/async/loader2.js&quot;</span>,</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugins(&#123;</span><br><span class="line">            template:path.resolve(__dirname,<span class="string">&quot;./src/index.html&quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">&quot;development&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打包输出结果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230831230039876.png" alt="image-20230831230039876"></p>
<h3 id="24-5-raw-loader"><a href="#24-5-raw-loader" class="headerlink" title="24.5 raw loader"></a>24.5 raw loader</h3><p>raw loader接收到的文件时Buffer数据，一般用来处理图片，字体等文件</p>
<p>定义 raw-loader</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// loader/raw/raw-loader.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">content</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(content)</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 暴露raw为true，表示这个是raw loader</span></span><br><span class="line"><span class="built_in">module</span>.exports.raw = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugins = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">&quot;./js/main.js&quot;</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">&quot;dist&quot;</span>),</span><br><span class="line">        filename: <span class="string">&quot;js/[name].[hash:10].js&quot;</span>,</span><br><span class="line">        clean: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            <span class="comment">// &#123;</span></span><br><span class="line">            <span class="comment">//     test: /\.js$/,</span></span><br><span class="line">            <span class="comment">//     loader: &quot;./loader/test-loader.js&quot;</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            <span class="comment">// &#123;</span></span><br><span class="line">            <span class="comment">//     test:/\.js$/,</span></span><br><span class="line">            <span class="comment">//     use: [</span></span><br><span class="line">            <span class="comment">//         &quot;./loader/async/loader1.js&quot;,</span></span><br><span class="line">            <span class="comment">//         &quot;./loader/async/loader2.js&quot;,</span></span><br><span class="line">            <span class="comment">//     ]</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                loader: <span class="string">&quot;./loader/raw/raw-loader.js&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugins(&#123;</span><br><span class="line">            template:path.resolve(__dirname,<span class="string">&quot;./src/index.html&quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">&quot;development&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查看输出</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230831230842737.png" alt="image-20230831230842737"></p>
<h3 id="24-6-pitch-loader"><a href="#24-6-pitch-loader" class="headerlink" title="24.6 pitch loader"></a>24.6 pitch loader</h3><p>pitch loader会在 normal 之前执行，并且当存在多个 pitch loader 时执行的循序和normal loader循序相反，从左往右，从上到下</p>
<p>定义 pitch loader1</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// loader/pitch/pitch1.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">content</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;pitch-normal-1&quot;</span>,content)</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.pitch = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;pitch1&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义 pitch loader2</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// loader/pitch/pitch1.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">content</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;pitch-normal-2&quot;</span>,content)</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.pitch = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;pitch2&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugins = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">&quot;./js/main.js&quot;</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">&quot;dist&quot;</span>),</span><br><span class="line">        filename: <span class="string">&quot;js/[name].[hash:10].js&quot;</span>,</span><br><span class="line">        clean: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            <span class="comment">// &#123;</span></span><br><span class="line">            <span class="comment">//     test: /\.js$/,</span></span><br><span class="line">            <span class="comment">//     loader: &quot;./loader/test-loader.js&quot;</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            <span class="comment">// &#123;</span></span><br><span class="line">            <span class="comment">//     test:/\.js$/,</span></span><br><span class="line">            <span class="comment">//     use: [</span></span><br><span class="line">            <span class="comment">//         &quot;./loader/async/loader1.js&quot;,</span></span><br><span class="line">            <span class="comment">//         &quot;./loader/async/loader2.js&quot;,</span></span><br><span class="line">            <span class="comment">//     ]</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            <span class="comment">// &#123;</span></span><br><span class="line">            <span class="comment">//     test: /\.js$/,</span></span><br><span class="line">            <span class="comment">//     loader: &quot;./loader/raw/raw-loader.js&quot;</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.js$/</span>,</span><br><span class="line">                use:[</span><br><span class="line">                    <span class="string">&quot;./loader/pitch/pitch1.js&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;./loader/pitch/pitch2.js&quot;</span>,</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugins(&#123;</span><br><span class="line">            template:path.resolve(__dirname,<span class="string">&quot;./src/index.html&quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">&quot;development&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行打包输出结果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230902095630023.png" alt="image-20230902095630023"></p>
<p>通过结果可以看到先执行 pitch1 和 pitch2 方法，再接着执行 normal loader 方法</p>
<p>当在一个 pitch loader 中添加的 return 时，会终止后面的 pitch 方法和 normal loader 方法，然后把之前的 normal loader 方法执行完</p>
<p>例如，再新建一个 pitch3</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">content</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;pitch-normal-3&quot;</span>,content)</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.pitch = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;pitch3&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后修改 pitch2</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">content</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;pitch-normal-2&quot;</span>,content)</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.pitch = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;pitch2&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;pitch2&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.js$/</span>,</span><br><span class="line">                use:[</span><br><span class="line">                    <span class="string">&quot;./loader/pitch/pitch1.js&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;./loader/pitch/pitch2.js&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;./loader/pitch/pitch3.js&quot;</span>,</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行打包效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230902100354552.png" alt="image-20230902100354552"></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230902100748081.png" alt="image-20230902100748081"></p>
<p>执行流程图如上</p>
<h3 id="24-7-loader-Api"><a href="#24-7-loader-Api" class="headerlink" title="24.7. loader Api"></a>24.7. loader Api</h3><table>
<thead>
<tr>
<th>方法名</th>
<th>含义</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>this.async</td>
<td>异步回调 loader。返回 this.callback</td>
<td>const callback = this.async()</td>
</tr>
<tr>
<td>this.callback</td>
<td>可以同步或者异步调用的并返回多个结果的函数</td>
<td>this.callback(err, content, sourceMap?, meta?)</td>
</tr>
<tr>
<td>this.getOptions(schema)</td>
<td>获取 loader 的 options</td>
<td>this.getOptions(schema)</td>
</tr>
<tr>
<td>this.emitFile</td>
<td>产生一个文件</td>
<td>this.emitFile(name, content, sourceMap)</td>
</tr>
<tr>
<td>this.utils.contextify</td>
<td>返回一个相对路径</td>
<td>this.utils.contextify(context, request)</td>
</tr>
<tr>
<td>this.utils.absolutify</td>
<td>返回一个绝对路径</td>
<td>this.utils.absolutify(context, request)</td>
</tr>
</tbody></table>
<blockquote>
<p>更多文档，请查阅 <a target="_blank" rel="noopener" href="https://webpack.docschina.org/api/loaders/#the-loader-context">webpack 官方 loader api 文档</a></p>
</blockquote>
<h2 id="25-自实现loader"><a href="#25-自实现loader" class="headerlink" title="25. 自实现loader"></a>25. 自实现loader</h2><h3 id="25-1-clear-log-loader"><a href="#25-1-clear-log-loader" class="headerlink" title="25.1 clear-log-loader"></a>25.1 clear-log-loader</h3><p>在项目开发阶段我们会使用 console.log 打印信息，但是到生产环境后我们不需要这个 log 打印。所以可以通过 loader 在打包时将 console.log 去掉</p>
<p>新建 <code>clear-log-loader.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">content</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> content.replace(<span class="regexp">/console\.log\(.*\);?/g</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.js$/</span>,</span><br><span class="line">                loader: <span class="string">&quot;./loader/clear-log-loader.js&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="25-2-给loader添加options参数"><a href="#25-2-给loader添加options参数" class="headerlink" title="25.2 给loader添加options参数"></a>25.2 给loader添加options参数</h3><p>上面的 loader 中我们通过 option 添加一个  enable 属性，俩控制是否清除 log</p>
<p>首先在 loader 中添加 enable 配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test:<span class="regexp">/\.js$/</span>,</span><br><span class="line">                loader: <span class="string">&quot;./loader/clear-log-loader.js&quot;</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    enable:<span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 clear-log-loader.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义loader options属性的规则约束</span></span><br><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line">    <span class="comment">// options的类型是一个object</span></span><br><span class="line">    type:<span class="string">&quot;object&quot;</span>,</span><br><span class="line">    <span class="comment">// 定义options中的属性有哪些</span></span><br><span class="line">    properties:&#123;</span><br><span class="line">        <span class="comment">// 有enable属性</span></span><br><span class="line">        enable:&#123;</span><br><span class="line">            <span class="comment">// enable属性是一个布尔值</span></span><br><span class="line">            type:<span class="string">&quot;boolean&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 不允许使用未定义的属性</span></span><br><span class="line">    additionalProperties:<span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">content</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// this.getOptions 获取配置项</span></span><br><span class="line">    <span class="keyword">let</span> &#123;enable&#125; = <span class="built_in">this</span>.getOptions(schema)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> enable ? content.replace(<span class="regexp">/console\.log\(.*\);?/g</span>,<span class="string">&quot;&quot;</span>) : content</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个时候我们配置的enable值是false，所以打包后文件是有log的</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230902111210143.png" alt="image-20230902111210143"></p>
<p>我们改成 true，再次打包，log就没有了</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230902111245817.png" alt="image-20230902111245817"></p>
<h3 id="25-3-自实现babel-loader"><a href="#25-3-自实现babel-loader" class="headerlink" title="25.3 自实现babel-loader"></a>25.3 自实现babel-loader</h3><blockquote>
<p>babel 官网：<a target="_blank" rel="noopener" href="https://www.babeljs.cn/">Babel 中文文档 | Babel中文网 · Babel 中文文档 | Babel中文网 (babeljs.cn)</a></p>
</blockquote>
<p>将代码转成ES5语法</p>
<p>安装</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @babel/core @babel/preset-env -D</span><br></pre></td></tr></table></figure>

<p>新建 babel-loader.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;presets&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;array&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;additionalProperties&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">&quot;@babel/core&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">content</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> options = <span class="built_in">this</span>.getOptions(schema);</span><br><span class="line">    <span class="comment">// 使用异步loader</span></span><br><span class="line">    <span class="keyword">const</span> callback = <span class="built_in">this</span>.async();</span><br><span class="line">    <span class="comment">// 使用babel对js代码进行编译</span></span><br><span class="line">    babel.transform(content, options, <span class="function"><span class="keyword">function</span> (<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">        callback(err, result.code);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>wabpack配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rules:[</span><br><span class="line">    &#123;</span><br><span class="line">        test:<span class="regexp">/\.js$/</span>,</span><br><span class="line">        loader: <span class="string">&quot;./loader/babel-loader.js&quot;</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            presets:[<span class="string">&quot;@babel/preset-env&quot;</span>],</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="25-4-file-loader"><a href="#25-4-file-loader" class="headerlink" title="25.4 file-loader"></a>25.4 file-loader</h3><p>将文件原封不动的输出</p>
<p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i loader-utils -D</span><br></pre></td></tr></table></figure>

<p><code>file-loader</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loaderUtils = <span class="built_in">require</span>(<span class="string">&quot;loader-utils&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">content</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 根据文件内容自动生成文件名</span></span><br><span class="line">    <span class="keyword">const</span> interpolatedName = loaderUtils.interpolateName(</span><br><span class="line">        <span class="built_in">this</span>,</span><br><span class="line">        <span class="string">&quot;asset/[name].[hash].[ext]&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 文件内容</span></span><br><span class="line">            content:content</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将文件输出出去</span></span><br><span class="line">    <span class="built_in">this</span>.emitFile(interpolatedName,content)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回 module.export = &quot;文件路径/文件名&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`module.exports = &quot;<span class="subst">$&#123;interpolatedName&#125;</span>&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.raw = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rules:[</span><br><span class="line">    &#123;</span><br><span class="line">        test:<span class="regexp">/\.(png|jpg)$/</span>,</span><br><span class="line">        loader: <span class="string">&quot;./loader/file-loader.js&quot;</span>,</span><br><span class="line">        type:<span class="string">&quot;javascript/auto&quot;</span> <span class="comment">// 阻止默认的asset打包配置</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="26-Plugin原理"><a href="#26-Plugin原理" class="headerlink" title="26. Plugin原理"></a>26. Plugin原理</h2><h3 id="Plugin-的作用"><a href="#Plugin-的作用" class="headerlink" title="Plugin 的作用"></a>Plugin 的作用</h3><p>通过插件我们可以扩展 webpack，加入自定义的构建行为，使 webpack 可以执行更广泛的任务，拥有更强的构建能力。</p>
<h3 id="Plugin-工作原理"><a href="#Plugin-工作原理" class="headerlink" title="Plugin 工作原理"></a>Plugin 工作原理</h3><blockquote>
<p>webpack 就像一条生产线，要经过一系列处理流程后才能将源文件转换成输出结果。 这条生产线上的每个处理流程的职责都是单一的，多个流程之间有存在依赖关系，只有完成当前处理后才能交给下一个流程去处理。 插件就像是一个插入到生产线中的一个功能，在特定的时机对生产线上的资源做处理。webpack 通过 Tapable 来组织这条复杂的生产线。 webpack 在运行过程中会广播事件，插件只需要监听它所关心的事件，就能加入到这条生产线中，去改变生产线的运作。 webpack 的事件流机制保证了插件的有序性，使得整个系统扩展性很好。 ——「深入浅出 Webpack」</p>
</blockquote>
<p>站在代码逻辑的角度就是：webpack 在编译代码过程中，会触发一系列 <code>Tapable</code> 钩子事件，插件所做的，就是找到相应的钩子，往上面挂上自己的任务，也就是注册事件，这样，当 webpack 构建的时候，插件注册的事件就会随着钩子的触发而执行了。</p>
<h3 id="Webpack-内部的钩子"><a href="#Webpack-内部的钩子" class="headerlink" title="Webpack 内部的钩子"></a>Webpack 内部的钩子</h3><h4 id="什么是钩子"><a href="#什么是钩子" class="headerlink" title="什么是钩子"></a>什么是钩子</h4><p>钩子的本质就是：事件。为了方便我们直接介入和控制编译过程，webpack 把编译过程中触发的各类关键事件封装成事件接口暴露了出来。这些接口被很形象地称做：<code>hooks</code>（钩子）。开发插件，离不开这些钩子。</p>
<h4 id="Tapable"><a href="#Tapable" class="headerlink" title="Tapable"></a>Tapable</h4><p><code>Tapable</code> 为 webpack 提供了统一的插件接口（钩子）类型定义，它是 webpack 的核心功能库。webpack 中目前有十种 <code>hooks</code>，在 <code>Tapable</code> 源码中可以看到，他们是：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://github.com/webpack/tapable/blob/master/lib/index.js</span></span><br><span class="line"><span class="built_in">exports</span>.SyncHook = <span class="built_in">require</span>(<span class="string">&quot;./SyncHook&quot;</span>);</span><br><span class="line"><span class="built_in">exports</span>.SyncBailHook = <span class="built_in">require</span>(<span class="string">&quot;./SyncBailHook&quot;</span>);</span><br><span class="line"><span class="built_in">exports</span>.SyncWaterfallHook = <span class="built_in">require</span>(<span class="string">&quot;./SyncWaterfallHook&quot;</span>);</span><br><span class="line"><span class="built_in">exports</span>.SyncLoopHook = <span class="built_in">require</span>(<span class="string">&quot;./SyncLoopHook&quot;</span>);</span><br><span class="line"><span class="built_in">exports</span>.AsyncParallelHook = <span class="built_in">require</span>(<span class="string">&quot;./AsyncParallelHook&quot;</span>);</span><br><span class="line"><span class="built_in">exports</span>.AsyncParallelBailHook = <span class="built_in">require</span>(<span class="string">&quot;./AsyncParallelBailHook&quot;</span>);</span><br><span class="line"><span class="built_in">exports</span>.AsyncSeriesHook = <span class="built_in">require</span>(<span class="string">&quot;./AsyncSeriesHook&quot;</span>);</span><br><span class="line"><span class="built_in">exports</span>.AsyncSeriesBailHook = <span class="built_in">require</span>(<span class="string">&quot;./AsyncSeriesBailHook&quot;</span>);</span><br><span class="line"><span class="built_in">exports</span>.AsyncSeriesLoopHook = <span class="built_in">require</span>(<span class="string">&quot;./AsyncSeriesLoopHook&quot;</span>);</span><br><span class="line"><span class="built_in">exports</span>.AsyncSeriesWaterfallHook = <span class="built_in">require</span>(<span class="string">&quot;./AsyncSeriesWaterfallHook&quot;</span>);</span><br><span class="line"><span class="built_in">exports</span>.HookMap = <span class="built_in">require</span>(<span class="string">&quot;./HookMap&quot;</span>);</span><br><span class="line"><span class="built_in">exports</span>.MultiHook = <span class="built_in">require</span>(<span class="string">&quot;./MultiHook&quot;</span>);</span><br></pre></td></tr></table></figure>



<p><code>Tapable</code> 还统一暴露了三个方法给插件，用于注入不同类型的自定义构建行为：</p>
<ul>
<li><code>tap</code>：可以注册同步钩子和异步钩子。</li>
<li><code>tapAsync</code>：回调方式注册异步钩子。</li>
<li><code>tapPromise</code>：Promise 方式注册异步钩子。</li>
</ul>
<h3 id="Plugin-构建对象"><a href="#Plugin-构建对象" class="headerlink" title="Plugin 构建对象"></a>Plugin 构建对象</h3><h4 id="Compiler"><a href="#Compiler" class="headerlink" title="Compiler"></a>Compiler</h4><p>compiler 对象中保存着完整的 Webpack 环境配置，每次启动 webpack 构建时它都是一个独一无二，仅仅会创建一次的对象。</p>
<p>这个对象会在首次启动 Webpack 时创建，我们可以通过 compiler 对象上访问到 Webapck 的主环境配置，比如 loader 、 plugin 等等配置信息。</p>
<p>它有以下主要属性：</p>
<ul>
<li><code>compiler.options</code> 可以访问本次启动 webpack 时候所有的配置文件，包括但不限于 loaders 、 entry 、 output 、 plugin 等等完整配置信息。</li>
<li><code>compiler.inputFileSystem</code> 和 <code>compiler.outputFileSystem</code> 可以进行文件操作，相当于 Nodejs 中 fs。</li>
<li><code>compiler.hooks</code> 可以注册 tapable 的不同种类 Hook，从而可以在 compiler 生命周期中植入不同的逻辑。</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/api/compiler-hooks/">compiler hooks 文档open in new window</a></p>
</blockquote>
<h4 id="Compilation"><a href="#Compilation" class="headerlink" title="Compilation"></a>Compilation</h4><p>compilation 对象代表一次资源的构建，compilation 实例能够访问所有的模块和它们的依赖。</p>
<p>一个 compilation 对象会对构建依赖图中所有模块，进行编译。 在编译阶段，模块会被加载(load)、封存(seal)、优化(optimize)、 分块(chunk)、哈希(hash)和重新创建(restore)。</p>
<p>它有以下主要属性：</p>
<ul>
<li><code>compilation.modules</code> 可以访问所有模块，打包的每一个文件都是一个模块。</li>
<li><code>compilation.chunks</code> chunk 即是多个 modules 组成而来的一个代码块。入口文件引入的资源组成一个 chunk，通过代码分割的模块又是另外的 chunk。</li>
<li><code>compilation.assets</code> 可以访问本次打包生成所有文件的结果。</li>
<li><code>compilation.hooks</code> 可以注册 tapable 的不同种类 Hook，用于在 compilation 编译模块阶段进行逻辑添加以及修改。</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/api/compilation-hooks/">compilation hooks 文档open in new window</a></p>
</blockquote>
<h3 id="生命周期简图"><a href="#生命周期简图" class="headerlink" title="生命周期简图"></a>生命周期简图</h3><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/plugin.jpg" style="zoom:50%;" />

<h2 id="27-自实现Plugin"><a href="#27-自实现Plugin" class="headerlink" title="27. 自实现Plugin"></a>27. 自实现Plugin</h2><h3 id="27-1-TestPlugin"><a href="#27-1-TestPlugin" class="headerlink" title="27.1 TestPlugin"></a>27.1 TestPlugin</h3><p>plugin都是一个构造函数，所以我们采用es6的class语法来自定义Plugin</p>
<p>webpack 在打包过程中触发 plugin 中的 apply 方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestPlugin</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;TestPlugin constructor&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">apply</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;TestPlugin apply&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = TestPlugin</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugins = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> TestPlugin = <span class="built_in">require</span>(<span class="string">&quot;./plugins/test-plugin&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugins(&#123;</span><br><span class="line">            template:path.resolve(__dirname,<span class="string">&quot;./src/index.html&quot;</span>)</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> TestPlugin()</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">&quot;development&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打包的时候会先输出plugin中的内容</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230902173132814.png" alt="image-20230902173132814"></p>
<h3 id="27-2-注册hook"><a href="#27-2-注册hook" class="headerlink" title="27.2 注册hook"></a>27.2 注册hook</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestPlugin</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;TestPlugin constructor&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">apply</span>(<span class="params">compiler</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;TestPlugin apply&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从文档可知, compile hook 是 SyncHook, 也就是同步钩子, 只能用tap注册</span></span><br><span class="line">        compiler.hooks.compile.tap(<span class="string">&quot;TestPlugin&quot;</span>, <span class="function">(<span class="params">compilationParams</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;compiler.compile()&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从文档可知, make 是 AsyncParallelHook, 也就是异步并行钩子, 特点就是异步任务同时执行</span></span><br><span class="line">        <span class="comment">// 可以使用 tap、tapAsync、tapPromise 注册。</span></span><br><span class="line">        <span class="comment">// 如果使用tap注册的话，进行异步操作是不会等待异步操作执行完成的。</span></span><br><span class="line">        compiler.hooks.make.tap(<span class="string">&quot;TestPlugin&quot;</span>, <span class="function">(<span class="params">compilation</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;compiler.make() 111&quot;</span>);</span><br><span class="line">            &#125;, <span class="number">2000</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用tapAsync、tapPromise注册，进行异步操作会等异步操作做完再继续往下执行</span></span><br><span class="line">        compiler.hooks.make.tapAsync(<span class="string">&quot;TestPlugin&quot;</span>, <span class="function">(<span class="params">compilation, callback</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;compiler.make() 222&quot;</span>);</span><br><span class="line">                <span class="comment">// 必须调用</span></span><br><span class="line">                callback();</span><br><span class="line">            &#125;, <span class="number">1000</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        compiler.hooks.make.tapPromise(<span class="string">&quot;TestPlugin&quot;</span>, <span class="function">(<span class="params">compilation</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;compiler.make() 333&quot;</span>);</span><br><span class="line">            <span class="comment">// 必须返回promise</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">                resolve();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从文档可知, emit 是 AsyncSeriesHook, 也就是异步串行钩子，特点就是异步任务顺序执行</span></span><br><span class="line">        compiler.hooks.emit.tapAsync(<span class="string">&quot;TestPlugin&quot;</span>, <span class="function">(<span class="params">compilation, callback</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;compiler.emit() 111&quot;</span>);</span><br><span class="line">                callback();</span><br><span class="line">            &#125;, <span class="number">3000</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        compiler.hooks.emit.tapAsync(<span class="string">&quot;TestPlugin&quot;</span>, <span class="function">(<span class="params">compilation, callback</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;compiler.emit() 222&quot;</span>);</span><br><span class="line">                callback();</span><br><span class="line">            &#125;, <span class="number">2000</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        compiler.hooks.emit.tapAsync(<span class="string">&quot;TestPlugin&quot;</span>, <span class="function">(<span class="params">compilation, callback</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;compiler.emit() 333&quot;</span>);</span><br><span class="line">                callback();</span><br><span class="line">            &#125;, <span class="number">1000</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = TestPlugin</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230902210225146.png" alt="image-20230902210225146"></p>
<h3 id="27-3-添加node调试命令"><a href="#27-3-添加node调试命令" class="headerlink" title="27.3 添加node调试命令"></a>27.3 添加node调试命令</h3><p>在plugin中添加 debugger</p>
<p>然后添加 <code>package.json</code> 添加调试启动命令</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;debug&quot;: &quot;node --inspect-brk ./node_modules/webpack-cli/bin/cli.js&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run debug</span><br></pre></td></tr></table></figure>

<p>然后随便一个页面打开浏览器的控制台，点击 node 图标</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230902212955581.png" alt="image-20230902212955581"></p>
<p>点击后会跳转一个新页面，默认是在程序第一行打断点，我们点击下一步跳转到下一个断点即可跳转到我们打断点的位置</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230902213024409.png" alt="image-20230902213024409"></p>
<h3 id="27-4-BannerWebpackPlugin"><a href="#27-4-BannerWebpackPlugin" class="headerlink" title="27.4 BannerWebpackPlugin"></a>27.4 BannerWebpackPlugin</h3><p>作用，给打包生成的文件添加作者信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BannerWebpackPlugin</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">options</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.options = options;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">apply</span>(<span class="params">compile</span>)</span>&#123;</span><br><span class="line">        compile.hooks.emit.tapAsync(<span class="string">&quot;BannerWebpackPlugin&quot;</span>,<span class="function">(<span class="params">compilation,callback</span>)=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 得到将要输出的文件，只获取JS和CSS</span></span><br><span class="line">            <span class="keyword">const</span> assetPaths = <span class="built_in">Object</span>.keys(compilation.assets).filter(<span class="function"><span class="params">assetsFile</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">let</span> extensions  = [<span class="string">&quot;js&quot;</span>,<span class="string">&quot;css&quot;</span>]</span><br><span class="line">                <span class="keyword">let</span> splits = assetsFile.split(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">                <span class="keyword">let</span> splitEd = splits[splits.length - <span class="number">1</span>]</span><br><span class="line">                <span class="keyword">return</span> extensions.includes(splitEd)</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">debugger</span></span><br><span class="line"></span><br><span class="line">            assetPaths.forEach(<span class="function"><span class="params">path</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="comment">// 得到文件本身</span></span><br><span class="line">                <span class="keyword">const</span> asset = compilation.assets[path]</span><br><span class="line"><span class="comment">// 要添加的注释信息</span></span><br><span class="line"><span class="keyword">const</span> newSource = <span class="string">`/**</span></span><br><span class="line"><span class="string"> * author：<span class="subst">$&#123;<span class="built_in">this</span>.options.auther&#125;</span></span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string"> <span class="subst">$&#123;asset.source()&#125;</span></span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">                <span class="comment">// 覆盖资源</span></span><br><span class="line">                compilation.assets[path] = &#123;</span><br><span class="line">                    <span class="comment">// 返回新的资源</span></span><br><span class="line">                    <span class="function"><span class="title">source</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> newSource</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="comment">// 返回新的大小</span></span><br><span class="line">                    <span class="function"><span class="title">size</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> newSource.length</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            callback()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = BannerWebpackPlugin</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugins = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> BannerWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;./plugins/banner-webpack-plugin&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">&quot;./js/main.js&quot;</span>,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugins(&#123;</span><br><span class="line">            template:path.resolve(__dirname,<span class="string">&quot;./src/index.html&quot;</span>)</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> BannerWebpackPlugin(&#123;</span><br><span class="line">            auther:<span class="string">&quot;SongZX&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">&quot;production&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打包后的效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230902230032368.png" alt="image-20230902230032368"></p>
<h3 id="27-5-CleanWebpackPlugin"><a href="#27-5-CleanWebpackPlugin" class="headerlink" title="27.5 CleanWebpackPlugin"></a>27.5 CleanWebpackPlugin</h3><p>打包前删除旧的打包文件</p>
<p>添加 <code>clean-webpack-plugin.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CleanWebpackPlugin</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">apply</span>(<span class="params">compiler</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取打包输出的目的地址</span></span><br><span class="line">        <span class="keyword">let</span> outputPath = compiler.options.output.path;</span><br><span class="line">        <span class="comment">// 获取操作文件的对象</span></span><br><span class="line">        <span class="keyword">let</span> fs = compiler.outputFileSystem;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注册钩子，在文件输出前执行删除旧文件操作</span></span><br><span class="line">        compiler.hooks.emit.tap(<span class="string">&quot;CleanWebpackPlugin&quot;</span>,<span class="function">(<span class="params">compilation</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="comment">// 通过fs删除打包目录下的所有文件</span></span><br><span class="line">            <span class="built_in">this</span>.removeFiles(fs,outputPath)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">removeFiles</span>(<span class="params">fs,filePath</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 读取指定文件夹下的文件内容，得到的是一个数组</span></span><br><span class="line">        <span class="keyword">let</span> files = fs.readdirSync(filePath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 遍历文件一个个删除</span></span><br><span class="line">        files.forEach(<span class="function"><span class="params">fileName</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="comment">// 得到文件全路径</span></span><br><span class="line">            <span class="keyword">let</span> path = <span class="string">`<span class="subst">$&#123;filePath&#125;</span>/<span class="subst">$&#123;fileName&#125;</span>`</span></span><br><span class="line">            <span class="comment">// 判断是否是文件夹</span></span><br><span class="line">            <span class="keyword">let</span> stats = fs.statSync(path);</span><br><span class="line">            <span class="comment">// isDirectory方法用来判断是否是文件夹</span></span><br><span class="line">            <span class="keyword">if</span>(stats.isDirectory())&#123;</span><br><span class="line">                <span class="built_in">this</span>.removeFiles(fs,path)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                fs.unlinkSync(path)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = CleanWebpackPlugin</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugins = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> TestPlugin = <span class="built_in">require</span>(<span class="string">&quot;./plugins/test-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> BannerWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;./plugins/banner-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;./plugins/clean-webpack-plugin&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">&quot;./js/main.js&quot;</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">&quot;dist&quot;</span>),</span><br><span class="line">        filename: <span class="string">&quot;js/[name].[hash:10].js&quot;</span>,</span><br><span class="line">        clean: <span class="literal">false</span>, <span class="comment">// 关闭默认的删除文件</span></span><br><span class="line">        assetModuleFilename: <span class="string">&quot;asset/[name].[hash:10][ext]&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugins(&#123;</span><br><span class="line">            template:path.resolve(__dirname,<span class="string">&quot;./src/index.html&quot;</span>)</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// new TestPlugin()</span></span><br><span class="line">        <span class="keyword">new</span> BannerWebpackPlugin(&#123;</span><br><span class="line">            auther:<span class="string">&quot;SongZX&quot;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 使用自定义的删除文件插件</span></span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin()</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">&quot;production&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="27-6-AnalyzeWebpackPlugin"><a href="#27-6-AnalyzeWebpackPlugin" class="headerlink" title="27.6 AnalyzeWebpackPlugin"></a>27.6 AnalyzeWebpackPlugin</h3><p>在打包时自动生成一个分析文件大小的 md 文件</p>
<p>新建 <code>analyze-webpack-plugin.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnalyzeWebpackPlugin</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">apply</span>(<span class="params">compiler</span>)</span>&#123;</span><br><span class="line">        compiler.hooks.emit.tap(<span class="string">&quot;AnalyzeWebpackPlugin&quot;</span>,<span class="function">(<span class="params">compilation</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="comment">// 获取即将输出的文件</span></span><br><span class="line">            <span class="keyword">let</span> assets = <span class="built_in">Object</span>.entries(compilation.assets)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> content = <span class="string">`| 文件名称 | 文件大小 |</span></span><br><span class="line"><span class="string">| ------ | ------ |`</span></span><br><span class="line">            assets.forEach(<span class="function">(<span class="params">[fileName,file]</span>)=&gt;</span>&#123;</span><br><span class="line">                content += <span class="string">`\n|<span class="subst">$&#123;fileName&#125;</span>|<span class="subst">$&#123;<span class="built_in">Math</span>.ceil(file.size()/<span class="number">1024</span>)&#125;</span>kb|`</span></span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 覆盖资源</span></span><br><span class="line">            compilation.assets[<span class="string">&#x27;analyze.md&#x27;</span>] = &#123;</span><br><span class="line">                <span class="comment">// 返回新的资源</span></span><br><span class="line">                <span class="function"><span class="title">source</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> content</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">// 返回新的大小</span></span><br><span class="line">                <span class="function"><span class="title">size</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> content.length</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = AnalyzeWebpackPlugin</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugins = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> TestPlugin = <span class="built_in">require</span>(<span class="string">&quot;./plugins/test-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> BannerWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;./plugins/banner-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;./plugins/clean-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> AnalyzeWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;./plugins/analyze-webpack-plugin&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">&quot;./js/main.js&quot;</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname,<span class="string">&quot;dist&quot;</span>),</span><br><span class="line">        filename: <span class="string">&quot;js/[name].[hash:10].js&quot;</span>,</span><br><span class="line">        clean: <span class="literal">false</span>,</span><br><span class="line">        assetModuleFilename: <span class="string">&quot;asset/[name].[hash:10][ext]&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugins(&#123;</span><br><span class="line">            template:path.resolve(__dirname,<span class="string">&quot;./src/index.html&quot;</span>)</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// new TestPlugin()</span></span><br><span class="line">        <span class="keyword">new</span> BannerWebpackPlugin(&#123;</span><br><span class="line">            auther:<span class="string">&quot;SongZX&quot;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">        <span class="keyword">new</span> AnalyzeWebpackPlugin()</span><br><span class="line">    ],</span><br><span class="line">    mode: <span class="string">&quot;production&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20230903144121290.png" alt="image-20230903144121290"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">SZX</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://songzx0106.github.io/webpack/webpack5/">https://songzx0106.github.io/webpack/webpack5/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://SongZX0106.github.io" target="_blank">SZX的开发笔记</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/webpack/">webpack</a></div><div class="post_share"><div class="social-share" data-image="/images/ys05.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/share.min.css" media="print" onload="this.media='all'"><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/images/wechat.png" target="_blank"><img class="post-qr-code-img" data-lazy-src="/images/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/images/alipay.jpg" target="_blank"><img class="post-qr-code-img" data-lazy-src="/images/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/Vue/20230915/"><img class="prev-cover" data-lazy-src="/images/ys06.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">实现瀑布流布局</div></div></a></div><div class="next-post pull-right"><a href="/Vue/20230823/"><img class="next-cover" data-lazy-src="/images/ys14.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Vue自定义好用的指令</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/Tool/webpack/" title="webpack实现前端工程化"><img class="cover" data-lazy-src="/images/ys03.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-12</div><div class="title">webpack实现前端工程化</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="/images/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">SZX</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">153</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://gitee.com/szxio"><i class="iconfont icon-gitee-fill-round"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">welcome to my blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">1. 简单使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 搭建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E7%BC%96%E5%86%99JS%E4%BB%A3%E7%A0%81"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 编写JS代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E8%BF%90%E8%A1%8C%E4%BB%A3%E7%A0%81"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 运行代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BE%9D%E8%B5%96"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 初始化依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-%E5%90%AF%E5%8A%A8webpack"><span class="toc-number">1.5.</span> <span class="toc-text">1.5 启动webpack</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-number">2.</span> <span class="toc-text">2. 基本配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-5%E5%A4%A7%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 5大核心概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 基础配置文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%A4%84%E7%90%86%E6%A0%B7%E5%BC%8F%E8%B5%84%E6%BA%90"><span class="toc-number">3.</span> <span class="toc-text">3. 处理样式资源</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%A4%84%E7%90%86CSS%E8%B5%84%E6%BA%90"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 处理CSS资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%A4%84%E7%90%86Less%E8%B5%84%E6%BA%90"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 处理Less资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%A4%84%E7%90%86Scss%E8%B5%84%E6%BA%90"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 处理Scss资源</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%A4%84%E7%90%86%E5%9B%BE%E7%89%87%E8%B5%84%E6%BA%90"><span class="toc-number">4.</span> <span class="toc-text">4. 处理图片资源</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%9B%BE%E7%89%87%E8%BD%ACBase64"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 图片转Base64</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6%E8%BE%93%E5%87%BA%E5%9C%B0%E5%9D%80"><span class="toc-number">5.</span> <span class="toc-text">5. 修改文件输出地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E8%87%AA%E5%8A%A8%E6%B8%85%E7%A9%BA%E4%B8%8A%E6%AC%A1%E6%89%93%E5%8C%85%E6%96%87%E4%BB%B6"><span class="toc-number">6.</span> <span class="toc-text">6. 自动清空上次打包文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%A4%84%E7%90%86%E5%AD%97%E4%BD%93%E5%9B%BE%E6%A0%87%E8%B5%84%E6%BA%90"><span class="toc-number">7.</span> <span class="toc-text">7. 处理字体图标资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%A4%84%E7%90%86%E5%85%B6%E4%BB%96%E8%B5%84%E6%BA%90"><span class="toc-number">8.</span> <span class="toc-text">8. 处理其他资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%A4%84%E7%90%86JS%E6%96%87%E4%BB%B6"><span class="toc-number">9.</span> <span class="toc-text">9. 处理JS文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-Eslint-%E6%8F%92%E4%BB%B6"><span class="toc-number">9.1.</span> <span class="toc-text">9.1 Eslint 插件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%99%E6%B3%95"><span class="toc-number">9.1.1.</span> <span class="toc-text">配置文件的写法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E9%85%8D%E7%BD%AE"><span class="toc-number">9.1.2.</span> <span class="toc-text">具体配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Esline%E5%9C%A8Webpack%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">9.1.3.</span> <span class="toc-text">Esline在Webpack中的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0eslint%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6"><span class="toc-number">9.1.4.</span> <span class="toc-text">添加eslint忽略文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-Babel-%E6%8F%92%E4%BB%B6"><span class="toc-number">9.2.</span> <span class="toc-text">9.2 Babel 插件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">9.2.1.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="toc-number">9.2.2.</span> <span class="toc-text">配置示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8webpack%E4%B8%AD%E4%BD%BF%E7%94%A8"><span class="toc-number">9.2.3.</span> <span class="toc-text">在webpack中使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%BE%93%E5%87%BA%E7%9A%84%E7%BB%93%E6%9E%9C%E4%B8%8D%E4%BB%A5%E7%AE%AD%E5%A4%B4%E8%BE%93%E5%87%BA"><span class="toc-number">9.2.4.</span> <span class="toc-text">修改输出的结果不以箭头输出</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E5%A4%84%E7%90%86HTML%E6%96%87%E4%BB%B6"><span class="toc-number">10.</span> <span class="toc-text">10. 处理HTML文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">11.</span> <span class="toc-text">11. 搭建开发服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">12.</span> <span class="toc-text">12. 生产环境准备工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-CSS%E5%A4%84%E7%90%86"><span class="toc-number">13.</span> <span class="toc-text">13. CSS处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1-%E6%8F%90%E5%8F%96CSS%E6%88%90%E5%8D%95%E7%8B%AC%E6%96%87%E4%BB%B6"><span class="toc-number">13.1.</span> <span class="toc-text">13.1 提取CSS成单独文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-%E5%A4%84%E7%90%86CSS%E5%85%BC%E5%AE%B9%E6%80%A7%E9%97%AE%E9%A2%98"><span class="toc-number">13.2.</span> <span class="toc-text">13.2 处理CSS兼容性问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-3-%E6%8F%90%E5%8F%96%E9%87%8D%E5%A4%8D%E9%85%8D%E7%BD%AE"><span class="toc-number">13.3.</span> <span class="toc-text">13.3 提取重复配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-4-%E5%8E%8B%E7%BC%A9CSS"><span class="toc-number">13.4.</span> <span class="toc-text">13.4 压缩CSS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E9%AB%98%E7%BA%A7%E4%BC%98%E5%8C%96"><span class="toc-number">14.</span> <span class="toc-text">14. 高级优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#14-1-%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E4%BD%93%E9%AA%8CSourceMap"><span class="toc-number">14.1.</span> <span class="toc-text">14.1 提升开发体验SourceMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-2-Hot%E7%83%AD%E6%9B%BF%E6%8D%A2"><span class="toc-number">14.2.</span> <span class="toc-text">14.2 Hot热替换</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88"><span class="toc-number">14.2.1.</span> <span class="toc-text">为什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">14.2.2.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%94%A8"><span class="toc-number">14.2.3.</span> <span class="toc-text">怎么用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-3-oneOf"><span class="toc-number">14.3.</span> <span class="toc-text">14.3 oneOf</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-1"><span class="toc-number">14.3.1.</span> <span class="toc-text">为什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-1"><span class="toc-number">14.3.2.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%94%A8-1"><span class="toc-number">14.3.3.</span> <span class="toc-text">怎么用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-4-Include-Exclude"><span class="toc-number">14.4.</span> <span class="toc-text">14.4 Include&#x2F;Exclude</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-2"><span class="toc-number">14.4.1.</span> <span class="toc-text">为什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-2"><span class="toc-number">14.4.2.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%94%A8-2"><span class="toc-number">14.4.3.</span> <span class="toc-text">怎么用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-5-Catch"><span class="toc-number">14.5.</span> <span class="toc-text">14.5 Catch</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-3"><span class="toc-number">14.5.1.</span> <span class="toc-text">为什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%94%A8-3"><span class="toc-number">14.5.2.</span> <span class="toc-text">怎么用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-6-%E5%BC%80%E5%90%AF%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%89%93%E5%8C%85"><span class="toc-number">14.6.</span> <span class="toc-text">14.6 开启多线程打包</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-4"><span class="toc-number">14.6.1.</span> <span class="toc-text">为什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%94%A8-4"><span class="toc-number">14.6.2.</span> <span class="toc-text">怎么用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-7-%E5%87%8F%E5%B0%91%E4%BB%A3%E7%A0%81%E4%BD%93%E7%A7%AF"><span class="toc-number">14.7.</span> <span class="toc-text">14.7 减少代码体积</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-5"><span class="toc-number">14.7.1.</span> <span class="toc-text">为什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-3"><span class="toc-number">14.7.2.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%94%A8-5"><span class="toc-number">14.7.3.</span> <span class="toc-text">怎么用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-8-%E5%8E%8B%E7%BC%A9%E5%9B%BE%E7%89%87"><span class="toc-number">14.8.</span> <span class="toc-text">14.8 压缩图片</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E6%8F%90%E9%AB%98%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E6%95%88%E7%8E%87"><span class="toc-number">15.</span> <span class="toc-text">15. 提高代码运行效率</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#15-1-Code-Split"><span class="toc-number">15.1.</span> <span class="toc-text">15.1 Code Split</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E5%85%A5%E5%8F%A3%E9%85%8D%E7%BD%AE"><span class="toc-number">15.1.1.</span> <span class="toc-text">多入口配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E5%8F%96%E9%87%8D%E5%A4%8D%E6%96%87%E4%BB%B6"><span class="toc-number">15.1.2.</span> <span class="toc-text">提取重复文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD"><span class="toc-number">15.1.3.</span> <span class="toc-text">按需加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%99%E5%8A%A8%E6%80%81%E7%94%9F%E6%88%90%E7%9A%84%E6%96%87%E4%BB%B6%E5%91%BD%E5%90%8D"><span class="toc-number">15.1.4.</span> <span class="toc-text">给动态生成的文件命名</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-%E6%96%87%E4%BB%B6%E7%BB%9F%E4%B8%80%E5%91%BD%E5%90%8D"><span class="toc-number">16.</span> <span class="toc-text">16. 文件统一命名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-Preload-Prefetch"><span class="toc-number">17.</span> <span class="toc-text">17. Preload &#x2F; Prefetch</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-6"><span class="toc-number">17.1.</span> <span class="toc-text">为什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-4"><span class="toc-number">17.2.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%94%A8-6"><span class="toc-number">17.3.</span> <span class="toc-text">怎么用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-contenthash"><span class="toc-number">18.</span> <span class="toc-text">18. contenthash</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-7"><span class="toc-number">18.1.</span> <span class="toc-text">为什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-5"><span class="toc-number">18.2.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%94%A8-7"><span class="toc-number">18.3.</span> <span class="toc-text">怎么用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-runtimeChunk"><span class="toc-number">19.</span> <span class="toc-text">19. runtimeChunk</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-8"><span class="toc-number">19.1.</span> <span class="toc-text">为什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-6"><span class="toc-number">19.2.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%94%A8-8"><span class="toc-number">19.3.</span> <span class="toc-text">怎么用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-CoreJS"><span class="toc-number">20.</span> <span class="toc-text">20. CoreJS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-9"><span class="toc-number">20.1.</span> <span class="toc-text">为什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88-7"><span class="toc-number">20.2.</span> <span class="toc-text">是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E7%94%A8-9"><span class="toc-number">20.3.</span> <span class="toc-text">怎么用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-%E4%BC%98%E5%8C%96%E6%80%BB%E7%BB%93"><span class="toc-number">21.</span> <span class="toc-text">21. 优化总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-%E6%89%8B%E5%8A%A8%E6%90%AD%E5%BB%BAVue%E8%84%9A%E6%89%8B%E6%9E%B6"><span class="toc-number">22.</span> <span class="toc-text">22. 手动搭建Vue脚手架</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#22-1-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">22.1.</span> <span class="toc-text">22.1 项目结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-2-%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F%E9%85%8D%E7%BD%AE"><span class="toc-number">22.2.</span> <span class="toc-text">22.2 开发模式配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-3-%E7%94%9F%E4%BA%A7%E6%A8%A1%E5%BC%8F%E9%85%8D%E7%BD%AE"><span class="toc-number">22.3.</span> <span class="toc-text">22.3 生产模式配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-4-%E5%85%B6%E4%BB%96%E6%96%87%E4%BB%B6%E4%BB%A3%E7%A0%81"><span class="toc-number">22.4.</span> <span class="toc-text">22.4 其他文件代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-5-%E6%B5%8B%E8%AF%95%E8%BF%90%E8%A1%8C"><span class="toc-number">22.5.</span> <span class="toc-text">22.5 测试运行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-6-%E5%90%88%E5%B9%B6%E9%85%8D%E7%BD%AE"><span class="toc-number">22.6.</span> <span class="toc-text">22.6 合并配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-ElementPlus%E6%8C%89%E9%9C%80%E5%AF%BC%E5%85%A5"><span class="toc-number">23.</span> <span class="toc-text">23. ElementPlus按需导入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24-loader%E5%8E%9F%E7%90%86"><span class="toc-number">24.</span> <span class="toc-text">24. loader原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#24-1-loader%E6%A6%82%E5%BF%B5"><span class="toc-number">24.1.</span> <span class="toc-text">24.1 loader概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-2-loader%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">24.2.</span> <span class="toc-text">24.2 loader的执行顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-3-%E8%87%AA%E5%AE%9A%E4%B9%89loader"><span class="toc-number">24.3.</span> <span class="toc-text">24.3 自定义loader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-4-%E5%90%8C%E6%AD%A5loader%E5%92%8C%E5%BC%82%E6%AD%A5loader"><span class="toc-number">24.4.</span> <span class="toc-text">24.4 同步loader和异步loader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-5-raw-loader"><span class="toc-number">24.5.</span> <span class="toc-text">24.5 raw loader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-6-pitch-loader"><span class="toc-number">24.6.</span> <span class="toc-text">24.6 pitch loader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-7-loader-Api"><span class="toc-number">24.7.</span> <span class="toc-text">24.7. loader Api</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25-%E8%87%AA%E5%AE%9E%E7%8E%B0loader"><span class="toc-number">25.</span> <span class="toc-text">25. 自实现loader</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#25-1-clear-log-loader"><span class="toc-number">25.1.</span> <span class="toc-text">25.1 clear-log-loader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-2-%E7%BB%99loader%E6%B7%BB%E5%8A%A0options%E5%8F%82%E6%95%B0"><span class="toc-number">25.2.</span> <span class="toc-text">25.2 给loader添加options参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-3-%E8%87%AA%E5%AE%9E%E7%8E%B0babel-loader"><span class="toc-number">25.3.</span> <span class="toc-text">25.3 自实现babel-loader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-4-file-loader"><span class="toc-number">25.4.</span> <span class="toc-text">25.4 file-loader</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#26-Plugin%E5%8E%9F%E7%90%86"><span class="toc-number">26.</span> <span class="toc-text">26. Plugin原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Plugin-%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">26.1.</span> <span class="toc-text">Plugin 的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Plugin-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">26.2.</span> <span class="toc-text">Plugin 工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Webpack-%E5%86%85%E9%83%A8%E7%9A%84%E9%92%A9%E5%AD%90"><span class="toc-number">26.3.</span> <span class="toc-text">Webpack 内部的钩子</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E9%92%A9%E5%AD%90"><span class="toc-number">26.3.1.</span> <span class="toc-text">什么是钩子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tapable"><span class="toc-number">26.3.2.</span> <span class="toc-text">Tapable</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Plugin-%E6%9E%84%E5%BB%BA%E5%AF%B9%E8%B1%A1"><span class="toc-number">26.4.</span> <span class="toc-text">Plugin 构建对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Compiler"><span class="toc-number">26.4.1.</span> <span class="toc-text">Compiler</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Compilation"><span class="toc-number">26.4.2.</span> <span class="toc-text">Compilation</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%80%E5%9B%BE"><span class="toc-number">26.5.</span> <span class="toc-text">生命周期简图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#27-%E8%87%AA%E5%AE%9E%E7%8E%B0Plugin"><span class="toc-number">27.</span> <span class="toc-text">27. 自实现Plugin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#27-1-TestPlugin"><span class="toc-number">27.1.</span> <span class="toc-text">27.1 TestPlugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#27-2-%E6%B3%A8%E5%86%8Chook"><span class="toc-number">27.2.</span> <span class="toc-text">27.2 注册hook</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#27-3-%E6%B7%BB%E5%8A%A0node%E8%B0%83%E8%AF%95%E5%91%BD%E4%BB%A4"><span class="toc-number">27.3.</span> <span class="toc-text">27.3 添加node调试命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#27-4-BannerWebpackPlugin"><span class="toc-number">27.4.</span> <span class="toc-text">27.4 BannerWebpackPlugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#27-5-CleanWebpackPlugin"><span class="toc-number">27.5.</span> <span class="toc-text">27.5 CleanWebpackPlugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#27-6-AnalyzeWebpackPlugin"><span class="toc-number">27.6.</span> <span class="toc-text">27.6 AnalyzeWebpackPlugin</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Vue/ElementPlus%E5%AE%98%E7%BD%91%E7%9A%84%E9%BB%91%E7%99%BD%E5%88%87%E6%8D%A2%E6%95%88%E6%9E%9C/" title="使用vue3实现element-plus的主题切换特效"><img data-lazy-src="/images/ys05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用vue3实现element-plus的主题切换特效"/></a><div class="content"><a class="title" href="/Vue/ElementPlus%E5%AE%98%E7%BD%91%E7%9A%84%E9%BB%91%E7%99%BD%E5%88%87%E6%8D%A2%E6%95%88%E6%9E%9C/" title="使用vue3实现element-plus的主题切换特效">使用vue3实现element-plus的主题切换特效</a><time datetime="2024-11-29T02:21:25.000Z" title="发表于 2024-11-29 10:21:25">2024-11-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Java/springboot/%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" title="logback.xml 常用配置"><img data-lazy-src="/images/ys11.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="logback.xml 常用配置"/></a><div class="content"><a class="title" href="/Java/springboot/%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" title="logback.xml 常用配置">logback.xml 常用配置</a><time datetime="2024-11-22T06:09:55.000Z" title="发表于 2024-11-22 14:09:55">2024-11-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Vue/node+vue%E5%AE%9E%E7%8E%B0%E7%BE%A4%E8%81%8A%E5%8A%9F%E8%83%BD/" title="使用node+prisma和vue3实现一个群聊功能"><img data-lazy-src="/images/ys02.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用node+prisma和vue3实现一个群聊功能"/></a><div class="content"><a class="title" href="/Vue/node+vue%E5%AE%9E%E7%8E%B0%E7%BE%A4%E8%81%8A%E5%8A%9F%E8%83%BD/" title="使用node+prisma和vue3实现一个群聊功能">使用node+prisma和vue3实现一个群聊功能</a><time datetime="2024-10-09T02:30:49.000Z" title="发表于 2024-10-09 10:30:49">2024-10-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Vue/%E4%B8%80%E4%B8%AA%E4%BC%98%E9%9B%85%E7%9A%84%E8%BD%AE%E5%BE%AA%E4%BB%A3%E7%A0%81/" title="一个优雅的轮循代码"><img data-lazy-src="/images/ys04.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="一个优雅的轮循代码"/></a><div class="content"><a class="title" href="/Vue/%E4%B8%80%E4%B8%AA%E4%BC%98%E9%9B%85%E7%9A%84%E8%BD%AE%E5%BE%AA%E4%BB%A3%E7%A0%81/" title="一个优雅的轮循代码">一个优雅的轮循代码</a><time datetime="2024-09-22T16:00:00.000Z" title="发表于 2024-09-23 00:00:00">2024-09-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/JavaScript/pm2_linux_nginx/" title="pm2 + linux + nginx"><img data-lazy-src="/images/ys19.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="pm2 + linux + nginx"/></a><div class="content"><a class="title" href="/JavaScript/pm2_linux_nginx/" title="pm2 + linux + nginx">pm2 + linux + nginx</a><time datetime="2024-09-07T16:00:00.000Z" title="发表于 2024-09-08 00:00:00">2024-09-08</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/images/ys05.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By SZX</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">少年辛苦终身事，莫向光阴惰寸功。<a target="_blank" rel="noopener" href="https://gitee.com/szxio">My Gitee</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/instantpage.min.js" type="module"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'iJzt0X9OdhFCcdn4N0dJ86fY-gzGzoHsz',
      appKey: '8vtaRafgQSvU5ntYgszJfRW5',
      placeholder: '留下你的精彩评论',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/canvas-fluttering-ribbon.min.js"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/click-show-text.min.js" data-mobile="true" data-text="富强,民主,文明,和谐,自由,平等,公正,法制,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>