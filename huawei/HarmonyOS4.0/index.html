<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>鸿蒙开发HarmonyOS4.0入门与实践 | SZX的开发笔记</title><meta name="keywords" content="华为"><meta name="author" content="SZX"><meta name="copyright" content="SZX"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="课程地址：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1Sa4y1Z7B1&#x2F; 源码地址：https:&#x2F;&#x2F;gitee.com&#x2F;szxio&#x2F;harmonyOS4  准备工作官网地址鸿蒙开发者官网：https:&#x2F;&#x2F;developer.huawei.com&#x2F;consumer&#x2F;cn&#x2F;develop&#x2F; 工具下载打开 HUAWEI DevEco Studio和SDK下载和升级 | 华为开">
<meta property="og:type" content="article">
<meta property="og:title" content="鸿蒙开发HarmonyOS4.0入门与实践">
<meta property="og:url" content="https://songzx0106.github.io/huawei/HarmonyOS4.0/index.html">
<meta property="og:site_name" content="SZX的开发笔记">
<meta property="og:description" content="课程地址：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1Sa4y1Z7B1&#x2F; 源码地址：https:&#x2F;&#x2F;gitee.com&#x2F;szxio&#x2F;harmonyOS4  准备工作官网地址鸿蒙开发者官网：https:&#x2F;&#x2F;developer.huawei.com&#x2F;consumer&#x2F;cn&#x2F;develop&#x2F; 工具下载打开 HUAWEI DevEco Studio和SDK下载和升级 | 华为开">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://songzx0106.github.io/images/ys12.jpg">
<meta property="article:published_time" content="2024-04-24T02:26:56.000Z">
<meta property="article:modified_time" content="2024-11-22T06:14:31.227Z">
<meta property="article:author" content="SZX">
<meta property="article:tag" content="华为">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://songzx0106.github.io/images/ys12.jpg"><link rel="shortcut icon" href="/images/favicon.png"><link rel="canonical" href="https://songzx0106.github.io/huawei/HarmonyOS4.0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":5000,"languages":{"author":"作者: SZX","link":"链接: ","source":"来源: SZX的开发笔记","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/jquery.min.js',
    justifiedGallery: {
      js: 'https://fastly.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://fastly.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://fastly.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-11-22 14:14:31'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2467717_jlvw8717b8.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/images/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">157</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/ys12.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">SZX的开发笔记</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">鸿蒙开发HarmonyOS4.0入门与实践</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-04-24T02:26:56.000Z" title="发表于 2024-04-24 10:26:56">2024-04-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-22T06:14:31.227Z" title="更新于 2024-11-22 14:14:31">2024-11-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%B8%BF%E8%92%994-0/">鸿蒙4.0</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">24.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>122分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="鸿蒙开发HarmonyOS4.0入门与实践"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>课程地址：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Sa4y1Z7B1/">https://www.bilibili.com/video/BV1Sa4y1Z7B1/</a></p>
<p>源码地址：<a target="_blank" rel="noopener" href="https://gitee.com/szxio/harmonyOS4">https://gitee.com/szxio/harmonyOS4</a></p>
</blockquote>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="官网地址"><a href="#官网地址" class="headerlink" title="官网地址"></a>官网地址</h3><p>鸿蒙开发者官网：<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/develop/">https://developer.huawei.com/consumer/cn/develop/</a></p>
<h3 id="工具下载"><a href="#工具下载" class="headerlink" title="工具下载"></a>工具下载</h3><p>打开 <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/deveco-studio/">HUAWEI DevEco Studio和SDK下载和升级 | 华为开发者联盟</a><br>网站，选择对应的文件点击下载安装即可</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240309203545487.png" alt="image-20240309203545487"></p>
<h3 id="入门案例"><a href="#入门案例" class="headerlink" title="入门案例"></a>入门案例</h3><p>安装好之后，选择一个空白项目创建</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240309203635598.png" alt="image-20240309203635598"></p>
<p>等待工具加载完成，打开这个 pages/Index.ets 文件</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240309203732381.png" alt="image-20240309203732381"></p>
<p>这个文件是一个入口文件，点击工具的右侧 Previewer 按钮，会出来预览界面，我们在左侧改动代码会实时的在这里显示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240310193607007.png" alt="image-20240310193607007"></p>
<blockquote>
<p>如果点击 Previewer 按钮出来的是一对文字，可以关掉工具，重启一下即可</p>
</blockquote>
<p>上面我们修改了文字的颜色，并且给文字添加了一个点击事件，点击之后改变文字的内容为 Hello ArkTS</p>
<h2 id="华为手机模拟器安装"><a href="#华为手机模拟器安装" class="headerlink" title="华为手机模拟器安装"></a>华为手机模拟器安装</h2><p>安装文档：<a target="_blank" rel="noopener" href="https://b11et3un53m.feishu.cn/wiki/LGprwXi1biC7TQkWPNDc45IXndh">https://b11et3un53m.feishu.cn/wiki/LGprwXi1biC7TQkWPNDc45IXndh</a></p>
<h2 id="ArkUI组件"><a href="#ArkUI组件" class="headerlink" title="ArkUI组件"></a>ArkUI组件</h2><h3 id="Image组件"><a href="#Image组件" class="headerlink" title="Image组件"></a>Image组件</h3><p>方式一：加载网络图片</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Image(<span class="string">&quot;https://pic.rmb.bdstatic.com/bjh/37f17dae02f15085e1becd5954b990839309.jpeg@h_1280&quot;</span>)</span><br><span class="line">    .width(<span class="number">300</span>)</span><br></pre></td></tr></table></figure>

<p>这种方式需要开通网络访问权限才可以在真机上正常加载</p>
<p>添加网络权限，<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/accesstoken-guidelines-0000001493744016-V2">更多文档说明</a></p>
<p>找到 module.json5 文件，添加如下配置</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;module&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;requestPermissions&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;ohos.permission.INTERNET&quot;</span></span><br><span class="line">        <span class="comment">// 开启网络访问权限</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时就可正常查看这个图片了</p>
<img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240310200735246.png" alt="image-20240310200735246" style="zoom:50%;" />

<p>方式二：加载本地文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载本地文件</span></span><br><span class="line">Image($r(<span class="string">&quot;app.media.icon&quot;</span>))</span><br><span class="line">    .width(<span class="number">300</span>)</span><br><span class="line">    .interpolation(ImageInterpolation.High)</span><br></pre></td></tr></table></figure>

<p>app 是固定的开头，media.icon 表示当前图片所在目录，图片的后缀不需要写</p>
<p><code>interpolation(ImageInterpolation.High)</code> 表示抗锯齿效果，可以提高图片的清晰度</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240310201035451.png" alt="image-20240310201035451"></p>
<p>抗锯齿打开效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240310201244187.png" alt="image-20240310201244187"></p>
<p>抗锯齿关闭效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240310201302813.png" alt="image-20240310201302813"></p>
<h3 id="Text组件"><a href="#Text组件" class="headerlink" title="Text组件"></a>Text组件</h3><p>基本用法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Text(<span class="string">&quot;hello world&quot;</span>) <span class="comment">// 字体内容</span></span><br><span class="line">    .fontSize(<span class="number">30</span>) <span class="comment">// 字体大小</span></span><br><span class="line">    .fontWeight(FontWeight.Bold) <span class="comment">// 字体加粗</span></span><br><span class="line">    .textAlign(TextAlign.Center) <span class="comment">// 水平居中</span></span><br><span class="line">    .width(<span class="string">&quot;100%&quot;</span>) <span class="comment">// 宽度</span></span><br><span class="line">    .textCase(TextCase.UpperCase) <span class="comment">// 设置字体变大写</span></span><br><span class="line">    .fontColor(<span class="string">&quot;#09c&quot;</span>) <span class="comment">// 字体颜色</span></span><br></pre></td></tr></table></figure>

<p>配置国际显示</p>
<p>首先在 string.json 文件中定义好键值对</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240310203601950.png" alt="image-20240310203601950"></p>
<p>英文也对应的配置成一样的</p>
<p>然后基础的 element.string.json 中配置一个name一样的，value无所谓</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240310203709310.png" alt="image-20240310203709310"></p>
<p>然后可以使用下面方式来展示配置的国际化语言</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Text($r(<span class="string">&quot;app.string.Image_width&quot;</span>)) <span class="comment">// 字体内容</span></span><br><span class="line">    .fontSize(<span class="number">30</span>) <span class="comment">// 字体大小</span></span><br><span class="line">    .fontWeight(FontWeight.Bold) <span class="comment">// 字体加粗</span></span><br><span class="line">    .textAlign(TextAlign.Center) <span class="comment">// 水平居中</span></span><br><span class="line">    .width(<span class="string">&quot;100%&quot;</span>) <span class="comment">// 宽度</span></span><br><span class="line">    .textCase(TextCase.UpperCase) <span class="comment">// 设置字体变大写</span></span><br><span class="line">    .fontColor(<span class="string">&quot;#09c&quot;</span>) <span class="comment">// 字体颜色</span></span><br></pre></td></tr></table></figure>

<p>默认根据当前手机系统的语言，显示对应的value值，可以修改系统语言，显示不同的文字</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240310204312982.png" alt="image-20240310204312982"></p>
<h3 id="TextInput组件"><a href="#TextInput组件" class="headerlink" title="TextInput组件"></a>TextInput组件</h3><p>绑定一个值改变图片宽度</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">ImagePage</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    imageWidth</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">200</span></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            Column()</span><br><span class="line">            &#123;</span><br><span class="line">                Image($r(<span class="string">&quot;app.media.icon&quot;</span>))</span><br><span class="line">                    .width(<span class="built_in">this</span>.imageWidth)</span><br><span class="line">                    .interpolation(ImageInterpolation.High)</span><br><span class="line"></span><br><span class="line">                Text($r(<span class="string">&quot;app.string.Image_width&quot;</span>))</span><br><span class="line">                    .fontSize(<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">                TextInput(&#123;</span><br><span class="line">                    placeholder: <span class="string">&quot;请输入图片宽度&quot;</span>,</span><br><span class="line">                    text: <span class="built_in">this</span>.imageWidth.toString()</span><br><span class="line">                &#125;)</span><br><span class="line">                    .width(<span class="number">200</span>)</span><br><span class="line">                    .type(InputType.Number)</span><br><span class="line">                    .onChange(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.imageWidth = value ? <span class="built_in">parseInt</span>(value) : <span class="number">20</span></span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        height(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240310211112180.png" alt="image-20240310211112180" style="zoom:67%;" />

<h3 id="Button组件"><a href="#Button组件" class="headerlink" title="Button组件"></a>Button组件</h3><p>普通用法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Button(<span class="string">&quot;缩小&quot;</span>).width(<span class="number">80</span>).type(ButtonType.Circle).stateEffect(<span class="literal">true</span>).onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.imageWidth &gt;= <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.imageWidth -= <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Button(<span class="string">&quot;放大&quot;</span>).width(<span class="number">80</span>).stateEffect(<span class="literal">true</span>).margin(<span class="number">10</span>).onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.imageWidth &lt; <span class="number">300</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.imageWidth += <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>type支持的类型</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Capsule</td>
<td>胶囊型按钮（圆角默认为高度的一半）。</td>
</tr>
<tr>
<td>Circle</td>
<td>圆形按钮。</td>
</tr>
<tr>
<td>Normal</td>
<td>普通按钮（默认不带圆角）。</td>
</tr>
</tbody></table>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240311135126685.png" alt="image-20240311135126685"></p>
<p>图片按钮</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Button()</span><br><span class="line">&#123;</span><br><span class="line">    Image($r(<span class="string">&quot;app.media.jian&quot;</span>)).width(<span class="number">20</span>).margin(<span class="number">15</span>)</span><br><span class="line">&#125;</span><br><span class="line">.</span><br><span class="line">width(<span class="number">80</span>)</span><br><span class="line">    .type(ButtonType.Circle)</span><br><span class="line">    .stateEffect(<span class="literal">true</span>)</span><br><span class="line">    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.imageWidth &gt;= <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.imageWidth -= <span class="number">10</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Slider滑动条"><a href="#Slider滑动条" class="headerlink" title="Slider滑动条"></a>Slider滑动条</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 滑块</span></span><br><span class="line">Slider(&#123;</span><br><span class="line">    value: <span class="built_in">this</span>.imageWidth,</span><br><span class="line">    step: <span class="number">10</span>,</span><br><span class="line">    min: <span class="number">10</span>,</span><br><span class="line">    max: <span class="number">100</span>,</span><br><span class="line">    <span class="comment">// 设置Slider的滑块与滑轨显示样式,</span></span><br><span class="line">    <span class="comment">// OutSet 滑块在滑轨上。</span></span><br><span class="line">    <span class="comment">// InSet 滑块在滑轨内。</span></span><br><span class="line">    style: SliderStyle.OutSet</span><br><span class="line">&#125;)</span><br><span class="line">    .blockColor(<span class="string">&quot;#36D&quot;</span>) <span class="comment">// 设置滑块的颜色。</span></span><br><span class="line">    .trackColor(<span class="string">&quot;#ececec&quot;</span>) <span class="comment">// 设置滑轨的背景颜色。</span></span><br><span class="line">    .selectedColor(<span class="string">&quot;#09C&quot;</span>) <span class="comment">// 设置滑轨的已滑动部分颜色。</span></span><br><span class="line">    .showSteps(<span class="literal">true</span>) <span class="comment">// 设置当前是否显示步长刻度值</span></span><br><span class="line">    .showTips(<span class="literal">true</span>) <span class="comment">// 设置滑动时是否显示百分比气泡提示。</span></span><br><span class="line">    .trackThickness(<span class="number">7</span>) <span class="comment">// 滑动条的粗细</span></span><br><span class="line">    .onChange(<span class="function">(<span class="params">value: <span class="built_in">number</span>, mode: SliderChangeMode</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.imageWidth = <span class="built_in">parseInt</span>(value.toFixed(<span class="number">0</span>))</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240311140942599.png" alt="image-20240311140942599"></p>
<h3 id="Columl和Row"><a href="#Columl和Row" class="headerlink" title="Columl和Row"></a>Columl和Row</h3><p>Column和Row在主轴方向上的对齐方式</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240311142257609.png" alt="image-20240311142257609"></p>
<p>在交叉轴的对齐方式</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240311142428140.png" alt="image-20240311142428140"></p>
<h3 id="设置图片大小Demo"><a href="#设置图片大小Demo" class="headerlink" title="设置图片大小Demo"></a>设置图片大小Demo</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">ImagePage</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    imageWidth</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">200</span></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;</span><br><span class="line">            space: <span class="number">20</span></span><br><span class="line">        &#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Image($r(<span class="string">&quot;app.media.icon&quot;</span>))</span><br><span class="line">                    .width(<span class="built_in">this</span>.imageWidth)</span><br><span class="line">                    .interpolation(ImageInterpolation.High)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .height(<span class="number">350</span>)</span><br><span class="line">                .margin(&#123;</span><br><span class="line">                    bottom: <span class="number">20</span></span><br><span class="line">                &#125;)</span><br><span class="line">                .justifyContent(FlexAlign.Center)</span><br><span class="line">                .backgroundColor(<span class="string">&quot;#ececec&quot;</span>)</span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text($r(<span class="string">&quot;app.string.Image_width&quot;</span>))</span><br><span class="line">                    .fontSize(<span class="number">20</span>)</span><br><span class="line">                    .margin(&#123;</span><br><span class="line">                        right: <span class="number">15</span></span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                TextInput(&#123;</span><br><span class="line">                    placeholder: <span class="string">&quot;请输入图片宽度&quot;</span>,</span><br><span class="line">                    text: <span class="built_in">this</span>.imageWidth.toString()</span><br><span class="line">                &#125;)</span><br><span class="line">                    .width(<span class="number">200</span>)</span><br><span class="line">                    .type(InputType.Number)</span><br><span class="line">                    .onChange(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.imageWidth = value ? <span class="built_in">parseInt</span>(value) : <span class="number">20</span></span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">/*文字类型按钮*/</span></span><br><span class="line">                Button(<span class="string">&quot;缩小&quot;</span>).width(<span class="number">80</span>).stateEffect(<span class="literal">true</span>).onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">this</span>.imageWidth &gt;= <span class="number">10</span>) &#123;</span><br><span class="line">                        <span class="built_in">this</span>.imageWidth -= <span class="number">10</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">                <span class="comment">/*文字类型按钮*/</span></span><br><span class="line">                Button(<span class="string">&quot;放大&quot;</span>).width(<span class="number">80</span>).stateEffect(<span class="literal">true</span>).margin(<span class="number">10</span>).onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">this</span>.imageWidth &lt; <span class="number">300</span>) &#123;</span><br><span class="line">                        <span class="built_in">this</span>.imageWidth += <span class="number">10</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;80%&quot;</span>)</span><br><span class="line">                .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 滑块</span></span><br><span class="line">                Slider(&#123;</span><br><span class="line">                    value: <span class="built_in">this</span>.imageWidth,</span><br><span class="line">                    step: <span class="number">10</span>,</span><br><span class="line">                    min: <span class="number">10</span>,</span><br><span class="line">                    max: <span class="number">100</span>,</span><br><span class="line">                    <span class="comment">// 设置Slider的滑块与滑轨显示样式,</span></span><br><span class="line">                    <span class="comment">// OutSet 滑块在滑轨上。</span></span><br><span class="line">                    <span class="comment">// InSet 滑块在滑轨内。</span></span><br><span class="line">                    style: SliderStyle.OutSet</span><br><span class="line">                &#125;)</span><br><span class="line">                    .blockColor(<span class="string">&quot;#36D&quot;</span>) <span class="comment">// 设置滑块的颜色。</span></span><br><span class="line">                    .trackColor(<span class="string">&quot;#ececec&quot;</span>) <span class="comment">// 设置滑轨的背景颜色。</span></span><br><span class="line">                    .selectedColor(<span class="string">&quot;#09C&quot;</span>) <span class="comment">// 设置滑轨的已滑动部分颜色。</span></span><br><span class="line">                    .showSteps(<span class="literal">true</span>) <span class="comment">// 设置当前是否显示步长刻度值</span></span><br><span class="line">                    .showTips(<span class="literal">true</span>) <span class="comment">// 设置滑动时是否显示百分比气泡提示。</span></span><br><span class="line">                    .trackThickness(<span class="number">7</span>) <span class="comment">// 滑动条的粗细</span></span><br><span class="line">                    .onChange(<span class="function">(<span class="params">value: <span class="built_in">number</span>, mode: SliderChangeMode</span>) =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.imageWidth = <span class="built_in">parseInt</span>(value.toFixed(<span class="number">0</span>))</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;90%&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .height(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240311143701924.png" alt="image-20240311143701924"></p>
<h3 id="List和ForEach"><a href="#List和ForEach" class="headerlink" title="List和ForEach"></a>List和ForEach</h3><ul>
<li>layoutWeight(1)  样式权重，数值越大，权重越高，会将除了其他低权重区域的高度减掉之后，剩下的都是自己的</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    name: <span class="built_in">string</span></span><br><span class="line">    price: <span class="built_in">number</span></span><br><span class="line">    img: Resource</span><br><span class="line">    discount: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name: <span class="built_in">string</span>, img: Resource, price: <span class="built_in">number</span>, discount?: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name</span><br><span class="line">        <span class="built_in">this</span>.img = img</span><br><span class="line">        <span class="built_in">this</span>.price = price</span><br><span class="line">        <span class="built_in">this</span>.discount = discount</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">ItemsPage</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    ItemList</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">Array</span> &lt; Item &gt; = []</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 页面显示时触发</span></span><br><span class="line">    onPageShow()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 模拟从后端加载数据</span></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.ItemList = [</span><br><span class="line">                <span class="keyword">new</span> Item(<span class="string">&quot;华为Meta60&quot;</span>, $r(<span class="string">&quot;app.media.phone&quot;</span>), <span class="number">6799</span>, <span class="number">500</span>),</span><br><span class="line">                <span class="keyword">new</span> Item(<span class="string">&quot;小米14&quot;</span>, $r(<span class="string">&quot;app.media.phone&quot;</span>), <span class="number">4999</span>),</span><br><span class="line">                <span class="keyword">new</span> Item(<span class="string">&quot;vivo X100&quot;</span>, $r(<span class="string">&quot;app.media.phone&quot;</span>), <span class="number">4699</span>),</span><br><span class="line">                <span class="keyword">new</span> Item(<span class="string">&quot;红米K70&quot;</span>, $r(<span class="string">&quot;app.media.phone&quot;</span>), <span class="number">2799</span>),</span><br><span class="line">                <span class="keyword">new</span> Item(<span class="string">&quot;vivo X100&quot;</span>, $r(<span class="string">&quot;app.media.phone&quot;</span>), <span class="number">4699</span>),</span><br><span class="line">                <span class="keyword">new</span> Item(<span class="string">&quot;红米K70&quot;</span>, $r(<span class="string">&quot;app.media.phone&quot;</span>), <span class="number">2799</span>),</span><br><span class="line">                <span class="keyword">new</span> Item(<span class="string">&quot;vivo X100&quot;</span>, $r(<span class="string">&quot;app.media.phone&quot;</span>), <span class="number">4699</span>),</span><br><span class="line">                <span class="keyword">new</span> Item(<span class="string">&quot;红米K70&quot;</span>, $r(<span class="string">&quot;app.media.phone&quot;</span>), <span class="number">2799</span>)</span><br><span class="line">            ]</span><br><span class="line">        &#125;, <span class="number">2000</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 顶部标题</span></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="string">&quot;百亿补贴&quot;</span>)</span><br><span class="line">                    .fontSize(<span class="number">30</span>)</span><br><span class="line">                    .fontColor(Color.Red)</span><br><span class="line">                    .fontWeight(FontWeight.Bold)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .height(<span class="number">45</span>)</span><br><span class="line">                .margin(&#123;<span class="attr">bottom</span>: <span class="number">20</span>&#125;)</span><br><span class="line"></span><br><span class="line">            List(&#123;<span class="attr">space</span>: <span class="number">15</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 遍历每一个</span></span><br><span class="line">                ForEach(<span class="built_in">this</span>.ItemList, <span class="function">(<span class="params">item: Item</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// List组件内必须用ListItem组件包裹</span></span><br><span class="line">                    ListItem()</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// 每一个商品卡片</span></span><br><span class="line">                        Row()</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="comment">// 左侧商品图片</span></span><br><span class="line">                            Image(item.img)</span><br><span class="line">                                .width(<span class="string">&quot;30%&quot;</span>)</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// 右侧商品信息</span></span><br><span class="line">                            Column(&#123;<span class="attr">space</span>: <span class="number">10</span>&#125;)</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="comment">// 商品名称</span></span><br><span class="line">                                Row()</span><br><span class="line">                                &#123;</span><br><span class="line">                                    Text(item.name)</span><br><span class="line">                                        .fontSize(<span class="number">25</span>)</span><br><span class="line">                                &#125;</span><br><span class="line">                            .</span><br><span class="line">                                width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line"></span><br><span class="line">                                <span class="comment">// 判断是否有折扣</span></span><br><span class="line">                                <span class="keyword">if</span> (item.discount) &#123;</span><br><span class="line">                                    <span class="comment">// 原价</span></span><br><span class="line">                                    Row()</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        Text(<span class="string">`原价 ￥<span class="subst">$&#123;item.price&#125;</span>`</span>)</span><br><span class="line">                                            .fontSize(<span class="number">16</span>)</span><br><span class="line">                                            .fontColor(<span class="string">&quot;#ccc&quot;</span>)</span><br><span class="line">                                            .decoration(&#123;<span class="attr">type</span>: TextDecorationType.LineThrough&#125;)</span><br><span class="line">                                    &#125;</span><br><span class="line">                                .</span><br><span class="line">                                    width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line"></span><br><span class="line">                                    <span class="comment">// 折扣价</span></span><br><span class="line">                                    Row()</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        Text(<span class="string">`补贴 ￥<span class="subst">$&#123;item.discount&#125;</span>`</span>)</span><br><span class="line">                                            .fontSize(<span class="number">18</span>)</span><br><span class="line">                                            .fontColor(Color.Red)</span><br><span class="line">                                    &#125;</span><br><span class="line">                                .</span><br><span class="line">                                    width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line"></span><br><span class="line">                                    <span class="comment">// 现在价格</span></span><br><span class="line">                                    Row()</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        Text(<span class="string">`折扣价 ￥<span class="subst">$&#123;item.price - item.discount&#125;</span>`</span>)</span><br><span class="line">                                            .fontSize(<span class="number">20</span>)</span><br><span class="line">                                            .fontColor(Color.Red)</span><br><span class="line">                                    &#125;</span><br><span class="line">                                .</span><br><span class="line">                                    width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line"></span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    <span class="comment">// 价格</span></span><br><span class="line">                                    Row()</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        Text(<span class="string">`折扣价 ￥<span class="subst">$&#123;item.price&#125;</span>`</span>)</span><br><span class="line">                                            .fontSize(<span class="number">20</span>)</span><br><span class="line">                                            .fontColor(Color.Red)</span><br><span class="line">                                    &#125;</span><br><span class="line">                                .</span><br><span class="line">                                    width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    .</span><br><span class="line">                        width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                            .padding(<span class="number">10</span>)</span><br><span class="line">                            .borderRadius(<span class="number">5</span>)</span><br><span class="line">                            .alignItems(VerticalAlign.Top)</span><br><span class="line">                            .backgroundColor(Color.White)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .layoutWeight(<span class="number">1</span>) <span class="comment">// 样式权重，数值越大，权重越高，会将除了其他低权重区域的高度减掉之后，剩下的都是自己的</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        padding(<span class="number">15</span>)</span><br><span class="line">            .width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .height(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .backgroundColor(<span class="string">&quot;#ececec&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240311153547454.png" alt="image-20240311153547454"></p>
<h3 id="Toast"><a href="#Toast" class="headerlink" title="Toast"></a>Toast</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> promptAction <span class="keyword">from</span> <span class="string">&#x27;@ohos.promptAction&#x27;</span></span><br><span class="line"></span><br><span class="line">Button(<span class="string">&quot;Toast&quot;</span>).onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    promptAction.showToast(&#123;</span><br><span class="line">        message: <span class="string">&quot;消息提示&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240324212649298.png" alt="image-20240324212649298"></p>
<h2 id="自定义组件"><a href="#自定义组件" class="headerlink" title="自定义组件"></a>自定义组件</h2><p>新建组件 <code>src/main/ets/components/Header.ets</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义Header组件</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span></span><br><span class="line">struct</span><br><span class="line">Header</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 定义参数，父组件使用时通过参数传递过来</span></span><br><span class="line"><span class="keyword">private</span></span><br><span class="line">    title:<span class="built_in">string</span></span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 顶部标题</span></span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            Text(<span class="built_in">this</span>.title)</span><br><span class="line">                .fontSize(<span class="number">30</span>)</span><br><span class="line">                .fontColor(Color.Red)</span><br><span class="line">                .fontWeight(FontWeight.Bold)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .height(<span class="number">45</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用方法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Header&#125; <span class="keyword">from</span> <span class="string">&#x27;../components/Header&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">ItemsPage</span><br><span class="line">&#123;</span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 引用顶部标题</span></span><br><span class="line">            Header(&#123;<span class="attr">title</span>: <span class="string">&quot;百亿补贴&quot;</span>&#125;).margin(&#123;<span class="attr">bottom</span>: <span class="number">20</span>&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自定义构建函数"><a href="#自定义构建函数" class="headerlink" title="自定义构建函数"></a>自定义构建函数</h2><h3 id="全局自定义构建函数"><a href="#全局自定义构建函数" class="headerlink" title="全局自定义构建函数"></a>全局自定义构建函数</h3><p>可以定义在组件外部，并且可以接受参数</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局自定义构建函数,函数前面加上 @Builder</span></span><br><span class="line"><span class="meta">@Builder</span> <span class="function"><span class="keyword">function</span> <span class="title">ItemCar</span>(<span class="params">item: Item</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 每一个商品卡片</span></span><br><span class="line">    Row()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 左侧商品图片</span></span><br><span class="line">        Image(item.img)</span><br><span class="line">            .width(<span class="string">&quot;30%&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ......</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用方法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">build()</span><br><span class="line">&#123;</span><br><span class="line">    Column()</span><br><span class="line">    &#123;</span><br><span class="line">        Header(&#123;<span class="attr">title</span>: <span class="string">&quot;百亿补贴&quot;</span>&#125;).margin(&#123;<span class="attr">bottom</span>: <span class="number">20</span>&#125;)</span><br><span class="line"></span><br><span class="line">        List(&#123;<span class="attr">space</span>: <span class="number">15</span>&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            ForEach(<span class="built_in">this</span>.ItemList, <span class="function">(<span class="params">item: Item</span>) =&gt;</span> &#123;</span><br><span class="line">                ListItem()</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 使用自定义构建函数</span></span><br><span class="line">                    ItemCar(item)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="局部构建函数"><a href="#局部构建函数" class="headerlink" title="局部构建函数"></a>局部构建函数</h3><p>和全局定义构建函数类似，不需要添加 function 关键词，必须和 build 函数同级，不能放在 build 函数内部</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 局部自定义构建函数</span></span><br><span class="line"><span class="meta">@Builder</span> <span class="function"><span class="keyword">function</span> <span class="title">ItemCar</span>(<span class="params">item: Item</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 每一个商品卡片</span></span><br><span class="line">    Row()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 左侧商品图片</span></span><br><span class="line">        Image(item.img)</span><br><span class="line">            .width(<span class="string">&quot;30%&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ......</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用局部构建函数时要添加 this.xxx</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">build()</span><br><span class="line">&#123;</span><br><span class="line">    Column()</span><br><span class="line">    &#123;</span><br><span class="line">        Header(&#123;<span class="attr">title</span>: <span class="string">&quot;百亿补贴&quot;</span>&#125;).margin(&#123;<span class="attr">bottom</span>: <span class="number">20</span>&#125;)</span><br><span class="line"></span><br><span class="line">        List(&#123;<span class="attr">space</span>: <span class="number">15</span>&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            ForEach(<span class="built_in">this</span>.ItemList, <span class="function">(<span class="params">item: Item</span>) =&gt;</span> &#123;</span><br><span class="line">                ListItem()</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 使用自定义构建函数</span></span><br><span class="line">                    <span class="built_in">this</span>.ItemCar(item)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 局部自定义构建函数</span></span><br><span class="line"><span class="meta">@Builder</span> <span class="function"><span class="keyword">function</span> <span class="title">ItemCar</span>(<span class="params">item: Item</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 每一个商品卡片</span></span><br><span class="line">    Row()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 左侧商品图片</span></span><br><span class="line">        Image(item.img)</span><br><span class="line">            .width(<span class="string">&quot;30%&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ......</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="样式封装"><a href="#样式封装" class="headerlink" title="样式封装"></a>样式封装</h2><h3 id="公共样式封装"><a href="#公共样式封装" class="headerlink" title="公共样式封装"></a>公共样式封装</h3><p>封装公共样式包含的属性也必须是公共的属性，特殊组件的特殊属性不支持在公共样式内</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 公共样式封装</span></span><br><span class="line"><span class="meta">@Styles</span> <span class="function"><span class="keyword">function</span> <span class="title">pageCommonStyle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">.</span><br><span class="line">    padding(<span class="number">15</span>)</span><br><span class="line">        .width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">        .height(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">        .backgroundColor(<span class="string">&quot;#ececec&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">ItemsPage</span><br><span class="line">&#123;</span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//......</span></span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        pageCommonStyle() <span class="comment">// 使用公共样式</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义样式封装"><a href="#自定义样式封装" class="headerlink" title="自定义样式封装"></a>自定义样式封装</h3><p>可以封装特殊组件的样式</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 特殊组件的样式封装</span></span><br><span class="line"><span class="meta">@Extend</span>(Text) <span class="function"><span class="keyword">function</span> <span class="title">textStyle</span>(<span class="params">fontSize: <span class="built_in">number</span></span>) </span>&#123;</span><br><span class="line">.</span><br><span class="line">    fontSize(fontSize)</span><br><span class="line">        .fontColor(Color.Red)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 折扣价</span></span><br><span class="line">Row()</span><br><span class="line">&#123;</span><br><span class="line">    Text(<span class="string">`补贴 ￥<span class="subst">$&#123;item.discount&#125;</span>`</span>)</span><br><span class="line">        .textStyle(<span class="number">18</span>)</span><br><span class="line">&#125;</span><br><span class="line">.</span><br><span class="line">width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 现在价格</span></span><br><span class="line">Row()</span><br><span class="line">&#123;</span><br><span class="line">    Text(<span class="string">`折扣价 ￥<span class="subst">$&#123;item.price - item.discount&#125;</span>`</span>)</span><br><span class="line">        .textStyle(<span class="number">20</span>)</span><br><span class="line">&#125;</span><br><span class="line">.</span><br><span class="line">width(<span class="string">&quot;100%&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h2><h3 id="State"><a href="#State" class="headerlink" title="@State"></a>@State</h3><ul>
<li>@State装饰器标记的变量必须初始化，不能为空值</li>
<li>@State支持Object，class，string，number，boolean，enum类型以及这些类型的数组</li>
<li>嵌套类型以及数组中的对象属性发生变化，无法触发页面更新</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    name: <span class="built_in">string</span></span><br><span class="line">    age: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name, age</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name</span><br><span class="line">        <span class="built_in">this</span>.age = age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">Index</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    age</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">18</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    jack</span><br><span class="line">:</span><br><span class="line">    User = <span class="keyword">new</span> User(<span class="string">&quot;Jack&quot;</span>, <span class="number">19</span>)</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    gfs</span><br><span class="line">:</span><br><span class="line">    User[] = [</span><br><span class="line">        <span class="keyword">new</span> User(<span class="string">&quot;露丝&quot;</span>, <span class="number">18</span>),</span><br><span class="line">        <span class="keyword">new</span> User(<span class="string">&quot;玛丽&quot;</span>, <span class="number">20</span>)</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Row()&#123;</span></span><br><span class="line">            <span class="comment">//   Text(`$&#123;this.age&#125;`)</span></span><br><span class="line">            <span class="comment">//     .fontSize(25)</span></span><br><span class="line">            <span class="comment">//     .onClick(()=&gt;&#123;</span></span><br><span class="line">            <span class="comment">//       // 基础类型的数据变化可以触发页面更新</span></span><br><span class="line">            <span class="comment">//       this.age++</span></span><br><span class="line">            <span class="comment">//     &#125;)</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.jack.name&#125;</span> <span class="subst">$&#123;<span class="built_in">this</span>.jack.age&#125;</span>`</span>)</span><br><span class="line">                    .fontSize(<span class="number">30</span>)</span><br><span class="line">                    .fontWeight(FontWeight.Bold)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="comment">// 单层对象的内容是可以实时响应的</span></span><br><span class="line">                        <span class="built_in">this</span>.jack.age++</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="string">`===女友列表===`</span>)</span><br><span class="line">                    .fontSize(<span class="number">25</span>)</span><br><span class="line">                    .fontWeight(FontWeight.Bold)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .margin(&#123;<span class="attr">top</span>: <span class="number">20</span>&#125;)</span><br><span class="line">                .justifyContent(FlexAlign.Center)</span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Button(<span class="string">&quot;增加&quot;</span>).onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// 新增一项也可以触发更新</span></span><br><span class="line">                    <span class="built_in">this</span>.gfs.push(<span class="keyword">new</span> User(<span class="string">`女友<span class="subst">$&#123;<span class="built_in">this</span>.gfs.length&#125;</span>`</span>, <span class="number">18</span>))</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ForEach(<span class="built_in">this</span>.gfs, <span class="function">(<span class="params">gf: User, index</span>) =&gt;</span> &#123;</span><br><span class="line">                Row()</span><br><span class="line">                &#123;</span><br><span class="line">                    Text(<span class="string">`<span class="subst">$&#123;gf.name&#125;</span> <span class="subst">$&#123;gf.age&#125;</span>`</span>)</span><br><span class="line">                        .fontSize(<span class="number">30</span>)</span><br><span class="line">                        .fontWeight(FontWeight.Bold)</span><br><span class="line">                        .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            <span class="comment">// 嵌套层级的数据改变，不会触发页面更新</span></span><br><span class="line">                            gf.age++</span><br><span class="line">                        &#125;)</span><br><span class="line"></span><br><span class="line">                    Button(<span class="string">&quot;删除&quot;</span>).onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="comment">// 删除数组可以触发更新</span></span><br><span class="line">                        <span class="built_in">this</span>.gfs.splice(index, <span class="number">1</span>)</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            .</span><br><span class="line">                margin(&#123;<span class="attr">top</span>: <span class="number">20</span>&#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .padding(<span class="number">20</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240311175038381.png" alt="image-20240311175038381"></p>
<h3 id="任务列表Demo"><a href="#任务列表Demo" class="headerlink" title="任务列表Demo"></a>任务列表Demo</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 任务对象</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> id = <span class="number">1</span></span><br><span class="line">    name: <span class="built_in">string</span></span><br><span class="line">    finish: <span class="built_in">boolean</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = <span class="string">`任务<span class="subst">$&#123;Task.id++&#125;</span>`</span></span><br><span class="line">        <span class="built_in">this</span>.finish = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义卡片公共样式</span></span><br><span class="line"><span class="meta">@Styles</span> <span class="function"><span class="keyword">function</span> <span class="title">carStyle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">.</span><br><span class="line">    borderRadius(<span class="number">8</span>)</span><br><span class="line">        .shadow(&#123;</span><br><span class="line">            radius: <span class="number">20</span>,</span><br><span class="line">            color: <span class="string">&quot;#bbb&quot;</span>,</span><br><span class="line">            offsetX: <span class="number">3</span>,</span><br><span class="line">            offsetY: <span class="number">4</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .backgroundColor(Color.White)</span><br><span class="line">        .width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FinishColor = <span class="string">&quot;#36D&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">TaskList</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 任务总数量</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    taskTotal</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 已完成数量</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    finishTotal</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 任务数组</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    taskList</span><br><span class="line">:</span><br><span class="line">    Task[] = [</span><br><span class="line">        <span class="keyword">new</span> Task(),</span><br><span class="line">        <span class="keyword">new</span> Task()</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    handleTaskChange()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.taskTotal = <span class="built_in">this</span>.taskList.length</span><br><span class="line">        <span class="built_in">this</span>.finishTotal = <span class="built_in">this</span>.taskList.filter(<span class="function"><span class="params">i</span> =&gt;</span> i.finish).length</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onPageShow()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.handleTaskChange()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="string">&quot;任务列表&quot;</span>)</span><br><span class="line">                    .fontSize(<span class="number">25</span>)</span><br><span class="line">                    .fontWeight(FontWeight.Bold)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 栈组件，让多个组件堆叠在一起</span></span><br><span class="line">                Stack()</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 进度条</span></span><br><span class="line">                    Progress(&#123;</span><br><span class="line">                        value: <span class="built_in">this</span>.finishTotal,</span><br><span class="line">                        total: <span class="built_in">this</span>.taskTotal,</span><br><span class="line">                        <span class="keyword">type</span>: ProgressType.ScaleRing <span class="comment">// 设置成环形进度条</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                        .width(<span class="number">100</span>)</span><br><span class="line">                        .color(FinishColor)</span><br><span class="line">                        .style(&#123;</span><br><span class="line">                            strokeWidth: <span class="number">5</span></span><br><span class="line">                        &#125;)</span><br><span class="line"></span><br><span class="line">                    Row()</span><br><span class="line">                    &#123;</span><br><span class="line">                        Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.finishTotal&#125;</span>`</span>)</span><br><span class="line">                            .fontColor(FinishColor)</span><br><span class="line">                            .fontSize(<span class="number">25</span>)</span><br><span class="line"></span><br><span class="line">                        Text(<span class="string">` / <span class="subst">$&#123;<span class="built_in">this</span>.taskTotal&#125;</span>`</span>)</span><br><span class="line">                            .fontSize(<span class="number">25</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            carStyle()</span><br><span class="line">                .padding(<span class="number">35</span>)</span><br><span class="line">                .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Button(<span class="string">&quot;添加任务&quot;</span>)</span><br><span class="line">                    .width(<span class="number">200</span>)</span><br><span class="line">                    .margin(&#123;<span class="attr">top</span>: <span class="number">30</span>, <span class="attr">bottom</span>: <span class="number">30</span>&#125;)</span><br><span class="line">                    .backgroundColor(FinishColor)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.taskList.push(<span class="keyword">new</span> Task())</span><br><span class="line">                        <span class="built_in">this</span>.handleTaskChange()</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            List(&#123;<span class="attr">space</span>: <span class="number">20</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                ForEach(<span class="built_in">this</span>.taskList, <span class="function">(<span class="params">task: Task, index</span>) =&gt;</span> &#123;</span><br><span class="line">                    ListItem()</span><br><span class="line">                    &#123;</span><br><span class="line">                        Row()</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">if</span> (task.finish) &#123;</span><br><span class="line">                                Text(<span class="string">`<span class="subst">$&#123;task.name&#125;</span>`</span>)</span><br><span class="line">                                    .fontColor(<span class="string">&quot;#ccc&quot;</span>)</span><br><span class="line">                                    .decoration(&#123;<span class="attr">type</span>: TextDecorationType.LineThrough&#125;)</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                Text(<span class="string">`<span class="subst">$&#123;task.name&#125;</span>`</span>)</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            Checkbox()</span><br><span class="line">                                .select(task.finish)</span><br><span class="line">                                .selectedColor(FinishColor)</span><br><span class="line">                                .onChange(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">                                    task.finish = val</span><br><span class="line">                                    <span class="built_in">this</span>.handleTaskChange()</span><br><span class="line">                                &#125;)</span><br><span class="line">                        &#125;</span><br><span class="line">                    .</span><br><span class="line">                        carStyle()</span><br><span class="line">                            .padding(<span class="number">20</span>)</span><br><span class="line">                            .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line">                    &#125;</span><br><span class="line">                .</span><br><span class="line">                    swipeAction(&#123; <span class="comment">// 往左边滑动时出现自定义的构建函数</span></span><br><span class="line">                        end: <span class="built_in">this</span>.deleteBuilder(index)</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .layoutWeight(<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .height(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .padding(<span class="number">15</span>)</span><br><span class="line">            .backgroundColor(<span class="string">&quot;#ececec&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line">    deleteBuilder(index)</span><br><span class="line">    &#123;</span><br><span class="line">        Button()</span><br><span class="line">        &#123;</span><br><span class="line">            Image($r(<span class="string">&quot;app.media.deleteIcon&quot;</span>))</span><br><span class="line">                .width(<span class="number">20</span>)</span><br><span class="line">                .interpolation(ImageInterpolation.High)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="number">40</span>)</span><br><span class="line">            .height(<span class="number">40</span>)</span><br><span class="line">            .margin(&#123;<span class="attr">left</span>: <span class="number">15</span>&#125;)</span><br><span class="line">            .backgroundColor(Color.Red)</span><br><span class="line">            .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.taskList.splice(index, <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">this</span>.handleTaskChange()</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/tasklist.gif" alt="tasklist"></p>
<h3 id="Prop和-Link"><a href="#Prop和-Link" class="headerlink" title="@Prop和@Link"></a>@Prop和@Link</h3><table>
<thead>
<tr>
<th></th>
<th>@prop</th>
<th>@LInk</th>
</tr>
</thead>
<tbody><tr>
<td>同步类型</td>
<td>单项同步</td>
<td>双向同步</td>
</tr>
<tr>
<td>允许装饰的变量类型</td>
<td>@Prop只支持string、number、boolean、enum类型<br />父组件是对象类型，子组件是对象属性<br />不可以是数组、any</td>
<td>父子类型一致：string、number、boolean、enum、object、class、以及他们的数组<br />数组中的元素增、删、改、查等都会引起刷新<br />嵌套类型以及数组中的对象属性无法引起刷新</td>
</tr>
<tr>
<td>初始化方式</td>
<td>不允许子组件进行初始化</td>
<td>父组件传递、禁止子组件进进行初始化</td>
</tr>
</tbody></table>
<p>现在我们使用@Prop和@Link将上面的代码进行组件封装</p>
<p>新建 <code>components/taskComponents/HeaderCar</code> 定义顶部卡片组件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> FinishColor = <span class="string">&quot;#36D&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义卡片公共样式</span></span><br><span class="line"><span class="meta">@Styles</span> <span class="function"><span class="keyword">function</span> <span class="title">carStyle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">.</span><br><span class="line">    borderRadius(<span class="number">8</span>)</span><br><span class="line">        .shadow(&#123;</span><br><span class="line">            radius: <span class="number">20</span>,</span><br><span class="line">            color: <span class="string">&quot;#bbb&quot;</span>,</span><br><span class="line">            offsetX: <span class="number">3</span>,</span><br><span class="line">            offsetY: <span class="number">4</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .backgroundColor(Color.White)</span><br><span class="line">        .width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span></span><br><span class="line">struct</span><br><span class="line">HeaderCar</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 定义从父组件接收的字段</span></span><br><span class="line"><span class="meta">@Prop</span></span><br><span class="line">    finishTotal</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line"><span class="meta">@Prop</span></span><br><span class="line">    taskTotal</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            Text(<span class="string">&quot;任务列表&quot;</span>)</span><br><span class="line">                .fontSize(<span class="number">25</span>)</span><br><span class="line">                .fontWeight(FontWeight.Bold)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 栈组件，让多个组件堆叠在一起</span></span><br><span class="line">            Stack()</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 进度条</span></span><br><span class="line">                Progress(&#123;</span><br><span class="line">                    value: <span class="built_in">this</span>.finishTotal,</span><br><span class="line">                    total: <span class="built_in">this</span>.taskTotal,</span><br><span class="line">                    <span class="keyword">type</span>: ProgressType.ScaleRing <span class="comment">// 设置成环形进度条</span></span><br><span class="line">                &#125;)</span><br><span class="line">                    .width(<span class="number">100</span>)</span><br><span class="line">                    .color(FinishColor)</span><br><span class="line">                    .style(&#123;</span><br><span class="line">                        strokeWidth: <span class="number">5</span></span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                Row()</span><br><span class="line">                &#123;</span><br><span class="line">                    Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.finishTotal&#125;</span>`</span>)</span><br><span class="line">                        .fontColor(FinishColor)</span><br><span class="line">                        .fontSize(<span class="number">25</span>)</span><br><span class="line"></span><br><span class="line">                    Text(<span class="string">` / <span class="subst">$&#123;<span class="built_in">this</span>.taskTotal&#125;</span>`</span>)</span><br><span class="line">                        .fontSize(<span class="number">25</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        carStyle()</span><br><span class="line">            .padding(<span class="number">35</span>)</span><br><span class="line">            .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建 <code>components/taskComponents/TaskListItem</code> 封装任务列表组件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> id = <span class="number">1</span></span><br><span class="line">    name: <span class="built_in">string</span></span><br><span class="line">    finish: <span class="built_in">boolean</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = <span class="string">`任务<span class="subst">$&#123;Task.id++&#125;</span>`</span></span><br><span class="line">        <span class="built_in">this</span>.finish = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义卡片公共样式</span></span><br><span class="line"><span class="meta">@Styles</span> <span class="function"><span class="keyword">function</span> <span class="title">carStyle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">.</span><br><span class="line">    borderRadius(<span class="number">8</span>)</span><br><span class="line">        .shadow(&#123;</span><br><span class="line">            radius: <span class="number">20</span>,</span><br><span class="line">            color: <span class="string">&quot;#bbb&quot;</span>,</span><br><span class="line">            offsetX: <span class="number">3</span>,</span><br><span class="line">            offsetY: <span class="number">4</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .backgroundColor(Color.White)</span><br><span class="line">        .width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FinishColor = <span class="string">&quot;#36D&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span></span><br><span class="line">struct</span><br><span class="line">TaskItem</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@Link</span></span><br><span class="line">    taskTotal</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line"><span class="meta">@Link</span></span><br><span class="line">    finishTotal</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    taskList</span><br><span class="line">:</span><br><span class="line">    Task[] = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    handleTaskChange()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.taskTotal = <span class="built_in">this</span>.taskList.length</span><br><span class="line">        <span class="built_in">this</span>.finishTotal = <span class="built_in">this</span>.taskList.filter(<span class="function"><span class="params">i</span> =&gt;</span> i.finish).length</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Button(<span class="string">&quot;添加任务&quot;</span>)</span><br><span class="line">                .width(<span class="number">200</span>)</span><br><span class="line">                .margin(&#123;<span class="attr">top</span>: <span class="number">30</span>, <span class="attr">bottom</span>: <span class="number">30</span>&#125;)</span><br><span class="line">                .backgroundColor(FinishColor)</span><br><span class="line">                .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.taskList.push(<span class="keyword">new</span> Task())</span><br><span class="line">                    <span class="built_in">this</span>.handleTaskChange()</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                List(&#123;<span class="attr">space</span>: <span class="number">20</span>&#125;)</span><br><span class="line">                &#123;</span><br><span class="line">                    ForEach(<span class="built_in">this</span>.taskList, <span class="function">(<span class="params">task: Task, index</span>) =&gt;</span> &#123;</span><br><span class="line">                        ListItem()</span><br><span class="line">                        &#123;</span><br><span class="line">                            Row()</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="keyword">if</span> (task.finish) &#123;</span><br><span class="line">                                    Text(<span class="string">`<span class="subst">$&#123;task.name&#125;</span>`</span>)</span><br><span class="line">                                        .fontColor(<span class="string">&quot;#ccc&quot;</span>)</span><br><span class="line">                                        .decoration(&#123;<span class="attr">type</span>: TextDecorationType.LineThrough&#125;)</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    Text(<span class="string">`<span class="subst">$&#123;task.name&#125;</span>`</span>)</span><br><span class="line">                                &#125;</span><br><span class="line"></span><br><span class="line">                                Checkbox()</span><br><span class="line">                                    .select(task.finish)</span><br><span class="line">                                    .selectedColor(FinishColor)</span><br><span class="line">                                    .onChange(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">                                        task.finish = val</span><br><span class="line">                                        <span class="built_in">this</span>.handleTaskChange()</span><br><span class="line">                                    &#125;)</span><br><span class="line">                            &#125;</span><br><span class="line">                        .</span><br><span class="line">                            carStyle()</span><br><span class="line">                                .padding(<span class="number">20</span>)</span><br><span class="line">                                .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line">                        &#125;</span><br><span class="line">                    .</span><br><span class="line">                        swipeAction(&#123; <span class="comment">// 往左边滑动时出现自定义的构建函数</span></span><br><span class="line">                            end: <span class="built_in">this</span>.deleteBuilder(index)</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            .</span><br><span class="line">                width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                    .layoutWeight(<span class="number">1</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自定义删除按钮的构建函数</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line">    deleteBuilder(index)</span><br><span class="line">    &#123;</span><br><span class="line">        Button()</span><br><span class="line">        &#123;</span><br><span class="line">            Image($r(<span class="string">&quot;app.media.deleteIcon&quot;</span>))</span><br><span class="line">                .width(<span class="number">20</span>)</span><br><span class="line">                .interpolation(ImageInterpolation.High)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="number">40</span>)</span><br><span class="line">            .height(<span class="number">40</span>)</span><br><span class="line">            .margin(&#123;<span class="attr">left</span>: <span class="number">15</span>&#125;)</span><br><span class="line">            .backgroundColor(Color.Red)</span><br><span class="line">            .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.taskList.splice(index, <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">this</span>.handleTaskChange()</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后父组件引用上面个子组件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 任务对象</span></span><br><span class="line"><span class="keyword">import</span> &#123;HeaderCar&#125; <span class="keyword">from</span> <span class="string">&#x27;../components/taskComponents/HeaderCar&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;TaskItem&#125; <span class="keyword">from</span> <span class="string">&#x27;../components/taskComponents/TaskListItem&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">TaskList</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 任务总数量</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    taskTotal</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 已完成数量</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    finishTotal</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    onPageShow()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 调用子组件的方法</span></span><br><span class="line">        TaskItem.prototype.handleTaskChange()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 头部卡片</span></span><br><span class="line">            HeaderCar(&#123;</span><br><span class="line">                taskTotal: <span class="built_in">this</span>.taskTotal,</span><br><span class="line">                finishTotal: <span class="built_in">this</span>.finishTotal</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 底部的任务列表组件</span></span><br><span class="line">            TaskItem(&#123;</span><br><span class="line">                taskTotal: $taskTotal,</span><br><span class="line">                finishTotal: $finishTotal</span><br><span class="line">            &#125;)</span><br><span class="line">                .layoutWeight(<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .height(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .padding(<span class="number">15</span>)</span><br><span class="line">            .backgroundColor(<span class="string">&quot;#ececec&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果一致</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240311213516805.png" alt="image-20240311213516805"></p>
<h3 id="Provide和-Consume"><a href="#Provide和-Consume" class="headerlink" title="@Provide和@Consume"></a>@Provide和@Consume</h3><p>@Provide和@Consume适用于跨组件传递数据的场景</p>
<p>在父组件定义一个变量，并且用@Provide修饰，然后子组件或者孙子组件使用@Consume修饰接收的变量，然后父组件引用这些子组件时不需要传递参数，子组件可以自动的获取父组件的变量值。并且支持双向同步</p>
<p>代码示例</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">ProvidePage</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@Provide</span></span><br><span class="line">    name</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span> = <span class="string">&quot;李四&quot;</span></span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="string">`父组件的值：<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>)</span><br><span class="line">                    .fontSize(<span class="number">30</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 定义子组件</span></span><br><span class="line">            NameCom()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">NameCom</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@Consume</span></span><br><span class="line">    name</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span></span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                TextInput(&#123;</span><br><span class="line">                    text: <span class="built_in">this</span>.name</span><br><span class="line">                &#125;)</span><br><span class="line">                    .onChange(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.name = val</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果展示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/Provide.gif" alt="Provide"></p>
<h3 id="Observed和-ObjectLink"><a href="#Observed和-ObjectLink" class="headerlink" title="@Observed和@ObjectLink"></a>@Observed和@ObjectLink</h3><p>上面我们知道，嵌套的字段发生改变时，页面不会刷新。为了解决这个问题，我们就要使用 @Observed和@ObjectLink</p>
<p>现在我们来修改任务列表这个代码，我们发现点击完右侧的复选框后，文字的样式并没有发生变化</p>
<p>修改 <code>components/taskComponents/TaskListItem</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Observed</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> id = <span class="number">1</span></span><br><span class="line">    name: <span class="built_in">string</span></span><br><span class="line">    finish: <span class="built_in">boolean</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = <span class="string">`任务<span class="subst">$&#123;Task.id++&#125;</span>`</span></span><br><span class="line">        <span class="built_in">this</span>.finish = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义卡片公共样式</span></span><br><span class="line"><span class="meta">@Styles</span> <span class="function"><span class="keyword">function</span> <span class="title">carStyle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">.</span><br><span class="line">    borderRadius(<span class="number">8</span>)</span><br><span class="line">        .shadow(&#123;</span><br><span class="line">            radius: <span class="number">20</span>,</span><br><span class="line">            color: <span class="string">&quot;#bbb&quot;</span>,</span><br><span class="line">            offsetX: <span class="number">3</span>,</span><br><span class="line">            offsetY: <span class="number">4</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .backgroundColor(Color.White)</span><br><span class="line">        .width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FinishColor = <span class="string">&quot;#36D&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span></span><br><span class="line">struct</span><br><span class="line">TaskItem</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@Link</span></span><br><span class="line">    taskTotal</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line"><span class="meta">@Link</span></span><br><span class="line">    finishTotal</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    taskList</span><br><span class="line">:</span><br><span class="line">    Task[] = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    handleTaskChange()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.taskTotal = <span class="built_in">this</span>.taskList.length</span><br><span class="line">        <span class="built_in">this</span>.finishTotal = <span class="built_in">this</span>.taskList.filter(<span class="function"><span class="params">i</span> =&gt;</span> i.finish).length</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Button(<span class="string">&quot;添加任务&quot;</span>)</span><br><span class="line">                .width(<span class="number">200</span>)</span><br><span class="line">                .margin(&#123;<span class="attr">top</span>: <span class="number">30</span>, <span class="attr">bottom</span>: <span class="number">30</span>&#125;)</span><br><span class="line">                .backgroundColor(FinishColor)</span><br><span class="line">                .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.taskList.push(<span class="keyword">new</span> Task())</span><br><span class="line">                    <span class="built_in">this</span>.handleTaskChange()</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                List(&#123;<span class="attr">space</span>: <span class="number">20</span>&#125;)</span><br><span class="line">                &#123;</span><br><span class="line">                    ForEach(<span class="built_in">this</span>.taskList, <span class="function">(<span class="params">task: Task, index</span>) =&gt;</span> &#123;</span><br><span class="line">                        ListItem()</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="comment">// 每一行组件</span></span><br><span class="line">                            RowItem(&#123;</span><br><span class="line">                                task: task,</span><br><span class="line">                                <span class="comment">// 将父组件定义的方法传递给子组件，并绑定this为父组件的this</span></span><br><span class="line">                                handleTaskChange: <span class="built_in">this</span>.handleTaskChange.bind(<span class="built_in">this</span>)</span><br><span class="line">                            &#125;)</span><br><span class="line">                        &#125;</span><br><span class="line">                    .</span><br><span class="line">                        swipeAction(&#123; <span class="comment">// 往左边滑动时出现自定义的构建函数</span></span><br><span class="line">                            end: <span class="built_in">this</span>.deleteBuilder(index)</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            .</span><br><span class="line">                width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                    .layoutWeight(<span class="number">1</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自定义删除按钮的构建函数</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line">    deleteBuilder(index)</span><br><span class="line">    &#123;</span><br><span class="line">        Button()</span><br><span class="line">        &#123;</span><br><span class="line">            Image($r(<span class="string">&quot;app.media.deleteIcon&quot;</span>))</span><br><span class="line">                .width(<span class="number">20</span>)</span><br><span class="line">                .interpolation(ImageInterpolation.High)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="number">40</span>)</span><br><span class="line">            .height(<span class="number">40</span>)</span><br><span class="line">            .margin(&#123;<span class="attr">left</span>: <span class="number">15</span>&#125;)</span><br><span class="line">            .backgroundColor(Color.Red)</span><br><span class="line">            .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.taskList.splice(index, <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">this</span>.handleTaskChange()</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">RowItem</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@ObjectLink</span></span><br><span class="line">    task</span><br><span class="line">:</span><br><span class="line">    Task</span><br><span class="line">    handleTaskChange: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line"></span><br><span class="line">        build()</span><br><span class="line">    &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.task.finish) &#123;</span><br><span class="line">                Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.task.name&#125;</span>`</span>)</span><br><span class="line">                    .fontColor(<span class="string">&quot;#ccc&quot;</span>)</span><br><span class="line">                    .decoration(&#123;<span class="attr">type</span>: TextDecorationType.LineThrough&#125;)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.task.name&#125;</span>`</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Checkbox()</span><br><span class="line">                .select(<span class="built_in">this</span>.task.finish)</span><br><span class="line">                .selectedColor(FinishColor)</span><br><span class="line">                .onChange(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.task.finish = val</span><br><span class="line">                    <span class="built_in">this</span>.handleTaskChange()</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        carStyle()</span><br><span class="line">            .padding(<span class="number">20</span>)</span><br><span class="line">            .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>给 <code>class Task</code> 添加了 @Observe 修饰，然后将每一行做了组件抽离，并接收参数，使用 @ObjectLink 修饰</p>
<p>然后我们需要在RowItem组件中调用父组件的handleTaskChange方法，所以定义了一个handleTaskChange参数，通过父组件传递过来，但是在子组件调用时，this指向会发生变化，所以父组件在传递方法时，使用bind改变这个方法内部的this指向</p>
<p>现在代码的运行效果就是正常的</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/Observe.gif" alt="Observe"></p>
<h2 id="页面路由"><a href="#页面路由" class="headerlink" title="页面路由"></a>页面路由</h2><ol>
<li>页面栈的最大容量上限是32个，使用 <code>router.clear()</code> 方法可以清空页面栈，释放内存</li>
<li>Router有两种跳转模式，分别为：<ul>
<li>router.pushUrl()：目标页面不会替换当前页面，而是压入页面栈，因此可以用 <code>router.back()</code> 返回当前页面</li>
<li>router.replaceUrl()：目标页面会替换当前页面，当前页面会被销毁并释放资源，无法返回当前页面</li>
</ul>
</li>
<li>Router有两种页面实例模式，分别是：<ul>
<li>Standard：标准页面实例，每次跳转都会新建一个目标页面压入页面栈，默认就是此模式</li>
<li>Single：单实例模式，如果目标页已经在页面栈中，则距离页面栈顶部最近的同Url页面会被移动到栈顶，并重新加载</li>
</ul>
</li>
</ol>
<p>修改首页代码</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RouterItem</span> </span>&#123;</span><br><span class="line">    url: <span class="built_in">string</span></span><br><span class="line">    title: <span class="built_in">string</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">url, title</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.url = url</span><br><span class="line">        <span class="built_in">this</span>.title = title</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">Index</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    message</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span> = <span class="string">&#x27;页面列表&#x27;</span></span><br><span class="line">    routerList: RouterItem[] = [</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/ImagePage&quot;</span>, <span class="string">&quot;查看图片页面&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/ItemsPage&quot;</span>, <span class="string">&quot;商品列表页面&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/StatePage&quot;</span>, <span class="string">&quot;Jack和他的女朋友们&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/TaskListPage&quot;</span>, <span class="string">&quot;任务列表&quot;</span>),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="built_in">this</span>.message)</span><br><span class="line">                    .fontSize(<span class="number">50</span>)</span><br><span class="line">                    .fontWeight(FontWeight.Bold)</span><br><span class="line">                    .fontColor(<span class="string">&quot;#36d&quot;</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.message = <span class="string">&quot;Hello ArkTS&quot;</span></span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            List(&#123;<span class="attr">space</span>: <span class="number">20</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                ForEach(<span class="built_in">this</span>.routerList, <span class="function">(<span class="params">r: RouterItem, index: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">                    ListItem()</span><br><span class="line">                    &#123;</span><br><span class="line">                        RouterItemBox(&#123;</span><br><span class="line">                            item: r,</span><br><span class="line">                            rid: index + <span class="number">1</span></span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .margin(&#123;<span class="attr">top</span>: <span class="number">35</span>&#125;)</span><br><span class="line">                .layoutWeight(<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .height(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .padding(<span class="number">15</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">RouterItemBox</span><br><span class="line">&#123;</span><br><span class="line">    item: RouterItem</span><br><span class="line">    rid: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.rid&#125;</span>.`</span>)</span><br><span class="line">                .fontColor(Color.White)</span><br><span class="line">                .fontSize(<span class="number">18</span>)</span><br><span class="line">                .fontWeight(FontWeight.Bold)</span><br><span class="line">            Blank()</span><br><span class="line">            Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.item.title&#125;</span>`</span>)</span><br><span class="line">                .fontColor(Color.White)</span><br><span class="line">                .fontSize(<span class="number">18</span>)</span><br><span class="line">                .fontWeight(FontWeight.Bold)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .padding(&#123;</span><br><span class="line">                top: <span class="number">15</span>,</span><br><span class="line">                right: <span class="number">25</span>,</span><br><span class="line">                bottom: <span class="number">15</span>,</span><br><span class="line">                left: <span class="number">25</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .backgroundColor(<span class="string">&quot;#36D&quot;</span>)</span><br><span class="line">            .borderRadius(<span class="number">30</span>)</span><br><span class="line">            .shadow(&#123;</span><br><span class="line">                radius: <span class="number">8</span>,</span><br><span class="line">                color: <span class="string">&quot;#ff484848&quot;</span>,</span><br><span class="line">                offsetX: <span class="number">5</span>,</span><br><span class="line">                offsetY: <span class="number">5</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line">            .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                router.pushUrl(</span><br><span class="line">                    &#123;</span><br><span class="line">                        url: <span class="built_in">this</span>.item.url</span><br><span class="line">                    &#125;,</span><br><span class="line">                    router.RouterMode.Single,</span><br><span class="line">                    err =&gt; &#123;</span><br><span class="line">                        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                            <span class="built_in">console</span>.log(<span class="string">`页面跳转出错，errCode：<span class="subst">$&#123;err.code&#125;</span>，errMsg：<span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改公共的Header组件，添加点击返回功能</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义Header组件</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span></span><br><span class="line">struct</span><br><span class="line">Header</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 定义参数，父组件使用时通过参数传递过来</span></span><br><span class="line"><span class="keyword">private</span></span><br><span class="line">    title:<span class="built_in">string</span></span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 顶部标题</span></span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            Row(&#123;<span class="attr">space</span>: <span class="number">15</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Image($r(<span class="string">&quot;app.media.back&quot;</span>))</span><br><span class="line">                    .width(<span class="number">30</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="comment">// 返回前确认弹框,用户点击确认后，才会继续往下执行代码。否则不会继续往下执行</span></span><br><span class="line">                        router.showAlertBeforeBackPage(&#123;</span><br><span class="line">                            message: <span class="string">&quot;确认离开当前页面吗?&quot;</span>,</span><br><span class="line">                        &#125;)</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// 返回上一页</span></span><br><span class="line">                        router.back()</span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                Text(<span class="built_in">this</span>.title)</span><br><span class="line">                    .fontSize(<span class="number">20</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            Image($r(<span class="string">&quot;app.media.refresh&quot;</span>))</span><br><span class="line">                .width(<span class="number">25</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .padding(&#123;</span><br><span class="line">                left: <span class="number">15</span>,</span><br><span class="line">                right: <span class="number">15</span>,</span><br><span class="line">                top: <span class="number">15</span>,</span><br><span class="line">                bottom: <span class="number">15</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .alignItems(VerticalAlign.Center)</span><br><span class="line">            .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后需要配置页面地址，找到 <code>resources/base/profile/main_pages.json</code> 文件，添加页面路由信息</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;src&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;pages/Index&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pages/ImagePage&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pages/ItemsPage&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pages/StatePage&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pages/TaskListPage&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果不配置，则不会跳转</p>
<p>另外，在新建时，可以选择新建 Page，这样会自动的往该文件中添加路由信息</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240312154237370.png" alt="image-20240312154237370"></p>
<p>效果展示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/ohmoRouter2.gif" alt="ohmoRouter2"></p>
<h2 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h2><h3 id="属性动画"><a href="#属性动画" class="headerlink" title="属性动画"></a>属性动画</h3><p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240312155633801.png" alt="image-20240312155633801"></p>
<p>实例代码</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">AnimationPage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 小鱼坐标</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    fishX</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">200</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    fishY</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">180</span></span><br><span class="line">    <span class="comment">// 小鱼角度</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    angle</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 小鱼图片</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    src</span><br><span class="line">:</span><br><span class="line">    Resource = $r(<span class="string">&quot;app.media.yu&quot;</span>)</span><br><span class="line">    <span class="comment">// 是否开始游戏</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    isBegin</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">    <span class="comment">// 移动速度</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    speed</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">20</span></span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            Stack()</span><br><span class="line">            &#123;</span><br><span class="line">                Button(<span class="string">&quot;返回&quot;</span>)</span><br><span class="line">                    .position(&#123;<span class="attr">x</span>: <span class="number">15</span>, <span class="attr">y</span>: <span class="number">15</span>&#125;)</span><br><span class="line">                    .width(<span class="number">80</span>)</span><br><span class="line">                    .backgroundColor(<span class="string">&quot;#bc515151&quot;</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        router.back()</span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!<span class="built_in">this</span>.isBegin) &#123;</span><br><span class="line">                    Button(<span class="string">&quot;开始游戏&quot;</span>)</span><br><span class="line">                        .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            <span class="built_in">this</span>.isBegin = <span class="literal">true</span></span><br><span class="line">                        &#125;)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Image(<span class="built_in">this</span>.src)</span><br><span class="line">                        .position(&#123;<span class="attr">x</span>: <span class="built_in">this</span>.fishX - <span class="number">40</span>, <span class="attr">y</span>: <span class="built_in">this</span>.fishY - <span class="number">40</span>&#125;)</span><br><span class="line">                        .rotate(&#123;<span class="attr">angle</span>: <span class="built_in">this</span>.angle, <span class="attr">centerX</span>: <span class="string">&quot;50%&quot;</span>, <span class="attr">centerY</span>: <span class="string">&quot;50%&quot;</span>&#125;)</span><br><span class="line">                        .width(<span class="number">80</span>)</span><br><span class="line">                        .height(<span class="number">80</span>)</span><br><span class="line">                        .animation(&#123;</span><br><span class="line">                            duration: <span class="number">500</span>, <span class="comment">// 动画时长,当上面的动画值发生变化时会触发动画</span></span><br><span class="line">                        &#125;)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 摇杆区域</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.isBegin) &#123;</span><br><span class="line">                    Row()</span><br><span class="line">                    &#123;</span><br><span class="line">                        Button(<span class="string">&quot;←&quot;</span>)</span><br><span class="line">                            .backgroundColor(<span class="string">&quot;#bc515151&quot;</span>)</span><br><span class="line">                            .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                <span class="built_in">this</span>.fishX -= <span class="built_in">this</span>.speed</span><br><span class="line">                                <span class="built_in">this</span>.src = $r(<span class="string">&quot;app.media.yu&quot;</span>)</span><br><span class="line">                            &#125;)</span><br><span class="line"></span><br><span class="line">                        Column(&#123;<span class="attr">space</span>: <span class="number">40</span>&#125;)</span><br><span class="line">                        &#123;</span><br><span class="line">                            Button(<span class="string">&quot;↑&quot;</span>)</span><br><span class="line">                                .backgroundColor(<span class="string">&quot;#bc515151&quot;</span>)</span><br><span class="line">                                .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                    <span class="built_in">this</span>.fishY -= <span class="built_in">this</span>.speed</span><br><span class="line">                                &#125;)</span><br><span class="line"></span><br><span class="line">                            Button(<span class="string">&quot;↓&quot;</span>)</span><br><span class="line">                                .backgroundColor(<span class="string">&quot;#bc515151&quot;</span>)</span><br><span class="line">                                .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                    <span class="built_in">this</span>.fishY += <span class="built_in">this</span>.speed</span><br><span class="line">                                &#125;)</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        Button(<span class="string">&quot;→&quot;</span>)</span><br><span class="line">                            .backgroundColor(<span class="string">&quot;#bc515151&quot;</span>)</span><br><span class="line">                            .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                <span class="built_in">this</span>.fishX += <span class="built_in">this</span>.speed</span><br><span class="line">                                <span class="built_in">this</span>.src = $r(<span class="string">&quot;app.media.yuR&quot;</span>)</span><br><span class="line">                            &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                .</span><br><span class="line">                    width(<span class="number">240</span>)</span><br><span class="line">                        .height(<span class="number">240</span>)</span><br><span class="line">                        .position(&#123;<span class="attr">x</span>: <span class="number">15</span>, <span class="attr">y</span>: <span class="number">150</span>&#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">                .width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        justifyContent(FlexAlign.Center)</span><br><span class="line">            .alignItems(VerticalAlign.Center)</span><br><span class="line">            .backgroundImage($r(<span class="string">&quot;app.media.yuBg&quot;</span>))</span><br><span class="line">            .backgroundImageSize(ImageSize.Cover) <span class="comment">// 背景图片铺满</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面代码完成了小鱼游动的效果，点击上下箭头，可以看到小鱼很平滑的在移动</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240312170542861.png" alt="image-20240312170542861"></p>
<h3 id="显示动画"><a href="#显示动画" class="headerlink" title="显示动画"></a>显示动画</h3><p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240312171446745.png" alt="image-20240312171446745"></p>
<p>修改上面的代码为显示动画</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">Stack()</span><br><span class="line">&#123;</span><br><span class="line">    Button(<span class="string">&quot;返回&quot;</span>)</span><br><span class="line">        .position(&#123;<span class="attr">x</span>: <span class="number">15</span>, <span class="attr">y</span>: <span class="number">15</span>&#125;)</span><br><span class="line">        .width(<span class="number">80</span>)</span><br><span class="line">        .backgroundColor(<span class="string">&quot;#bc515151&quot;</span>)</span><br><span class="line">        .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            router.back()</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.isBegin) &#123;</span><br><span class="line">        Button(<span class="string">&quot;开始游戏&quot;</span>)</span><br><span class="line">            .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.isBegin = <span class="literal">true</span></span><br><span class="line">            &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Image(<span class="built_in">this</span>.src)</span><br><span class="line">            .position(&#123;<span class="attr">x</span>: <span class="built_in">this</span>.fishX - <span class="number">40</span>, <span class="attr">y</span>: <span class="built_in">this</span>.fishY - <span class="number">40</span>&#125;)</span><br><span class="line">            .rotate(&#123;<span class="attr">angle</span>: <span class="built_in">this</span>.angle, <span class="attr">centerX</span>: <span class="string">&quot;50%&quot;</span>, <span class="attr">centerY</span>: <span class="string">&quot;50%&quot;</span>&#125;)</span><br><span class="line">            .width(<span class="number">80</span>)</span><br><span class="line">            .height(<span class="number">80</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 摇杆区域</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.isBegin) &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            Button(<span class="string">&quot;←&quot;</span>)</span><br><span class="line">                .backgroundColor(<span class="string">&quot;#bc515151&quot;</span>)</span><br><span class="line">                .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// 全局暴露的动画函数，第一个参数设置动画相关内容</span></span><br><span class="line">                    <span class="comment">// 第二个是修改的动画值</span></span><br><span class="line">                    animateTo(</span><br><span class="line">                        &#123;</span><br><span class="line">                            duration: <span class="number">500</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        () =&gt; &#123;</span><br><span class="line">                            <span class="built_in">this</span>.fishX -= <span class="built_in">this</span>.speed</span><br><span class="line">                            <span class="built_in">this</span>.src = $r(<span class="string">&quot;app.media.yu&quot;</span>)</span><br><span class="line">                        &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">            Column(&#123;<span class="attr">space</span>: <span class="number">40</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Button(<span class="string">&quot;↑&quot;</span>)</span><br><span class="line">                    .backgroundColor(<span class="string">&quot;#bc515151&quot;</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        animateTo(</span><br><span class="line">                            &#123;</span><br><span class="line">                                duration: <span class="number">500</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                            () =&gt; &#123;</span><br><span class="line">                                <span class="built_in">this</span>.fishY -= <span class="built_in">this</span>.speed</span><br><span class="line">                            &#125;)</span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                Button(<span class="string">&quot;↓&quot;</span>)</span><br><span class="line">                    .backgroundColor(<span class="string">&quot;#bc515151&quot;</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        animateTo(</span><br><span class="line">                            &#123;</span><br><span class="line">                                duration: <span class="number">500</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                            () =&gt; &#123;</span><br><span class="line">                                <span class="built_in">this</span>.fishY += <span class="built_in">this</span>.speed</span><br><span class="line">                            &#125;)</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Button(<span class="string">&quot;→&quot;</span>)</span><br><span class="line">                .backgroundColor(<span class="string">&quot;#bc515151&quot;</span>)</span><br><span class="line">                .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    animateTo(</span><br><span class="line">                        &#123;</span><br><span class="line">                            duration: <span class="number">500</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        () =&gt; &#123;</span><br><span class="line">                            <span class="built_in">this</span>.fishX += <span class="built_in">this</span>.speed</span><br><span class="line">                            <span class="built_in">this</span>.src = $r(<span class="string">&quot;app.media.yuR&quot;</span>)</span><br><span class="line">                        &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="number">240</span>)</span><br><span class="line">            .height(<span class="number">240</span>)</span><br><span class="line">            .position(&#123;<span class="attr">x</span>: <span class="number">15</span>, <span class="attr">y</span>: <span class="number">150</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">.</span><br><span class="line">height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .width(<span class="string">&quot;100%&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="组件转场动画"><a href="#组件转场动画" class="headerlink" title="组件转场动画"></a>组件转场动画</h3><p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240312172055505.png" alt="image-20240312172055505"></p>
<p>为小鱼添加入场动画，修改开始游戏按钮的方法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="built_in">this</span>.isBegin) &#123;</span><br><span class="line">    Button(<span class="string">&quot;开始游戏&quot;</span>)</span><br><span class="line">        .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 点击开始游戏后，使用animateTo控制小鱼开始执行入场动画</span></span><br><span class="line">            <span class="comment">// 注意：必须使用animateTo方法的回调控制变量，才能触发transition动画</span></span><br><span class="line">            animateTo(</span><br><span class="line">                &#123;</span><br><span class="line">                    duration: <span class="number">1000</span></span><br><span class="line">                &#125;,</span><br><span class="line">                () =&gt; &#123;</span><br><span class="line">                    <span class="built_in">this</span>.isBegin = <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">        &#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Image(<span class="built_in">this</span>.src)</span><br><span class="line">        .position(&#123;<span class="attr">x</span>: <span class="built_in">this</span>.fishX - <span class="number">40</span>, <span class="attr">y</span>: <span class="built_in">this</span>.fishY - <span class="number">40</span>&#125;)</span><br><span class="line">        .rotate(&#123;<span class="attr">angle</span>: <span class="built_in">this</span>.angle, <span class="attr">centerX</span>: <span class="string">&quot;50%&quot;</span>, <span class="attr">centerY</span>: <span class="string">&quot;50%&quot;</span>&#125;)</span><br><span class="line">        .width(<span class="number">80</span>)</span><br><span class="line">        .height(<span class="number">80</span>)</span><br><span class="line">        <span class="comment">// 添加初始位置，点击开始游戏后，由下面的样式变成上面定义的样式</span></span><br><span class="line">        .transition(&#123;</span><br><span class="line">            <span class="keyword">type</span>: TransitionType.Insert, <span class="comment">// Insert 表示入场动画</span></span><br><span class="line">            translate: &#123;<span class="attr">x</span>: -<span class="built_in">this</span>.fishX&#125;, <span class="comment">// x 轴上的位置，设置为负数，表示从屏幕外面移动到屏幕里面</span></span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果展示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/transition.gif" alt="transition"></p>
<h3 id="实现摇杆功能"><a href="#实现摇杆功能" class="headerlink" title="实现摇杆功能"></a>实现摇杆功能</h3><p>完整代码</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> curves <span class="keyword">from</span> <span class="string">&#x27;@ohos.curves&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">AnimationPage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 小鱼坐标</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    fishX</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">300</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    fishY</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">180</span></span><br><span class="line">    <span class="comment">// 小鱼角度</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    angle</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 小鱼图片</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    src</span><br><span class="line">:</span><br><span class="line">    Resource = $r(<span class="string">&quot;app.media.yuR&quot;</span>)</span><br><span class="line">    <span class="comment">// 是否开始游戏</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    isBegin</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">    <span class="comment">// 移动速度</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    speed</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">20</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 摇杆中心区域坐标</span></span><br><span class="line">    centerX: <span class="built_in">number</span> = <span class="number">120</span></span><br><span class="line">    centerY: <span class="built_in">number</span> = <span class="number">120</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 大小圆的半径</span></span><br><span class="line">    maxRadius: <span class="built_in">number</span> = <span class="number">100</span></span><br><span class="line">    radius: <span class="built_in">number</span> = <span class="number">20</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 摇杆小圆球的初始位置</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    positionX</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="built_in">this</span>.centerX</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    positionY</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="built_in">this</span>.centerY</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 角度正弦和余弦</span></span><br><span class="line">    sin: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">    cos: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    taskId: <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line">    scaleTaskId: <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    fishScale</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            Stack()</span><br><span class="line">            &#123;</span><br><span class="line">                Button(<span class="string">&quot;返回&quot;</span>)</span><br><span class="line">                    .position(&#123;<span class="attr">x</span>: <span class="number">15</span>, <span class="attr">y</span>: <span class="number">15</span>&#125;)</span><br><span class="line">                    .width(<span class="number">80</span>)</span><br><span class="line">                    .backgroundColor(<span class="string">&quot;#bc515151&quot;</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        router.back()</span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!<span class="built_in">this</span>.isBegin) &#123;</span><br><span class="line">                    Button(<span class="string">&quot;开始游戏&quot;</span>)</span><br><span class="line">                        .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            <span class="comment">// 点击开始游戏后，使用animateTo控制小鱼开始执行入场动画</span></span><br><span class="line">                            <span class="comment">// 注意：必须使用animateTo方法的回调控制变量，才能触发transition动画</span></span><br><span class="line">                            animateTo(</span><br><span class="line">                                &#123;</span><br><span class="line">                                    duration: <span class="number">1000</span></span><br><span class="line">                                &#125;,</span><br><span class="line">                                () =&gt; &#123;</span><br><span class="line">                                    <span class="built_in">this</span>.isBegin = <span class="literal">true</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            )</span><br><span class="line">                        &#125;)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Image(<span class="built_in">this</span>.src)</span><br><span class="line">                        .position(&#123;<span class="attr">x</span>: <span class="built_in">this</span>.fishX - <span class="number">40</span>, <span class="attr">y</span>: <span class="built_in">this</span>.fishY - <span class="number">40</span>&#125;)</span><br><span class="line">                        .rotate(&#123;<span class="attr">angle</span>: <span class="built_in">this</span>.angle, <span class="attr">centerX</span>: <span class="string">&quot;50%&quot;</span>, <span class="attr">centerY</span>: <span class="string">&quot;50%&quot;</span>&#125;)</span><br><span class="line">                        .width(<span class="number">80</span>)</span><br><span class="line">                        .height(<span class="number">80</span>)</span><br><span class="line">                        .scale(&#123;<span class="attr">x</span>: <span class="built_in">this</span>.fishScale, <span class="attr">y</span>: <span class="built_in">this</span>.fishScale&#125;)</span><br><span class="line">                        <span class="comment">// 添加初始位置，点击开始游戏后，由下面的样式变成上面定义的样式</span></span><br><span class="line">                        .transition(&#123;</span><br><span class="line">                            <span class="keyword">type</span>: TransitionType.Insert, <span class="comment">// Insert 表示入场动画</span></span><br><span class="line">                            translate: &#123;<span class="attr">x</span>: -<span class="built_in">this</span>.fishX&#125;, <span class="comment">// x 轴上的位置</span></span><br><span class="line">                        &#125;)</span><br><span class="line">                        .interpolation(ImageInterpolation.High)</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 摇杆区域</span></span><br><span class="line">                Row()</span><br><span class="line">                &#123;</span><br><span class="line">                    Circle(&#123;<span class="attr">width</span>: <span class="built_in">this</span>.maxRadius * <span class="number">2</span>, <span class="attr">height</span>: <span class="built_in">this</span>.maxRadius * <span class="number">2</span>&#125;)</span><br><span class="line">                        .fill(<span class="string">&quot;#3a101020&quot;</span>)</span><br><span class="line">                        .position(&#123;<span class="attr">x</span>: <span class="built_in">this</span>.centerX - <span class="built_in">this</span>.maxRadius, <span class="attr">y</span>: <span class="built_in">this</span>.centerY - <span class="built_in">this</span>.maxRadius&#125;)</span><br><span class="line"></span><br><span class="line">                    Circle(&#123;<span class="attr">width</span>: <span class="built_in">this</span>.radius * <span class="number">2</span>, <span class="attr">height</span>: <span class="built_in">this</span>.radius * <span class="number">2</span>&#125;)</span><br><span class="line">                        .fill(<span class="string">&quot;#ffeaa311&quot;</span>)</span><br><span class="line">                        .position(&#123;<span class="attr">x</span>: <span class="built_in">this</span>.positionX - <span class="built_in">this</span>.radius, <span class="attr">y</span>: <span class="built_in">this</span>.positionY - <span class="built_in">this</span>.radius&#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            .</span><br><span class="line">                width(<span class="number">240</span>)</span><br><span class="line">                    .height(<span class="number">240</span>)</span><br><span class="line">                    .justifyContent(FlexAlign.Center)</span><br><span class="line">                    .position(&#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">120</span>&#125;)</span><br><span class="line">                    .onTouch(<span class="built_in">this</span>.onTouchEvent.bind(<span class="built_in">this</span>))</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">                .width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        justifyContent(FlexAlign.Center)</span><br><span class="line">            .alignItems(VerticalAlign.Center)</span><br><span class="line">            .backgroundImage($r(<span class="string">&quot;app.media.yuBg&quot;</span>))</span><br><span class="line">            .backgroundImageSize(ImageSize.Cover) <span class="comment">// 背景图片铺满</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理摇杆区域的触摸事件</span></span><br><span class="line">    onTouchEvent(event</span><br><span class="line">:</span><br><span class="line">    TouchEvent</span><br><span class="line">)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 区分不同的类型</span></span><br><span class="line">        <span class="keyword">switch</span> (event.type) &#123;</span><br><span class="line">            <span class="comment">// 手指松开事件</span></span><br><span class="line">            <span class="keyword">case</span> TouchType.Up:</span><br><span class="line">                animateTo(</span><br><span class="line">                    &#123;</span><br><span class="line">                        curve: curves.springMotion()</span><br><span class="line">                    &#125;,</span><br><span class="line">                    () =&gt; &#123;</span><br><span class="line">                        <span class="comment">// 还原小球的位置</span></span><br><span class="line">                        <span class="built_in">this</span>.positionX = <span class="built_in">this</span>.centerX</span><br><span class="line">                        <span class="built_in">this</span>.positionY = <span class="built_in">this</span>.centerY</span><br><span class="line">                        <span class="comment">// 还原小鱼的倾斜角度</span></span><br><span class="line">                        <span class="built_in">this</span>.angle = <span class="number">0</span></span><br><span class="line">                        <span class="comment">// 还原小鱼大小</span></span><br><span class="line">                        <span class="built_in">this</span>.fishScale = <span class="number">1</span></span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line">                <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.taskId)</span><br><span class="line">                <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.scaleTaskId)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment">// 手指点击事件</span></span><br><span class="line">            <span class="keyword">case</span> TouchType.Down:</span><br><span class="line">                <span class="comment">// 不断的更新小鱼的位置</span></span><br><span class="line">                <span class="built_in">this</span>.taskId = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.fishX += <span class="built_in">this</span>.speed * <span class="built_in">this</span>.cos</span><br><span class="line">                    <span class="built_in">this</span>.fishY += <span class="built_in">this</span>.speed * <span class="built_in">this</span>.sin</span><br><span class="line">                &#125;, <span class="number">40</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 每隔500毫秒让小鱼逐渐变大</span></span><br><span class="line">                <span class="built_in">this</span>.scaleTaskId = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    animateTo(</span><br><span class="line">                        &#123;</span><br><span class="line">                            curve: curves.springMotion()</span><br><span class="line">                        &#125;,</span><br><span class="line">                        () =&gt; &#123;</span><br><span class="line">                            <span class="built_in">this</span>.fishScale += <span class="number">0.2</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    )</span><br><span class="line">                &#125;, <span class="number">500</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment">// 手指移动事件</span></span><br><span class="line">            <span class="keyword">case</span> TouchType.Move:</span><br><span class="line">                <span class="comment">// 1.获取手指位置坐标</span></span><br><span class="line">                <span class="keyword">let</span> x = event.touches[<span class="number">0</span>].x</span><br><span class="line">                <span class="keyword">let</span> y = event.touches[<span class="number">0</span>].y</span><br><span class="line">                <span class="comment">// 2.计算手指与中心点坐标的差值</span></span><br><span class="line">                <span class="keyword">let</span> vx = x - <span class="built_in">this</span>.centerX</span><br><span class="line">                <span class="keyword">let</span> vy = y - <span class="built_in">this</span>.centerY</span><br><span class="line">                <span class="comment">// 3.计算手指与中心点连线和x轴半径的夹角，单位是弧度</span></span><br><span class="line">                <span class="keyword">let</span> angle = <span class="built_in">Math</span>.atan2(vy, vx)</span><br><span class="line">                <span class="comment">// 4.计算手指与中心点的距离</span></span><br><span class="line">                <span class="keyword">let</span> distance = <span class="built_in">this</span>.getDistance(vx, vy)</span><br><span class="line">                <span class="comment">// 5.计算摇杆小球的坐标</span></span><br><span class="line">                <span class="built_in">this</span>.cos = <span class="built_in">Math</span>.cos(angle)</span><br><span class="line">                <span class="built_in">this</span>.sin = <span class="built_in">Math</span>.sin(angle)</span><br><span class="line"></span><br><span class="line">                animateTo(</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// 设置动画为连续动画</span></span><br><span class="line">                        curve: curves.responsiveSpringMotion()</span><br><span class="line">                    &#125;,</span><br><span class="line">                    () =&gt; &#123;</span><br><span class="line">                        <span class="built_in">this</span>.positionX = <span class="built_in">this</span>.centerX + distance * <span class="built_in">Math</span>.cos(angle)</span><br><span class="line">                        <span class="built_in">this</span>.positionY = <span class="built_in">this</span>.centerY + distance * <span class="built_in">Math</span>.sin(angle)</span><br><span class="line">                        <span class="comment">// 6.计算小鱼的位置</span></span><br><span class="line">                        <span class="built_in">this</span>.speed = <span class="number">5</span></span><br><span class="line">                        <span class="comment">// 计算角度绝对值，如果小于90则需要翻转图片</span></span><br><span class="line">                        <span class="keyword">if</span> (<span class="built_in">Math</span>.abs(angle * <span class="number">2</span>) &lt; <span class="built_in">Math</span>.PI) &#123;</span><br><span class="line">                            <span class="built_in">this</span>.src = $r(<span class="string">&quot;app.media.yuR&quot;</span>)</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="built_in">this</span>.src = $r(<span class="string">&quot;app.media.yu&quot;</span>)</span><br><span class="line">                            angle = angle &lt; <span class="number">0</span> ? angle + <span class="built_in">Math</span>.PI : angle - <span class="built_in">Math</span>.PI</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// 弧度转角度计算公式：弧度 * (180 / π)</span></span><br><span class="line">                        <span class="built_in">this</span>.angle = angle * (<span class="number">180</span> / <span class="built_in">Math</span>.PI)</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getDistance(x, y)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 求平方根,计算两点的距离</span></span><br><span class="line">        <span class="keyword">let</span> d = <span class="built_in">Math</span>.sqrt(x * x + y * y)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Math</span>.min(d, <span class="built_in">this</span>.maxRadius)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240313170808603.png" alt="image-20240313170808603"></p>
<h2 id="Stage模型"><a href="#Stage模型" class="headerlink" title="Stage模型"></a>Stage模型</h2><h3 id="文档介绍"><a href="#文档介绍" class="headerlink" title="文档介绍"></a>文档介绍</h3><p><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/application-configuration-file-overview-stage-0000001428061460-V2">https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/application-configuration-file-overview-stage-0000001428061460-V2</a></p>
<p>在需要的时候来翻阅文档即可</p>
<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><h3 id="页面及组件的生命周期"><a href="#页面及组件的生命周期" class="headerlink" title="页面及组件的生命周期"></a>页面及组件的生命周期</h3><p>完成流程图</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240313212734129.png" alt="image-20240313212734129"></p>
<p>接下来通过两个案例来查看生命周期函数的执行情况</p>
<h4 id="案例一"><a href="#案例一" class="headerlink" title="案例一"></a>案例一</h4><p>首先给首页添加生命周期函数</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RouterItem</span> </span>&#123;</span><br><span class="line">    url: <span class="built_in">string</span></span><br><span class="line">    title: <span class="built_in">string</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">url, title</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.url = url</span><br><span class="line">        <span class="built_in">this</span>.title = title</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">Index</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    message</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span> = <span class="string">&#x27;页面列表&#x27;</span></span><br><span class="line">    routerList: RouterItem[] = [</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/ImagePage&quot;</span>, <span class="string">&quot;查看图片页面&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/ItemsPage&quot;</span>, <span class="string">&quot;商品列表页面&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/StatePage&quot;</span>, <span class="string">&quot;Jack和他的女朋友们&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/TaskListPage&quot;</span>, <span class="string">&quot;任务列表&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/AnimationPage&quot;</span>, <span class="string">&quot;小鱼动画&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/AnimationPageV2&quot;</span>, <span class="string">&quot;小鱼动画V2&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/LifeCyclePage&quot;</span>, <span class="string">&quot;生命周期案例1&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/LifeCyclePage1&quot;</span>, <span class="string">&quot;生命周期案例2&quot;</span>),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    tag: <span class="built_in">string</span> = <span class="string">&quot;Index Page&quot;</span></span><br><span class="line"></span><br><span class="line">    aboutToAppear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面创建完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onBackPress()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面返回前触发`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onPageShow()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面显示完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onPageHide()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面隐藏完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    aboutToDisappear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面销毁完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="built_in">this</span>.message)</span><br><span class="line">                    .fontSize(<span class="number">50</span>)</span><br><span class="line">                    .fontWeight(FontWeight.Bold)</span><br><span class="line">                    .fontColor(<span class="string">&quot;#36d&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            List(&#123;<span class="attr">space</span>: <span class="number">20</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                ForEach(<span class="built_in">this</span>.routerList, <span class="function">(<span class="params">r: RouterItem, index: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">                    ListItem()</span><br><span class="line">                    &#123;</span><br><span class="line">                        RouterItemBox(&#123;</span><br><span class="line">                            item: r,</span><br><span class="line">                            rid: index + <span class="number">1</span></span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .margin(&#123;<span class="attr">top</span>: <span class="number">35</span>&#125;)</span><br><span class="line">                .layoutWeight(<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .height(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .padding(<span class="number">15</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">RouterItemBox</span><br><span class="line">&#123;</span><br><span class="line">    item: RouterItem</span><br><span class="line">    rid: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.rid&#125;</span>.`</span>)</span><br><span class="line">                .fontColor(Color.White)</span><br><span class="line">                .fontSize(<span class="number">18</span>)</span><br><span class="line">                .fontWeight(FontWeight.Bold)</span><br><span class="line">            Blank()</span><br><span class="line">            Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.item.title&#125;</span>`</span>)</span><br><span class="line">                .fontColor(Color.White)</span><br><span class="line">                .fontSize(<span class="number">18</span>)</span><br><span class="line">                .fontWeight(FontWeight.Bold)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .padding(&#123;</span><br><span class="line">                top: <span class="number">15</span>,</span><br><span class="line">                right: <span class="number">25</span>,</span><br><span class="line">                bottom: <span class="number">15</span>,</span><br><span class="line">                left: <span class="number">25</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .backgroundColor(<span class="string">&quot;#36D&quot;</span>)</span><br><span class="line">            .borderRadius(<span class="number">30</span>)</span><br><span class="line">            .shadow(&#123;</span><br><span class="line">                radius: <span class="number">8</span>,</span><br><span class="line">                color: <span class="string">&quot;#ff484848&quot;</span>,</span><br><span class="line">                offsetX: <span class="number">5</span>,</span><br><span class="line">                offsetY: <span class="number">5</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line">            .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                router.pushUrl(</span><br><span class="line">                    &#123;</span><br><span class="line">                        url: <span class="built_in">this</span>.item.url</span><br><span class="line">                    &#125;,</span><br><span class="line">                    router.RouterMode.Single,</span><br><span class="line">                    err =&gt; &#123;</span><br><span class="line">                        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                            <span class="built_in">console</span>.log(<span class="string">`页面跳转出错，errCode：<span class="subst">$&#123;err.code&#125;</span>，errMsg：<span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在加载完首页后会触发 <code>aboutToAppear</code> 和 <code>onPageShow</code></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240313220640521.png" alt="image-20240313220640521"></p>
<p>然后点击跳转到 <code>pages/LifeCyclePage</code>，页面代码如下</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">LifeCyclePage</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    isShow</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    emptyList</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">any</span>[] = [<span class="number">0</span>]</span><br><span class="line">    tag: <span class="built_in">string</span> = <span class="string">&quot;LifeCyclePage&quot;</span></span><br><span class="line"></span><br><span class="line">    aboutToAppear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面创建完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onBackPress()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面返回前触发`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onPageShow()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面显示完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onPageHide()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面隐藏完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    aboutToDisappear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面销毁完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            Column(&#123;<span class="attr">space</span>: <span class="number">35</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Button(<span class="string">&quot;显示组件&quot;</span>)</span><br><span class="line">                    .margin(&#123;<span class="attr">top</span>: <span class="number">30</span>&#125;)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.isShow = !<span class="built_in">this</span>.isShow</span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.isShow) &#123;</span><br><span class="line">                    MyText()</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Button(<span class="string">&quot;增加组件&quot;</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.emptyList.push(<span class="built_in">this</span>.emptyList.length + <span class="number">1</span>)</span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                ForEach(<span class="built_in">this</span>.emptyList, <span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">                    Row(&#123;<span class="attr">space</span>: <span class="number">25</span>&#125;)</span><br><span class="line">                    &#123;</span><br><span class="line">                        MyText()</span><br><span class="line"></span><br><span class="line">                        Button(<span class="string">&quot;删除&quot;</span>)</span><br><span class="line">                            .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                <span class="built_in">this</span>.emptyList.splice(index, <span class="number">1</span>)</span><br><span class="line">                            &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                .</span><br><span class="line">                    width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                        .justifyContent(FlexAlign.Center)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">                .height(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .alignItems(HorizontalAlign.Center)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">MyText</span><br><span class="line">&#123;</span><br><span class="line">    messages: <span class="built_in">string</span> = <span class="string">&quot;hello world&quot;</span></span><br><span class="line"></span><br><span class="line">    tag: <span class="built_in">string</span> = <span class="string">&quot;MyText&quot;</span></span><br><span class="line"></span><br><span class="line">    aboutToAppear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面创建完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组件没有onBackPress、onPageShow、onPageHide这三个钩子函数</span></span><br><span class="line">    onBackPress()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面返回前触发`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onPageShow()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面显示完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onPageHide()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面隐藏完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    aboutToDisappear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面销毁完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Text(<span class="built_in">this</span>.messages)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>会打印如下</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240313220736436.png" alt="image-20240313220736436"></p>
<ul>
<li>首先调用页面的 aboutToAppear 页面创建钩子</li>
<li>然后触发组件的 aboutToAppear 页面创建钩子</li>
<li>接着触发首页的 aboutToDisappear 页面销毁钩子</li>
<li>最后触发页面的 onPageShow 显示钩子</li>
</ul>
<p>这时在页面上显示和隐藏组件，或者增加遍历组件，都只会触发组件的 aboutToAppear 创建和 aboutToDisappear 销毁</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240313221014359.png" alt="image-20240313221014359"></p>
<p>这也再次印证了组件是不包含 <code>onBackPress</code> 、<code>onPageShow</code>、<code>onPageHide</code> 这三个页面级别的生命周期函数</p>
<p>然后再返回首页时，会触发下面的钩子</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240313221142154.png" alt="image-20240313221142154"></p>
<h4 id="案例二"><a href="#案例二" class="headerlink" title="案例二"></a>案例二</h4><p>首先准备两个页面</p>
<p>LifeCyclePage1.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">LifeCyclePage1</span><br><span class="line">&#123;</span><br><span class="line">    pageName: <span class="built_in">string</span> = <span class="string">&quot;LifeCycle Page1&quot;</span></span><br><span class="line"></span><br><span class="line">    aboutToAppear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.pageName&#125;</span> aboutToAppear,页面创建完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onBackPress()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.pageName&#125;</span> aboutToAppear,页面返回前触发`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onPageShow()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.pageName&#125;</span> aboutToAppear,页面显示完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onPageHide()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.pageName&#125;</span> aboutToAppear,页面隐藏完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    aboutToDisappear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.pageName&#125;</span> aboutToAppear,页面销毁完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: <span class="number">35</span>&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="built_in">this</span>.pageName)</span><br><span class="line">                    .fontSize(<span class="number">30</span>)</span><br><span class="line">                    .fontWeight(FontWeight.Bold)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            margin(&#123;<span class="attr">top</span>: <span class="number">35</span>&#125;)</span><br><span class="line"></span><br><span class="line">            Row(&#123;<span class="attr">space</span>: <span class="number">5</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Button(<span class="string">&quot;push 跳转Page2&quot;</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        router.pushUrl(&#123;</span><br><span class="line">                            url: <span class="string">&quot;pages/LifeCyclePage2&quot;</span></span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                Button(<span class="string">&quot;replace 跳转Page2&quot;</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        router.replaceUrl(&#123;</span><br><span class="line">                            url: <span class="string">&quot;pages/LifeCyclePage2&quot;</span></span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LifeCyclePage2.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">LifeCyclePage2</span><br><span class="line">&#123;</span><br><span class="line">    pageName: <span class="built_in">string</span> = <span class="string">&quot;LifeCycle Page2&quot;</span></span><br><span class="line"></span><br><span class="line">    aboutToAppear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.pageName&#125;</span> aboutToAppear,页面创建完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onBackPress()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.pageName&#125;</span> aboutToAppear,页面返回前触发`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onPageShow()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.pageName&#125;</span> aboutToAppear,页面显示完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onPageHide()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.pageName&#125;</span> aboutToAppear,页面隐藏完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    aboutToDisappear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.pageName&#125;</span> aboutToAppear,页面销毁完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: <span class="number">35</span>&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="built_in">this</span>.pageName)</span><br><span class="line">                    .fontSize(<span class="number">30</span>)</span><br><span class="line">                    .fontWeight(FontWeight.Bold)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            margin(&#123;<span class="attr">top</span>: <span class="number">35</span>&#125;)</span><br><span class="line"></span><br><span class="line">            Row(&#123;<span class="attr">space</span>: <span class="number">5</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Button(<span class="string">&quot;push 跳转Page1&quot;</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        router.pushUrl(&#123;</span><br><span class="line">                            url: <span class="string">&quot;pages/LifeCyclePage1&quot;</span></span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                Button(<span class="string">&quot;replace 跳转Page1&quot;</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        router.replaceUrl(&#123;</span><br><span class="line">                            url: <span class="string">&quot;pages/LifeCyclePage1&quot;</span></span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先点击 “push跳转” 按钮，查看打印结果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240313221952327.png" alt="image-20240313221952327"></p>
<blockquote>
<p>会发现在不断地触发创建和隐藏钩子，但是没有触发<code>aboutToDisappear</code> 页面销毁钩子，这说明通过push方式跳转的页面，系统会帮我们做缓存</p>
</blockquote>
<p>接下来点击 “replace跳转” 按钮，查看打印结果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240313222147108.png" alt="image-20240313222147108"></p>
<blockquote>
<p>发现通过 replace 跳转会触发上一页面的销毁钩子</p>
</blockquote>
<h2 id="UIAbility的启动模式"><a href="#UIAbility的启动模式" class="headerlink" title="UIAbility的启动模式"></a>UIAbility的启动模式</h2><h3 id="模式介绍"><a href="#模式介绍" class="headerlink" title="模式介绍"></a>模式介绍</h3><table>
<thead>
<tr>
<th>模式类型</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>singleton</td>
<td>每一个UIAbility只存在唯一实例。是默认启动模式，任务列表中只会存在一个相同的UIAbility</td>
</tr>
<tr>
<td>standard</td>
<td>每次启动UIAbility都会创建一个实例。任务列表中会存在多个相同的UIAbility</td>
</tr>
<tr>
<td>specified</td>
<td>每个UIAbility实例可以设置key标识，启动UIAbility时，需要指定Key，存在相同的Key的实力会直接被拉起，不存在则创建一个新的实例</td>
</tr>
</tbody></table>
<h3 id="案例演示"><a href="#案例演示" class="headerlink" title="案例演示"></a>案例演示</h3><p>下面我们来使用一下 specified 模式</p>
<p>首先新建 <code>pages/DocumentPage.ets</code> 页面</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Header&#125; <span class="keyword">from</span> <span class="string">&#x27;../components/Header&#x27;</span></span><br><span class="line"><span class="keyword">import</span> common <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.common&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Want <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.Want&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">DocumentPage</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    index</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    documentList</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span>[] = []</span><br><span class="line"></span><br><span class="line">    context = getContext(<span class="built_in">this</span>) <span class="keyword">as</span> common.UIAbilityContext</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Header(&#123;<span class="attr">title</span>: <span class="string">&quot;文档列表&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">            Column(&#123;<span class="attr">space</span>: <span class="number">15</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Row()</span><br><span class="line">                &#123;</span><br><span class="line">                    Button(<span class="string">&quot;添加文档&quot;</span>)</span><br><span class="line">                        .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            <span class="built_in">this</span>.documentList.push(<span class="built_in">this</span>.index)</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">let</span> want: Want = &#123;</span><br><span class="line">                                deviceId: <span class="string">&quot;&quot;</span>,<span class="comment">// deviceId为空表示本设备</span></span><br><span class="line">                                bundleName: <span class="string">&quot;com.example.myapplication&quot;</span>, <span class="comment">// 包的名称，对应AppScope/app.json5的app.bundleName</span></span><br><span class="line">                                abilityName: <span class="string">&quot;DocumentAbility&quot;</span>, <span class="comment">// 要跳转到目标ability名称</span></span><br><span class="line">                                moduleName: <span class="string">&quot;entry&quot;</span>, <span class="comment">// 当前的模块名称</span></span><br><span class="line">                                parameters: &#123;</span><br><span class="line">                                    instanceKey: <span class="built_in">this</span>.index <span class="comment">// 传过去的key</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// 跳转到一个新的Ability</span></span><br><span class="line">                            <span class="built_in">this</span>.context.startAbility(want)</span><br><span class="line"></span><br><span class="line">                            <span class="built_in">this</span>.index++</span><br><span class="line">                        &#125;)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                ForEach(<span class="built_in">this</span>.documentList, <span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">                    Row(&#123;<span class="attr">space</span>: <span class="number">15</span>&#125;)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Image($r(<span class="string">&quot;app.media.doc&quot;</span>))</span><br><span class="line">                            .width(<span class="number">25</span>)</span><br><span class="line"></span><br><span class="line">                        Text(<span class="string">`文档<span class="subst">$&#123;id&#125;</span>`</span>)</span><br><span class="line">                            .fontSize(<span class="number">20</span>)</span><br><span class="line">                            .fontWeight(FontWeight.Bold)</span><br><span class="line">                            .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                                <span class="keyword">let</span> want: Want = &#123;</span><br><span class="line">                                    deviceId: <span class="string">&quot;&quot;</span>,<span class="comment">// deviceId为空表示本设备</span></span><br><span class="line">                                    bundleName: <span class="string">&quot;com.example.myapplication&quot;</span>, <span class="comment">// 包的名称，对应AppScope/app.json5的app.bundleName</span></span><br><span class="line">                                    abilityName: <span class="string">&quot;DocumentAbility&quot;</span>, <span class="comment">// 要跳转到目标ability名称</span></span><br><span class="line">                                    moduleName: <span class="string">&quot;entry&quot;</span>, <span class="comment">// 当前的模块名称</span></span><br><span class="line">                                    parameters: &#123;</span><br><span class="line">                                        instanceKey: id <span class="comment">// 传过去的key</span></span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="comment">// 跳转到一个新的Ability</span></span><br><span class="line">                                <span class="built_in">this</span>.context.startAbility(want)</span><br><span class="line">                            &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                .</span><br><span class="line">                    width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">                .height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">                .padding(<span class="number">15</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着新建文档编辑页面 <code>pages/DocumentEdit.ets</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Want <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.Want&#x27;</span></span><br><span class="line"><span class="keyword">import</span> common <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.common&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">DocumentEdit</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    docEdit</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">boolean</span> = <span class="literal">true</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    docName</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    context = getContext(<span class="built_in">this</span>) <span class="keyword">as</span> common.UIAbilityContext</span><br><span class="line"></span><br><span class="line">    onPageShow()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> abilityInfo = <span class="built_in">this</span>.context</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`DocumnetAbility: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(abilityInfo)&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Row(&#123;<span class="attr">space</span>: <span class="number">15</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Image($r(<span class="string">&quot;app.media.back&quot;</span>))</span><br><span class="line">                    .width(<span class="number">25</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">let</span> want: Want = &#123;</span><br><span class="line">                            deviceId: <span class="string">&quot;&quot;</span>,<span class="comment">// deviceId为空表示本设备</span></span><br><span class="line">                            bundleName: <span class="string">&quot;com.example.myapplication&quot;</span>, <span class="comment">// 包的名称，对应AppScope/app.json5的app.bundleName</span></span><br><span class="line">                            abilityName: <span class="string">&quot;EntryAbility&quot;</span>, <span class="comment">// 要跳转到目标ability名称</span></span><br><span class="line">                            moduleName: <span class="string">&quot;entry&quot;</span>, <span class="comment">// 当前的模块名称</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// 跳转到一个新的Ability</span></span><br><span class="line">                        <span class="built_in">this</span>.context.startAbility(want)</span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.docEdit) &#123;</span><br><span class="line">                    TextInput(&#123;</span><br><span class="line">                        placeholder: <span class="string">&quot;请输入文档名称&quot;</span>,</span><br><span class="line">                        text: <span class="built_in">this</span>.docName</span><br><span class="line">                    &#125;)</span><br><span class="line">                        .onChange(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">                            <span class="built_in">this</span>.docName = val</span><br><span class="line">                        &#125;)</span><br><span class="line">                        .layoutWeight(<span class="number">1</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Text(<span class="built_in">this</span>.docName)</span><br><span class="line">                        .fontSize(<span class="number">25</span>)</span><br><span class="line">                        .layoutWeight(<span class="number">1</span>)</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                Button(<span class="string">&quot;确定&quot;</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.docEdit = !<span class="built_in">this</span>.docEdit</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                TextArea(&#123;</span><br><span class="line">                    placeholder: <span class="string">&#x27;The text area can hold an unlimited amount of text. input your word...&#x27;</span>,</span><br><span class="line">                &#125;)</span><br><span class="line">                    .placeholderFont(&#123;<span class="attr">size</span>: <span class="number">16</span>, <span class="attr">weight</span>: <span class="number">400</span>&#125;)</span><br><span class="line">                    .fontSize(<span class="number">16</span>)</span><br><span class="line">                    .fontColor(<span class="string">&#x27;#182431&#x27;</span>)</span><br><span class="line">                    .height(<span class="string">&quot;98%&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">                .layoutWeight(<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .padding(<span class="number">15</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再首页中添加跳转按钮</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RouterItem</span> </span>&#123;</span><br><span class="line">    url: <span class="built_in">string</span></span><br><span class="line">    title: <span class="built_in">string</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">url, title</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.url = url</span><br><span class="line">        <span class="built_in">this</span>.title = title</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">Index</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    message</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span> = <span class="string">&#x27;页面列表&#x27;</span></span><br><span class="line">    routerList: RouterItem[] = [</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/ImagePage&quot;</span>, <span class="string">&quot;查看图片页面&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/ItemsPage&quot;</span>, <span class="string">&quot;商品列表页面&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/StatePage&quot;</span>, <span class="string">&quot;Jack和他的女朋友们&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/TaskListPage&quot;</span>, <span class="string">&quot;任务列表&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/AnimationPage&quot;</span>, <span class="string">&quot;小鱼动画&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/AnimationPageV2&quot;</span>, <span class="string">&quot;小鱼动画V2&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/LifeCyclePage&quot;</span>, <span class="string">&quot;生命周期案例1&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/LifeCyclePage1&quot;</span>, <span class="string">&quot;生命周期案例2&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/DocumentPage&quot;</span>, <span class="string">&quot;文档列表页面&quot;</span>),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    tag: <span class="built_in">string</span> = <span class="string">&quot;Index Page&quot;</span></span><br><span class="line"></span><br><span class="line">    aboutToAppear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面创建完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onBackPress()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面返回前触发`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onPageShow()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面显示完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onPageHide()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面隐藏完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    aboutToDisappear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.tag&#125;</span> aboutToAppear,页面销毁完成`</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="built_in">this</span>.message)</span><br><span class="line">                    .fontSize(<span class="number">50</span>)</span><br><span class="line">                    .fontWeight(FontWeight.Bold)</span><br><span class="line">                    .fontColor(<span class="string">&quot;#36d&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            List(&#123;<span class="attr">space</span>: <span class="number">20</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                ForEach(<span class="built_in">this</span>.routerList, <span class="function">(<span class="params">r: RouterItem, index: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">                    ListItem()</span><br><span class="line">                    &#123;</span><br><span class="line">                        RouterItemBox(&#123;</span><br><span class="line">                            item: r,</span><br><span class="line">                            rid: index + <span class="number">1</span></span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .margin(&#123;<span class="attr">top</span>: <span class="number">35</span>&#125;)</span><br><span class="line">                .layoutWeight(<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .height(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .padding(<span class="number">15</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">RouterItemBox</span><br><span class="line">&#123;</span><br><span class="line">    item: RouterItem</span><br><span class="line">    rid: <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.rid&#125;</span>.`</span>)</span><br><span class="line">                .fontColor(Color.White)</span><br><span class="line">                .fontSize(<span class="number">18</span>)</span><br><span class="line">                .fontWeight(FontWeight.Bold)</span><br><span class="line">            Blank()</span><br><span class="line">            Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.item.title&#125;</span>`</span>)</span><br><span class="line">                .fontColor(Color.White)</span><br><span class="line">                .fontSize(<span class="number">18</span>)</span><br><span class="line">                .fontWeight(FontWeight.Bold)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .padding(&#123;</span><br><span class="line">                top: <span class="number">15</span>,</span><br><span class="line">                right: <span class="number">25</span>,</span><br><span class="line">                bottom: <span class="number">15</span>,</span><br><span class="line">                left: <span class="number">25</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .backgroundColor(<span class="string">&quot;#36D&quot;</span>)</span><br><span class="line">            .borderRadius(<span class="number">30</span>)</span><br><span class="line">            .shadow(&#123;</span><br><span class="line">                radius: <span class="number">8</span>,</span><br><span class="line">                color: <span class="string">&quot;#ff484848&quot;</span>,</span><br><span class="line">                offsetX: <span class="number">5</span>,</span><br><span class="line">                offsetY: <span class="number">5</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line">            .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                router.pushUrl(</span><br><span class="line">                    &#123;</span><br><span class="line">                        url: <span class="built_in">this</span>.item.url</span><br><span class="line">                    &#125;,</span><br><span class="line">                    router.RouterMode.Single,</span><br><span class="line">                    err =&gt; &#123;</span><br><span class="line">                        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                            <span class="built_in">console</span>.log(<span class="string">`页面跳转出错，errCode：<span class="subst">$&#123;err.code&#125;</span>，errMsg：<span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240314222733379.png" alt="image-20240314222733379" style="zoom:50%;" />

<p>然后再 ets 文件夹右键，选择新建一个 Ability，名称是 <code>DocumentAbility.ts</code></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240314222845313.png" alt="image-20240314222845313"></p>
<p>完成之后会自动帮我们创建好文件，将 DocumentAbility.ts 文件中的默认打开页面修改成文档编辑页面</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240314223119938.png" alt="image-20240314223119938"></p>
<p>接着修改 <code>src/main/resources/base/profile/main_pages.json</code> ，设置 DocumentAbility 的启动模式为 <code>specified</code></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240314223242865.png" alt="image-20240314223242865"></p>
<p>然后新建 <code>src/main/ets/myabilitystage/MyAbilityStage.ts</code> 接收key，并返回一个新的key</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AbilityStage <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.AbilityStage&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Want <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.Want&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAbility</span> <span class="keyword">extends</span> <span class="title">AbilityStage</span> </span>&#123;</span><br><span class="line">    onAcceptWant(want: Want): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="comment">// 判断被启动的Ability的名称</span></span><br><span class="line">        <span class="keyword">if</span> (want.abilityName === <span class="string">&quot;DocumentAbility&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`DocumentAbility_<span class="subst">$&#123;want.parameters.instanceKey&#125;</span>`</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在  <code>src/main/ets/myabilitystage/MyAbilityStage.ts</code>  中指定 <code>srcEntry</code></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240314223425674.png" alt="image-20240314223425674"></p>
<p>现在启动手机模拟器，查看效果，通过动画我们就实现根据Key打开Ability</p>
<img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/gif1.gif" alt="gif1" style="zoom:67%;" />

<h2 id="网络请求"><a href="#网络请求" class="headerlink" title="网络请求"></a>网络请求</h2><h3 id="内置的Httprequest请求"><a href="#内置的Httprequest请求" class="headerlink" title="内置的Httprequest请求"></a>内置的Httprequest请求</h3><h4 id="准备node服务"><a href="#准备node服务" class="headerlink" title="准备node服务"></a>准备node服务</h4><p>需要安装 express</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express</span><br></pre></td></tr></table></figure>

<p>新建 nodeServe/index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> app = express();</span><br><span class="line"><span class="keyword">let</span> allData = <span class="built_in">require</span>(<span class="string">&quot;./data.json&quot;</span>)</span><br><span class="line">app.use(<span class="string">&#x27;/images&#x27;</span>, express.static(<span class="string">&#x27;images&#x27;</span>)); <span class="comment">// 设置静态资源目录</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/shop&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.query, <span class="string">&#x27;接收的参数&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> &#123;pageNo, pageSize&#125; = req.query</span><br><span class="line">    <span class="comment">// 确保pageNo和pageSize是正整数</span></span><br><span class="line">    pageNo = <span class="built_in">Math</span>.max(<span class="number">1</span>, <span class="built_in">parseInt</span>(pageNo, <span class="number">10</span>));</span><br><span class="line">    pageSize = <span class="built_in">Math</span>.max(<span class="number">1</span>, <span class="built_in">parseInt</span>(pageSize, <span class="number">10</span>));</span><br><span class="line">    <span class="comment">// 计算起始索引和结束索引</span></span><br><span class="line">    <span class="keyword">let</span> startIndex = (pageNo - <span class="number">1</span>) * pageSize;</span><br><span class="line">    <span class="keyword">let</span> endIndex = startIndex + pageSize;</span><br><span class="line">    <span class="comment">// 返回当前页的数据</span></span><br><span class="line">    <span class="keyword">let</span> currentPageData = allData.slice(startIndex, endIndex);</span><br><span class="line">    <span class="comment">// 返回总页数</span></span><br><span class="line">    <span class="keyword">let</span> totalPages = <span class="built_in">Math</span>.ceil(allData.length / pageSize);</span><br><span class="line">    res.send(&#123;</span><br><span class="line">        code: <span class="string">&quot;200&quot;</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">            total: allData.length,</span><br><span class="line">            rows: currentPageData,</span><br><span class="line">            totalPages: totalPages</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`服务启动成功 http://localhost:3000`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>准备json数据，新建 data.json 文件，内容如下，这个文件模拟了10条数据</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;新白鹿烤鱼餐厅(西湖店)&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;images&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;/images/1.jpg&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;area&quot;</span>: <span class="string">&quot;西湖区&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;address&quot;</span>: <span class="string">&quot;西湖大道1号西湖天地F5&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;avgPrice&quot;</span>: <span class="number">61</span>,</span><br><span class="line">    <span class="attr">&quot;comments&quot;</span>: <span class="number">8045</span>,</span><br><span class="line">    <span class="attr">&quot;score&quot;</span>: <span class="number">47</span>,</span><br><span class="line">    <span class="attr">&quot;openHours&quot;</span>: <span class="string">&quot;11:00-21:00&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;两岸咖啡(下城区店)&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;images&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;/images/2.jpg&quot;</span>,</span><br><span class="line">      <span class="string">&quot;/images/3.jpg&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;area&quot;</span>: <span class="string">&quot;下城区&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;address&quot;</span>: <span class="string">&quot;中山路5号下城区广场F7&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;avgPrice&quot;</span>: <span class="number">80</span>,</span><br><span class="line">    <span class="attr">&quot;comments&quot;</span>: <span class="number">1500</span>,</span><br><span class="line">    <span class="attr">&quot;score&quot;</span>: <span class="number">39</span>,</span><br><span class="line">    <span class="attr">&quot;openHours&quot;</span>: <span class="string">&quot;09:00-23:00&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;味庄餐厅(上城区店)&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;images&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;/images/4.jpg&quot;</span>,</span><br><span class="line">      <span class="string">&quot;/images/5.jpg&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;area&quot;</span>: <span class="string">&quot;上城区&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;address&quot;</span>: <span class="string">&quot;清泰街5号上城区购物中心F4&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;avgPrice&quot;</span>: <span class="number">55</span>,</span><br><span class="line">    <span class="attr">&quot;comments&quot;</span>: <span class="number">5689</span>,</span><br><span class="line">    <span class="attr">&quot;score&quot;</span>: <span class="number">43</span>,</span><br><span class="line">    <span class="attr">&quot;openHours&quot;</span>: <span class="string">&quot;11:00-21:00&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;杭州小笼包(拱墅区店)&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;images&quot;</span>: [],</span><br><span class="line">    <span class="attr">&quot;area&quot;</span>: <span class="string">&quot;拱墅区&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;address&quot;</span>: <span class="string">&quot;莫干山路2号拱墅区购物中心F2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;avgPrice&quot;</span>: <span class="number">48</span>,</span><br><span class="line">    <span class="attr">&quot;comments&quot;</span>: <span class="number">4500</span>,</span><br><span class="line">    <span class="attr">&quot;score&quot;</span>: <span class="number">42</span>,</span><br><span class="line">    <span class="attr">&quot;openHours&quot;</span>: <span class="string">&quot;07:00-21:00&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;咖啡时光(江干区店)&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;images&quot;</span>: [],</span><br><span class="line">    <span class="attr">&quot;area&quot;</span>: <span class="string">&quot;江干区&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;address&quot;</span>: <span class="string">&quot;钱塘路10号江干区广场F1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;avgPrice&quot;</span>: <span class="number">75</span>,</span><br><span class="line">    <span class="attr">&quot;comments&quot;</span>: <span class="number">3200</span>,</span><br><span class="line">    <span class="attr">&quot;score&quot;</span>: <span class="number">41</span>,</span><br><span class="line">    <span class="attr">&quot;openHours&quot;</span>: <span class="string">&quot;10:00-22:00&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">6</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;大福来餐厅(滨江店)&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;images&quot;</span>: [],</span><br><span class="line">    <span class="attr">&quot;area&quot;</span>: <span class="string">&quot;滨江区&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;address&quot;</span>: <span class="string">&quot;江南大道6号滨江购物中心F6&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;avgPrice&quot;</span>: <span class="number">68</span>,</span><br><span class="line">    <span class="attr">&quot;comments&quot;</span>: <span class="number">2900</span>,</span><br><span class="line">    <span class="attr">&quot;score&quot;</span>: <span class="number">40</span>,</span><br><span class="line">    <span class="attr">&quot;openHours&quot;</span>: <span class="string">&quot;11:30-21:30&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">7</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;老杭州餐厅(下城区店)&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;images&quot;</span>: [],</span><br><span class="line">    <span class="attr">&quot;area&quot;</span>: <span class="string">&quot;下城区&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;address&quot;</span>: <span class="string">&quot;中山路3号下城区广场F3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;avgPrice&quot;</span>: <span class="number">58</span>,</span><br><span class="line">    <span class="attr">&quot;comments&quot;</span>: <span class="number">6500</span>,</span><br><span class="line">    <span class="attr">&quot;score&quot;</span>: <span class="number">45</span>,</span><br><span class="line">    <span class="attr">&quot;openHours&quot;</span>: <span class="string">&quot;10:30-20:30&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">8</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;豪客来牛排馆(江干区店)&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;images&quot;</span>: [],</span><br><span class="line">    <span class="attr">&quot;area&quot;</span>: <span class="string">&quot;江干区&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;address&quot;</span>: <span class="string">&quot;钱塘路8号江干区广场F8&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;avgPrice&quot;</span>: <span class="number">95</span>,</span><br><span class="line">    <span class="attr">&quot;comments&quot;</span>: <span class="number">1200</span>,</span><br><span class="line">    <span class="attr">&quot;score&quot;</span>: <span class="number">38</span>,</span><br><span class="line">    <span class="attr">&quot;openHours&quot;</span>: <span class="string">&quot;11:00-21:00&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">9</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;小尾羊火锅(上城区店)&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;images&quot;</span>: [],</span><br><span class="line">    <span class="attr">&quot;area&quot;</span>: <span class="string">&quot;上城区&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;address&quot;</span>: <span class="string">&quot;清泰街10号上城区购物中心F10&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;avgPrice&quot;</span>: <span class="number">70</span>,</span><br><span class="line">    <span class="attr">&quot;comments&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;score&quot;</span>: <span class="number">37</span>,</span><br><span class="line">    <span class="attr">&quot;openHours&quot;</span>: <span class="string">&quot;11:00-21:00&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;新概念咖啡(下城区店)&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;images&quot;</span>: [],</span><br><span class="line">    <span class="attr">&quot;area&quot;</span>: <span class="string">&quot;下城区&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;address&quot;</span>: <span class="string">&quot;中山路12号下城区广场F8&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;avgPrice&quot;</span>: <span class="number">50</span>,</span><br><span class="line">    <span class="attr">&quot;comments&quot;</span>: <span class="number">1000</span>,</span><br><span class="line">    <span class="attr">&quot;score&quot;</span>: <span class="number">36</span>,</span><br><span class="line">    <span class="attr">&quot;openHours&quot;</span>: <span class="string">&quot;08:00-22:00&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>然后启动 node 服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node index.js</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240316123438911.png" alt="image-20240316123438911"></p>
<p>测试服务是否正常运行</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240316123504897.png" alt="image-20240316123504897"></p>
<h4 id="viewModel"><a href="#viewModel" class="headerlink" title="viewModel"></a>viewModel</h4><p>新建 src/main/ets/viewModel，这个文件用来放所有页面模型数据</p>
<p>在该文件夹下添加如下文件</p>
<p>ShopInfo.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">ShopInfo</span> </span>&#123;</span><br><span class="line">    id: <span class="built_in">number</span></span><br><span class="line">    name: <span class="built_in">string</span></span><br><span class="line">    images: <span class="built_in">string</span>[]</span><br><span class="line">    area: <span class="built_in">string</span></span><br><span class="line">    address: <span class="built_in">string</span></span><br><span class="line">    avgPrice: <span class="built_in">number</span></span><br><span class="line">    comments: <span class="built_in">number</span></span><br><span class="line">    score: <span class="built_in">number</span></span><br><span class="line">    openHours: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ResponseInfo.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">responseData</span> </span>&#123;</span><br><span class="line">    total: <span class="built_in">number</span></span><br><span class="line">    totalPages: <span class="built_in">number</span></span><br><span class="line">    rows: <span class="built_in">any</span>[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseInfo</span> </span>&#123;</span><br><span class="line">    code: <span class="built_in">number</span></span><br><span class="line">    data: responseData</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="model"><a href="#model" class="headerlink" title="model"></a>model</h4><p>新建 src/main/ets/model 文件夹，这个文件夹用来放有关请求的文件</p>
<p>在该文件夹下新增</p>
<p>ShopModel.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;@ohos.net.http&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ResponseInfo <span class="keyword">from</span> <span class="string">&#x27;../viewModel/ResponseInfo&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShopModel</span> </span>&#123;</span><br><span class="line">    pageNo: <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line">    pageSize: <span class="built_in">number</span> = <span class="number">3</span></span><br><span class="line">    baseUrl: <span class="built_in">string</span> = <span class="string">&quot;http://localhost:3000&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">buildUrl</span>(<span class="params">url</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.baseUrl&#125;</span><span class="subst">$&#123;url&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getListFun(): <span class="built_in">Promise</span>&lt;ResponseInfo&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 1.创建Http请求对象</span></span><br><span class="line">            <span class="keyword">let</span> httpRequest = http.createHttp()</span><br><span class="line">            <span class="comment">// 2.发送请求体</span></span><br><span class="line">            httpRequest.request(</span><br><span class="line">                <span class="comment">// 请求路径</span></span><br><span class="line">                <span class="built_in">this</span>.buildUrl(<span class="string">`/shop?pageNo=<span class="subst">$&#123;<span class="built_in">this</span>.pageNo&#125;</span>&amp;pageSize=<span class="subst">$&#123;<span class="built_in">this</span>.pageSize&#125;</span>&#125;`</span>),</span><br><span class="line">                <span class="comment">// 请求体</span></span><br><span class="line">                &#123;</span><br><span class="line">                    method: http.RequestMethod.GET,  <span class="comment">// 请求方式</span></span><br><span class="line">                &#125;)</span><br><span class="line">                .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="comment">// 3.拿到请求结果</span></span><br><span class="line">                    <span class="keyword">if</span> (res.responseCode === <span class="number">200</span>) &#123;</span><br><span class="line">                        resolve(<span class="built_in">JSON</span>.parse(res.result.toString()))</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="built_in">console</span>.log(<span class="string">`请求失败：<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(res)&#125;</span>`</span>)</span><br><span class="line">                        reject()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">`请求失败：<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(err)&#125;</span>`</span>)</span><br><span class="line">                    reject()</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> ShopModel()</span><br></pre></td></tr></table></figure>

<h4 id="pages"><a href="#pages" class="headerlink" title="pages"></a>pages</h4><p>新建页面 ShopPage.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Header&#125; <span class="keyword">from</span> <span class="string">&#x27;../components/Header&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ShopInfo <span class="keyword">from</span> <span class="string">&#x27;../viewModel/ShopInfo&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;ShopItem&#125; <span class="keyword">from</span> <span class="string">&#x27;../views/ShopItem&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ShopModel <span class="keyword">from</span> <span class="string">&quot;../model/ShopModel&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">ShopPage</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    shopList</span><br><span class="line">:</span><br><span class="line">    ShopInfo[] = []</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    total</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    isLoading</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    aboutToAppear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.getShopList()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Header(&#123;<span class="attr">title</span>: <span class="string">&quot;商铺列表&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">            List(&#123;<span class="attr">space</span>: <span class="number">10</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                ForEach(<span class="built_in">this</span>.shopList, <span class="function">(<span class="params">shop: ShopInfo, index: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">                    ListItem()</span><br><span class="line">                    &#123;</span><br><span class="line">                        ShopItem(&#123;<span class="attr">shop</span>: shop&#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            layoutWeight(<span class="number">1</span>)</span><br><span class="line">                .width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">                .padding(<span class="number">10</span>)</span><br><span class="line">                .onReachEnd(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;触底&quot;</span>)</span><br><span class="line">                    <span class="comment">// 页面触底方法</span></span><br><span class="line">                    <span class="keyword">if</span> (!<span class="built_in">this</span>.isLoading &amp;&amp; <span class="built_in">this</span>.shopList.length &lt; <span class="built_in">this</span>.total) &#123;</span><br><span class="line">                        <span class="built_in">this</span>.isLoading = <span class="literal">true</span></span><br><span class="line">                        ShopModel.pageNo++</span><br><span class="line">                        <span class="built_in">this</span>.getShopList()</span><br><span class="line">                        <span class="built_in">console</span>.log(<span class="string">&quot;触底加载&quot;</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .backgroundColor(<span class="string">&quot;#ececec&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getShopList()</span><br><span class="line">    &#123;</span><br><span class="line">        ShopModel.getListFun().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> shops = res.data.rows</span><br><span class="line">            shops.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (item.images &amp;&amp; item.images.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    item.images.forEach(<span class="function">(<span class="params">img, i</span>) =&gt;</span> &#123;</span><br><span class="line">                        item.images[i] = <span class="string">`http://localhost:3000`</span> + img</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    item.images = [$r(<span class="string">&quot;app.media.mt&quot;</span>)]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.shopList = <span class="built_in">this</span>.shopList.concat(shops)</span><br><span class="line">            <span class="built_in">this</span>.total = res.data.total <span class="comment">// 获取总数</span></span><br><span class="line">            <span class="built_in">this</span>.isLoading = <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>里面用到了 ShopItem 组件，代码如下</p>
<h4 id="view"><a href="#view" class="headerlink" title="view"></a>view</h4><p>新建 src/main/ets/views 文件夹，我们将页面用到的组件都放在这个文件夹中</p>
<p>新增 ShopItem.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ShopInfo <span class="keyword">from</span> <span class="string">&#x27;../viewModel/ShopInfo&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span></span><br><span class="line">struct</span><br><span class="line">ShopItem</span><br><span class="line">&#123;</span><br><span class="line">    shop: ShopInfo</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: <span class="number">8</span>&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="built_in">this</span>.shop.name)</span><br><span class="line">                    .fontSize(<span class="number">20</span>)</span><br><span class="line">                    .fontWeight(FontWeight.Bold)</span><br><span class="line"></span><br><span class="line">                Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.computedScore(<span class="built_in">this</span>.shop.score)&#125;</span>分`</span>)</span><br><span class="line">                    .fontColor(Color.Orange)</span><br><span class="line">                    .fontSize(<span class="number">21</span>)</span><br><span class="line">                    .fontWeight(FontWeight.Bold)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line"></span><br><span class="line">            Row(&#123;<span class="attr">space</span>: <span class="number">5</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Image($r(<span class="string">&quot;app.media.dh&quot;</span>))</span><br><span class="line">                    .width(<span class="number">15</span>)</span><br><span class="line"></span><br><span class="line">                Text(<span class="built_in">this</span>.shop.address)</span><br><span class="line">                    .fontColor(<span class="string">&quot;#a3a3a3&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.shop.comments&#125;</span>条评价`</span>)</span><br><span class="line">                    .fontSize(<span class="number">18</span>)</span><br><span class="line">                    .fontWeight(FontWeight.Bold)</span><br><span class="line"></span><br><span class="line">                Text(<span class="string">`￥ <span class="subst">$&#123;<span class="built_in">this</span>.shop.avgPrice&#125;</span>/人`</span>)</span><br><span class="line">                    .fontSize(<span class="number">18</span>)</span><br><span class="line">                    .fontWeight(FontWeight.Bold)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line"></span><br><span class="line">            List(&#123;<span class="attr">space</span>: <span class="number">10</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                ForEach(<span class="built_in">this</span>.shop.images, <span class="function"><span class="params">src</span> =&gt;</span> &#123;</span><br><span class="line">                    ListItem()</span><br><span class="line">                    &#123;</span><br><span class="line">                        Image(src)</span><br><span class="line">                            .width(<span class="number">150</span>)</span><br><span class="line">                            .borderRadius(<span class="number">5</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .listDirection(Axis.Horizontal) <span class="comment">// 水平滑动</span></span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .padding(<span class="number">15</span>)</span><br><span class="line">            .borderRadius(<span class="number">15</span>)</span><br><span class="line">            .backgroundColor(Color.White)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    computedScore(score</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line">)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> (score / <span class="number">10</span>).toFixed(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="实现效果"><a href="#实现效果" class="headerlink" title="实现效果"></a>实现效果</h4><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240316124631986.png" alt="image-20240316124631986" style="zoom:50%;" />

<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>上面商铺列表的核心请求逻辑在 ShopModel.ts 文件中，主要代码利用了内置的 httpRequest 来完成请求</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.创建Http请求对象</span></span><br><span class="line"><span class="keyword">let</span> httpRequest = http.createHttp()</span><br><span class="line"><span class="comment">// 2.发送请求体</span></span><br><span class="line">httpRequest.request(</span><br><span class="line">    <span class="comment">// 请求路径</span></span><br><span class="line">    <span class="built_in">this</span>.buildUrl(<span class="string">`/shop?pageNo=<span class="subst">$&#123;<span class="built_in">this</span>.pageNo&#125;</span>&amp;pageSize=<span class="subst">$&#123;<span class="built_in">this</span>.pageSize&#125;</span>&#125;`</span>),</span><br><span class="line">    <span class="comment">// 请求体</span></span><br><span class="line">    &#123;</span><br><span class="line">        method: http.RequestMethod.GET,  <span class="comment">// 请求方式</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 3.拿到请求结果</span></span><br><span class="line">        <span class="keyword">if</span> (res.responseCode === <span class="number">200</span>) &#123;</span><br><span class="line">            resolve(<span class="built_in">JSON</span>.parse(res.result.toString()))</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`请求失败：<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(res)&#125;</span>`</span>)</span><br><span class="line">            reject()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`请求失败：<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(err)&#125;</span>`</span>)</span><br><span class="line">        reject()</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="第三方库Axios使用"><a href="#第三方库Axios使用" class="headerlink" title="第三方库Axios使用"></a>第三方库Axios使用</h3><h4 id="工具安装"><a href="#工具安装" class="headerlink" title="工具安装"></a>工具安装</h4><p>首先需要安装一个命令行工具</p>
<p>打开<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/ide-command-line-ohpm-0000001490235312-V2">官网相关文档</a><br>，点击如下按钮</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240320195737932.png" alt="image-20240320195737932"></p>
<p>选择自己的系统进行下载</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240320195814586.png" alt="image-20240320195814586"></p>
<p>下载好之后，进入ohpm/bin 目录下，执行 init.bat</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240320200449481.png" alt="image-20240320200449481"></p>
<p>然后等待安装完成后，输入 <code>ohpm -v</code> 查看版本</p>
<p><strong>接着配置环境变量</strong></p>
<p>将 bin 目录的位置添加到环境变量中</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240320200625407.png" alt="image-20240320200625407"></p>
<p>然后再随便目录下查看版本</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240320200713387.png" alt="image-20240320200713387"></p>
<p>可以出现版本号表示安装成功</p>
<h4 id="安装axios"><a href="#安装axios" class="headerlink" title="安装axios"></a>安装axios</h4><p>打开**<a target="_blank" rel="noopener" href="https://ohpm.openharmony.cn/#/cn/home">OpenHarmony三方库中心仓</a>**网站，搜索 axios 即可查看安装和使用方式</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240320201945272.png" alt="image-20240320201945272"></p>
<p>在项目根目录下执行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ohpm install @ohos/axios</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240320202404741.png" alt="image-20240320202404741"></p>
<h4 id="项目中使用"><a href="#项目中使用" class="headerlink" title="项目中使用"></a>项目中使用</h4><p>首先简单封装一下 axios，新建 src/main/ets/utils/service.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;@ohos/axios&#x27;</span></span><br><span class="line"></span><br><span class="line">axios.defaults.headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;application/json;charset=utf-8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建axios实例</span></span><br><span class="line"><span class="keyword">const</span> service = axios.create(&#123;</span><br><span class="line">    <span class="comment">// axios中请求配置有baseURL选项，表示请求URL公共部分</span></span><br><span class="line">    baseURL: <span class="string">&quot;http://localhost:3000&quot;</span>,</span><br><span class="line">    <span class="comment">// 超时1分钟</span></span><br><span class="line">    timeout: <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// request拦截器</span></span><br><span class="line">service.interceptors.request.use(</span><br><span class="line">    (config) =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> config</span><br><span class="line">    &#125;,</span><br><span class="line">    (error) =&gt; &#123;</span><br><span class="line">        <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">service.interceptors.response.use(</span><br><span class="line">    (res) =&gt; &#123;</span><br><span class="line">        <span class="comment">// 二进制数据则直接返回</span></span><br><span class="line">        <span class="keyword">if</span> (res.request.responseType === <span class="string">&#x27;blob&#x27;</span> || res.request.responseType === <span class="string">&#x27;arraybuffer&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.data</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res.data</span><br><span class="line">    &#125;,</span><br><span class="line">    (error) =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service</span><br></pre></td></tr></table></figure>

<p>然后新建接口请求api文件，这个文件用来放所有的请求部分</p>
<p>src/main/ets/api/ShopModelApi.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> service <span class="keyword">from</span> <span class="string">&quot;../utils/service&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取商铺列表方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">pageNo</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">pageSize</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getShopModelListFun</span>(<span class="params">pageNo, pageSize</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> service(&#123;</span><br><span class="line">        url: <span class="string">&quot;/shop&quot;</span>,</span><br><span class="line">        method: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">        params: &#123;</span><br><span class="line">            pageNo,</span><br><span class="line">            pageSize</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后修改 src/main/ets/model/ShopModel.ts，使用我们上面写好的方法来加载数据</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;getShopModelListFun&#125; <span class="keyword">from</span> <span class="string">&#x27;../api/ShopModelApi&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShopModel</span> </span>&#123;</span><br><span class="line">    pageNo: <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line">    pageSize: <span class="built_in">number</span> = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">getListFun</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getShopModelListFun(<span class="built_in">this</span>.pageNo, <span class="built_in">this</span>.pageSize)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> ShopModel()</span><br></pre></td></tr></table></figure>

<h2 id="应用数据持久化"><a href="#应用数据持久化" class="headerlink" title="应用数据持久化"></a>应用数据持久化</h2><h3 id="首选项实现轻量级数据持久化"><a href="#首选项实现轻量级数据持久化" class="headerlink" title="首选项实现轻量级数据持久化"></a>首选项实现轻量级数据持久化</h3><h4 id="场景介绍"><a href="#场景介绍" class="headerlink" title="场景介绍"></a>场景介绍</h4><p>用户首选项为应用提供Key-Value键值型的数据处理能力，支持应用持久化轻量级数据，并对其修改和查询。当用户希望有一个全局唯一存储的地方，可以采用用户首选项来进行存储。Preferences会将该数据缓存在内存中，当用户读取的时候，能够快速从内存中获取数据。Preferences会随着存放的数据量越多而导致应用占用的内存越大，因此，Preferences不适合存放过多的数据，适用的场景一般为应用保存用户的个性化设置（字体大小，是否开启夜间模式）等。</p>
<h4 id="运作机制"><a href="#运作机制" class="headerlink" title="运作机制"></a>运作机制</h4><p>如图所示，用户程序通过JS接口调用用户首选项读写对应的数据文件。开发者可以将用户首选项持久化文件的内容加载到Preferences实例，每个文件唯一对应到一个Preferences实例，系统会通过静态容器将该实例存储在内存中，直到主动从内存中移除该实例或者删除该文件。</p>
<p>应用首选项的持久化文件保存在应用沙箱内部，可以通过context获取其路径。具体可见<a target="_blank" rel="noopener" href="https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/application-context-stage-0000001427744560-V3#ZH-CN_TOPIC_0000001574128741__%E8%8E%B7%E5%8F%96%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E8%B7%AF%E5%BE%84">获取应用开发路径</a><br>。</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/0000000000011111111.20231121184036.52041992927498244504454425795214:50001231000000:2800:275286A8BDB4AD5B914B2109CC71CFFFFE43A89D6EAD8BF8A4EA4F5B5B16D8D6.jpg" alt="img"></p>
<h4 id="约束限制"><a href="#约束限制" class="headerlink" title="约束限制"></a>约束限制</h4><ul>
<li>Key键为string类型，要求非空且长度不超过80个字节。</li>
<li>如果Value值为string类型，可以为空，不为空时长度不超过8192个字节。</li>
<li>内存会随着存储数据量的增大而增大，所以存储的数据量应该是轻量级的，建议存储的数据不超过一万条，否则会在内存方面产生较大的开销。</li>
</ul>
<h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4><p>封装 PreferenceUtils 文件，添加操作缓存的几个方法。新建 src/main/ets/utils/PreferencesUtils.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dataPreferences <span class="keyword">from</span> <span class="string">&#x27;@ohos.data.preferences&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PreferencesUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> prefMap: <span class="built_in">Map</span>&lt;<span class="built_in">string</span>, dataPreferences.Preferences&gt; = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加载Preference</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param </span>context 上下文实例</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param </span>name 每个Preferences实例的唯一标识</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">onLoadPreferences</span>(<span class="params">context, name: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 创建Preference实例</span></span><br><span class="line">            <span class="keyword">let</span> pre = <span class="keyword">await</span> dataPreferences.getPreferences(context, name)</span><br><span class="line">            <span class="comment">// 将得到的Preference保存到一个map中</span></span><br><span class="line">            <span class="built_in">this</span>.prefMap.set(name, pre)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;test-preference&quot;</span>, <span class="string">`创建【preference <span class="subst">$&#123;name&#125;</span>】成功`</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;test-preference&quot;</span>, <span class="string">`创建【preference <span class="subst">$&#123;name&#125;</span>】失败`</span>, <span class="built_in">JSON</span>.stringify(e))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存缓存数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param </span>name preference唯一表示</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param </span>key 缓存的键名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param </span>value 缓存的键值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">putPreferences</span>(<span class="params">name: <span class="built_in">string</span>, key: <span class="built_in">string</span>, value: dataPreferences.ValueType</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> pref = <span class="built_in">this</span>.prefMap.get(name)</span><br><span class="line">        <span class="keyword">if</span> (!pref) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;test-preferences&quot;</span>, <span class="string">`preferences:【<span class="subst">$&#123;name&#125;</span>】实例不存在`</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 写入数据</span></span><br><span class="line">            <span class="keyword">await</span> pref.put(key, value)</span><br><span class="line">            <span class="comment">// 刷入磁盘</span></span><br><span class="line">            <span class="keyword">await</span> pref.flush()</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;test-preferences&quot;</span>, <span class="string">`保存【<span class="subst">$&#123;key&#125;</span> = <span class="subst">$&#123;value&#125;</span>】成功`</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;test-preferences&quot;</span>, <span class="string">`保存【<span class="subst">$&#123;key&#125;</span> = <span class="subst">$&#123;value&#125;</span>】失败`</span>, <span class="built_in">JSON</span>.stringify(e))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取缓存数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param </span>name preference唯一表示</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param </span>key 读取的键名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param </span>defValue 当键名不存在时默认的返回值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getPreferences</span>(<span class="params">name: <span class="built_in">string</span>, key: <span class="built_in">string</span>, defValue: dataPreferences.ValueType</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> pref = <span class="built_in">this</span>.prefMap.get(name)</span><br><span class="line">        <span class="keyword">if</span> (!pref) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;test-preferences&quot;</span>, <span class="string">`preferences:【<span class="subst">$&#123;name&#125;</span>】实例不存在`</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> value = <span class="keyword">await</span> pref.get(key, defValue)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;test-preferences&quot;</span>, <span class="string">`读取【<span class="subst">$&#123;key&#125;</span> = <span class="subst">$&#123;value&#125;</span>】成功`</span>)</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;test-preferences&quot;</span>, <span class="string">`读取【<span class="subst">$&#123;key&#125;</span>】失败`</span>, <span class="built_in">JSON</span>.stringify(e))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除指定key的缓存数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param </span>name preference唯一表示</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param </span>key 要删除的键名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">deletePreferences</span>(<span class="params">name: <span class="built_in">string</span>, key: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> pref = <span class="built_in">this</span>.prefMap.get(name)</span><br><span class="line">        <span class="keyword">if</span> (!pref) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;test-preferences&quot;</span>, <span class="string">`preferences:【<span class="subst">$&#123;name&#125;</span>】实例不存在`</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">await</span> pref.delete(key)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;test-preferences&quot;</span>, <span class="string">`删除【<span class="subst">$&#123;key&#125;</span>】成功`</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;test-preferences&quot;</span>, <span class="string">`删除【<span class="subst">$&#123;key&#125;</span>】失败`</span>, <span class="built_in">JSON</span>.stringify(e))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 监听缓存变化</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param </span>name preference唯一表示</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param </span>callback 缓存变化后触发的回调，会通过参数传递当前变化的key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">onPreferences</span>(<span class="params">name: <span class="built_in">string</span>, callback</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> pref = <span class="built_in">this</span>.prefMap.get(name)</span><br><span class="line">        <span class="keyword">if</span> (!pref) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;test-preferences&quot;</span>, <span class="string">`preferences:【<span class="subst">$&#123;name&#125;</span>】实例不存在`</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        pref.on(<span class="string">&quot;change&quot;</span>, callback)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> PreferencesUtils()</span><br></pre></td></tr></table></figure>

<p>然后再应用Ability启动时，去获取 Preference 实例</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240321094652436.png" alt="image-20240321094652436"></p>
<p>然后修改首页，增加了控制字体大小的功能，并且将修改后的结果保存到缓存中，重新启动时会从缓存读取上次保存的字体大小</p>
<p>新增一个控制字体大小的组件 src/main/ets/views/IndexFontSizePanel.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PreferenceUtils <span class="keyword">from</span> <span class="string">&quot;../utils/PreferencesUtils&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span></span><br><span class="line">struct</span><br><span class="line">IndexFontSizePanel</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@Consume</span></span><br><span class="line">    fontSize</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line">    fontSizeMap:<span class="built_in">object</span> = &#123;</span><br><span class="line">        <span class="number">14</span>: <span class="string">&quot;小&quot;</span>,</span><br><span class="line">        <span class="number">16</span>: <span class="string">&quot;标准&quot;</span>,</span><br><span class="line">        <span class="number">18</span>: <span class="string">&quot;大&quot;</span>,</span><br><span class="line">        <span class="number">20</span>: <span class="string">&quot;特大&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: <span class="number">10</span>&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.fontSizeMap[<span class="built_in">this</span>.fontSize]&#125;</span>`</span>)</span><br><span class="line">                    .fontSize(<span class="built_in">this</span>.fontSize)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .height(<span class="number">20</span>)</span><br><span class="line">                .justifyContent(FlexAlign.Center)</span><br><span class="line"></span><br><span class="line">            Row(&#123;<span class="attr">space</span>: <span class="number">10</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="string">`A`</span>).fontSize(<span class="number">14</span>).fontWeight(FontWeight.Bold)</span><br><span class="line"></span><br><span class="line">                Slider(&#123;</span><br><span class="line">                    min: <span class="number">14</span>,</span><br><span class="line">                    max: <span class="number">20</span>,</span><br><span class="line">                    step: <span class="number">2</span>,</span><br><span class="line">                    value: <span class="built_in">this</span>.fontSize</span><br><span class="line">                &#125;)</span><br><span class="line">                    .onChange(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.fontSize = val</span><br><span class="line">                        <span class="comment">// 修改字体大小后将最新值保存到缓存中</span></span><br><span class="line">                        PreferenceUtils.putPreferences(<span class="string">&quot;MyPreference&quot;</span>, <span class="string">&quot;fontSize&quot;</span>, val)</span><br><span class="line">                    &#125;)</span><br><span class="line">                    .layoutWeight(<span class="number">1</span>)</span><br><span class="line">                    .trackThickness(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">                Text(<span class="string">`A`</span>).fontSize(<span class="number">20</span>).fontWeight(FontWeight.Bold)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .padding(&#123;<span class="attr">left</span>: <span class="number">5</span>, <span class="attr">right</span>: <span class="number">5</span>&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .padding(<span class="number">10</span>)</span><br><span class="line">            .backgroundColor(<span class="string">&#x27;#fff1f0f0&#x27;</span>)</span><br><span class="line">            .borderRadius(<span class="number">20</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再IndexPages中使用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> RouterItem <span class="keyword">from</span> <span class="string">&#x27;../viewModel/RouterItem&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;IndexFontSizePanel&#125; <span class="keyword">from</span> <span class="string">&#x27;../views/IndexFontSizePanel&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;RouterItemBox&#125; <span class="keyword">from</span> <span class="string">&#x27;../views/RouterItemBox&#x27;</span></span><br><span class="line"><span class="keyword">import</span> PreferenceUtils <span class="keyword">from</span> <span class="string">&quot;../utils/PreferencesUtils&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routerList: RouterItem[] = [</span><br><span class="line">    <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/ImagePage&quot;</span>, <span class="string">&quot;查看图片页面&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/ItemsPage&quot;</span>, <span class="string">&quot;商品列表页面&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/StatePage&quot;</span>, <span class="string">&quot;Jack和他的女朋友们&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/TaskListPage&quot;</span>, <span class="string">&quot;任务列表&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/AnimationPage&quot;</span>, <span class="string">&quot;小鱼动画&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/AnimationPageV2&quot;</span>, <span class="string">&quot;小鱼动画V2&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/LifeCyclePage&quot;</span>, <span class="string">&quot;生命周期案例1&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/LifeCyclePage1&quot;</span>, <span class="string">&quot;生命周期案例2&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/DocumentPage&quot;</span>, <span class="string">&quot;文档列表页面&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> RouterItem(<span class="string">&quot;pages/ShopPage&quot;</span>, <span class="string">&quot;商铺列表&quot;</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">Index</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    message</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span> = <span class="string">&#x27;页面列表&#x27;</span></span><br><span class="line">    tag: <span class="built_in">string</span> = <span class="string">&quot;Index Page&quot;</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    isShowPanel</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line"><span class="meta">@Provide</span></span><br><span class="line">    fontSize</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">16</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 页面加载成功后，从缓存中读取fontSize</span></span><br><span class="line">    <span class="keyword">async</span></span><br><span class="line">    aboutToAppear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.fontSize = <span class="keyword">await</span> PreferenceUtils.getPreferences(<span class="string">&quot;MyPreference&quot;</span>, <span class="string">&quot;fontSize&quot;</span>, <span class="number">16</span>) <span class="keyword">as</span> <span class="built_in">number</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="built_in">this</span>.message)</span><br><span class="line">                    .fontSize(<span class="number">30</span>)</span><br><span class="line">                    .fontWeight(FontWeight.Bold)</span><br><span class="line">                    .fontColor(<span class="string">&quot;#36d&quot;</span>)</span><br><span class="line"></span><br><span class="line">                Image($r(<span class="string">&quot;app.media.settingPng&quot;</span>))</span><br><span class="line">                    .width(<span class="number">25</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        animateTo(&#123;</span><br><span class="line">                            duration: <span class="number">500</span>,</span><br><span class="line">                            curve: Curve.EaseOut</span><br><span class="line">                        &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            <span class="built_in">this</span>.isShowPanel = !<span class="built_in">this</span>.isShowPanel</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line">                .padding(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">            List(&#123;<span class="attr">space</span>: <span class="number">10</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                ForEach(routerList, <span class="function">(<span class="params">r: RouterItem, index: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">                    ListItem()</span><br><span class="line">                    &#123;</span><br><span class="line">                        RouterItemBox(&#123;</span><br><span class="line">                            item: r,</span><br><span class="line">                            rid: index + <span class="number">1</span></span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .layoutWeight(<span class="number">1</span>)</span><br><span class="line">                .padding(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.isShowPanel) &#123;</span><br><span class="line">                IndexFontSizePanel()</span><br><span class="line">                    .transition(&#123;</span><br><span class="line">                        translate: &#123;<span class="attr">y</span>: <span class="number">115</span>&#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .height(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240321095424636.png" alt="image-20240321095424636"></p>
<blockquote>
<p>注意：首选项缓存只能在模拟器或者真机中有效</p>
</blockquote>
<h3 id="关系型数据库"><a href="#关系型数据库" class="headerlink" title="关系型数据库"></a>关系型数据库</h3><p><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/data-persistence-by-rdb-store-0000001505752421-V2">官方文档</a></p>
<h4 id="新建页面"><a href="#新建页面" class="headerlink" title="新建页面"></a>新建页面</h4><p>新建页面 src/main/ets/pages/TaskSqlPage.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Header&#125; <span class="keyword">from</span> <span class="string">&#x27;../components/Header&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;HeaderCar&#125; <span class="keyword">from</span> <span class="string">&#x27;../views/task/HeaderCar&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;TaskItem&#125; <span class="keyword">from</span> <span class="string">&#x27;../views/task/TaskListItem&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">TaskSqlPage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 任务总数量</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    taskTotal</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 已完成数量</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    finishTotal</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Header(&#123;<span class="attr">title</span>: <span class="string">&quot;任务列表SQL版本&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">            Column()</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 头部卡片</span></span><br><span class="line">                HeaderCar(&#123;</span><br><span class="line">                    taskTotal: <span class="built_in">this</span>.taskTotal,</span><br><span class="line">                    finishTotal: <span class="built_in">this</span>.finishTotal</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 底部的任务列表组件</span></span><br><span class="line">                TaskItem(&#123;</span><br><span class="line">                    taskTotal: $taskTotal,</span><br><span class="line">                    finishTotal: $finishTotal</span><br><span class="line">                &#125;)</span><br><span class="line">                    .layoutWeight(<span class="number">1</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">                .width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">                .padding(<span class="number">15</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>views/task/HeaderCar</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> FinishColor = <span class="string">&quot;#36D&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义卡片公共样式</span></span><br><span class="line"><span class="meta">@Styles</span> <span class="function"><span class="keyword">function</span> <span class="title">carStyle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">.</span><br><span class="line">    borderRadius(<span class="number">8</span>)</span><br><span class="line">        .shadow(&#123;</span><br><span class="line">            radius: <span class="number">20</span>,</span><br><span class="line">            color: <span class="string">&quot;#bbb&quot;</span>,</span><br><span class="line">            offsetX: <span class="number">3</span>,</span><br><span class="line">            offsetY: <span class="number">4</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .backgroundColor(Color.White)</span><br><span class="line">        .width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span></span><br><span class="line">struct</span><br><span class="line">HeaderCar</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 定义从父组件接收的字段</span></span><br><span class="line"><span class="meta">@Prop</span></span><br><span class="line">    finishTotal</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line"><span class="meta">@Prop</span></span><br><span class="line">    taskTotal</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            Text(<span class="string">&quot;任务列表&quot;</span>)</span><br><span class="line">                .fontSize(<span class="number">25</span>)</span><br><span class="line">                .fontWeight(FontWeight.Bold)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 栈组件，让多个组件堆叠在一起</span></span><br><span class="line">            Stack()</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 进度条</span></span><br><span class="line">                Progress(&#123;</span><br><span class="line">                    value: <span class="built_in">this</span>.finishTotal,</span><br><span class="line">                    total: <span class="built_in">this</span>.taskTotal,</span><br><span class="line">                    <span class="keyword">type</span>: ProgressType.ScaleRing <span class="comment">// 设置成环形进度条</span></span><br><span class="line">                &#125;)</span><br><span class="line">                    .width(<span class="number">100</span>)</span><br><span class="line">                    .color(FinishColor)</span><br><span class="line">                    .style(&#123;</span><br><span class="line">                        strokeWidth: <span class="number">5</span></span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                Row()</span><br><span class="line">                &#123;</span><br><span class="line">                    Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.finishTotal&#125;</span>`</span>)</span><br><span class="line">                        .fontColor(FinishColor)</span><br><span class="line">                        .fontSize(<span class="number">25</span>)</span><br><span class="line"></span><br><span class="line">                    Text(<span class="string">` / <span class="subst">$&#123;<span class="built_in">this</span>.taskTotal&#125;</span>`</span>)</span><br><span class="line">                        .fontSize(<span class="number">25</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        carStyle()</span><br><span class="line">            .padding(<span class="number">35</span>)</span><br><span class="line">            .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>src/main/ets/views/task/TaskListItem.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Task&#125; <span class="keyword">from</span> <span class="string">&#x27;../../viewModel/TaskInfo&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;TaskDialog&#125; <span class="keyword">from</span> <span class="string">&#x27;./TaskDialog&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;RowItem&#125; <span class="keyword">from</span> <span class="string">&#x27;./TaskRowItem&#x27;</span></span><br><span class="line"><span class="keyword">import</span> taskModel <span class="keyword">from</span> <span class="string">&quot;../../model/TaskModel&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span></span><br><span class="line">struct</span><br><span class="line">TaskItem</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@Link</span></span><br><span class="line">    taskTotal</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line"><span class="meta">@Link</span></span><br><span class="line">    finishTotal</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    taskList</span><br><span class="line">:</span><br><span class="line">    Task[] = []</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 任务弹框</span></span><br><span class="line">    dialogController: CustomDialogController = <span class="keyword">new</span> CustomDialogController(&#123;</span><br><span class="line">        builder: TaskDialog(&#123;</span><br><span class="line">            onTaskConfirm: <span class="built_in">this</span>.addTaskName.bind(<span class="built_in">this</span>)</span><br><span class="line">        &#125;),</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    aboutToAppear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;test-tag:TaskItem onPageShow&quot;</span>)</span><br><span class="line">        taskModel.getTaskList().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.taskList = res</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;test-tag:查询数据&quot;</span>, <span class="built_in">JSON</span>.stringify(<span class="built_in">this</span>.taskList))</span><br><span class="line">            <span class="built_in">this</span>.handleTaskChange()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handleTaskChange()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.taskTotal = <span class="built_in">this</span>.taskList.length</span><br><span class="line">        <span class="built_in">this</span>.finishTotal = <span class="built_in">this</span>.taskList.filter(<span class="function"><span class="params">i</span> =&gt;</span> i.finish).length</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    addTaskName(taskName</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span></span><br><span class="line">)</span><br><span class="line">    &#123;</span><br><span class="line">        taskModel.addTask(taskName)</span><br><span class="line">            .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">`test-tag:添加任务成功：<span class="subst">$&#123;taskName&#125;</span>`</span>)</span><br><span class="line">                <span class="built_in">this</span>.taskList.push(<span class="keyword">new</span> Task(<span class="number">1</span>, taskName))</span><br><span class="line">                <span class="built_in">this</span>.handleTaskChange()</span><br><span class="line">            &#125;)</span><br><span class="line">            .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">`test-tag:添加任务失败：<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(err)&#125;</span>`</span>)</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Button(<span class="string">&quot;添加任务&quot;</span>)</span><br><span class="line">                    .width(<span class="number">200</span>)</span><br><span class="line">                    .margin(&#123;<span class="attr">top</span>: <span class="number">30</span>, <span class="attr">bottom</span>: <span class="number">30</span>&#125;)</span><br><span class="line">                    .backgroundColor(<span class="string">&quot;#36D&quot;</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.dialogController.open()</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            List(&#123;<span class="attr">space</span>: <span class="number">20</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                ForEach(<span class="built_in">this</span>.taskList, <span class="function">(<span class="params">task: Task, index</span>) =&gt;</span> &#123;</span><br><span class="line">                    ListItem()</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// 每一行组件</span></span><br><span class="line">                        RowItem(&#123;</span><br><span class="line">                            task: task,</span><br><span class="line">                            <span class="comment">// 将父组件定义的方法传递给子组件，并绑定this为父组件的this</span></span><br><span class="line">                            handleTaskChange: <span class="built_in">this</span>.handleTaskChange.bind(<span class="built_in">this</span>)</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                .</span><br><span class="line">                    swipeAction(&#123;</span><br><span class="line">                        <span class="comment">// 往左边滑动时出现自定义的构建函数</span></span><br><span class="line">                        end: <span class="built_in">this</span>.deleteBuilder(index, task.id)</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .layoutWeight(<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自定义删除按钮的构建函数</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line">    deleteBuilder(index, id</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line">)</span><br><span class="line">    &#123;</span><br><span class="line">        Button()</span><br><span class="line">        &#123;</span><br><span class="line">            Image($r(<span class="string">&quot;app.media.deleteIcon&quot;</span>))</span><br><span class="line">                .width(<span class="number">20</span>)</span><br><span class="line">                .interpolation(ImageInterpolation.High)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="number">40</span>)</span><br><span class="line">            .height(<span class="number">40</span>)</span><br><span class="line">            .margin(&#123;<span class="attr">left</span>: <span class="number">15</span>&#125;)</span><br><span class="line">            .backgroundColor(Color.Red)</span><br><span class="line">            .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 删除任务</span></span><br><span class="line">                taskModel.deleteTaskById(id)</span><br><span class="line">                <span class="built_in">this</span>.taskList.splice(index, <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">this</span>.handleTaskChange()</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加弹框组件</p>
<p>src/main/ets/views/task/TaskDialog.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CustomDialog</span></span><br><span class="line"><span class="keyword">export</span></span><br><span class="line">struct</span><br><span class="line">TaskDialog</span><br><span class="line">&#123;</span><br><span class="line">    controller: CustomDialogController</span><br><span class="line">    <span class="comment">// 任务名称</span></span><br><span class="line">    name: <span class="built_in">string</span></span><br><span class="line">    <span class="comment">// 点击确认后触发的事件</span></span><br><span class="line">    onTaskConfirm: <span class="function">(<span class="params">name: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line"></span><br><span class="line">        build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: <span class="number">20</span>&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                TextInput(&#123;</span><br><span class="line">                    placeholder: <span class="string">&quot;请输入任务名称&quot;</span>,</span><br><span class="line">                    text: <span class="built_in">this</span>.name</span><br><span class="line">                &#125;)</span><br><span class="line">                    .onChange(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.name = val</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Button(<span class="string">&quot;取消&quot;</span>)</span><br><span class="line">                    .backgroundColor(Color.Gray)</span><br><span class="line">                    .width(<span class="string">&quot;100&quot;</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.controller.close()</span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                Button(<span class="string">&quot;确定&quot;</span>)</span><br><span class="line">                    .backgroundColor(<span class="string">&quot;#36d&quot;</span>)</span><br><span class="line">                    .fontColor(Color.White)</span><br><span class="line">                    .width(<span class="string">&quot;100&quot;</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="comment">// 对外触发确认事件，并发送填写的任务名称</span></span><br><span class="line">                        <span class="built_in">this</span>.onTaskConfirm(<span class="built_in">this</span>.name)</span><br><span class="line">                        <span class="built_in">this</span>.controller.close()</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .justifyContent(FlexAlign.SpaceAround)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .padding(<span class="number">20</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>src/main/ets/views/task/TaskRowItem.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Task&#125; <span class="keyword">from</span> <span class="string">&#x27;../../viewModel/TaskInfo&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义卡片公共样式</span></span><br><span class="line"><span class="meta">@Styles</span> <span class="function"><span class="keyword">function</span> <span class="title">carStyle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">.</span><br><span class="line">    borderRadius(<span class="number">8</span>)</span><br><span class="line">        .shadow(&#123;</span><br><span class="line">            radius: <span class="number">20</span>,</span><br><span class="line">            color: <span class="string">&quot;#bbb&quot;</span>,</span><br><span class="line">            offsetX: <span class="number">3</span>,</span><br><span class="line">            offsetY: <span class="number">4</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .backgroundColor(Color.White)</span><br><span class="line">        .width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span></span><br><span class="line">struct</span><br><span class="line">RowItem</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@ObjectLink</span></span><br><span class="line">    task</span><br><span class="line">:</span><br><span class="line">    Task</span><br><span class="line">    handleTaskChange: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line"></span><br><span class="line">        build()</span><br><span class="line">    &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.task.finish) &#123;</span><br><span class="line">                Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.task.name&#125;</span>`</span>)</span><br><span class="line">                    .fontColor(<span class="string">&quot;#ccc&quot;</span>)</span><br><span class="line">                    .decoration(&#123;<span class="attr">type</span>: TextDecorationType.LineThrough&#125;)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.task.name&#125;</span>`</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Checkbox()</span><br><span class="line">                .select(<span class="built_in">this</span>.task.finish)</span><br><span class="line">                .selectedColor(<span class="string">&quot;#036D&quot;</span>)</span><br><span class="line">                .onChange(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.task.finish = val</span><br><span class="line">                    <span class="built_in">this</span>.handleTaskChange()</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        carStyle()</span><br><span class="line">            .padding(<span class="number">20</span>)</span><br><span class="line">            .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="封装接口方法"><a href="#封装接口方法" class="headerlink" title="封装接口方法"></a>封装接口方法</h4><p>src/main/ets/model/TaskModel.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> relationalStore <span class="keyword">from</span> <span class="string">&quot;@ohos.data.relationalStore&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123;Task&#125; <span class="keyword">from</span> <span class="string">&#x27;../viewModel/TaskInfo&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskModel</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 数据库实例</span></span><br><span class="line">    <span class="keyword">private</span> rdbStore: relationalStore.RdbStore</span><br><span class="line">    <span class="comment">// 表名称</span></span><br><span class="line">    <span class="keyword">private</span> tableName: <span class="built_in">string</span> = <span class="string">&#x27;TASK&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化数据库</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param </span>context 上下文</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="title">initTaskDB</span>(<span class="params">context</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// rdb配置</span></span><br><span class="line">        <span class="keyword">const</span> config = &#123;</span><br><span class="line">            name: <span class="string">&quot;Task.db&quot;</span>, <span class="comment">// 数据库文件名，也是数据库唯一标识符。</span></span><br><span class="line">            securityLevel: relationalStore.SecurityLevel.S1</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 创建数据库的SQL语句</span></span><br><span class="line">        <span class="keyword">const</span> sql = <span class="string">`CREATE TABLE IF NOT EXISTS TASK (</span></span><br><span class="line"><span class="string">                  ID INTEGER PRIMARY KEY AUTOINCREMENT,</span></span><br><span class="line"><span class="string">                  NAME TEXT NOT NULL,</span></span><br><span class="line"><span class="string">                  FINISH bit</span></span><br><span class="line"><span class="string">                 )`</span></span><br><span class="line">        relationalStore.getRdbStore(context, config, <span class="function">(<span class="params">err, rdbStore</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;test-tag&quot;</span>, <span class="string">`数据库Task.db创建失败`</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 执行SQL</span></span><br><span class="line">            rdbStore.executeSql(sql)</span><br><span class="line">            <span class="comment">// 保存rdb</span></span><br><span class="line">            <span class="built_in">this</span>.rdbStore = rdbStore</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`test-tag 初始化数据库成功`</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">getTaskList</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.构建查询条件</span></span><br><span class="line">        <span class="keyword">let</span> predicates = <span class="keyword">new</span> relationalStore.RdbPredicates(<span class="built_in">this</span>.tableName)</span><br><span class="line">        <span class="comment">// 2.查询</span></span><br><span class="line">        <span class="keyword">let</span> result = <span class="keyword">await</span> <span class="built_in">this</span>.rdbStore.query(predicates, [<span class="string">&#x27;ID&#x27;</span>, <span class="string">&#x27;NAME&#x27;</span>, <span class="string">&#x27;FINISH&#x27;</span>])</span><br><span class="line">        <span class="comment">// 3.解析查询结果</span></span><br><span class="line">        <span class="comment">// 3.1.定义一个数组，组装最终的查询结果</span></span><br><span class="line">        <span class="keyword">let</span> tasks: Task[] = []</span><br><span class="line">        <span class="comment">// 3.2.遍历封装</span></span><br><span class="line">        <span class="keyword">while</span> (!result.isAtLastRow) &#123;</span><br><span class="line">            <span class="comment">// 3.3.指针移动到下一行</span></span><br><span class="line">            result.goToNextRow()</span><br><span class="line">            <span class="comment">// 3.4.获取数据</span></span><br><span class="line">            <span class="keyword">let</span> id = result.getLong(result.getColumnIndex(<span class="string">&#x27;ID&#x27;</span>))</span><br><span class="line">            <span class="keyword">let</span> name = result.getString(result.getColumnIndex(<span class="string">&#x27;NAME&#x27;</span>))</span><br><span class="line">            <span class="keyword">let</span> finish = result.getLong(result.getColumnIndex(<span class="string">&#x27;FINISH&#x27;</span>))</span><br><span class="line">            <span class="comment">// 3.5.封装到数组</span></span><br><span class="line">            tasks.push(&#123;id, name, <span class="attr">finish</span>: !!finish&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;test-tag&#x27;</span>, <span class="string">&#x27;查询到数据：&#x27;</span>, <span class="built_in">JSON</span>.stringify(tasks))</span><br><span class="line">        <span class="keyword">return</span> tasks</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加任务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param </span>name 任务名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">addTask</span>(<span class="params">name: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> <span class="built_in">this</span>.rdbStore.insert(<span class="built_in">this</span>.tableName, &#123;</span><br><span class="line">            name,</span><br><span class="line">            finish: <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="variable">id</span></span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="variable">finish</span></span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">updateTaskById</span>(<span class="params">id: <span class="built_in">number</span>, finish: <span class="built_in">boolean</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 1 要更新的数据</span></span><br><span class="line">        <span class="keyword">let</span> data = &#123;finish&#125;</span><br><span class="line">        <span class="comment">// 2 创建条件构造器</span></span><br><span class="line">        <span class="keyword">let</span> predicates = <span class="keyword">new</span> relationalStore.RdbPredicates(<span class="built_in">this</span>.tableName)</span><br><span class="line">        <span class="comment">// 3 先找到这个数据</span></span><br><span class="line">        predicates.equalTo(<span class="string">&quot;ID&quot;</span>, id)</span><br><span class="line">        <span class="comment">// 4 更新</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> <span class="built_in">this</span>.rdbStore.update(data, predicates)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="variable">id</span></span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param <span class="variable">finish</span></span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@returns</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">deleteTaskById</span>(<span class="params">id: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 1 创建条件构造器</span></span><br><span class="line">        <span class="keyword">let</span> predicates = <span class="keyword">new</span> relationalStore.RdbPredicates(<span class="built_in">this</span>.tableName)</span><br><span class="line">        <span class="comment">// 2 先找到这个数据</span></span><br><span class="line">        predicates.equalTo(<span class="string">&quot;ID&quot;</span>, id)</span><br><span class="line">        <span class="comment">// 3 删除</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> <span class="built_in">this</span>.rdbStore.delete(predicates)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> TaskModel()</span><br></pre></td></tr></table></figure>

<h2 id="通知"><a href="#通知" class="headerlink" title="通知"></a>通知</h2><h3 id="基础通知"><a href="#基础通知" class="headerlink" title="基础通知"></a>基础通知</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> notify <span class="keyword">from</span> <span class="string">&#x27;@ohos.notificationManager&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;Header&#125; <span class="keyword">from</span> <span class="string">&#x27;../components/Header&#x27;</span></span><br><span class="line"><span class="keyword">import</span> image <span class="keyword">from</span> <span class="string">&#x27;@ohos.multimedia.image&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">NotificationMessagePage</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    mid</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">100</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    picture</span><br><span class="line">:</span><br><span class="line">    PixelMap = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span></span><br><span class="line">    aboutToAppear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取资源管理器</span></span><br><span class="line">        <span class="keyword">let</span> rm = getContext(<span class="built_in">this</span>).resourceManager;</span><br><span class="line">        <span class="comment">// 读取图片</span></span><br><span class="line">        <span class="keyword">let</span> file = <span class="keyword">await</span> rm.getMediaContent($r(<span class="string">&#x27;app.media.xiaomi14&#x27;</span>))</span><br><span class="line">        <span class="comment">// 创建PixelMap</span></span><br><span class="line">        image.createImageSource(file.buffer).createPixelMap()</span><br><span class="line">            .then(<span class="function"><span class="params">value</span> =&gt;</span> <span class="built_in">this</span>.picture = value)</span><br><span class="line">            .catch(<span class="function"><span class="params">reason</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;加载图片异常&#x27;</span>, <span class="built_in">JSON</span>.stringify(reason)))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Header(&#123;<span class="attr">title</span>: <span class="string">&quot;消息通知&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">            Column()</span><br><span class="line">            &#123;</span><br><span class="line">                Row()</span><br><span class="line">                &#123;</span><br><span class="line">                    Button(<span class="string">&quot;发送normal通知&quot;</span>).onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.publishBasicText()</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            .</span><br><span class="line">                width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                Row()</span><br><span class="line">                &#123;</span><br><span class="line">                    Button(<span class="string">&quot;发送longText通知&quot;</span>).onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.publishLongText()</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            .</span><br><span class="line">                width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                Row()</span><br><span class="line">                &#123;</span><br><span class="line">                    Button(<span class="string">&quot;发送multiLine通知&quot;</span>).onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.publishMultilineText()</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            .</span><br><span class="line">                width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                Row()</span><br><span class="line">                &#123;</span><br><span class="line">                    Button(<span class="string">&quot;发送picture通知&quot;</span>).onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.publishPictureText()</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            .</span><br><span class="line">                width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">                .height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">                .padding(<span class="number">15</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// normal通知</span></span><br><span class="line">    publishBasicText()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> request: notify.NotificationRequest = &#123;</span><br><span class="line">            id: <span class="built_in">this</span>.mid++,</span><br><span class="line">            content: &#123;</span><br><span class="line">                contentType: notify.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT,</span><br><span class="line">                normal: &#123;</span><br><span class="line">                    title: <span class="string">&quot;通知标题&quot;</span> + <span class="built_in">this</span>.mid,</span><br><span class="line">                    text: <span class="string">&quot;我是通知内容&quot;</span>,</span><br><span class="line">                    additionalText: <span class="string">&quot;我是附加内容&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            showDeliveryTime: <span class="literal">true</span>, <span class="comment">// 是否显示通知时间</span></span><br><span class="line">            deliveryTime: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(), <span class="comment">// 通知时间</span></span><br><span class="line">            groupName: <span class="string">&quot;wechat&quot;</span>, <span class="comment">// 通知分组</span></span><br><span class="line">            slotType: notify.SlotType.SOCIAL_COMMUNICATION <span class="comment">// 通知通道</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.publish(request)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 长文本通知</span></span><br><span class="line">    publishLongText()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> request: notify.NotificationRequest = &#123;</span><br><span class="line">            id: <span class="built_in">this</span>.mid++,</span><br><span class="line">            content: &#123;</span><br><span class="line">                contentType: notify.ContentType.NOTIFICATION_CONTENT_LONG_TEXT,</span><br><span class="line">                longText: &#123;</span><br><span class="line">                    title: <span class="string">&quot;通知标题&quot;</span> + <span class="built_in">this</span>.mid,</span><br><span class="line">                    text: <span class="string">&quot;我是通知内容&quot;</span>,</span><br><span class="line">                    additionalText: <span class="string">&quot;我是附加内容&quot;</span>,</span><br><span class="line">                    longText: <span class="string">&quot;我是很长的文本，我是很长的文本，我是很长的文本，我是很长的文本&quot;</span>,</span><br><span class="line">                    expandedTitle: <span class="string">&quot;展开后的标题&quot;</span>,</span><br><span class="line">                    briefText: <span class="string">&quot;通知展开后的概要&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            showDeliveryTime: <span class="literal">true</span>, <span class="comment">// 是否显示通知时间</span></span><br><span class="line">            deliveryTime: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(), <span class="comment">// 通知时间</span></span><br><span class="line">            groupName: <span class="string">&quot;wechat&quot;</span>, <span class="comment">// 通知分组</span></span><br><span class="line">            slotType: notify.SlotType.SOCIAL_COMMUNICATION <span class="comment">// 通知通道</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.publish(request)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 多行标题</span></span><br><span class="line">    publishMultilineText()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> request: notify.NotificationRequest = &#123;</span><br><span class="line">            id: <span class="built_in">this</span>.mid++,</span><br><span class="line">            content: &#123;</span><br><span class="line">                contentType: notify.ContentType.NOTIFICATION_CONTENT_MULTILINE,</span><br><span class="line">                multiLine: &#123;</span><br><span class="line">                    title: <span class="string">&quot;通知标题&quot;</span> + <span class="built_in">this</span>.mid,</span><br><span class="line">                    text: <span class="string">&quot;我是通知内容&quot;</span>,</span><br><span class="line">                    additionalText: <span class="string">&quot;我是附加内容&quot;</span>,</span><br><span class="line">                    briefText: <span class="string">&quot;通知展开时的概要&quot;</span>,</span><br><span class="line">                    longTitle: <span class="string">&quot;展开时的标题&quot;</span>,</span><br><span class="line">                    lines: [</span><br><span class="line">                        <span class="string">&quot;第一行&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;第二行&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;第三行&quot;</span></span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            showDeliveryTime: <span class="literal">true</span>, <span class="comment">// 是否显示通知时间</span></span><br><span class="line">            deliveryTime: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(), <span class="comment">// 通知时间</span></span><br><span class="line">            groupName: <span class="string">&quot;wechat&quot;</span>, <span class="comment">// 通知分组</span></span><br><span class="line">            slotType: notify.SlotType.SOCIAL_COMMUNICATION <span class="comment">// 通知通道</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.publish(request)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 图文消息</span></span><br><span class="line">    publishPictureText()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> request: notify.NotificationRequest = &#123;</span><br><span class="line">            id: <span class="built_in">this</span>.mid++,</span><br><span class="line">            content: &#123;</span><br><span class="line">                contentType: notify.ContentType.NOTIFICATION_CONTENT_PICTURE,</span><br><span class="line">                picture: &#123;</span><br><span class="line">                    title: <span class="string">&quot;通知标题&quot;</span> + <span class="built_in">this</span>.mid,</span><br><span class="line">                    text: <span class="string">&quot;我是通知内容&quot;</span>,</span><br><span class="line">                    additionalText: <span class="string">&quot;我是附加内容&quot;</span>,</span><br><span class="line">                    briefText: <span class="string">&quot;通知展开时的概要&quot;</span>,</span><br><span class="line">                    expandedTitle: <span class="string">&quot;展开时的标题&quot;</span>,</span><br><span class="line">                    picture: <span class="built_in">this</span>.picture <span class="comment">// 图片信息</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            showDeliveryTime: <span class="literal">true</span>, <span class="comment">// 是否显示通知时间</span></span><br><span class="line">            deliveryTime: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(), <span class="comment">// 通知时间</span></span><br><span class="line">            groupName: <span class="string">&quot;wechat&quot;</span>, <span class="comment">// 通知分组</span></span><br><span class="line">            slotType: notify.SlotType.SOCIAL_COMMUNICATION <span class="comment">// 通知通道</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.publish(request)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    publish(request</span><br><span class="line">:</span><br><span class="line">    notify.NotificationRequest</span><br><span class="line">)</span><br><span class="line">    &#123;</span><br><span class="line">        notify.publish(request).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;通知发送成功&quot;</span>)</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`通知发送失败：<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(err)&#125;</span>`</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不同的通道类型，发送消息提醒的权限</p>
<p>notify.SlotType 枚举类型</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240324211115977.png" alt="image-20240324211115977"></p>
<p>效果展示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240324210938443.png" alt="image-20240324210938443"></p>
<h3 id="进度条通知"><a href="#进度条通知" class="headerlink" title="进度条通知"></a>进度条通知</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> promptAction <span class="keyword">from</span> <span class="string">&#x27;@ohos.promptAction&#x27;</span></span><br><span class="line"><span class="keyword">import</span> notify <span class="keyword">from</span> <span class="string">&#x27;@ohos.notificationManager&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">enum</span> DownloadState &#123;</span><br><span class="line">    NOT_BEGIN = <span class="string">&#x27;未开始&#x27;</span>,</span><br><span class="line">    DOWNLOADING = <span class="string">&#x27;下载中&#x27;</span>,</span><br><span class="line">    PAUSE = <span class="string">&#x27;已暂停&#x27;</span>,</span><br><span class="line">    FINISHED = <span class="string">&#x27;已完成&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span></span><br><span class="line">struct</span><br><span class="line">ProgressCar</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 下载进度</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    progressValue</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">    progressMaxValue: <span class="built_in">number</span> = <span class="number">100</span></span><br><span class="line">    <span class="comment">// 任务状态</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    state</span><br><span class="line">:</span><br><span class="line">    DownloadState = DownloadState.NOT_BEGIN</span><br><span class="line">    <span class="comment">// 下载的文件名</span></span><br><span class="line">    filename: <span class="built_in">string</span> = <span class="string">&#x27;圣诞星.mp4&#x27;</span></span><br><span class="line">    <span class="comment">// 模拟下载的任务的id</span></span><br><span class="line">    taskId: <span class="built_in">number</span> = -<span class="number">1</span></span><br><span class="line">    <span class="comment">// 通知id</span></span><br><span class="line">    notificationId: <span class="built_in">number</span> = <span class="number">999</span></span><br><span class="line">    isSupport: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span></span><br><span class="line">    aboutToAppear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 1.判断当前系统是否支持进度条模板</span></span><br><span class="line">        <span class="comment">// 注意：进度条模板名称固定 downloadTemplate</span></span><br><span class="line">        <span class="built_in">this</span>.isSupport = <span class="keyword">await</span> notify.isSupportTemplate(<span class="string">&quot;downloadTemplate&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: <span class="number">10</span>&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Row(&#123;<span class="attr">space</span>: <span class="number">10</span>&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Image($r(<span class="string">&#x27;app.media.video&#x27;</span>)).width(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">                Column(&#123;<span class="attr">space</span>: <span class="number">5</span>&#125;)</span><br><span class="line">                &#123;</span><br><span class="line">                    Row()</span><br><span class="line">                    &#123;</span><br><span class="line">                        Text(<span class="built_in">this</span>.filename)</span><br><span class="line">                        Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.progressValue&#125;</span>%`</span>).fontColor(<span class="string">&#x27;#c1c2c1&#x27;</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                .</span><br><span class="line">                    width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">                        .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line"></span><br><span class="line">                    Progress(&#123;</span><br><span class="line">                        value: <span class="built_in">this</span>.progressValue,</span><br><span class="line">                        total: <span class="built_in">this</span>.progressMaxValue,</span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                    Row(&#123;<span class="attr">space</span>: <span class="number">5</span>&#125;)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Text(<span class="string">`<span class="subst">$&#123;(<span class="built_in">this</span>.progressValue * <span class="number">0.43</span>).toFixed(<span class="number">2</span>)&#125;</span>MB`</span>)</span><br><span class="line">                            .fontSize(<span class="number">14</span>).fontColor(<span class="string">&#x27;#c1c2c1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                        Blank()</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (<span class="built_in">this</span>.state === DownloadState.NOT_BEGIN) &#123;</span><br><span class="line">                            Button(<span class="string">&#x27;开始&#x27;</span>).downloadButton()</span><br><span class="line">                                .onClick(<span class="function">() =&gt;</span> <span class="built_in">this</span>.download())</span><br><span class="line"></span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.state === DownloadState.DOWNLOADING) &#123;</span><br><span class="line">                            Button(<span class="string">&#x27;取消&#x27;</span>).downloadButton().backgroundColor(<span class="string">&#x27;#d1d2d3&#x27;</span>)</span><br><span class="line">                                .onClick(<span class="function">() =&gt;</span> <span class="built_in">this</span>.cancel())</span><br><span class="line"></span><br><span class="line">                            Button(<span class="string">&#x27;暂停&#x27;</span>).downloadButton()</span><br><span class="line">                                .onClick(<span class="function">() =&gt;</span> <span class="built_in">this</span>.pause())</span><br><span class="line"></span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.state === DownloadState.PAUSE) &#123;</span><br><span class="line">                            Button(<span class="string">&#x27;取消&#x27;</span>).downloadButton().backgroundColor(<span class="string">&#x27;#d1d2d3&#x27;</span>)</span><br><span class="line">                                .onClick(<span class="function">() =&gt;</span> <span class="built_in">this</span>.cancel())</span><br><span class="line"></span><br><span class="line">                            Button(<span class="string">&#x27;继续&#x27;</span>).downloadButton()</span><br><span class="line">                                .onClick(<span class="function">() =&gt;</span> <span class="built_in">this</span>.download())</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            Button(<span class="string">&#x27;打开&#x27;</span>).downloadButton()</span><br><span class="line">                                .onClick(<span class="function">() =&gt;</span> <span class="built_in">this</span>.open())</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                .</span><br><span class="line">                    width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            .</span><br><span class="line">                layoutWeight(<span class="number">1</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">                .borderRadius(<span class="number">20</span>)</span><br><span class="line">                .padding(<span class="number">15</span>)</span><br><span class="line">                .backgroundColor(Color.White)</span><br><span class="line">                .shadow(&#123;<span class="attr">radius</span>: <span class="number">15</span>, <span class="attr">color</span>: <span class="string">&quot;#ff929292&quot;</span>, <span class="attr">offsetX</span>: <span class="number">10</span>, <span class="attr">offsetY</span>: <span class="number">10</span>&#125;)</span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Button(<span class="string">&quot;重新开始&quot;</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.cancel()</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下载</span></span><br><span class="line">    download()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.taskId &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.taskId)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.taskId = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.progressValue &gt;= <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="comment">// 如果已经下载完成，删除定时任务</span></span><br><span class="line">                <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.taskId)</span><br><span class="line">                <span class="comment">// 标记任务已完成</span></span><br><span class="line">                <span class="built_in">this</span>.state = DownloadState.FINISHED</span><br><span class="line">                <span class="comment">// 发送通知</span></span><br><span class="line">                <span class="built_in">this</span>.publishDownloadNotification()</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">this</span>.progressValue += <span class="number">2</span></span><br><span class="line">            <span class="comment">// 发送通知</span></span><br><span class="line">            <span class="built_in">this</span>.publishDownloadNotification()</span><br><span class="line">        &#125;, <span class="number">500</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.state = DownloadState.DOWNLOADING</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 取消</span></span><br><span class="line">    cancel()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.taskId &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.taskId)</span><br><span class="line">            <span class="built_in">this</span>.taskId = -<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.progressValue = <span class="number">0</span></span><br><span class="line">        <span class="built_in">this</span>.state = DownloadState.NOT_BEGIN</span><br><span class="line">        <span class="comment">// 取消通知</span></span><br><span class="line">        <span class="built_in">this</span>.cleanProgressNotifyMessage()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 暂停</span></span><br><span class="line">    pause()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 取消定时任务</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.taskId &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.taskId);</span><br><span class="line">            <span class="built_in">this</span>.taskId = -<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 标记任务状态：已暂停</span></span><br><span class="line">        <span class="built_in">this</span>.state = DownloadState.PAUSE</span><br><span class="line">        <span class="comment">// 发送通知</span></span><br><span class="line">        <span class="built_in">this</span>.publishDownloadNotification()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打开</span></span><br><span class="line">    open()</span><br><span class="line">    &#123;</span><br><span class="line">        promptAction.showToast(&#123;</span><br><span class="line">            message: <span class="string">&quot;功能暂未实现&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送进度条模板</span></span><br><span class="line">    publishDownloadNotification()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 1.判断当前系统是否支持进度条模板</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.isSupport) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.准备进度条模板的参数</span></span><br><span class="line">        <span class="keyword">let</span> template = &#123;</span><br><span class="line">            name: <span class="string">&quot;downloadTemplate&quot;</span>,</span><br><span class="line">            data: &#123;</span><br><span class="line">                <span class="comment">// 当前的进度</span></span><br><span class="line">                progressValue: <span class="built_in">this</span>.progressValue,</span><br><span class="line">                <span class="comment">// 最大进度</span></span><br><span class="line">                progressMaxValue: <span class="built_in">this</span>.progressMaxValue</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.准备消息request</span></span><br><span class="line">        <span class="keyword">let</span> request: notify.NotificationRequest = &#123;</span><br><span class="line">            id: <span class="built_in">this</span>.notificationId,</span><br><span class="line">            template: template,</span><br><span class="line">            content: &#123;</span><br><span class="line">                contentType: notify.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT,</span><br><span class="line">                normal: &#123;</span><br><span class="line">                    title: <span class="built_in">this</span>.filename + <span class="string">&quot;：&quot;</span> + <span class="built_in">this</span>.state,</span><br><span class="line">                    text: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    additionalText: <span class="built_in">this</span>.progressValue + <span class="string">&quot;%&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.发送通知</span></span><br><span class="line">        notify.publish(request)</span><br><span class="line">            .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;test-notify&quot;</span>, <span class="string">&quot;发送通知成功&quot;</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">            .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;test-notify&quot;</span>, <span class="string">&quot;发送通知失败&quot;</span>, <span class="built_in">JSON</span>.stringify(err))</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 取消进度条通知</span></span><br><span class="line">    cleanProgressNotifyMessage()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 根据消息ID清除通知</span></span><br><span class="line">        notify.cancel(<span class="built_in">this</span>.notificationId)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Extend</span>(Button) <span class="function"><span class="keyword">function</span> <span class="title">downloadButton</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">.</span><br><span class="line">    width(<span class="number">75</span>).height(<span class="number">28</span>).fontSize(<span class="number">14</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果</p>
<img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240324223600457.png" alt="image-20240324223600457" style="zoom: 50%;" />

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240324223524158.png" alt="image-20240324223524158"></p>
<h3 id="添加行为意图"><a href="#添加行为意图" class="headerlink" title="添加行为意图"></a>添加行为意图</h3><p>通过给通知添加行为意图，可以实现点击通知后自动返回到应用内</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> wantAgent, &#123;WantAgent&#125; <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.wantAgent&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span></span><br><span class="line">struct</span><br><span class="line">ProgressCar</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 行为意图</span></span><br><span class="line">    wantAgentInstance: WantAgent</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span></span><br><span class="line">    aboutToAppear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 1.判断当前系统是否支持进度条模板</span></span><br><span class="line">        <span class="comment">// 注意：进度条模板名称固定 downloadTemplate</span></span><br><span class="line">        <span class="built_in">this</span>.isSupport = <span class="keyword">await</span> notify.isSupportTemplate(<span class="string">&quot;downloadTemplate&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 创建拉取当前应用的行为意图</span></span><br><span class="line">        <span class="comment">// 2.1 创建wantInfo信息</span></span><br><span class="line">        <span class="keyword">let</span> wantInfo: wantAgent.WantAgentInfo = &#123;</span><br><span class="line">            wants: [</span><br><span class="line">                &#123;</span><br><span class="line">                    bundleName: <span class="string">&quot;com.example.myapplication&quot;</span>,</span><br><span class="line">                    abilityName: <span class="string">&quot;EntryAbility&quot;</span> <span class="comment">// 声明要拉起的AbilityName</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            requestCode: <span class="number">0</span>,</span><br><span class="line">            operationType: wantAgent.OperationType.START_ABILITY, <span class="comment">// 开启一个Ability</span></span><br><span class="line">            wantAgentFlags: [wantAgent.WantAgentFlags.CONSTANT_FLAG]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.2 创建wantAgent实例</span></span><br><span class="line">        <span class="built_in">this</span>.wantAgentInstance = <span class="keyword">await</span> wantAgent.getWantAgent(wantInfo)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// .....省略其他代码</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送进度条模板</span></span><br><span class="line">    publishDownloadNotification()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 1.判断当前系统是否支持进度条模板</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.isSupport) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.准备进度条模板的参数</span></span><br><span class="line">        <span class="keyword">let</span> template = &#123;</span><br><span class="line">            name: <span class="string">&quot;downloadTemplate&quot;</span>,</span><br><span class="line">            data: &#123;</span><br><span class="line">                <span class="comment">// 当前的进度</span></span><br><span class="line">                progressValue: <span class="built_in">this</span>.progressValue,</span><br><span class="line">                <span class="comment">// 最大进度</span></span><br><span class="line">                progressMaxValue: <span class="built_in">this</span>.progressMaxValue</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.准备消息request</span></span><br><span class="line">        <span class="keyword">let</span> request: notify.NotificationRequest = &#123;</span><br><span class="line">            id: <span class="built_in">this</span>.notificationId,</span><br><span class="line">            template: template,</span><br><span class="line">            <span class="comment">// 设置行为意图</span></span><br><span class="line">            wantAgent: <span class="built_in">this</span>.wantAgentInstance,</span><br><span class="line">            content: &#123;</span><br><span class="line">                contentType: notify.ContentType.NOTIFICATION_CONTENT_BASIC_TEXT,</span><br><span class="line">                normal: &#123;</span><br><span class="line">                    title: <span class="built_in">this</span>.filename + <span class="string">&quot;：&quot;</span> + <span class="built_in">this</span>.state,</span><br><span class="line">                    text: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    additionalText: <span class="built_in">this</span>.progressValue + <span class="string">&quot;%&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.发送通知</span></span><br><span class="line">        notify.publish(request)</span><br><span class="line">            .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;test-notify&quot;</span>, <span class="string">&quot;发送通知成功&quot;</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">            .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;test-notify&quot;</span>, <span class="string">&quot;发送通知失败&quot;</span>, <span class="built_in">JSON</span>.stringify(err))</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240330221629726.png" alt="image-20240330221629726" style="zoom: 67%;" />

<h2 id="黑马健康实战案例"><a href="#黑马健康实战案例" class="headerlink" title="黑马健康实战案例"></a>黑马健康实战案例</h2><h3 id="欢迎页实现"><a href="#欢迎页实现" class="headerlink" title="欢迎页实现"></a>欢迎页实现</h3><p>静态代码</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文字样式封装</span></span><br><span class="line"><span class="meta">@Extend</span>(Text) <span class="function"><span class="keyword">function</span> <span class="title">opacityColor</span>(<span class="params">opacity: <span class="built_in">number</span>, fontSize: <span class="built_in">number</span> = <span class="number">10</span></span>) </span>&#123;</span><br><span class="line">.</span><br><span class="line">    fontColor(Color.White)</span><br><span class="line">        .fontSize(fontSize)</span><br><span class="line">        .opacity(opacity)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">WelcomePage</span><br><span class="line">&#123;</span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: <span class="number">10</span>&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Image($r(<span class="string">&quot;app.media.home_slogan&quot;</span>)).width(<span class="number">200</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            layoutWeight(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            Image($r(<span class="string">&quot;app.media.home_logo&quot;</span>)).width(<span class="number">150</span>)</span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="string">&quot;黑马健康APP支持&quot;</span>)</span><br><span class="line">                    .opacityColor(<span class="number">0.8</span>, <span class="number">13</span>)</span><br><span class="line">                Text(<span class="string">&quot;IPV6&quot;</span>)</span><br><span class="line">                    .opacityColor(<span class="number">0.8</span>, <span class="number">13</span>)</span><br><span class="line">                    .border(&#123;<span class="attr">style</span>: BorderStyle.Solid, <span class="attr">width</span>: <span class="number">1</span>, <span class="attr">color</span>: Color.White, <span class="attr">radius</span>: <span class="number">16</span>&#125;)</span><br><span class="line">                    .padding(&#123;<span class="attr">left</span>: <span class="number">5</span>, <span class="attr">right</span>: <span class="number">5</span>&#125;)</span><br><span class="line">                Text(<span class="string">&quot;网络&quot;</span>)</span><br><span class="line">                    .opacityColor(<span class="number">0.8</span>, <span class="number">13</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Text(<span class="string">`&#x27;减更多&#x27;指黑马健康App希望通过软件工具的形式，帮助更多用户实现身材管理`</span>)</span><br><span class="line">                .opacityColor(<span class="number">0.6</span>)</span><br><span class="line"></span><br><span class="line">            Text(<span class="string">`浙ICP备0000000号-36D`</span>)</span><br><span class="line">                .opacityColor(<span class="number">0.4</span>)</span><br><span class="line">                .margin(&#123;<span class="attr">bottom</span>: <span class="number">35</span>&#125;)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .backgroundColor($r(<span class="string">&quot;app.color.welcome_page_background&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240401213841129.png" alt="image-20240401213841129"  />

<h3 id="用户协议弹框"><a href="#用户协议弹框" class="headerlink" title="用户协议弹框"></a>用户协议弹框</h3><p>新建一个弹框组件页面</p>
<p>src/main/ets/view/welcome/UserPrivacyDialog.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CustomDialog</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct</span><br><span class="line">UserPrivacyDialog</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 定义一个构造器，类型是自定义弹框类型</span></span><br><span class="line">    controller: CustomDialogController</span><br><span class="line">    confirm:<span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">        cancel</span><br><span class="line">:</span><br><span class="line">    () =&gt; <span class="built_in">void</span></span><br><span class="line"></span><br><span class="line">        build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: <span class="number">10</span>&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Text($r(<span class="string">&quot;app.string.user_privacy_title&quot;</span>))</span><br><span class="line">                .fontSize(<span class="number">22</span>)</span><br><span class="line">                .fontWeight(FontWeight.Bold)</span><br><span class="line"></span><br><span class="line">            Text($r(<span class="string">&quot;app.string.user_privacy_content&quot;</span>))</span><br><span class="line"></span><br><span class="line">            Button(<span class="string">&quot;我同意&quot;</span>)</span><br><span class="line">                .width(<span class="number">150</span>)</span><br><span class="line">                .backgroundColor($r(<span class="string">&quot;app.color.primary_color&quot;</span>))</span><br><span class="line">                .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.confirm()</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">            Button(<span class="string">&quot;不同意&quot;</span>)</span><br><span class="line">                .width(<span class="number">150</span>)</span><br><span class="line">                .backgroundColor($r(<span class="string">&quot;app.color.lightest_primary_color&quot;</span>))</span><br><span class="line">                .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.cancel()</span><br><span class="line">                    <span class="built_in">this</span>.controller.close()</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .padding(<span class="number">15</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在欢迎页使用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 首选项工具</span></span><br><span class="line"><span class="keyword">import</span> preferenceUtil <span class="keyword">from</span> <span class="string">&quot;../common/utils/PreferenceUtil&quot;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> common <span class="keyword">from</span> <span class="string">&#x27;@ohos.app.ability.common&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否同意的Key</span></span><br><span class="line"><span class="keyword">const</span> PREF_KEY = <span class="string">&#x27;userPrivacyKey&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">WelcomePage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 上下文</span></span><br><span class="line">    context = getContext(<span class="built_in">this</span>) <span class="keyword">as</span> common.UIAbilityContext</span><br><span class="line">    <span class="comment">// 定义弹框</span></span><br><span class="line">    controller: CustomDialogController = <span class="keyword">new</span> CustomDialogController(&#123;</span><br><span class="line">        builder: UserPrivacyDialog(&#123;</span><br><span class="line">            confirm: <span class="built_in">this</span>.confirm.bind(<span class="built_in">this</span>),</span><br><span class="line">            cancel: <span class="built_in">this</span>.cancel.bind(<span class="built_in">this</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 弹框确定方法</span></span><br><span class="line">    confirm()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 设置首选项</span></span><br><span class="line">        preferenceUtil.putPreferenceValue(PREF_KEY, <span class="literal">true</span>)</span><br><span class="line">        <span class="comment">// 跳转到首页</span></span><br><span class="line">        <span class="built_in">this</span>.jumpToIndex()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 弹框不同意方法</span></span><br><span class="line">    cancel()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// terminateSelf 终止自身</span></span><br><span class="line">        <span class="built_in">this</span>.context.terminateSelf()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 页面显示触发</span></span><br><span class="line">    <span class="keyword">async</span></span><br><span class="line">    aboutToAppear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 判断用户是否同意</span></span><br><span class="line">        <span class="keyword">let</span> isAgree = <span class="keyword">await</span> preferenceUtil.getPreferenceValue(PREF_KEY, <span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">if</span> (isAgree) &#123;</span><br><span class="line">            <span class="built_in">this</span>.jumpToIndex()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.controller.open()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 跳转到首页</span></span><br><span class="line">    jumpToIndex()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            router.replaceUrl(&#123;</span><br><span class="line">                url: <span class="string">&quot;pages/Index&quot;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;, <span class="number">2000</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// .... 省略重复代码</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240401225618538.png" alt="image-20240401225618538"  />

<h3 id="首页Tab实现"><a href="#首页Tab实现" class="headerlink" title="首页Tab实现"></a>首页Tab实现</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../common/constants/CommonConstants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">Index</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    currentIndex</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自定义tabBar</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line">    builderTabBar(title</span><br><span class="line">:</span><br><span class="line">    Resource, image</span><br><span class="line">:</span><br><span class="line">    Resource, index</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line">)</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: CommonConstants.SPACE_2&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Image(image)</span><br><span class="line">                .width(<span class="number">22</span>)</span><br><span class="line">                .fillColor(<span class="built_in">this</span>.selectColor(index))</span><br><span class="line">            Text(title)</span><br><span class="line">                .fontSize(<span class="number">14</span>)</span><br><span class="line">                .fontColor(<span class="built_in">this</span>.selectColor(index))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据当前选中的tab自动切换选中颜色</span></span><br><span class="line">    selectColor(index</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line">)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.currentIndex === index ? $r(<span class="string">&quot;app.color.primary_color&quot;</span>) : $r(<span class="string">&quot;app.color.gray&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// barPosition:BarPosition.End 定义Tab的位置</span></span><br><span class="line">        Tabs(&#123;<span class="attr">barPosition</span>: BarPosition.End&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            TabContent()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="string">&quot;页签1&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            tabBar(<span class="built_in">this</span>.builderTabBar($r(<span class="string">&quot;app.string.tab_record&quot;</span>), $r(<span class="string">&quot;app.media.ic_calendar&quot;</span>), <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">            TabContent()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="string">&quot;页签2&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            tabBar(<span class="built_in">this</span>.builderTabBar($r(<span class="string">&quot;app.string.tab_discover&quot;</span>), $r(<span class="string">&quot;app.media.discover&quot;</span>), <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">            TabContent()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="string">&quot;页签3&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            tabBar(<span class="built_in">this</span>.builderTabBar($r(<span class="string">&quot;app.string.tab_user&quot;</span>), $r(<span class="string">&quot;app.media.ic_user_portrait&quot;</span>), <span class="number">2</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .onChange(<span class="function"><span class="params">index</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.currentIndex = index</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240404145708751.png" alt="image-20240404145708751"  />

<h3 id="头部搜索框"><a href="#头部搜索框" class="headerlink" title="头部搜索框"></a>头部搜索框</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../../common/constants/CommonConstants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct</span><br><span class="line">HeaderSearch</span><br><span class="line">&#123;</span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Row(&#123;<span class="attr">space</span>: CommonConstants.SPACE_4&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Search(&#123;<span class="attr">placeholder</span>: <span class="string">&quot;请输入食物名称&quot;</span>&#125;)</span><br><span class="line">                .layoutWeight(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 角标</span></span><br><span class="line">            Badge(&#123;<span class="attr">count</span>: <span class="number">2</span>, <span class="attr">style</span>: &#123;<span class="attr">fontSize</span>: <span class="number">12</span>&#125;&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Image($r(<span class="string">&quot;app.media.ic_public_email&quot;</span>))</span><br><span class="line">                    .width(<span class="number">24</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(CommonConstants.THOUSANDTH_940)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240404163856492.png" alt="image-20240404163856492"></p>
<h3 id="日期和日期弹框"><a href="#日期和日期弹框" class="headerlink" title="日期和日期弹框"></a>日期和日期弹框</h3><p>日期展示组件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../../common/constants/CommonConstants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> DateUtils <span class="keyword">from</span> <span class="string">&#x27;../../common/utils/DateUtils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> DatePickDialog <span class="keyword">from</span> <span class="string">&#x27;./DatePickDialog&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct</span><br><span class="line">StatsCard</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 从全局存储中读取数据</span></span><br><span class="line"><span class="meta">@StorageProp</span>(<span class="string">&quot;selectedDate&quot;</span>)</span><br><span class="line">    selectedDate</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = DateUtils.beginTimeOfDate(<span class="keyword">new</span> <span class="built_in">Date</span>())</span><br><span class="line"></span><br><span class="line">    controller: CustomDialogController = <span class="keyword">new</span> CustomDialogController(&#123;</span><br><span class="line">        builder: DatePickDialog(&#123;</span><br><span class="line">            selectedDate: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">this</span>.selectedDate)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 日期行</span></span><br><span class="line">            Row(&#123;<span class="attr">space</span>: CommonConstants.SPACE_4&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Text(DateUtils.formatDateTime(<span class="built_in">this</span>.selectedDate))</span><br><span class="line">                    .fontColor($r(<span class="string">&quot;app.color.secondary_color&quot;</span>))</span><br><span class="line"></span><br><span class="line">                Image($r(<span class="string">&quot;app.media.ic_public_spinner&quot;</span>))</span><br><span class="line">                    .width(<span class="number">25</span>)</span><br><span class="line">                    .fillColor($r(<span class="string">&quot;app.color.secondary_color&quot;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .padding(&#123;<span class="attr">left</span>: <span class="number">15</span>, <span class="attr">top</span>: <span class="number">10</span>, <span class="attr">bottom</span>: <span class="number">25</span>&#125;)</span><br><span class="line">                .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.controller.open()</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 轮播卡片</span></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .height(<span class="number">200</span>)</span><br><span class="line">                .backgroundColor(Color.White)</span><br><span class="line">                .borderRadius(<span class="number">18</span>)</span><br><span class="line">                .margin(&#123;<span class="attr">top</span>: -<span class="number">20</span>&#125;)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(CommonConstants.THOUSANDTH_940)</span><br><span class="line">            .backgroundColor($r(<span class="string">&quot;app.color.stats_title_bgc&quot;</span>))</span><br><span class="line">            .borderRadius(<span class="number">18</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>日期弹框组件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../../common/constants/CommonConstants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@CustomDialog</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct</span><br><span class="line">DatePickDialog</span><br><span class="line">&#123;</span><br><span class="line">    controller: CustomDialogController</span><br><span class="line"><span class="keyword">private</span></span><br><span class="line">    selectedDate: <span class="built_in">Date</span> = <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: CommonConstants.SPACE_4&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            DatePicker(&#123;</span><br><span class="line">                start: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">&#x27;2020-1-1&#x27;</span>),</span><br><span class="line">                end: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">&#x27;2100-1-1&#x27;</span>),</span><br><span class="line">                selected: <span class="built_in">this</span>.selectedDate</span><br><span class="line">            &#125;)</span><br><span class="line">                .onChange(<span class="function">(<span class="params">value: DatePickerResult</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.selectedDate.setFullYear(value.year, value.month, value.day)</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">            Row(&#123;<span class="attr">space</span>: CommonConstants.SPACE_4&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Button(<span class="string">&quot;取消&quot;</span>)</span><br><span class="line">                    .width(<span class="number">120</span>)</span><br><span class="line">                    .backgroundColor($r(<span class="string">&quot;app.color.light_gray&quot;</span>))</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.controller.close()</span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                Button(<span class="string">&quot;确定&quot;</span>)</span><br><span class="line">                    .width(<span class="number">120</span>)</span><br><span class="line">                    .backgroundColor($r(<span class="string">&quot;app.color.primary_color&quot;</span>))</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="comment">// 将选中的日期保存到全局存储中</span></span><br><span class="line">                        AppStorage.SetOrCreate(<span class="string">&quot;selectedDate&quot;</span>, <span class="built_in">this</span>.selectedDate.getTime())</span><br><span class="line">                        <span class="built_in">this</span>.controller.close()</span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        padding(CommonConstants.SPACE_2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用到的日期工具类代码</p>
<p><code>DateUtils.ts</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">DateUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="title">beginTimeOfDate</span>(<span class="params">date: <span class="built_in">Date</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取日期对象的时间戳（包含时分秒）</span></span><br><span class="line">        <span class="keyword">const</span> timestampWithTime = date.getTime();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建一个新的Date对象，将时间设置为1970-01-01 00:00:00</span></span><br><span class="line">        <span class="keyword">const</span> dateWithoutTime = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">1970</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将包含时分秒的时间戳赋值给不含时分秒的日期对象</span></span><br><span class="line">        dateWithoutTime.setTime(timestampWithTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回不包含时分秒的时间戳</span></span><br><span class="line">        <span class="keyword">return</span> dateWithoutTime.getTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="title">formatDateTime</span>(<span class="params">dateTime: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(dateTime)</span><br><span class="line">        <span class="comment">// 获取年、月、日</span></span><br><span class="line">        <span class="keyword">const</span> year = date.getFullYear();</span><br><span class="line">        <span class="keyword">const</span> month = date.getMonth() + <span class="number">1</span>; <span class="comment">// 月份是从0开始的，所以需要+1</span></span><br><span class="line">        <span class="keyword">const</span> day = date.getDate();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 格式化月和日，如果不足两位数，前面补0</span></span><br><span class="line">        <span class="keyword">const</span> formattedMonth = month &lt; <span class="number">10</span> ? <span class="string">&#x27;0&#x27;</span> + month : month;</span><br><span class="line">        <span class="keyword">const</span> formattedDay = day &lt; <span class="number">10</span> ? <span class="string">&#x27;0&#x27;</span> + day : day;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回格式化的日期字符串</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;year&#125;</span>/<span class="subst">$&#123;formattedMonth&#125;</span>/<span class="subst">$&#123;formattedDay&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240404164002615.png" alt="image-20240404164002615"  />

<h3 id="统计信息卡片"><a href="#统计信息卡片" class="headerlink" title="统计信息卡片"></a>统计信息卡片</h3><p>使用轮播组件，将两个组件包裹起来</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../../common/constants/CommonConstants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> CalorieState <span class="keyword">from</span> <span class="string">&#x27;./CalorieStats&#x27;</span></span><br><span class="line"><span class="keyword">import</span> NutrientState <span class="keyword">from</span> <span class="string">&#x27;./NutrientStats&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct</span><br><span class="line">StatsCard</span><br><span class="line">&#123;</span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 1. 日期行</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2. 轮播卡片</span></span><br><span class="line">            Swiper()</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 2.1 热量信息</span></span><br><span class="line">                CalorieState()</span><br><span class="line">                <span class="comment">// 2.2 卡路里信息</span></span><br><span class="line">                NutrientState()</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .backgroundColor(Color.White)</span><br><span class="line">                .borderRadius(<span class="number">18</span>)</span><br><span class="line">                .margin(&#123;<span class="attr">top</span>: -<span class="number">20</span>&#125;)</span><br><span class="line">                .indicatorStyle(&#123;<span class="attr">selectedColor</span>: $r(<span class="string">&quot;app.color.primary_color&quot;</span>)&#125;)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(CommonConstants.THOUSANDTH_940)</span><br><span class="line">            .backgroundColor($r(<span class="string">&quot;app.color.stats_title_bgc&quot;</span>))</span><br><span class="line">            .borderRadius(<span class="number">18</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>热量信息卡片</p>
<p><code>CalorieStats.ets</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../../common/constants/CommonConstants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct</span><br><span class="line">CalorieState</span><br><span class="line">&#123;</span><br><span class="line">    intake:<span class="built_in">number</span> = <span class="number">600</span> <span class="comment">// 饮食摄入</span></span><br><span class="line">    expend:<span class="built_in">number</span> = <span class="number">192</span> <span class="comment">// 运动消耗</span></span><br><span class="line">    recommend:<span class="built_in">number</span> = CommonConstants.RECOMMEND_CALORIE <span class="comment">// 推荐卡路里</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算还可以吃多少</span></span><br><span class="line">    remainCalorie()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.recommend - <span class="built_in">this</span>.intake + <span class="built_in">this</span>.expend</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">this</span>.StatsBuilder(<span class="string">&quot;饮食摄入&quot;</span>, <span class="built_in">this</span>.intake)</span><br><span class="line"></span><br><span class="line">            Stack()</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 进度条</span></span><br><span class="line">                Progress(&#123;</span><br><span class="line">                    value: <span class="built_in">this</span>.intake,</span><br><span class="line">                    total: <span class="built_in">this</span>.recommend,</span><br><span class="line">                    <span class="keyword">type</span>: ProgressType.Ring</span><br><span class="line">                &#125;)</span><br><span class="line">                    .width(<span class="number">130</span>)</span><br><span class="line">                    .style(&#123;<span class="attr">strokeWidth</span>: <span class="number">8</span>&#125;)</span><br><span class="line">                    .color(<span class="built_in">this</span>.remainCalorie() &lt; <span class="number">0</span> ? Color.Red : $r(<span class="string">&quot;app.color.primary_color&quot;</span>))</span><br><span class="line"></span><br><span class="line">                <span class="built_in">this</span>.StatsBuilder(<span class="string">&quot;还可以吃&quot;</span>, <span class="built_in">this</span>.remainCalorie(), <span class="built_in">this</span>.recommend)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.StatsBuilder(<span class="string">&quot;运动消耗&quot;</span>, <span class="built_in">this</span>.expend)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .justifyContent(FlexAlign.SpaceEvenly)</span><br><span class="line">            .padding(&#123;<span class="attr">top</span>: <span class="number">30</span>, <span class="attr">bottom</span>: <span class="number">35</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line">    StatsBuilder(label</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span>, value</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span>, tip ? : <span class="built_in">number</span></span><br><span class="line">)</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: CommonConstants.SPACE_6&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Text(label)</span><br><span class="line">                .fontSize(<span class="number">16</span>)</span><br><span class="line">                .fontWeight(FontWeight.Bold)</span><br><span class="line"></span><br><span class="line">            Text(<span class="string">`<span class="subst">$&#123;value.toFixed(<span class="number">0</span>)&#125;</span>`</span>)</span><br><span class="line">                .fontSize(<span class="number">25</span>)</span><br><span class="line">                .fontWeight(FontWeight.Bold)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (tip) &#123;</span><br><span class="line">                Text(<span class="string">`推荐<span class="subst">$&#123;tip.toFixed(<span class="number">0</span>)&#125;</span>`</span>)</span><br><span class="line">                    .fontSize(<span class="number">14</span>)</span><br><span class="line">                    .fontColor($r(<span class="string">&quot;app.color.light_gray&quot;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240404175538115.png" alt="image-20240404175538115"  />

<p>卡路里信息卡片</p>
<p><code>NutrientState.ets</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../../common/constants/CommonConstants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct</span><br><span class="line">NutrientState</span><br><span class="line">&#123;</span><br><span class="line">    carbon:<span class="built_in">number</span> = <span class="number">23</span> <span class="comment">// 碳水</span></span><br><span class="line">    protein:<span class="built_in">number</span> = <span class="number">9</span> <span class="comment">// 蛋白质</span></span><br><span class="line">    fat:<span class="built_in">number</span> = <span class="number">7</span> <span class="comment">// 脂肪</span></span><br><span class="line"></span><br><span class="line">    recommendCarbon:<span class="built_in">number</span> = CommonConstants.RECOMMEND_CARBON</span><br><span class="line">    recommendProtein:<span class="built_in">number</span> = CommonConstants.RECOMMEND_PROTEIN</span><br><span class="line">    recommendFat:<span class="built_in">number</span> = CommonConstants.RECOMMEND_FAT</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">this</span>.StatsBuilder(<span class="string">&quot;碳水化合物&quot;</span>, <span class="built_in">this</span>.carbon, <span class="built_in">this</span>.recommendCarbon, $r(<span class="string">&quot;app.color.carbon_color&quot;</span>))</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.StatsBuilder(<span class="string">&quot;蛋白质&quot;</span>, <span class="built_in">this</span>.protein, <span class="built_in">this</span>.recommendProtein, $r(<span class="string">&quot;app.color.protein_color&quot;</span>))</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.StatsBuilder(<span class="string">&quot;脂肪&quot;</span>, <span class="built_in">this</span>.fat, <span class="built_in">this</span>.recommendFat, $r(<span class="string">&quot;app.color.fat_color&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .justifyContent(FlexAlign.SpaceEvenly)</span><br><span class="line">            .padding(&#123;<span class="attr">top</span>: <span class="number">30</span>, <span class="attr">bottom</span>: <span class="number">35</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line">    StatsBuilder(label</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span>, value</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span>, recommend</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span>, color</span><br><span class="line">:</span><br><span class="line">    ResourceStr</span><br><span class="line">)</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: CommonConstants.SPACE_6&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Stack()</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 进度条</span></span><br><span class="line">                Progress(&#123;</span><br><span class="line">                    value: value,</span><br><span class="line">                    total: recommend,</span><br><span class="line">                    <span class="keyword">type</span>: ProgressType.Ring</span><br><span class="line">                &#125;)</span><br><span class="line">                    .width(<span class="number">105</span>)</span><br><span class="line">                    .style(&#123;<span class="attr">strokeWidth</span>: <span class="number">6</span>&#125;)</span><br><span class="line">                    .color(value &gt; recommend ? Color.Red : color)</span><br><span class="line"></span><br><span class="line">                Column(&#123;<span class="attr">space</span>: CommonConstants.SPACE_6&#125;)</span><br><span class="line">                &#123;</span><br><span class="line">                    Text(<span class="string">&quot;摄入推荐&quot;</span>)</span><br><span class="line">                        .fontColor($r(<span class="string">&quot;app.color.gray&quot;</span>))</span><br><span class="line"></span><br><span class="line">                    Text(<span class="string">`<span class="subst">$&#123;value.toFixed(<span class="number">0</span>)&#125;</span>/<span class="subst">$&#123;recommend.toFixed(<span class="number">0</span>)&#125;</span>`</span>)</span><br><span class="line">                        .fontSize(<span class="number">20</span>)</span><br><span class="line">                        .fontWeight(FontWeight.Bold)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Text(<span class="string">`<span class="subst">$&#123;label&#125;</span>(克)`</span>)</span><br><span class="line">                .fontColor($r(<span class="string">&quot;app.color.light_gray&quot;</span>))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240404175642223.png" alt="image-20240404175642223"  />

<h3 id="实现记录列表"><a href="#实现记录列表" class="headerlink" title="实现记录列表"></a>实现记录列表</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../../common/constants/CommonConstants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Extend</span>(Text) <span class="function"><span class="keyword">function</span> <span class="title">grayText</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">.</span><br><span class="line">    fontSize(<span class="number">14</span>)</span><br><span class="line">        .fontColor($r(<span class="string">&quot;app.color.light_gray&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct</span><br><span class="line">RecordList</span><br><span class="line">&#123;</span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        List(&#123;<span class="attr">space</span>: CommonConstants.SPACE_10&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            ForEach([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                ListItem()</span><br><span class="line">                &#123;</span><br><span class="line">                    Column(&#123;<span class="attr">space</span>: CommonConstants.SPACE_6&#125;)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// 主分类信息</span></span><br><span class="line">                        Row(&#123;<span class="attr">space</span>: CommonConstants.SPACE_6&#125;)</span><br><span class="line">                        &#123;</span><br><span class="line">                            Image($r(<span class="string">&quot;app.media.ic_breakfast&quot;</span>))</span><br><span class="line">                                .width(<span class="number">24</span>)</span><br><span class="line"></span><br><span class="line">                            Text(<span class="string">&quot;早餐&quot;</span>)</span><br><span class="line">                                .fontSize(<span class="number">18</span>)</span><br><span class="line">                                .fontWeight(CommonConstants.FONT_WEIGHT_700)</span><br><span class="line">                            Text(<span class="string">&quot;建议423~592千卡&quot;</span>)</span><br><span class="line">                                .grayText()</span><br><span class="line">                            Blank()</span><br><span class="line">                            Text(<span class="string">&quot;190&quot;</span>)</span><br><span class="line">                                .fontColor($r(<span class="string">&quot;app.color.primary_color&quot;</span>))</span><br><span class="line">                                .fontWeight(CommonConstants.FONT_WEIGHT_700)</span><br><span class="line">                            Text(<span class="string">&quot;千卡&quot;</span>)</span><br><span class="line">                                .grayText()</span><br><span class="line">                            Image($r(<span class="string">&quot;app.media.ic_public_add_norm_filled&quot;</span>))</span><br><span class="line">                                .width(<span class="number">24</span>)</span><br><span class="line">                                .fillColor($r(<span class="string">&quot;app.color.primary_color&quot;</span>))</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line">                    .</span><br><span class="line">                        width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// 子分类信息</span></span><br><span class="line">                        List(&#123;<span class="attr">space</span>: CommonConstants.SPACE_6&#125;)</span><br><span class="line">                        &#123;</span><br><span class="line">                            ForEach([<span class="number">1</span>, <span class="number">2</span>], <span class="function"><span class="params">child</span> =&gt;</span> &#123;</span><br><span class="line">                                ListItem()</span><br><span class="line">                                &#123;</span><br><span class="line">                                    Row(&#123;<span class="attr">space</span>: CommonConstants.SPACE_4&#125;)</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        Image($r(<span class="string">&quot;app.media.toast&quot;</span>))</span><br><span class="line">                                            .width(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">                                        Column(&#123;<span class="attr">space</span>: CommonConstants.SPACE_6&#125;)</span><br><span class="line">                                        &#123;</span><br><span class="line">                                            Text(<span class="string">&quot;全麦吐司&quot;</span>)</span><br><span class="line">                                                .fontWeight(CommonConstants.FONT_WEIGHT_500)</span><br><span class="line">                                                .fontSize(<span class="number">14</span>)</span><br><span class="line">                                            Text(<span class="string">&quot;1片&quot;</span>)</span><br><span class="line">                                                .fontSize(<span class="number">12</span>)</span><br><span class="line">                                                .fontColor($r(<span class="string">&quot;app.color.gray&quot;</span>))</span><br><span class="line">                                                .textAlign(TextAlign.Start)</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    .</span><br><span class="line">                                        alignItems(HorizontalAlign.Start)</span><br><span class="line"></span><br><span class="line">                                        Blank()</span><br><span class="line"></span><br><span class="line">                                        Text(<span class="string">&quot;91千卡&quot;</span>)</span><br><span class="line">                                            .grayText()</span><br><span class="line">                                    &#125;</span><br><span class="line">                                .</span><br><span class="line">                                    width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                                &#125;</span><br><span class="line">                            .</span><br><span class="line">                                swipeAction(&#123;</span><br><span class="line">                                    <span class="comment">// 左滑出现删除按钮</span></span><br><span class="line">                                    end: <span class="built_in">this</span>.deleteBuilder.bind(<span class="built_in">this</span>)</span><br><span class="line">                                &#125;)</span><br><span class="line">                            &#125;)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                .</span><br><span class="line">                    padding(<span class="number">15</span>)</span><br><span class="line">                        .backgroundColor(Color.White)</span><br><span class="line">                        .borderRadius(<span class="number">10</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        layoutWeight(<span class="number">1</span>)</span><br><span class="line">            .width(CommonConstants.THOUSANDTH_940)</span><br><span class="line">            .margin(&#123;<span class="attr">top</span>: <span class="number">15</span>, <span class="attr">bottom</span>: <span class="number">15</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 左滑出现删除按钮</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line">    deleteBuilder()</span><br><span class="line">    &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            Image($r(<span class="string">&quot;app.media.ic_public_delete_filled&quot;</span>))</span><br><span class="line">                .width(<span class="number">25</span>)</span><br><span class="line">                .fillColor(Color.Red)</span><br><span class="line">                .margin(&#123;<span class="attr">left</span>: <span class="number">5</span>&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="number">35</span>)</span><br><span class="line">            .justifyContent(FlexAlign.End)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240404185301571.png" alt="image-20240404185301571"></p>
<h3 id="添加食物列表页面"><a href="#添加食物列表页面" class="headerlink" title="添加食物列表页面"></a>添加食物列表页面</h3><p>新建页面<code>ItemIndexPage</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../common/constants/CommonConstants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ItemTabList <span class="keyword">from</span> <span class="string">&#x27;../view/ItemIndex/ItemTabList&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">ItemIndexPage</span><br><span class="line">&#123;</span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 头部导航组件</span></span><br><span class="line">            <span class="built_in">this</span>.ItemHeaderBuilder()</span><br><span class="line"></span><br><span class="line">            <span class="comment">// tab列表组件</span></span><br><span class="line">            ItemTabList()</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line">    ItemHeaderBuilder()</span><br><span class="line">    &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            Image($r(<span class="string">&quot;app.media.ic_public_back&quot;</span>))</span><br><span class="line">                .width(<span class="number">30</span>)</span><br><span class="line">                .interpolation(ImageInterpolation.High)</span><br><span class="line">                .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    router.back()</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">            Text(<span class="string">&quot;早餐&quot;</span>)</span><br><span class="line">                .fontSize(<span class="number">18</span>)</span><br><span class="line">                .fontWeight(CommonConstants.FONT_WEIGHT_700)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        height(<span class="number">35</span>)</span><br><span class="line">            .width(CommonConstants.THOUSANDTH_940)</span><br><span class="line">            .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>tab列表组件代码</p>
<p><code>ItemTabList.ets</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../../common/constants/CommonConstants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct</span><br><span class="line">ItemTabList</span><br><span class="line">&#123;</span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Tabs()</span><br><span class="line">            &#123;</span><br><span class="line">                TabContent()</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">this</span>.TabContentList()</span><br><span class="line">                &#125;</span><br><span class="line">            .</span><br><span class="line">                tabBar(<span class="string">&quot;全部&quot;</span>)</span><br><span class="line"></span><br><span class="line">                TabContent()</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">this</span>.TabContentList()</span><br><span class="line">                &#125;</span><br><span class="line">            .</span><br><span class="line">                tabBar(<span class="string">&quot;主食&quot;</span>)</span><br><span class="line"></span><br><span class="line">                TabContent()</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">this</span>.TabContentList()</span><br><span class="line">                &#125;</span><br><span class="line">            .</span><br><span class="line">                tabBar(<span class="string">&quot;肉蛋奶&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        layoutWeight(<span class="number">1</span>)</span><br><span class="line">            .width(CommonConstants.THOUSANDTH_940)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line">    TabContentList()</span><br><span class="line">    &#123;</span><br><span class="line">        List(&#123;<span class="attr">space</span>: CommonConstants.SPACE_6&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            ForEach([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], <span class="function"><span class="params">child</span> =&gt;</span> &#123;</span><br><span class="line">                ListItem()</span><br><span class="line">                &#123;</span><br><span class="line">                    Row(&#123;<span class="attr">space</span>: CommonConstants.SPACE_4&#125;)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Image($r(<span class="string">&quot;app.media.toast&quot;</span>))</span><br><span class="line">                            .width(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">                        Column(&#123;<span class="attr">space</span>: CommonConstants.SPACE_6&#125;)</span><br><span class="line">                        &#123;</span><br><span class="line">                            Text(<span class="string">&quot;全麦吐司&quot;</span>)</span><br><span class="line">                                .fontWeight(CommonConstants.FONT_WEIGHT_500)</span><br><span class="line">                                .fontSize(<span class="number">14</span>)</span><br><span class="line">                            Text(<span class="string">&quot;91千卡/1片&quot;</span>)</span><br><span class="line">                                .fontSize(<span class="number">12</span>)</span><br><span class="line">                                .fontColor($r(<span class="string">&quot;app.color.gray&quot;</span>))</span><br><span class="line">                                .textAlign(TextAlign.Start)</span><br><span class="line">                        &#125;</span><br><span class="line">                    .</span><br><span class="line">                        alignItems(HorizontalAlign.Start)</span><br><span class="line"></span><br><span class="line">                        Blank()</span><br><span class="line"></span><br><span class="line">                        Image($r(<span class="string">&quot;app.media.ic_public_add_norm_filled&quot;</span>))</span><br><span class="line">                            .width(<span class="number">25</span>)</span><br><span class="line">                            .fillColor($r(<span class="string">&quot;app.color.primary_color&quot;</span>))</span><br><span class="line">                            .interpolation(ImageInterpolation.High)</span><br><span class="line">                    &#125;</span><br><span class="line">                .</span><br><span class="line">                    width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        height(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果显示</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240407214034553.png" alt="image-20240407214034553"></p>
<h3 id="底部Panel实现"><a href="#底部Panel实现" class="headerlink" title="底部Panel实现"></a>底部Panel实现</h3><p><code>ItemIndexPage.ets</code> 页面增加 Panel 组件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../common/constants/CommonConstants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ItemTabList <span class="keyword">from</span> <span class="string">&#x27;../view/ItemIndex/ItemTabList&#x27;</span></span><br><span class="line"><span class="keyword">import</span> PanelHeader <span class="keyword">from</span> <span class="string">&#x27;../view/ItemIndex/PanelHeader&#x27;</span></span><br><span class="line"><span class="keyword">import</span> PanelFoodInfo <span class="keyword">from</span> <span class="string">&#x27;../view/ItemIndex/PanelFoodInfo&#x27;</span></span><br><span class="line"><span class="keyword">import</span> PanelInput <span class="keyword">from</span> <span class="string">&#x27;../view/ItemIndex/PanelInput&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">ItemIndexPage</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    showPanel</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    onPanelShow()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.showPanel = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onPanelClose()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.showPanel = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 头部导航组件</span></span><br><span class="line">            <span class="built_in">this</span>.ItemHeaderBuilder()</span><br><span class="line">            <span class="comment">// tab列表组件</span></span><br><span class="line">            ItemTabList(&#123;<span class="attr">onPanelShow</span>: <span class="built_in">this</span>.onPanelShow.bind(<span class="built_in">this</span>)&#125;)</span><br><span class="line">            <span class="comment">// 底部弹框组件</span></span><br><span class="line">            Panel(<span class="built_in">this</span>.showPanel)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 弹框顶部日期</span></span><br><span class="line">                PanelHeader()</span><br><span class="line">                <span class="comment">// 食物信息</span></span><br><span class="line">                PanelFoodInfo()</span><br><span class="line">                <span class="comment">// 键盘区域</span></span><br><span class="line">                PanelInput(&#123;</span><br><span class="line">                    onPanelClose: <span class="built_in">this</span>.onPanelClose.bind(<span class="built_in">this</span>)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            mode(PanelMode.Full)</span><br><span class="line">                .dragBar(<span class="literal">false</span>)</span><br><span class="line">                .backgroundMask(<span class="string">&quot;#98eeeeee&quot;</span>)</span><br><span class="line">                .backgroundColor(Color.White)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line">    ItemHeaderBuilder()</span><br><span class="line">    &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            Image($r(<span class="string">&quot;app.media.ic_public_back&quot;</span>))</span><br><span class="line">                .width(<span class="number">30</span>)</span><br><span class="line">                .interpolation(ImageInterpolation.High)</span><br><span class="line">                .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    router.back()</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">            Text(<span class="string">&quot;早餐&quot;</span>)</span><br><span class="line">                .fontSize(<span class="number">18</span>)</span><br><span class="line">                .fontWeight(CommonConstants.FONT_WEIGHT_700)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        height(<span class="number">35</span>)</span><br><span class="line">            .width(CommonConstants.THOUSANDTH_940)</span><br><span class="line">            .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>PanelHeader</code> 弹框顶部日期</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../../common/constants/CommonConstants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct</span><br><span class="line">PanelHeader</span><br><span class="line">&#123;</span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Row(&#123;<span class="attr">space</span>: CommonConstants.SPACE_4&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Text(<span class="string">&quot;1月17日 早餐&quot;</span>)</span><br><span class="line">            Image($r(<span class="string">&quot;app.media.ic_public_spinner&quot;</span>))</span><br><span class="line">                .width(<span class="number">20</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        height(<span class="number">45</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>PanelFoodInfo</code> 食物信息</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../../common/constants/CommonConstants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct</span><br><span class="line">PanelFoodInfo</span><br><span class="line">&#123;</span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: CommonConstants.SPACE_10&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Image($r(<span class="string">&quot;app.media.toast&quot;</span>))</span><br><span class="line">                    .width(<span class="number">130</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="string">&quot;全麦吐司&quot;</span>)</span><br><span class="line">                    .fontWeight(CommonConstants.FONT_WEIGHT_700)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            backgroundColor($r(<span class="string">&quot;app.color.lightest_primary_color&quot;</span>))</span><br><span class="line">                .padding(<span class="number">10</span>)</span><br><span class="line">                .borderRadius(<span class="number">4</span>)</span><br><span class="line">                .margin(&#123;<span class="attr">bottom</span>: <span class="number">10</span>&#125;)</span><br><span class="line"></span><br><span class="line">            Divider().width(CommonConstants.THOUSANDTH_940).opacity(<span class="number">0.6</span>)</span><br><span class="line"></span><br><span class="line">            Row(&#123;<span class="attr">space</span>: CommonConstants.SPACE_10&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">this</span>.NutrientInfo(<span class="string">&quot;热量(千卡)&quot;</span>, <span class="number">91.0</span>)</span><br><span class="line">                <span class="built_in">this</span>.NutrientInfo(<span class="string">&quot;碳水(克)&quot;</span>, <span class="number">15.5</span>)</span><br><span class="line">                <span class="built_in">this</span>.NutrientInfo(<span class="string">&quot;蛋白质(克)&quot;</span>, <span class="number">4.4</span>)</span><br><span class="line">                <span class="built_in">this</span>.NutrientInfo(<span class="string">&quot;脂肪(克)&quot;</span>, <span class="number">1.3</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Divider().width(CommonConstants.THOUSANDTH_940).opacity(<span class="number">0.6</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        margin(&#123;<span class="attr">top</span>: -<span class="number">10</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line">    NutrientInfo(label</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span>, <span class="built_in">number</span></span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line">)</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: CommonConstants.SPACE_6&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Text(label)</span><br><span class="line">                .fontSize(<span class="number">13</span>)</span><br><span class="line">                .fontColor($r(<span class="string">&quot;app.color.light_gray&quot;</span>))</span><br><span class="line"></span><br><span class="line">            Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">number</span>&#125;</span>`</span>)</span><br><span class="line">                .fontSize(<span class="number">16</span>)</span><br><span class="line">                .fontWeight(CommonConstants.FONT_WEIGHT_700)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>PanelInput</code> 键盘区域</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../../common/constants/CommonConstants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct</span><br><span class="line">PanelInput</span><br><span class="line">&#123;</span><br><span class="line">    onPanelClose:<span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line"></span><br><span class="line">        build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Row(&#123;<span class="attr">space</span>: CommonConstants.SPACE_10&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Column()</span><br><span class="line">                &#123;</span><br><span class="line">                    Text(<span class="string">`1`</span>)</span><br><span class="line">                        .fontSize(<span class="number">50</span>)</span><br><span class="line">                        .fontWeight(CommonConstants.FONT_WEIGHT_700)</span><br><span class="line">                        .fontColor($r(<span class="string">&quot;app.color.primary_color&quot;</span>))</span><br><span class="line"></span><br><span class="line">                    Divider().width(<span class="number">100</span>).backgroundColor($r(<span class="string">&quot;app.color.primary_color&quot;</span>))</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Text(<span class="string">&quot; / 片&quot;</span>)</span><br><span class="line">                    .fontSize(<span class="number">25</span>)</span><br><span class="line">                    .fontWeight(CommonConstants.FONT_WEIGHT_700)</span><br><span class="line">                    .fontColor($r(<span class="string">&quot;app.color.primary_color&quot;</span>))</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            alignItems(VerticalAlign.Bottom)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 自定义键盘</span></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            height(<span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 按钮</span></span><br><span class="line">            Row(&#123;<span class="attr">space</span>: CommonConstants.SPACE_10&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Button(<span class="string">&quot;取消&quot;</span>)</span><br><span class="line">                    .width(<span class="number">110</span>)</span><br><span class="line">                    .backgroundColor($r(<span class="string">&quot;app.color.light_gray&quot;</span>))</span><br><span class="line">                    .type(ButtonType.Normal)</span><br><span class="line">                    .borderRadius(<span class="number">5</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.onPanelClose()</span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                Button(<span class="string">&quot;确定&quot;</span>)</span><br><span class="line">                    .width(<span class="number">110</span>)</span><br><span class="line">                    .backgroundColor($r(<span class="string">&quot;app.color.primary_color&quot;</span>))</span><br><span class="line">                    .type(ButtonType.Normal)</span><br><span class="line">                    .borderRadius(<span class="number">5</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.onPanelClose()</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            margin(&#123;<span class="attr">top</span>: <span class="number">10</span>&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240407224641778.png" alt="image-20240407224641778"></p>
<h3 id="实现数字键盘"><a href="#实现数字键盘" class="headerlink" title="实现数字键盘"></a>实现数字键盘</h3><p>这里使用到了<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/arkts-layout-development-create-grid-0000001504486057-V2#section3518453204812">Grid布局</a></p>
<p>键盘组件代码实现</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../../common/constants/CommonConstants&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct</span><br><span class="line">PanelInput</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 父组件传递过来的关闭Panel方法</span></span><br><span class="line">    onPanelClose: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">        onChangeAmount</span><br><span class="line">:</span><br><span class="line">    (amount) =&gt; <span class="built_in">void</span></span><br><span class="line">        gridList</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span>[] = [</span><br><span class="line">        <span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;4&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;6&quot;</span>,</span><br><span class="line">        <span class="string">&quot;7&quot;</span>, <span class="string">&quot;8&quot;</span>, <span class="string">&quot;9&quot;</span>,</span><br><span class="line">        <span class="string">&quot;.&quot;</span>, <span class="string">&quot;0&quot;</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 食物数量,声明成Link类型，实现父子组件双向绑定</span></span><br><span class="line"><span class="meta">@Link</span></span><br><span class="line">    amount</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line">    <span class="comment">// 每次点击的数组</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    value</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Styles</span></span><br><span class="line">    keyBoxStyle()</span><br><span class="line">    &#123;</span><br><span class="line">    .</span><br><span class="line">        height(<span class="number">60</span>)</span><br><span class="line">            .backgroundColor(Color.White)</span><br><span class="line">            .borderRadius(<span class="number">5</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Row(&#123;<span class="attr">space</span>: CommonConstants.SPACE_10&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Column()</span><br><span class="line">                &#123;</span><br><span class="line">                    Text(<span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.amount.toFixed(<span class="number">1</span>)&#125;</span>`</span>)</span><br><span class="line">                        .fontSize(<span class="number">50</span>)</span><br><span class="line">                        .fontWeight(CommonConstants.FONT_WEIGHT_700)</span><br><span class="line">                        .fontColor($r(<span class="string">&quot;app.color.primary_color&quot;</span>))</span><br><span class="line"></span><br><span class="line">                    Divider().width(<span class="number">100</span>).backgroundColor($r(<span class="string">&quot;app.color.primary_color&quot;</span>))</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Text(<span class="string">&quot; / 片&quot;</span>)</span><br><span class="line">                    .fontSize(<span class="number">20</span>)</span><br><span class="line">                    .fontWeight(CommonConstants.FONT_WEIGHT_700)</span><br><span class="line">                    .fontColor($r(<span class="string">&quot;app.color.light_gray&quot;</span>))</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            alignItems(VerticalAlign.Bottom)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 自定义键盘</span></span><br><span class="line">            Grid()</span><br><span class="line">            &#123;</span><br><span class="line">                ForEach(<span class="built_in">this</span>.gridList, <span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                    GridItem()</span><br><span class="line">                    &#123;</span><br><span class="line">                        Text(<span class="string">`<span class="subst">$&#123;item&#125;</span>`</span>).fontSize(<span class="number">16</span>).fontWeight(CommonConstants.FONT_WEIGHT_900)</span><br><span class="line">                    &#125;</span><br><span class="line">                .</span><br><span class="line">                    keyBoxStyle()</span><br><span class="line">                        .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            <span class="built_in">this</span>.clickNumber(item)</span><br><span class="line">                        &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">                GridItem()</span><br><span class="line">                &#123;</span><br><span class="line">                    Text(<span class="string">`删除`</span>).fontSize(<span class="number">16</span>).fontWeight(CommonConstants.FONT_WEIGHT_900)</span><br><span class="line">                &#125;</span><br><span class="line">            .</span><br><span class="line">                keyBoxStyle()</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.removeKey()</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .height(<span class="number">280</span>)</span><br><span class="line">                .columnsTemplate(<span class="string">&quot;1fr 1fr 1fr&quot;</span>)</span><br><span class="line">                .columnsGap(<span class="number">8</span>)</span><br><span class="line">                .rowsGap(<span class="number">8</span>)</span><br><span class="line">                .backgroundColor($r(<span class="string">&quot;app.color.index_page_background&quot;</span>))</span><br><span class="line">                .padding(<span class="number">8</span>)</span><br><span class="line">                .margin(&#123;<span class="attr">top</span>: <span class="number">10</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 按钮</span></span><br><span class="line">            Row(&#123;<span class="attr">space</span>: CommonConstants.SPACE_10&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Button(<span class="string">&quot;取消&quot;</span>)</span><br><span class="line">                    .width(<span class="number">110</span>)</span><br><span class="line">                    .backgroundColor($r(<span class="string">&quot;app.color.light_gray&quot;</span>))</span><br><span class="line">                    .type(ButtonType.Normal)</span><br><span class="line">                    .borderRadius(<span class="number">5</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.onPanelClose()</span><br><span class="line">                    &#125;)</span><br><span class="line"></span><br><span class="line">                Button(<span class="string">&quot;确定&quot;</span>)</span><br><span class="line">                    .width(<span class="number">110</span>)</span><br><span class="line">                    .backgroundColor($r(<span class="string">&quot;app.color.primary_color&quot;</span>))</span><br><span class="line">                    .type(ButtonType.Normal)</span><br><span class="line">                    .borderRadius(<span class="number">5</span>)</span><br><span class="line">                    .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.onPanelClose()</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            margin(&#123;<span class="attr">top</span>: <span class="number">10</span>&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除按钮</span></span><br><span class="line">    removeKey()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = <span class="built_in">this</span>.value.substring(<span class="number">0</span>, <span class="built_in">this</span>.value.length - <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">this</span>.amount = <span class="built_in">this</span>.parseFloat(<span class="built_in">this</span>.value)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 点击键盘事件</span></span><br><span class="line">    clickNumber(num</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span></span><br><span class="line">)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 1.拼接用户输入的内容</span></span><br><span class="line">        <span class="keyword">let</span> val = <span class="built_in">this</span>.value + num</span><br><span class="line">        <span class="comment">// 2.校验输入的格式是否正确</span></span><br><span class="line">        <span class="keyword">let</span> firstIndex = val.indexOf(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">        <span class="keyword">let</span> lastIndex = val.lastIndexOf(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> (firstIndex !== lastIndex || (lastIndex !== -<span class="number">1</span> &amp;&amp; lastIndex &lt; val.length - <span class="number">2</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.将字符串转成数值类型</span></span><br><span class="line">        <span class="keyword">let</span> amount = <span class="built_in">this</span>.parseFloat(val)</span><br><span class="line">        <span class="comment">// 4.保存</span></span><br><span class="line">        <span class="keyword">if</span> (amount &gt; <span class="number">999</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.amount = <span class="number">999</span></span><br><span class="line">            <span class="built_in">this</span>.value = <span class="string">&quot;999&quot;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.amount = amount</span><br><span class="line">            <span class="built_in">this</span>.value = val</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">parseFloat</span>(str</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span></span><br><span class="line">)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!str) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (str.endsWith(<span class="string">&quot;.&quot;</span>)) &#123;</span><br><span class="line">            str = str.substring(<span class="number">0</span>, str.length - <span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">parseFloat</span>(str || <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>父组件代码</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../common/constants/CommonConstants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ItemTabList <span class="keyword">from</span> <span class="string">&#x27;../view/ItemIndex/ItemTabList&#x27;</span></span><br><span class="line"><span class="keyword">import</span> PanelHeader <span class="keyword">from</span> <span class="string">&#x27;../view/ItemIndex/PanelHeader&#x27;</span></span><br><span class="line"><span class="keyword">import</span> PanelFoodInfo <span class="keyword">from</span> <span class="string">&#x27;../view/ItemIndex/PanelFoodInfo&#x27;</span></span><br><span class="line"><span class="keyword">import</span> PanelInput <span class="keyword">from</span> <span class="string">&#x27;../view/ItemIndex/PanelInput&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">ItemIndexPage</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    showPanel</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    amount</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    onPanelShow()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.showPanel = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onPanelClose()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.showPanel = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 头部导航组件</span></span><br><span class="line">            <span class="built_in">this</span>.ItemHeaderBuilder()</span><br><span class="line">            <span class="comment">// tab列表组件</span></span><br><span class="line">            ItemTabList(&#123;<span class="attr">onPanelShow</span>: <span class="built_in">this</span>.onPanelShow.bind(<span class="built_in">this</span>)&#125;)</span><br><span class="line">            <span class="comment">// 底部弹框组件</span></span><br><span class="line">            Panel(<span class="built_in">this</span>.showPanel)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 弹框顶部日期</span></span><br><span class="line">                PanelHeader()</span><br><span class="line">                <span class="comment">// 食物信息</span></span><br><span class="line">                PanelFoodInfo(&#123;</span><br><span class="line">                    amount: $amount</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">// 键盘区域</span></span><br><span class="line">                PanelInput(&#123;</span><br><span class="line">                    onPanelClose: <span class="built_in">this</span>.onPanelClose.bind(<span class="built_in">this</span>),</span><br><span class="line">                    amount: $amount</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            mode(PanelMode.Full)</span><br><span class="line">                .dragBar(<span class="literal">false</span>)</span><br><span class="line">                .backgroundMask(<span class="string">&quot;#98eeeeee&quot;</span>)</span><br><span class="line">                .backgroundColor(Color.White)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .height(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line">    ItemHeaderBuilder()</span><br><span class="line">    &#123;</span><br><span class="line">        Row()</span><br><span class="line">        &#123;</span><br><span class="line">            Image($r(<span class="string">&quot;app.media.ic_public_back&quot;</span>))</span><br><span class="line">                .width(<span class="number">30</span>)</span><br><span class="line">                .interpolation(ImageInterpolation.High)</span><br><span class="line">                .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    router.back()</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">            Text(<span class="string">&quot;早餐&quot;</span>)</span><br><span class="line">                .fontSize(<span class="number">18</span>)</span><br><span class="line">                .fontWeight(CommonConstants.FONT_WEIGHT_700)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        height(<span class="number">35</span>)</span><br><span class="line">            .width(CommonConstants.THOUSANDTH_940)</span><br><span class="line">            .justifyContent(FlexAlign.SpaceBetween)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>食物信息组件修改，根据传递进来的数量，自动计算对应的热量信息</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../../common/constants/CommonConstants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct</span><br><span class="line">PanelFoodInfo</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@Link</span></span><br><span class="line">    amount</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: CommonConstants.SPACE_10&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Image($r(<span class="string">&quot;app.media.toast&quot;</span>))</span><br><span class="line">                    .width(<span class="number">130</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="string">&quot;全麦吐司&quot;</span>)</span><br><span class="line">                    .fontWeight(CommonConstants.FONT_WEIGHT_700)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            backgroundColor($r(<span class="string">&quot;app.color.lightest_primary_color&quot;</span>))</span><br><span class="line">                .padding(<span class="number">10</span>)</span><br><span class="line">                .borderRadius(<span class="number">4</span>)</span><br><span class="line">                .margin(&#123;<span class="attr">bottom</span>: <span class="number">10</span>&#125;)</span><br><span class="line"></span><br><span class="line">            Divider().width(CommonConstants.THOUSANDTH_940).opacity(<span class="number">0.6</span>)</span><br><span class="line"></span><br><span class="line">            Row(&#123;<span class="attr">space</span>: CommonConstants.SPACE_10&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">this</span>.NutrientInfo(<span class="string">&quot;热量(千卡)&quot;</span>, <span class="number">91.0</span>)</span><br><span class="line">                <span class="built_in">this</span>.NutrientInfo(<span class="string">&quot;碳水(克)&quot;</span>, <span class="number">15.5</span>)</span><br><span class="line">                <span class="built_in">this</span>.NutrientInfo(<span class="string">&quot;蛋白质(克)&quot;</span>, <span class="number">4.4</span>)</span><br><span class="line">                <span class="built_in">this</span>.NutrientInfo(<span class="string">&quot;脂肪(克)&quot;</span>, <span class="number">1.3</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Divider().width(CommonConstants.THOUSANDTH_940).opacity(<span class="number">0.6</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        margin(&#123;<span class="attr">top</span>: -<span class="number">10</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line">    NutrientInfo(label</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span>, <span class="built_in">number</span></span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line">)</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: CommonConstants.SPACE_6&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Text(label)</span><br><span class="line">                .fontSize(<span class="number">13</span>)</span><br><span class="line">                .fontColor($r(<span class="string">&quot;app.color.light_gray&quot;</span>))</span><br><span class="line"></span><br><span class="line">            Text(<span class="string">`<span class="subst">$&#123;(<span class="built_in">number</span> * <span class="built_in">this</span>.amount).toFixed(<span class="number">1</span>)&#125;</span>`</span>)</span><br><span class="line">                .fontSize(<span class="number">16</span>)</span><br><span class="line">                .fontWeight(CommonConstants.FONT_WEIGHT_700)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/hmgif1.gif"></p>
<h3 id="多设备响应式开发"><a href="#多设备响应式开发" class="headerlink" title="多设备响应式开发"></a>多设备响应式开发</h3><p>同一个页面，在手机、折叠手机、平板等设备上显示的方式是不一样的，我们可以通过官方提供的 <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V2/arkts-layout-development-media-query-0000001454445606-V2">@ohos.mediaquery</a><br>库来获取当前屏幕的宽度，然后根据不同宽度做不同处理</p>
<p>第一步：定义一个Bean，这个文件的作用是传入一个配置对象，然后调用 getValue 方法返回不同尺寸下对应的值</p>
<p>src/main/ets/common/bean/BreanpointType.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">interface</span> BreakpointTypeOptions&lt;T&gt; &#123;</span><br><span class="line">    sm?: T,</span><br><span class="line">    md?: T,</span><br><span class="line">    lg?: T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">BreakpointType</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    options: BreakpointTypeOptions&lt;T&gt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">options: BreakpointTypeOptions&lt;T&gt;</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.options = options</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getValue(breakpoint: <span class="built_in">string</span>): T &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.options[breakpoint]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二步：定义一个常量类，声明各种查询条件及配置对象</p>
<p>src/main/ets/common/constants/BreakpointConstants.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> BreakpointType <span class="keyword">from</span> <span class="string">&#x27;../bean/BreanpointType&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">BreakpointConstants</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 小屏幕设备的 Breakpoints 标记.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">readonly</span> BREAKPOINT_SM: <span class="built_in">string</span> = <span class="string">&#x27;sm&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中等屏幕设备的 Breakpoints 标记.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">readonly</span> BREAKPOINT_MD: <span class="built_in">string</span> = <span class="string">&#x27;md&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 大屏幕设备的 Breakpoints 标记.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">readonly</span> BREAKPOINT_LG: <span class="built_in">string</span> = <span class="string">&#x27;lg&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当前设备的 breakpoints 存储key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">readonly</span> CURRENT_BREAKPOINT: <span class="built_in">string</span> = <span class="string">&#x27;currentBreakpoint&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 小屏幕设备宽度范围.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">readonly</span> RANGE_SM: <span class="built_in">string</span> = <span class="string">&#x27;(320vp&lt;=width&lt;600vp)&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中屏幕设备宽度范围.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">readonly</span> RANGE_MD: <span class="built_in">string</span> = <span class="string">&#x27;(600vp&lt;=width&lt;840vp)&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 大屏幕设备宽度范围.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">readonly</span> RANGE_LG: <span class="built_in">string</span> = <span class="string">&#x27;(840vp&lt;=width)&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义Bar在不同屏幕下的位置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">readonly</span> BAR_POSITION: BreakpointType&lt;BarPosition&gt; = <span class="keyword">new</span> BreakpointType(&#123;</span><br><span class="line">        sm: BarPosition.End,</span><br><span class="line">        md: BarPosition.Start,</span><br><span class="line">        lg: BarPosition.Start,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义Bar在不同屏幕下的布局方向</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">readonly</span> BAR_VERTICAL: BreakpointType&lt;<span class="built_in">boolean</span>&gt; = <span class="keyword">new</span> BreakpointType(&#123;</span><br><span class="line">        sm: <span class="literal">false</span>,</span><br><span class="line">        md: <span class="literal">true</span>,</span><br><span class="line">        lg: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三步：创建媒体查询工具类，创建不同尺寸的监听器，当命中时将结果保存到全局存储中</p>
<p>src/main/ets/common/utils/BreakpotionSystem.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mediaQuery <span class="keyword">from</span> <span class="string">&#x27;@ohos.mediaquery&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> BreakpointConstants <span class="keyword">from</span> <span class="string">&#x27;../constants/BreakpointConstants&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">BreakpointSystem</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建容器宽度监听器</span></span><br><span class="line">    <span class="keyword">private</span> smListener: mediaQuery.MediaQueryListener = mediaQuery.matchMediaSync(BreakpointConstants.RANGE_SM)</span><br><span class="line">    <span class="keyword">private</span> mdListener: mediaQuery.MediaQueryListener = mediaQuery.matchMediaSync(BreakpointConstants.RANGE_MD)</span><br><span class="line">    <span class="keyword">private</span> lgListener: mediaQuery.MediaQueryListener = mediaQuery.matchMediaSync(BreakpointConstants.RANGE_LG)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开始监听容器</span></span><br><span class="line">    <span class="function"><span class="title">register</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.smListener.on(<span class="string">&quot;change&quot;</span>, <span class="built_in">this</span>.smListenerCallback.bind(<span class="built_in">this</span>))</span><br><span class="line">        <span class="built_in">this</span>.mdListener.on(<span class="string">&quot;change&quot;</span>, <span class="built_in">this</span>.mdListenerCallback.bind(<span class="built_in">this</span>))</span><br><span class="line">        <span class="built_in">this</span>.lgListener.on(<span class="string">&quot;change&quot;</span>, <span class="built_in">this</span>.lgListenerCallback.bind(<span class="built_in">this</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 取消注册</span></span><br><span class="line">    <span class="function"><span class="title">unRegister</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.smListener.off(<span class="string">&quot;change&quot;</span>, <span class="built_in">this</span>.smListenerCallback.bind(<span class="built_in">this</span>))</span><br><span class="line">        <span class="built_in">this</span>.mdListener.off(<span class="string">&quot;change&quot;</span>, <span class="built_in">this</span>.mdListenerCallback.bind(<span class="built_in">this</span>))</span><br><span class="line">        <span class="built_in">this</span>.lgListener.off(<span class="string">&quot;change&quot;</span>, <span class="built_in">this</span>.lgListenerCallback.bind(<span class="built_in">this</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 监听器命中的回调</span></span><br><span class="line">    <span class="function"><span class="title">smListenerCallback</span>(<span class="params">result: mediaQuery.MediaQueryResult</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (result.matches) &#123;</span><br><span class="line">            <span class="built_in">this</span>.updateCurrentBreakpoint(BreakpointConstants.BREAKPOINT_SM)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">mdListenerCallback</span>(<span class="params">result: mediaQuery.MediaQueryResult</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (result.matches) &#123;</span><br><span class="line">            <span class="built_in">this</span>.updateCurrentBreakpoint(BreakpointConstants.BREAKPOINT_MD)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">lgListenerCallback</span>(<span class="params">result: mediaQuery.MediaQueryResult</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (result.matches) &#123;</span><br><span class="line">            <span class="built_in">this</span>.updateCurrentBreakpoint(BreakpointConstants.BREAKPOINT_LG)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新缓存值</span></span><br><span class="line">    <span class="function"><span class="title">updateCurrentBreakpoint</span>(<span class="params">breakpoint: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">        AppStorage.SetOrCreate(BreakpointConstants.CURRENT_BREAKPOINT, breakpoint)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第四步：页面使用</p>
<p>现在我们来修改首页代码，加入响应式功能，实现在不同设备上，Bar的位置显示到不同的地方</p>
<p>src/main/ets/pages/Index.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> BreakpointConstants <span class="keyword">from</span> <span class="string">&#x27;../common/constants/BreakpointConstants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../common/constants/CommonConstants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> BreakpointSystem <span class="keyword">from</span> <span class="string">&#x27;../common/utils/BreakpotionSystem&#x27;</span></span><br><span class="line"><span class="keyword">import</span> RecordIndex <span class="keyword">from</span> <span class="string">&#x27;../view/record/RecordIndex&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct</span><br><span class="line">Index</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@State</span></span><br><span class="line">    currentIndex</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 创建监听设备宽度的实例</span></span><br><span class="line">    breakpointSystem:BreakpointSystem = <span class="keyword">new</span> BreakpointSystem()</span><br><span class="line">    <span class="comment">// 获取当前设备宽度的缓存值</span></span><br><span class="line"><span class="meta">@StorageProp</span>(<span class="string">&quot;currentBreakpoint&quot;</span>)</span><br><span class="line">    currentBreakpoint</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span> = BreakpointConstants.BREAKPOINT_SM</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    aboutToAppear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.breakpointSystem.register()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    aboutToDisappear()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">this</span>.breakpointSystem.unRegister()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自定义tabBar</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line">    builderTabBar(title</span><br><span class="line">:</span><br><span class="line">    Resource, image</span><br><span class="line">:</span><br><span class="line">    Resource, index</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line">)</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: CommonConstants.SPACE_2&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Image(image)</span><br><span class="line">                .width(<span class="number">22</span>)</span><br><span class="line">                .fillColor(<span class="built_in">this</span>.selectColor(index))</span><br><span class="line">            Text(title)</span><br><span class="line">                .fontSize(<span class="number">14</span>)</span><br><span class="line">                .fontColor(<span class="built_in">this</span>.selectColor(index))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据当前选中的tab自动切换选中颜色</span></span><br><span class="line">    selectColor(index</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line">)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.currentIndex === index ? $r(<span class="string">&quot;app.color.primary_color&quot;</span>) : $r(<span class="string">&quot;app.color.gray&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据设备宽度设置Bar栏位置</span></span><br><span class="line">    chooseBarPosition()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> BreakpointConstants.BAR_POSITION.getValue(<span class="built_in">this</span>.currentBreakpoint)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// barPosition:BarPosition.End 定义Tab的位置</span></span><br><span class="line">        Tabs(&#123;<span class="attr">barPosition</span>: <span class="built_in">this</span>.chooseBarPosition()&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            TabContent()</span><br><span class="line">            &#123;</span><br><span class="line">                RecordIndex()</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            tabBar(<span class="built_in">this</span>.builderTabBar($r(<span class="string">&quot;app.string.tab_record&quot;</span>), $r(<span class="string">&quot;app.media.ic_calendar&quot;</span>), <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">            TabContent()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="string">&quot;页签2&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            tabBar(<span class="built_in">this</span>.builderTabBar($r(<span class="string">&quot;app.string.tab_discover&quot;</span>), $r(<span class="string">&quot;app.media.discover&quot;</span>), <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">            TabContent()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="string">&quot;页签3&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            tabBar(<span class="built_in">this</span>.builderTabBar($r(<span class="string">&quot;app.string.tab_user&quot;</span>), $r(<span class="string">&quot;app.media.ic_user_portrait&quot;</span>), <span class="number">2</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .onChange(<span class="function"><span class="params">index</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.currentIndex = index</span><br><span class="line">            &#125;)</span><br><span class="line">            .vertical(BreakpointConstants.BAR_VERTICAL.getValue(<span class="built_in">this</span>.currentBreakpoint))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还要修改卡片信息，在平板设备上就不要左右滑动显示了，而是直接显示两个卡片</p>
<p>src/main/ets/view/record/StatsCard.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> BreakpointType <span class="keyword">from</span> <span class="string">&#x27;../../common/bean/BreanpointType&#x27;</span></span><br><span class="line"><span class="keyword">import</span> BreakpointConstants <span class="keyword">from</span> <span class="string">&#x27;../../common/constants/BreakpointConstants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../../common/constants/CommonConstants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> DateUtils <span class="keyword">from</span> <span class="string">&#x27;../../common/utils/DateUtils&#x27;</span></span><br><span class="line"><span class="keyword">import</span> CalorieState <span class="keyword">from</span> <span class="string">&#x27;./CalorieStats&#x27;</span></span><br><span class="line"><span class="keyword">import</span> DatePickDialog <span class="keyword">from</span> <span class="string">&#x27;./DatePickDialog&#x27;</span></span><br><span class="line"><span class="keyword">import</span> NutrientState <span class="keyword">from</span> <span class="string">&#x27;./NutrientStats&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct</span><br><span class="line">StatsCard</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 从全局存储中读取数据</span></span><br><span class="line"><span class="meta">@StorageProp</span>(<span class="string">&quot;selectedDate&quot;</span>)</span><br><span class="line">    selectedDate</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span> = DateUtils.beginTimeOfDate(<span class="keyword">new</span> <span class="built_in">Date</span>())</span><br><span class="line"><span class="meta">@StorageProp</span>(<span class="string">&quot;currentBreakpoint&quot;</span>)</span><br><span class="line">    currentBreakpoint</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span> = BreakpointConstants.BREAKPOINT_SM</span><br><span class="line"></span><br><span class="line">    controller: CustomDialogController = <span class="keyword">new</span> CustomDialogController(&#123;</span><br><span class="line">        builder: DatePickDialog(&#123;</span><br><span class="line">            selectedDate: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">this</span>.selectedDate)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 1. 日期行</span></span><br><span class="line">            Row(&#123;<span class="attr">space</span>: CommonConstants.SPACE_4&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                Text(DateUtils.formatDateTime(<span class="built_in">this</span>.selectedDate))</span><br><span class="line">                    .fontColor($r(<span class="string">&quot;app.color.secondary_color&quot;</span>))</span><br><span class="line"></span><br><span class="line">                Image($r(<span class="string">&quot;app.media.ic_public_spinner&quot;</span>))</span><br><span class="line">                    .width(<span class="number">25</span>)</span><br><span class="line">                    .fillColor($r(<span class="string">&quot;app.color.secondary_color&quot;</span>))</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            padding(&#123;<span class="attr">left</span>: <span class="number">15</span>, <span class="attr">top</span>: <span class="number">5</span>, <span class="attr">bottom</span>: <span class="number">5</span>&#125;)</span><br><span class="line">                .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.controller.open()</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2. 轮播卡片</span></span><br><span class="line">            Swiper()</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 2.1 热量信息</span></span><br><span class="line">                CalorieState()</span><br><span class="line">                <span class="comment">// 2.2 卡路里信息</span></span><br><span class="line">                NutrientState()</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                .backgroundColor(Color.White)</span><br><span class="line">                .borderRadius(<span class="number">18</span>)</span><br><span class="line">                .indicatorStyle(&#123;<span class="attr">selectedColor</span>: $r(<span class="string">&quot;app.color.primary_color&quot;</span>)&#125;)</span><br><span class="line">                <span class="comment">// 设置滑动组件一页显示几个组件</span></span><br><span class="line">                .displayCount(</span><br><span class="line">                    <span class="keyword">new</span> BreakpointType(&#123;</span><br><span class="line">                        sm: <span class="number">1</span>,</span><br><span class="line">                        md: <span class="number">1</span>,</span><br><span class="line">                        lg: <span class="number">2</span></span><br><span class="line">                    &#125;).getValue(<span class="built_in">this</span>.currentBreakpoint)</span><br><span class="line">                )</span><br><span class="line">                <span class="comment">// 设置是否显示指示点</span></span><br><span class="line">                .indicator(</span><br><span class="line">                    <span class="keyword">new</span> BreakpointType(&#123;</span><br><span class="line">                        sm: <span class="literal">true</span>,</span><br><span class="line">                        md: <span class="literal">true</span>,</span><br><span class="line">                        lg: <span class="literal">false</span></span><br><span class="line">                    &#125;).getValue(<span class="built_in">this</span>.currentBreakpoint)</span><br><span class="line">                )</span><br><span class="line">                <span class="comment">// 设置是否禁用滑动功能</span></span><br><span class="line">                .disableSwipe(</span><br><span class="line">                    <span class="keyword">new</span> BreakpointType(&#123;</span><br><span class="line">                        sm: <span class="literal">false</span>,</span><br><span class="line">                        md: <span class="literal">false</span>,</span><br><span class="line">                        lg: <span class="literal">true</span></span><br><span class="line">                    &#125;).getValue(<span class="built_in">this</span>.currentBreakpoint)</span><br><span class="line">                )</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        width(CommonConstants.THOUSANDTH_940)</span><br><span class="line">            .backgroundColor($r(<span class="string">&quot;app.color.stats_title_bgc&quot;</span>))</span><br><span class="line">            .borderRadius(<span class="number">18</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后来看预览效果</p>
<p>首先点击这里，将多设备预览功能按钮打开，这样可以同时看到页面在手机、折叠屏、平板三种设备的显示效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240409153643642.png" alt="image-20240409153643642"></p>
<p>下面是不同设备的显示结果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240409153809299.png" alt="image-20240409153809299"></p>
<h3 id="显示不同的记录项"><a href="#显示不同的记录项" class="headerlink" title="显示不同的记录项"></a>显示不同的记录项</h3><p>核心处理代码</p>
<p>ItemModel.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> GroupInfo <span class="keyword">from</span> <span class="string">&#x27;../viewmodel/GroupInfo&#x27;</span></span><br><span class="line"><span class="keyword">import</span> RecordItem <span class="keyword">from</span> <span class="string">&#x27;../viewmodel/RecordItem&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;FoodCategories, FoodCategoryEnum, WorkoutCategories, WorkoutCategoryEnum&#125; <span class="keyword">from</span> <span class="string">&#x27;./ItemCategoryModel&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> foods: RecordItem[] = [</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">0</span>, <span class="string">&#x27;米饭&#x27;</span>, $r(<span class="string">&#x27;app.media.rice&#x27;</span>), FoodCategoryEnum.STAPLE, <span class="string">&#x27;碗&#x27;</span>, <span class="number">209</span>, <span class="number">46.6</span>, <span class="number">4.7</span>, <span class="number">0.5</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">1</span>, <span class="string">&#x27;馒头&#x27;</span>, $r(<span class="string">&#x27;app.media.steamed_bun&#x27;</span>), FoodCategoryEnum.STAPLE, <span class="string">&#x27;个&#x27;</span>, <span class="number">114</span>, <span class="number">24.0</span>, <span class="number">3.6</span>, <span class="number">0.6</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">2</span>, <span class="string">&#x27;面包&#x27;</span>, $r(<span class="string">&#x27;app.media.bun&#x27;</span>), FoodCategoryEnum.STAPLE, <span class="string">&#x27;个&#x27;</span>, <span class="number">188</span>, <span class="number">35.2</span>, <span class="number">5.0</span>, <span class="number">3.1</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">3</span>, <span class="string">&#x27;全麦吐司&#x27;</span>, $r(<span class="string">&#x27;app.media.toast&#x27;</span>), FoodCategoryEnum.STAPLE, <span class="string">&#x27;片&#x27;</span>, <span class="number">91</span>, <span class="number">15.5</span>, <span class="number">4.4</span>, <span class="number">1.3</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">4</span>, <span class="string">&#x27;紫薯&#x27;</span>, $r(<span class="string">&#x27;app.media.purple_potato&#x27;</span>), FoodCategoryEnum.STAPLE, <span class="string">&#x27;个&#x27;</span>, <span class="number">163</span>, <span class="number">42.0</span>, <span class="number">1.6</span>, <span class="number">0.4</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">5</span>, <span class="string">&#x27;煮玉米&#x27;</span>, $r(<span class="string">&#x27;app.media.corn&#x27;</span>), FoodCategoryEnum.STAPLE, <span class="string">&#x27;根&#x27;</span>, <span class="number">111</span>, <span class="number">22.6</span>, <span class="number">4.0</span>, <span class="number">1.2</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">6</span>, <span class="string">&#x27;黄瓜&#x27;</span>, $r(<span class="string">&#x27;app.media.cucumber&#x27;</span>), FoodCategoryEnum.FRUIT, <span class="string">&#x27;根&#x27;</span>, <span class="number">29</span>, <span class="number">5.3</span>, <span class="number">1.5</span>, <span class="number">0.4</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">7</span>, <span class="string">&#x27;蓝莓&#x27;</span>, $r(<span class="string">&#x27;app.media.blueberry&#x27;</span>), FoodCategoryEnum.FRUIT, <span class="string">&#x27;盒&#x27;</span>, <span class="number">71</span>, <span class="number">18.1</span>, <span class="number">0.9</span>, <span class="number">0.4</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">8</span>, <span class="string">&#x27;草莓&#x27;</span>, $r(<span class="string">&#x27;app.media.strawberry&#x27;</span>), FoodCategoryEnum.FRUIT, <span class="string">&#x27;颗&#x27;</span>, <span class="number">14</span>, <span class="number">3.1</span>, <span class="number">0.4</span>, <span class="number">0.1</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">9</span>, <span class="string">&#x27;火龙果&#x27;</span>, $r(<span class="string">&#x27;app.media.pitaya&#x27;</span>), FoodCategoryEnum.FRUIT, <span class="string">&#x27;个&#x27;</span>, <span class="number">100</span>, <span class="number">24.6</span>, <span class="number">2.2</span>, <span class="number">0.5</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10</span>, <span class="string">&#x27;奇异果&#x27;</span>, $r(<span class="string">&#x27;app.media.kiwi&#x27;</span>), FoodCategoryEnum.FRUIT, <span class="string">&#x27;个&#x27;</span>, <span class="number">25</span>, <span class="number">8.4</span>, <span class="number">0.5</span>, <span class="number">0.3</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">11</span>, <span class="string">&#x27;煮鸡蛋&#x27;</span>, $r(<span class="string">&#x27;app.media.egg&#x27;</span>), FoodCategoryEnum.MEAT, <span class="string">&#x27;个&#x27;</span>, <span class="number">74</span>, <span class="number">0.1</span>, <span class="number">6.2</span>, <span class="number">5.4</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">12</span>, <span class="string">&#x27;煮鸡胸肉&#x27;</span>, $r(<span class="string">&#x27;app.media.chicken_breast&#x27;</span>), FoodCategoryEnum.MEAT, <span class="string">&#x27;克&#x27;</span>, <span class="number">1.15</span>, <span class="number">0.011</span>, <span class="number">0.236</span>, <span class="number">0.018</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">13</span>, <span class="string">&#x27;煮鸡腿肉&#x27;</span>, $r(<span class="string">&#x27;app.media.chicken_leg&#x27;</span>), FoodCategoryEnum.MEAT, <span class="string">&#x27;克&#x27;</span>, <span class="number">1.87</span>, <span class="number">0.0</span>, <span class="number">0.243</span>, <span class="number">0.092</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">14</span>, <span class="string">&#x27;牛肉&#x27;</span>, $r(<span class="string">&#x27;app.media.beef&#x27;</span>), FoodCategoryEnum.MEAT, <span class="string">&#x27;克&#x27;</span>, <span class="number">1.22</span>, <span class="number">0.0</span>, <span class="number">0.23</span>, <span class="number">0.033</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">15</span>, <span class="string">&#x27;鱼肉&#x27;</span>, $r(<span class="string">&quot;app.media.fish&quot;</span>), FoodCategoryEnum.MEAT, <span class="string">&#x27;克&#x27;</span>, <span class="number">1.04</span>, <span class="number">0.0</span>, <span class="number">0.206</span>, <span class="number">0.024</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">16</span>, <span class="string">&#x27;牛奶&#x27;</span>, $r(<span class="string">&quot;app.media.milk&quot;</span>), FoodCategoryEnum.MEAT, <span class="string">&#x27;毫升&#x27;</span>, <span class="number">0.66</span>, <span class="number">0.05</span>, <span class="number">0.03</span>, <span class="number">0.038</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">17</span>, <span class="string">&#x27;酸奶&#x27;</span>, $r(<span class="string">&quot;app.media.yogurt&quot;</span>), FoodCategoryEnum.MEAT, <span class="string">&#x27;毫升&#x27;</span>, <span class="number">0.7</span>, <span class="number">0.10</span>, <span class="number">0.032</span>, <span class="number">0.019</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">18</span>, <span class="string">&#x27;核桃&#x27;</span>, $r(<span class="string">&quot;app.media.walnut&quot;</span>), FoodCategoryEnum.NUT, <span class="string">&#x27;颗&#x27;</span>, <span class="number">42</span>, <span class="number">1.2</span>, <span class="number">1.0</span>, <span class="number">3.8</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">19</span>, <span class="string">&#x27;花生&#x27;</span>, $r(<span class="string">&quot;app.media.peanut&quot;</span>), FoodCategoryEnum.NUT, <span class="string">&#x27;克&#x27;</span>, <span class="number">3.13</span>, <span class="number">0.13</span>, <span class="number">0.12</span>, <span class="number">0.254</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">20</span>, <span class="string">&#x27;腰果&#x27;</span>, $r(<span class="string">&quot;app.media.cashew&quot;</span>), FoodCategoryEnum.NUT, <span class="string">&#x27;克&#x27;</span>, <span class="number">5.59</span>, <span class="number">0.416</span>, <span class="number">0.173</span>, <span class="number">0.367</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">21</span>, <span class="string">&#x27;无糖拿铁&#x27;</span>, $r(<span class="string">&quot;app.media.coffee&quot;</span>), FoodCategoryEnum.OTHER, <span class="string">&#x27;毫升&#x27;</span>, <span class="number">0.43</span>, <span class="number">0.044</span>, <span class="number">0.028</span>, <span class="number">0.016</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">22</span>, <span class="string">&#x27;豆浆&#x27;</span>, $r(<span class="string">&quot;app.media.soybean_milk&quot;</span>), FoodCategoryEnum.OTHER, <span class="string">&#x27;毫升&#x27;</span>, <span class="number">0.31</span>, <span class="number">0.012</span>, <span class="number">0.030</span>, <span class="number">0.016</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> workouts: RecordItem[] = [</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10000</span>, <span class="string">&#x27;散步&#x27;</span>, $r(<span class="string">&#x27;app.media.ic_walk&#x27;</span>), WorkoutCategoryEnum.WALKING, <span class="string">&#x27;小时&#x27;</span>, <span class="number">111</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10001</span>, <span class="string">&#x27;快走&#x27;</span>, $r(<span class="string">&#x27;app.media.ic_walk&#x27;</span>), WorkoutCategoryEnum.WALKING, <span class="string">&#x27;小时&#x27;</span>, <span class="number">343</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10002</span>, <span class="string">&#x27;慢跑&#x27;</span>, $r(<span class="string">&#x27;app.media.ic_running&#x27;</span>), WorkoutCategoryEnum.RUNNING, <span class="string">&#x27;小时&#x27;</span>, <span class="number">472</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10003</span>, <span class="string">&#x27;快跑&#x27;</span>, $r(<span class="string">&#x27;app.media.ic_running&#x27;</span>), WorkoutCategoryEnum.RUNNING, <span class="string">&#x27;小时&#x27;</span>, <span class="number">652</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10004</span>, <span class="string">&#x27;自行车&#x27;</span>, $r(<span class="string">&#x27;app.media.ic_ridding&#x27;</span>), WorkoutCategoryEnum.RIDING, <span class="string">&#x27;小时&#x27;</span>, <span class="number">497</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10005</span>, <span class="string">&#x27;动感单车&#x27;</span>, $r(<span class="string">&#x27;app.media.ic_ridding&#x27;</span>), WorkoutCategoryEnum.RIDING, <span class="string">&#x27;小时&#x27;</span>, <span class="number">587</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10006</span>, <span class="string">&#x27;瑜伽&#x27;</span>, $r(<span class="string">&#x27;app.media.ic_aerobics&#x27;</span>), WorkoutCategoryEnum.AEROBICS, <span class="string">&#x27;小时&#x27;</span>, <span class="number">172</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10007</span>, <span class="string">&#x27;健身操&#x27;</span>, $r(<span class="string">&#x27;app.media.ic_aerobics&#x27;</span>), WorkoutCategoryEnum.AEROBICS, <span class="string">&#x27;小时&#x27;</span>, <span class="number">429</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10008</span>, <span class="string">&#x27;游泳&#x27;</span>, $r(<span class="string">&#x27;app.media.ic_swimming&#x27;</span>), WorkoutCategoryEnum.SWIMMING, <span class="string">&#x27;小时&#x27;</span>, <span class="number">472</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10009</span>, <span class="string">&#x27;冲浪&#x27;</span>, $r(<span class="string">&#x27;app.media.ic_swimming&#x27;</span>), WorkoutCategoryEnum.SWIMMING, <span class="string">&#x27;小时&#x27;</span>, <span class="number">429</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10010</span>, <span class="string">&#x27;篮球&#x27;</span>, $r(<span class="string">&#x27;app.media.ic_basketball&#x27;</span>), WorkoutCategoryEnum.BALLGAME, <span class="string">&#x27;小时&#x27;</span>, <span class="number">472</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10011</span>, <span class="string">&#x27;足球&#x27;</span>, $r(<span class="string">&#x27;app.media.ic_football&#x27;</span>), WorkoutCategoryEnum.BALLGAME, <span class="string">&#x27;小时&#x27;</span>, <span class="number">515</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10012</span>, <span class="string">&#x27;排球&#x27;</span>, $r(<span class="string">&quot;app.media.ic_volleyball&quot;</span>), WorkoutCategoryEnum.BALLGAME, <span class="string">&#x27;小时&#x27;</span>, <span class="number">403</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10013</span>, <span class="string">&#x27;羽毛球&#x27;</span>, $r(<span class="string">&quot;app.media.ic_badminton&quot;</span>), WorkoutCategoryEnum.BALLGAME, <span class="string">&#x27;小时&#x27;</span>, <span class="number">386</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10014</span>, <span class="string">&#x27;乒乓球&#x27;</span>, $r(<span class="string">&quot;app.media.ic_table_tennis&quot;</span>), WorkoutCategoryEnum.BALLGAME, <span class="string">&#x27;小时&#x27;</span>, <span class="number">257</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10015</span>, <span class="string">&#x27;哑铃飞鸟&#x27;</span>, $r(<span class="string">&quot;app.media.ic_dumbbell&quot;</span>), WorkoutCategoryEnum.STRENGTH, <span class="string">&#x27;小时&#x27;</span>, <span class="number">343</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10016</span>, <span class="string">&#x27;哑铃卧推&#x27;</span>, $r(<span class="string">&quot;app.media.ic_dumbbell&quot;</span>), WorkoutCategoryEnum.STRENGTH, <span class="string">&#x27;小时&#x27;</span>, <span class="number">429</span>),</span><br><span class="line">    <span class="keyword">new</span> RecordItem(<span class="number">10017</span>, <span class="string">&#x27;仰卧起坐&#x27;</span>, $r(<span class="string">&quot;app.media.ic_sit_up&quot;</span>), WorkoutCategoryEnum.STRENGTH, <span class="string">&#x27;小时&#x27;</span>, <span class="number">515</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ItemModel</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 根据大类返回对应的所有内容</span></span><br><span class="line">    <span class="function"><span class="title">list</span>(<span class="params">isFood: <span class="built_in">boolean</span></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> isFood ? foods : workouts</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取不同的分类以及分类对应的list</span></span><br><span class="line">    <span class="function"><span class="title">getGroupList</span>(<span class="params">isFood: <span class="built_in">boolean</span></span>)</span> &#123;</span><br><span class="line">        <span class="comment">// 根据是否是食物切换显示不同的类型列表</span></span><br><span class="line">        <span class="keyword">let</span> categories = isFood ? FoodCategories : WorkoutCategories</span><br><span class="line">        <span class="keyword">let</span> items = isFood ? foods : workouts</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 遍历tab类型</span></span><br><span class="line">        <span class="keyword">let</span> data = categories.map(<span class="function"><span class="params">itemCategory</span> =&gt;</span> <span class="keyword">new</span> GroupInfo(itemCategory, []))</span><br><span class="line">        items.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">            data[item.categoryId].items.push(item)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> itemModel = <span class="keyword">new</span> ItemModel()</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> itemModel <span class="keyword">as</span> ItemModel</span><br></pre></td></tr></table></figure>

<p>tab列表页面获取数据后遍历显示不同的页签以及对应的list</p>
<p>ItemTabList.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../../common/constants/CommonConstants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> RecordItem <span class="keyword">from</span> <span class="string">&#x27;../../viewmodel/RecordItem&#x27;</span></span><br><span class="line"><span class="keyword">import</span> itemModel <span class="keyword">from</span> <span class="string">&quot;../../model/ItemModel&quot;</span></span><br><span class="line"><span class="keyword">import</span> GroupInfo <span class="keyword">from</span> <span class="string">&#x27;../../viewmodel/GroupInfo&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct</span><br><span class="line">ItemTabList</span><br><span class="line">&#123;</span><br><span class="line">    onPanelShow:<span class="function">(<span class="params">item: RecordItem</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">        <span class="comment">// 是否是食物类型</span></span><br><span class="line">    <span class="meta">@State</span></span><br><span class="line">    isFood:<span class="built_in">boolean</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column()</span><br><span class="line">        &#123;</span><br><span class="line">            Tabs()</span><br><span class="line">            &#123;</span><br><span class="line">                TabContent()</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">this</span>.TabContentList(itemModel.list(<span class="built_in">this</span>.isFood))</span><br><span class="line">                &#125;</span><br><span class="line">            .</span><br><span class="line">                tabBar(<span class="string">&quot;全部&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 获取不同的分类信息</span></span><br><span class="line">                ForEach(itemModel.getGroupList(<span class="built_in">this</span>.isFood), <span class="function">(<span class="params">groupInfo: GroupInfo</span>) =&gt;</span> &#123;</span><br><span class="line">                    TabContent()</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="built_in">this</span>.TabContentList(groupInfo.items)</span><br><span class="line">                    &#125;</span><br><span class="line">                .</span><br><span class="line">                    tabBar(groupInfo.type.name)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            barMode(BarMode.Scrollable)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        layoutWeight(<span class="number">1</span>)</span><br><span class="line">            .width(CommonConstants.THOUSANDTH_940)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line">    TabContentList(items</span><br><span class="line">:</span><br><span class="line">    RecordItem[]</span><br><span class="line">)</span><br><span class="line">    &#123;</span><br><span class="line">        List(&#123;<span class="attr">space</span>: CommonConstants.SPACE_6&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            ForEach(items, <span class="function">(<span class="params">item: RecordItem</span>) =&gt;</span> &#123;</span><br><span class="line">                ListItem()</span><br><span class="line">                &#123;</span><br><span class="line">                    Row(&#123;<span class="attr">space</span>: CommonConstants.SPACE_4&#125;)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Image(item.image)</span><br><span class="line">                            .width(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">                        Column(&#123;<span class="attr">space</span>: CommonConstants.SPACE_6&#125;)</span><br><span class="line">                        &#123;</span><br><span class="line">                            Text(item.name)</span><br><span class="line">                                .fontWeight(CommonConstants.FONT_WEIGHT_500)</span><br><span class="line">                                .fontSize(<span class="number">14</span>)</span><br><span class="line">                            Text(<span class="string">`<span class="subst">$&#123;item.calorie&#125;</span>千卡 / <span class="subst">$&#123;item.unit&#125;</span>`</span>)</span><br><span class="line">                                .fontSize(<span class="number">12</span>)</span><br><span class="line">                                .fontColor($r(<span class="string">&quot;app.color.gray&quot;</span>))</span><br><span class="line">                                .textAlign(TextAlign.Start)</span><br><span class="line">                        &#125;</span><br><span class="line">                    .</span><br><span class="line">                        alignItems(HorizontalAlign.Start)</span><br><span class="line"></span><br><span class="line">                        Blank()</span><br><span class="line"></span><br><span class="line">                        Image($r(<span class="string">&quot;app.media.ic_public_add_norm_filled&quot;</span>))</span><br><span class="line">                            .width(<span class="number">25</span>)</span><br><span class="line">                            .fillColor($r(<span class="string">&quot;app.color.primary_color&quot;</span>))</span><br><span class="line">                            .interpolation(ImageInterpolation.High)</span><br><span class="line">                    &#125;</span><br><span class="line">                .</span><br><span class="line">                    width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                        .onClick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                            <span class="built_in">this</span>.onPanelShow(item)</span><br><span class="line">                        &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        height(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">            .width(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后点击每一个分类时将当前的分类信息传递给信息展示弹框中</p>
<p>PanelFoodInfo.ets</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;CommonConstants&#125; <span class="keyword">from</span> <span class="string">&#x27;../../common/constants/CommonConstants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> RecordItem <span class="keyword">from</span> <span class="string">&#x27;../../viewmodel/RecordItem&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> struct</span><br><span class="line">PanelFoodInfo</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">@Link</span></span><br><span class="line">    amount</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line"><span class="meta">@Link</span></span><br><span class="line">    recordItem</span><br><span class="line">:</span><br><span class="line">    RecordItem</span><br><span class="line"></span><br><span class="line">    build()</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: CommonConstants.SPACE_10&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Image(<span class="built_in">this</span>.recordItem.image)</span><br><span class="line">                    .width(<span class="number">130</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Row()</span><br><span class="line">            &#123;</span><br><span class="line">                Text(<span class="built_in">this</span>.recordItem.name)</span><br><span class="line">                    .fontWeight(CommonConstants.FONT_WEIGHT_700)</span><br><span class="line">            &#125;</span><br><span class="line">        .</span><br><span class="line">            backgroundColor($r(<span class="string">&quot;app.color.lightest_primary_color&quot;</span>))</span><br><span class="line">                .padding(<span class="number">10</span>)</span><br><span class="line">                .borderRadius(<span class="number">4</span>)</span><br><span class="line">                .margin(&#123;<span class="attr">bottom</span>: <span class="number">10</span>&#125;)</span><br><span class="line"></span><br><span class="line">            Divider().width(CommonConstants.THOUSANDTH_940).opacity(<span class="number">0.6</span>)</span><br><span class="line"></span><br><span class="line">            Row(&#123;<span class="attr">space</span>: CommonConstants.SPACE_10&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">this</span>.NutrientInfo(<span class="string">&quot;热量(千卡)&quot;</span>, <span class="built_in">this</span>.recordItem.calorie)</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.recordItem.id &lt; <span class="number">10000</span>) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.NutrientInfo(<span class="string">&quot;碳水(克)&quot;</span>, <span class="built_in">this</span>.recordItem.carbon)</span><br><span class="line">                    <span class="built_in">this</span>.NutrientInfo(<span class="string">&quot;蛋白质(克)&quot;</span>, <span class="built_in">this</span>.recordItem.protein)</span><br><span class="line">                    <span class="built_in">this</span>.NutrientInfo(<span class="string">&quot;脂肪(克)&quot;</span>, <span class="built_in">this</span>.recordItem.fat)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Divider().width(CommonConstants.THOUSANDTH_940).opacity(<span class="number">0.6</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    .</span><br><span class="line">        margin(&#123;<span class="attr">top</span>: -<span class="number">10</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line">    NutrientInfo(label</span><br><span class="line">:</span><br><span class="line">    <span class="built_in">string</span>, <span class="built_in">number</span></span><br><span class="line">:</span><br><span class="line">    <span class="built_in">number</span></span><br><span class="line">)</span><br><span class="line">    &#123;</span><br><span class="line">        Column(&#123;<span class="attr">space</span>: CommonConstants.SPACE_6&#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            Text(label)</span><br><span class="line">                .fontSize(<span class="number">13</span>)</span><br><span class="line">                .fontColor($r(<span class="string">&quot;app.color.light_gray&quot;</span>))</span><br><span class="line"></span><br><span class="line">            Text(<span class="string">`<span class="subst">$&#123;(<span class="built_in">number</span> * <span class="built_in">this</span>.amount).toFixed(<span class="number">1</span>)&#125;</span>`</span>)</span><br><span class="line">                .fontSize(<span class="number">16</span>)</span><br><span class="line">                .fontWeight(CommonConstants.FONT_WEIGHT_700)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现效果</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/picgo/image-20240410105736295.png" alt="image-20240410105736295"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">SZX</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://songzx0106.github.io/huawei/HarmonyOS4.0/">https://songzx0106.github.io/huawei/HarmonyOS4.0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://SongZX0106.github.io" target="_blank">SZX的开发笔记</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%8D%8E%E4%B8%BA/">华为</a></div><div class="post_share"><div class="social-share" data-image="/images/ys12.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/share.min.css" media="print" onload="this.media='all'"><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/images/wechat.png" target="_blank"><img class="post-qr-code-img" data-lazy-src="/images/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/images/alipay.jpg" target="_blank"><img class="post-qr-code-img" data-lazy-src="/images/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/Vue/%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9%E4%B8%8A%E4%BC%A0/"><img class="prev-cover" data-lazy-src="/images/ys06.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">前端使用Compressor.js实现图片压缩上传</div></div></a></div><div class="next-post pull-right"><a href="/Java/java%E5%AE%9E%E7%8E%B0%E7%9F%AD%E4%BF%A1%E5%8F%91%E9%80%81/"><img class="next-cover" data-lazy-src="/images/ys15.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Java实现短信发送并校验，华为云短信配合Redis实现发送与校验</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="/images/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">SZX</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">157</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">36</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://gitee.com/szxio"><i class="iconfont icon-gitee-fill-round"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">welcome to my blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">1.</span> <span class="toc-text">准备工作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%98%E7%BD%91%E5%9C%B0%E5%9D%80"><span class="toc-number">1.1.</span> <span class="toc-text">官网地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.2.</span> <span class="toc-text">工具下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="toc-number">1.3.</span> <span class="toc-text">入门案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%8E%E4%B8%BA%E6%89%8B%E6%9C%BA%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">华为手机模拟器安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ArkUI%E7%BB%84%E4%BB%B6"><span class="toc-number">3.</span> <span class="toc-text">ArkUI组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Image%E7%BB%84%E4%BB%B6"><span class="toc-number">3.1.</span> <span class="toc-text">Image组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Text%E7%BB%84%E4%BB%B6"><span class="toc-number">3.2.</span> <span class="toc-text">Text组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TextInput%E7%BB%84%E4%BB%B6"><span class="toc-number">3.3.</span> <span class="toc-text">TextInput组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Button%E7%BB%84%E4%BB%B6"><span class="toc-number">3.4.</span> <span class="toc-text">Button组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Slider%E6%BB%91%E5%8A%A8%E6%9D%A1"><span class="toc-number">3.5.</span> <span class="toc-text">Slider滑动条</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Columl%E5%92%8CRow"><span class="toc-number">3.6.</span> <span class="toc-text">Columl和Row</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%9B%BE%E7%89%87%E5%A4%A7%E5%B0%8FDemo"><span class="toc-number">3.7.</span> <span class="toc-text">设置图片大小Demo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#List%E5%92%8CForEach"><span class="toc-number">3.8.</span> <span class="toc-text">List和ForEach</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Toast"><span class="toc-number">3.9.</span> <span class="toc-text">Toast</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6"><span class="toc-number">4.</span> <span class="toc-text">自定义组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E5%87%BD%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">自定义构建函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%84%E5%BB%BA%E5%87%BD%E6%95%B0"><span class="toc-number">5.1.</span> <span class="toc-text">全局自定义构建函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E6%9E%84%E5%BB%BA%E5%87%BD%E6%95%B0"><span class="toc-number">5.2.</span> <span class="toc-text">局部构建函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B7%E5%BC%8F%E5%B0%81%E8%A3%85"><span class="toc-number">6.</span> <span class="toc-text">样式封装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AC%E5%85%B1%E6%A0%B7%E5%BC%8F%E5%B0%81%E8%A3%85"><span class="toc-number">6.1.</span> <span class="toc-text">公共样式封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%B7%E5%BC%8F%E5%B0%81%E8%A3%85"><span class="toc-number">6.2.</span> <span class="toc-text">自定义样式封装</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86"><span class="toc-number">7.</span> <span class="toc-text">状态管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#State"><span class="toc-number">7.1.</span> <span class="toc-text">@State</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E5%88%97%E8%A1%A8Demo"><span class="toc-number">7.2.</span> <span class="toc-text">任务列表Demo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Prop%E5%92%8C-Link"><span class="toc-number">7.3.</span> <span class="toc-text">@Prop和@Link</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Provide%E5%92%8C-Consume"><span class="toc-number">7.4.</span> <span class="toc-text">@Provide和@Consume</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Observed%E5%92%8C-ObjectLink"><span class="toc-number">7.5.</span> <span class="toc-text">@Observed和@ObjectLink</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1"><span class="toc-number">8.</span> <span class="toc-text">页面路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB"><span class="toc-number">9.</span> <span class="toc-text">动画</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E5%8A%A8%E7%94%BB"><span class="toc-number">9.1.</span> <span class="toc-text">属性动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%8A%A8%E7%94%BB"><span class="toc-number">9.2.</span> <span class="toc-text">显示动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB"><span class="toc-number">9.3.</span> <span class="toc-text">组件转场动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%91%87%E6%9D%86%E5%8A%9F%E8%83%BD"><span class="toc-number">9.4.</span> <span class="toc-text">实现摇杆功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Stage%E6%A8%A1%E5%9E%8B"><span class="toc-number">10.</span> <span class="toc-text">Stage模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E4%BB%8B%E7%BB%8D"><span class="toc-number">10.1.</span> <span class="toc-text">文档介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">11.</span> <span class="toc-text">生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E5%8F%8A%E7%BB%84%E4%BB%B6%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">11.1.</span> <span class="toc-text">页面及组件的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%B8%80"><span class="toc-number">11.1.1.</span> <span class="toc-text">案例一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E4%BA%8C"><span class="toc-number">11.1.2.</span> <span class="toc-text">案例二</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UIAbility%E7%9A%84%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">12.</span> <span class="toc-text">UIAbility的启动模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E4%BB%8B%E7%BB%8D"><span class="toc-number">12.1.</span> <span class="toc-text">模式介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E6%BC%94%E7%A4%BA"><span class="toc-number">12.2.</span> <span class="toc-text">案例演示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82"><span class="toc-number">13.</span> <span class="toc-text">网络请求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E7%9A%84Httprequest%E8%AF%B7%E6%B1%82"><span class="toc-number">13.1.</span> <span class="toc-text">内置的Httprequest请求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%86%E5%A4%87node%E6%9C%8D%E5%8A%A1"><span class="toc-number">13.1.1.</span> <span class="toc-text">准备node服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#viewModel"><span class="toc-number">13.1.2.</span> <span class="toc-text">viewModel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#model"><span class="toc-number">13.1.3.</span> <span class="toc-text">model</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pages"><span class="toc-number">13.1.4.</span> <span class="toc-text">pages</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#view"><span class="toc-number">13.1.5.</span> <span class="toc-text">view</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C"><span class="toc-number">13.1.6.</span> <span class="toc-text">实现效果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">13.1.7.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93Axios%E4%BD%BF%E7%94%A8"><span class="toc-number">13.2.</span> <span class="toc-text">第三方库Axios使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85"><span class="toc-number">13.2.1.</span> <span class="toc-text">工具安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85axios"><span class="toc-number">13.2.2.</span> <span class="toc-text">安装axios</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8"><span class="toc-number">13.2.3.</span> <span class="toc-text">项目中使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">14.</span> <span class="toc-text">应用数据持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E9%80%89%E9%A1%B9%E5%AE%9E%E7%8E%B0%E8%BD%BB%E9%87%8F%E7%BA%A7%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">14.1.</span> <span class="toc-text">首选项实现轻量级数据持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E4%BB%8B%E7%BB%8D"><span class="toc-number">14.1.1.</span> <span class="toc-text">场景介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="toc-number">14.1.2.</span> <span class="toc-text">运作机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F%E9%99%90%E5%88%B6"><span class="toc-number">14.1.3.</span> <span class="toc-text">约束限制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">14.1.4.</span> <span class="toc-text">使用方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">14.2.</span> <span class="toc-text">关系型数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E9%A1%B5%E9%9D%A2"><span class="toc-number">14.2.1.</span> <span class="toc-text">新建页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E6%8E%A5%E5%8F%A3%E6%96%B9%E6%B3%95"><span class="toc-number">14.2.2.</span> <span class="toc-text">封装接口方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5"><span class="toc-number">15.</span> <span class="toc-text">通知</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E9%80%9A%E7%9F%A5"><span class="toc-number">15.1.</span> <span class="toc-text">基础通知</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%BA%A6%E6%9D%A1%E9%80%9A%E7%9F%A5"><span class="toc-number">15.2.</span> <span class="toc-text">进度条通知</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%A1%8C%E4%B8%BA%E6%84%8F%E5%9B%BE"><span class="toc-number">15.3.</span> <span class="toc-text">添加行为意图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%91%E9%A9%AC%E5%81%A5%E5%BA%B7%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B"><span class="toc-number">16.</span> <span class="toc-text">黑马健康实战案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AC%A2%E8%BF%8E%E9%A1%B5%E5%AE%9E%E7%8E%B0"><span class="toc-number">16.1.</span> <span class="toc-text">欢迎页实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E5%8D%8F%E8%AE%AE%E5%BC%B9%E6%A1%86"><span class="toc-number">16.2.</span> <span class="toc-text">用户协议弹框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5Tab%E5%AE%9E%E7%8E%B0"><span class="toc-number">16.3.</span> <span class="toc-text">首页Tab实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%B4%E9%83%A8%E6%90%9C%E7%B4%A2%E6%A1%86"><span class="toc-number">16.4.</span> <span class="toc-text">头部搜索框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%A5%E6%9C%9F%E5%BC%B9%E6%A1%86"><span class="toc-number">16.5.</span> <span class="toc-text">日期和日期弹框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF%E5%8D%A1%E7%89%87"><span class="toc-number">16.6.</span> <span class="toc-text">统计信息卡片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E8%AE%B0%E5%BD%95%E5%88%97%E8%A1%A8"><span class="toc-number">16.7.</span> <span class="toc-text">实现记录列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E9%A3%9F%E7%89%A9%E5%88%97%E8%A1%A8%E9%A1%B5%E9%9D%A2"><span class="toc-number">16.8.</span> <span class="toc-text">添加食物列表页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%95%E9%83%A8Panel%E5%AE%9E%E7%8E%B0"><span class="toc-number">16.9.</span> <span class="toc-text">底部Panel实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%95%B0%E5%AD%97%E9%94%AE%E7%9B%98"><span class="toc-number">16.10.</span> <span class="toc-text">实现数字键盘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%AE%BE%E5%A4%87%E5%93%8D%E5%BA%94%E5%BC%8F%E5%BC%80%E5%8F%91"><span class="toc-number">16.11.</span> <span class="toc-text">多设备响应式开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E4%B8%8D%E5%90%8C%E7%9A%84%E8%AE%B0%E5%BD%95%E9%A1%B9"><span class="toc-number">16.12.</span> <span class="toc-text">显示不同的记录项</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Echarts/%E4%B8%96%E7%95%8C%E5%9C%B0%E5%9B%BE/" title="Echarts实现世界地图"><img data-lazy-src="/images/ys11.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Echarts实现世界地图"/></a><div class="content"><a class="title" href="/Echarts/%E4%B8%96%E7%95%8C%E5%9C%B0%E5%9B%BE/" title="Echarts实现世界地图">Echarts实现世界地图</a><time datetime="2025-02-11T01:32:03.000Z" title="发表于 2025-02-11 09:32:03">2025-02-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Vue/%E6%97%A0%E7%95%8C%E5%BE%AE%E5%89%8D%E7%AB%AF/" title="【无界】微前端技术应用"><img data-lazy-src="/images/ys10.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【无界】微前端技术应用"/></a><div class="content"><a class="title" href="/Vue/%E6%97%A0%E7%95%8C%E5%BE%AE%E5%89%8D%E7%AB%AF/" title="【无界】微前端技术应用">【无界】微前端技术应用</a><time datetime="2025-01-17T06:31:13.000Z" title="发表于 2025-01-17 14:31:13">2025-01-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/JavaScript/%E5%9C%A8%E7%BA%BF%E9%A2%84%E8%A7%88HTML%E6%96%87%E4%BB%B6/" title="JS实现在线预览HTML文件"><img data-lazy-src="/images/ys20.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JS实现在线预览HTML文件"/></a><div class="content"><a class="title" href="/JavaScript/%E5%9C%A8%E7%BA%BF%E9%A2%84%E8%A7%88HTML%E6%96%87%E4%BB%B6/" title="JS实现在线预览HTML文件">JS实现在线预览HTML文件</a><time datetime="2024-12-20T05:16:19.000Z" title="发表于 2024-12-20 13:16:19">2024-12-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Java/springboot/aop_log/" title="利用 Spring AOP 实现日志记录"><img data-lazy-src="/images/ys20.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="利用 Spring AOP 实现日志记录"/></a><div class="content"><a class="title" href="/Java/springboot/aop_log/" title="利用 Spring AOP 实现日志记录">利用 Spring AOP 实现日志记录</a><time datetime="2024-12-02T05:14:27.000Z" title="发表于 2024-12-02 13:14:27">2024-12-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Vue/ElementPlus%E5%AE%98%E7%BD%91%E7%9A%84%E9%BB%91%E7%99%BD%E5%88%87%E6%8D%A2%E6%95%88%E6%9E%9C/" title="使用vue3实现element-plus的主题切换特效"><img data-lazy-src="/images/ys16.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用vue3实现element-plus的主题切换特效"/></a><div class="content"><a class="title" href="/Vue/ElementPlus%E5%AE%98%E7%BD%91%E7%9A%84%E9%BB%91%E7%99%BD%E5%88%87%E6%8D%A2%E6%95%88%E6%9E%9C/" title="使用vue3实现element-plus的主题切换特效">使用vue3实现element-plus的主题切换特效</a><time datetime="2024-11-29T02:21:25.000Z" title="发表于 2024-11-29 10:21:25">2024-11-29</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/images/ys12.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By SZX</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">少年辛苦终身事，莫向光阴惰寸功。<a target="_blank" rel="noopener" href="https://gitee.com/szxio">My Gitee</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/instantpage.min.js" type="module"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'iJzt0X9OdhFCcdn4N0dJ86fY-gzGzoHsz',
      appKey: '8vtaRafgQSvU5ntYgszJfRW5',
      placeholder: '留下你的精彩评论',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/canvas-fluttering-ribbon.min.js"></script><script src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://szx-bucket1.oss-cn-hangzhou.aliyuncs.com/js/click-show-text.min.js" data-mobile="true" data-text="富强,民主,文明,和谐,自由,平等,公正,法制,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>